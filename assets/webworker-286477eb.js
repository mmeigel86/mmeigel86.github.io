var o1=Object.defineProperty;var s1=(De,Pe,Le)=>Pe in De?o1(De,Pe,{enumerable:!0,configurable:!0,writable:!0,value:Le}):De[Pe]=Le;var ys=(De,Pe,Le)=>(s1(De,typeof Pe!="symbol"?Pe+"":Pe,Le),Le),$l=(De,Pe,Le)=>{if(!Pe.has(De))throw TypeError("Cannot "+Le)};var Z=(De,Pe,Le)=>($l(De,Pe,"read from private field"),Le?Le.call(De):Pe.get(De)),vt=(De,Pe,Le)=>{if(Pe.has(De))throw TypeError("Cannot add the same private member more than once");Pe instanceof WeakSet?Pe.add(De):Pe.set(De,Le)},Ue=(De,Pe,Le,Gn)=>($l(De,Pe,"write to private field"),Gn?Gn.call(De,Le):Pe.set(De,Le),Le);(function(){var ge,et,dt,Nr,zr,Hr,sr,Gt,Wr,Vr,$r;"use strict";var De=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(n){n=n||{};var n=typeof n<"u"?n:{},i,o;n.ready=new Promise(function(u,l){i=u,o=l});var s=Object.assign({},n),a="./this.program",c=(u,l)=>{throw l},f=typeof window=="object",p=typeof importScripts=="function",v=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function g(u){return n.locateFile?n.locateFile(u,y):y+u}var S,E,k;function C(u){if(u instanceof gs)return;D("exiting due to exception: "+u)}var P,R,O;v?(p?y=require("path").dirname(y)+"/":y=__dirname+"/",O=()=>{R||(P=require("fs"),R=require("path"))},S=function(l,h){return O(),l=R.normalize(l),P.readFileSync(l,h?void 0:"utf8")},k=u=>{var l=S(u,!0);return l.buffer||(l=new Uint8Array(l)),l},E=(u,l,h)=>{O(),u=R.normalize(u),P.readFile(u,function(d,m){d?h(d):l(m.buffer)})},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(u){if(!(u instanceof gs))throw u}),process.on("unhandledRejection",function(u){throw u}),c=(u,l)=>{if(gl())throw process.exitCode=u,l;C(l),process.exit(u)},n.inspect=function(){return"[Emscripten Module object]"}):(f||p)&&(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),r&&(y=r),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",S=u=>{var l=new XMLHttpRequest;return l.open("GET",u,!1),l.send(null),l.responseText},p&&(k=u=>{var l=new XMLHttpRequest;return l.open("GET",u,!1),l.responseType="arraybuffer",l.send(null),new Uint8Array(l.response)}),E=(u,l,h)=>{var d=new XMLHttpRequest;d.open("GET",u,!0),d.responseType="arraybuffer",d.onload=()=>{if(d.status==200||d.status==0&&d.response){l(d.response);return}h()},d.onerror=h,d.send(null)});var q=n.print||console.log.bind(console),D=n.printErr||console.warn.bind(console);Object.assign(n,s),s=null,n.arguments&&n.arguments,n.thisProgram&&(a=n.thisProgram),n.quit&&(c=n.quit);var K=4,H;n.wasmBinary&&(H=n.wasmBinary);var V=n.noExitRuntime||!0;typeof WebAssembly!="object"&&ur("no native wasm support detected");var ee,te=!1;function pe(u,l){u||ur(l)}var de=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function we(u,l,h){for(var d=l+h,m=l;u[m]&&!(m>=d);)++m;if(m-l>16&&u.buffer&&de)return de.decode(u.subarray(l,m));for(var b="";l<m;){var x=u[l++];if(!(x&128)){b+=String.fromCharCode(x);continue}var _=u[l++]&63;if((x&224)==192){b+=String.fromCharCode((x&31)<<6|_);continue}var T=u[l++]&63;if((x&240)==224?x=(x&15)<<12|_<<6|T:x=(x&7)<<18|_<<12|T<<6|u[l++]&63,x<65536)b+=String.fromCharCode(x);else{var M=x-65536;b+=String.fromCharCode(55296|M>>10,56320|M&1023)}}return b}function se(u,l){return u?we(tt,u,l):""}function Ee(u,l,h,d){if(!(d>0))return 0;for(var m=h,b=h+d-1,x=0;x<u.length;++x){var _=u.charCodeAt(x);if(_>=55296&&_<=57343){var T=u.charCodeAt(++x);_=65536+((_&1023)<<10)|T&1023}if(_<=127){if(h>=b)break;l[h++]=_}else if(_<=2047){if(h+1>=b)break;l[h++]=192|_>>6,l[h++]=128|_&63}else if(_<=65535){if(h+2>=b)break;l[h++]=224|_>>12,l[h++]=128|_>>6&63,l[h++]=128|_&63}else{if(h+3>=b)break;l[h++]=240|_>>18,l[h++]=128|_>>12&63,l[h++]=128|_>>6&63,l[h++]=128|_&63}}return l[h]=0,h-m}function Ne(u,l,h){return Ee(u,tt,l,h)}function be(u){for(var l=0,h=0;h<u.length;++h){var d=u.charCodeAt(h);d>=55296&&d<=57343&&(d=65536+((d&1023)<<10)|u.charCodeAt(++h)&1023),d<=127?++l:d<=2047?l+=2:d<=65535?l+=3:l+=4}return l}var Te=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ye(u,l){for(var h=u,d=h>>1,m=d+l/2;!(d>=m)&&Rn[d];)++d;if(h=d<<1,h-u>32&&Te)return Te.decode(tt.subarray(u,h));for(var b="",x=0;!(x>=l/2);++x){var _=ar[u+x*2>>1];if(_==0)break;b+=String.fromCharCode(_)}return b}function it(u,l,h){if(h===void 0&&(h=2147483647),h<2)return 0;h-=2;for(var d=l,m=h<u.length*2?h/2:u.length,b=0;b<m;++b){var x=u.charCodeAt(b);ar[l>>1]=x,l+=2}return ar[l>>1]=0,l-d}function ke(u){return u.length*2}function Ve(u,l){for(var h=0,d="";!(h>=l/4);){var m=G[u+h*4>>2];if(m==0)break;if(++h,m>=65536){var b=m-65536;d+=String.fromCharCode(55296|b>>10,56320|b&1023)}else d+=String.fromCharCode(m)}return d}function An(u,l,h){if(h===void 0&&(h=2147483647),h<4)return 0;for(var d=l,m=d+h-4,b=0;b<u.length;++b){var x=u.charCodeAt(b);if(x>=55296&&x<=57343){var _=u.charCodeAt(++b);x=65536+((x&1023)<<10)|_&1023}if(G[l>>2]=x,l+=4,l+4>m)break}return G[l>>2]=0,l-d}function Qo(u){for(var l=0,h=0;h<u.length;++h){var d=u.charCodeAt(h);d>=55296&&d<=57343&&++h,l+=4}return l}function Ri(u){var l=be(u)+1,h=$t(l);return h&&Ee(u,je,h,l),h}function Mn(u,l){je.set(u,l)}function Oi(u,l,h){for(var d=0;d<u.length;++d)je[l++>>0]=u.charCodeAt(d);h||(je[l>>0]=0)}var Nt,je,tt,ar,Rn,G,ue,xt,cl;function fl(u){Nt=u,n.HEAP8=je=new Int8Array(u),n.HEAP16=ar=new Int16Array(u),n.HEAP32=G=new Int32Array(u),n.HEAPU8=tt=new Uint8Array(u),n.HEAPU16=Rn=new Uint16Array(u),n.HEAPU32=ue=new Uint32Array(u),n.HEAPF32=xt=new Float32Array(u),n.HEAPF64=cl=new Float64Array(u)}n.INITIAL_MEMORY;var hl,pl=[],dl=[],vl=[];function gl(){return V}function Eg(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Cg(n.preRun.shift());es(pl)}function Tg(){!n.noFSInit&&!w.init.initialized&&w.init(),w.ignorePermissions=!1,es(dl)}function kg(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)Ag(n.postRun.shift());es(vl)}function Cg(u){pl.unshift(u)}function Pg(u){dl.unshift(u)}function Ag(u){vl.unshift(u)}var yr=0,On=null;function a1(u){return u}function Jo(u){yr++,n.monitorRunDependencies&&n.monitorRunDependencies(yr)}function Di(u){if(yr--,n.monitorRunDependencies&&n.monitorRunDependencies(yr),yr==0&&On){var l=On;On=null,l()}}function ur(u){n.onAbort&&n.onAbort(u),u="Aborted("+u+")",D(u),te=!0,u+=". Build with -sASSERTIONS for more info.";var l=new WebAssembly.RuntimeError(u);throw o(l),l}var Mg="data:application/octet-stream;base64,";function ml(u){return u.startsWith(Mg)}function yl(u){return u.startsWith("file://")}var st;st="replicad_single.wasm",ml(st)||(st=g(st));function wl(u){try{if(u==st&&H)return new Uint8Array(H);if(k)return k(u);throw"both async and sync fetching of the wasm failed"}catch(l){ur(l)}}function Rg(){if(!H&&(f||p)){if(typeof fetch=="function"&&!yl(st))return fetch(st,{credentials:"same-origin"}).then(function(u){if(!u.ok)throw"failed to load wasm binary file at '"+st+"'";return u.arrayBuffer()}).catch(function(){return wl(st)});if(E)return new Promise(function(u,l){E(st,function(h){u(new Uint8Array(h))},l)})}return Promise.resolve().then(function(){return wl(st)})}function Og(){var u={a:r1};function l(x,_){var T=x.exports;n.asm=T,ee=n.asm.oa,fl(ee.buffer),hl=n.asm.va,Pg(n.asm.pa),Di()}Jo();function h(x){l(x.instance)}function d(x){return Rg().then(function(_){return WebAssembly.instantiate(_,u)}).then(function(_){return _}).then(x,function(_){D("failed to asynchronously prepare wasm: "+_),ur(_)})}function m(){return!H&&typeof WebAssembly.instantiateStreaming=="function"&&!ml(st)&&!yl(st)&&!v&&typeof fetch=="function"?fetch(st,{credentials:"same-origin"}).then(function(x){var _=WebAssembly.instantiateStreaming(x,u);return _.then(h,function(T){return D("wasm streaming compile failed: "+T),D("falling back to ArrayBuffer instantiation"),d(h)})}):d(h)}if(n.instantiateWasm)try{var b=n.instantiateWasm(u,l);return b}catch(x){return D("Module.instantiateWasm callback failed with error: "+x),!1}return m().catch(o),{}}var Xe,zt;function Dg(){return n.HEAP8.length}function es(u){for(;u.length>0;){var l=u.shift();if(typeof l=="function"){l(n);continue}var h=l.func;typeof h=="number"?l.arg===void 0?Ui(h)():Ui(h)(l.arg):h(l.arg===void 0?null:l.arg)}}var Fi=[];function Ui(u){var l=Fi[u];return l||(u>=Fi.length&&(Fi.length=u+1),Fi[u]=l=hl.get(u)),l}function Fg(u,l,h,d){ur("Assertion failed: "+se(u)+", at: "+[l?se(l):"unknown filename",h,d?se(d):"unknown function"])}function Ug(u){return $t(u+24)+24}function Lg(u){this.excPtr=u,this.ptr=u-24,this.set_type=function(l){ue[this.ptr+4>>2]=l},this.get_type=function(){return ue[this.ptr+4>>2]},this.set_destructor=function(l){ue[this.ptr+8>>2]=l},this.get_destructor=function(){return ue[this.ptr+8>>2]},this.set_refcount=function(l){G[this.ptr>>2]=l},this.set_caught=function(l){l=l?1:0,je[this.ptr+12>>0]=l},this.get_caught=function(){return je[this.ptr+12>>0]!=0},this.set_rethrown=function(l){l=l?1:0,je[this.ptr+13>>0]=l},this.get_rethrown=function(){return je[this.ptr+13>>0]!=0},this.init=function(l,h){this.set_adjusted_ptr(0),this.set_type(l),this.set_destructor(h),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var l=G[this.ptr>>2];G[this.ptr>>2]=l+1},this.release_ref=function(){var l=G[this.ptr>>2];return G[this.ptr>>2]=l-1,l===1},this.set_adjusted_ptr=function(l){ue[this.ptr+16>>2]=l},this.get_adjusted_ptr=function(){return ue[this.ptr+16>>2]},this.get_exception_ptr=function(){var l=Vl(this.get_type());if(l)return ue[this.excPtr>>2];var h=this.get_adjusted_ptr();return h!==0?h:this.excPtr}}function Bg(u,l,h){var d=new Lg(u);throw d.init(l,h),u}var le={isAbs:u=>u.charAt(0)==="/",splitPath:u=>{var l=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return l.exec(u).slice(1)},normalizeArray:(u,l)=>{for(var h=0,d=u.length-1;d>=0;d--){var m=u[d];m==="."?u.splice(d,1):m===".."?(u.splice(d,1),h++):h&&(u.splice(d,1),h--)}if(l)for(;h;h--)u.unshift("..");return u},normalize:u=>{var l=le.isAbs(u),h=u.substr(-1)==="/";return u=le.normalizeArray(u.split("/").filter(d=>!!d),!l).join("/"),!u&&!l&&(u="."),u&&h&&(u+="/"),(l?"/":"")+u},dirname:u=>{var l=le.splitPath(u),h=l[0],d=l[1];return!h&&!d?".":(d&&(d=d.substr(0,d.length-1)),h+d)},basename:u=>{if(u==="/")return"/";u=le.normalize(u),u=u.replace(/\/$/,"");var l=u.lastIndexOf("/");return l===-1?u:u.substr(l+1)},join:function(){var u=Array.prototype.slice.call(arguments,0);return le.normalize(u.join("/"))},join2:(u,l)=>le.normalize(u+"/"+l)};function Ig(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var u=new Uint8Array(1);return function(){return crypto.getRandomValues(u),u[0]}}else if(v)try{var l=require("crypto");return function(){return l.randomBytes(1)[0]}}catch{}return function(){ur("randomDevice")}}var Ht={resolve:function(){for(var u="",l=!1,h=arguments.length-1;h>=-1&&!l;h--){var d=h>=0?arguments[h]:w.cwd();if(typeof d!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!d)return"";u=d+"/"+u,l=le.isAbs(d)}return u=le.normalizeArray(u.split("/").filter(m=>!!m),!l).join("/"),(l?"/":"")+u||"."},relative:(u,l)=>{u=Ht.resolve(u).substr(1),l=Ht.resolve(l).substr(1);function h(M){for(var B=0;B<M.length&&M[B]==="";B++);for(var I=M.length-1;I>=0&&M[I]==="";I--);return B>I?[]:M.slice(B,I-B+1)}for(var d=h(u.split("/")),m=h(l.split("/")),b=Math.min(d.length,m.length),x=b,_=0;_<b;_++)if(d[_]!==m[_]){x=_;break}for(var T=[],_=x;_<d.length;_++)T.push("..");return T=T.concat(m.slice(x)),T.join("/")}},wr={ttys:[],init:function(){},shutdown:function(){},register:function(u,l){wr.ttys[u]={input:[],output:[],ops:l},w.registerDevice(u,wr.stream_ops)},stream_ops:{open:function(u){var l=wr.ttys[u.node.rdev];if(!l)throw new w.ErrnoError(43);u.tty=l,u.seekable=!1},close:function(u){u.tty.ops.flush(u.tty)},flush:function(u){u.tty.ops.flush(u.tty)},read:function(u,l,h,d,m){if(!u.tty||!u.tty.ops.get_char)throw new w.ErrnoError(60);for(var b=0,x=0;x<d;x++){var _;try{_=u.tty.ops.get_char(u.tty)}catch{throw new w.ErrnoError(29)}if(_===void 0&&b===0)throw new w.ErrnoError(6);if(_==null)break;b++,l[h+x]=_}return b&&(u.node.timestamp=Date.now()),b},write:function(u,l,h,d,m){if(!u.tty||!u.tty.ops.put_char)throw new w.ErrnoError(60);try{for(var b=0;b<d;b++)u.tty.ops.put_char(u.tty,l[h+b])}catch{throw new w.ErrnoError(29)}return d&&(u.node.timestamp=Date.now()),b}},default_tty_ops:{get_char:function(u){if(!u.input.length){var l=null;if(v){var h=256,d=Buffer.alloc(h),m=0;try{m=P.readSync(process.stdin.fd,d,0,h,-1)}catch(b){if(b.toString().includes("EOF"))m=0;else throw b}m>0?l=d.slice(0,m).toString("utf-8"):l=null}else typeof window<"u"&&typeof window.prompt=="function"?(l=window.prompt("Input: "),l!==null&&(l+=`
`)):typeof readline=="function"&&(l=readline(),l!==null&&(l+=`
`));if(!l)return null;u.input=Zi(l,!0)}return u.input.shift()},put_char:function(u,l){l===null||l===10?(q(we(u.output,0)),u.output=[]):l!=0&&u.output.push(l)},flush:function(u){u.output&&u.output.length>0&&(q(we(u.output,0)),u.output=[])}},default_tty1_ops:{put_char:function(u,l){l===null||l===10?(D(we(u.output,0)),u.output=[]):l!=0&&u.output.push(l)},flush:function(u){u.output&&u.output.length>0&&(D(we(u.output,0)),u.output=[])}}};function Gg(u,l){tt.fill(0,u,u+l)}function Ng(u,l){return Math.ceil(u/l)*l}function bl(u){u=Ng(u,65536);var l=Wl(65536,u);return l?(Gg(l,u),l):0}var ne={ops_table:null,mount:function(u){return ne.createNode(null,"/",16895,0)},createNode:function(u,l,h,d){if(w.isBlkdev(h)||w.isFIFO(h))throw new w.ErrnoError(63);ne.ops_table||(ne.ops_table={dir:{node:{getattr:ne.node_ops.getattr,setattr:ne.node_ops.setattr,lookup:ne.node_ops.lookup,mknod:ne.node_ops.mknod,rename:ne.node_ops.rename,unlink:ne.node_ops.unlink,rmdir:ne.node_ops.rmdir,readdir:ne.node_ops.readdir,symlink:ne.node_ops.symlink},stream:{llseek:ne.stream_ops.llseek}},file:{node:{getattr:ne.node_ops.getattr,setattr:ne.node_ops.setattr},stream:{llseek:ne.stream_ops.llseek,read:ne.stream_ops.read,write:ne.stream_ops.write,allocate:ne.stream_ops.allocate,mmap:ne.stream_ops.mmap,msync:ne.stream_ops.msync}},link:{node:{getattr:ne.node_ops.getattr,setattr:ne.node_ops.setattr,readlink:ne.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ne.node_ops.getattr,setattr:ne.node_ops.setattr},stream:w.chrdev_stream_ops}});var m=w.createNode(u,l,h,d);return w.isDir(m.mode)?(m.node_ops=ne.ops_table.dir.node,m.stream_ops=ne.ops_table.dir.stream,m.contents={}):w.isFile(m.mode)?(m.node_ops=ne.ops_table.file.node,m.stream_ops=ne.ops_table.file.stream,m.usedBytes=0,m.contents=null):w.isLink(m.mode)?(m.node_ops=ne.ops_table.link.node,m.stream_ops=ne.ops_table.link.stream):w.isChrdev(m.mode)&&(m.node_ops=ne.ops_table.chrdev.node,m.stream_ops=ne.ops_table.chrdev.stream),m.timestamp=Date.now(),u&&(u.contents[l]=m,u.timestamp=m.timestamp),m},getFileDataAsTypedArray:function(u){return u.contents?u.contents.subarray?u.contents.subarray(0,u.usedBytes):new Uint8Array(u.contents):new Uint8Array(0)},expandFileStorage:function(u,l){var h=u.contents?u.contents.length:0;if(!(h>=l)){var d=1024*1024;l=Math.max(l,h*(h<d?2:1.125)>>>0),h!=0&&(l=Math.max(l,256));var m=u.contents;u.contents=new Uint8Array(l),u.usedBytes>0&&u.contents.set(m.subarray(0,u.usedBytes),0)}},resizeFileStorage:function(u,l){if(u.usedBytes!=l)if(l==0)u.contents=null,u.usedBytes=0;else{var h=u.contents;u.contents=new Uint8Array(l),h&&u.contents.set(h.subarray(0,Math.min(l,u.usedBytes))),u.usedBytes=l}},node_ops:{getattr:function(u){var l={};return l.dev=w.isChrdev(u.mode)?u.id:1,l.ino=u.id,l.mode=u.mode,l.nlink=1,l.uid=0,l.gid=0,l.rdev=u.rdev,w.isDir(u.mode)?l.size=4096:w.isFile(u.mode)?l.size=u.usedBytes:w.isLink(u.mode)?l.size=u.link.length:l.size=0,l.atime=new Date(u.timestamp),l.mtime=new Date(u.timestamp),l.ctime=new Date(u.timestamp),l.blksize=4096,l.blocks=Math.ceil(l.size/l.blksize),l},setattr:function(u,l){l.mode!==void 0&&(u.mode=l.mode),l.timestamp!==void 0&&(u.timestamp=l.timestamp),l.size!==void 0&&ne.resizeFileStorage(u,l.size)},lookup:function(u,l){throw w.genericErrors[44]},mknod:function(u,l,h,d){return ne.createNode(u,l,h,d)},rename:function(u,l,h){if(w.isDir(u.mode)){var d;try{d=w.lookupNode(l,h)}catch{}if(d)for(var m in d.contents)throw new w.ErrnoError(55)}delete u.parent.contents[u.name],u.parent.timestamp=Date.now(),u.name=h,l.contents[h]=u,l.timestamp=u.parent.timestamp,u.parent=l},unlink:function(u,l){delete u.contents[l],u.timestamp=Date.now()},rmdir:function(u,l){var h=w.lookupNode(u,l);for(var d in h.contents)throw new w.ErrnoError(55);delete u.contents[l],u.timestamp=Date.now()},readdir:function(u){var l=[".",".."];for(var h in u.contents)u.contents.hasOwnProperty(h)&&l.push(h);return l},symlink:function(u,l,h){var d=ne.createNode(u,l,41471,0);return d.link=h,d},readlink:function(u){if(!w.isLink(u.mode))throw new w.ErrnoError(28);return u.link}},stream_ops:{read:function(u,l,h,d,m){var b=u.node.contents;if(m>=u.node.usedBytes)return 0;var x=Math.min(u.node.usedBytes-m,d);if(x>8&&b.subarray)l.set(b.subarray(m,m+x),h);else for(var _=0;_<x;_++)l[h+_]=b[m+_];return x},write:function(u,l,h,d,m,b){if(l.buffer===je.buffer&&(b=!1),!d)return 0;var x=u.node;if(x.timestamp=Date.now(),l.subarray&&(!x.contents||x.contents.subarray)){if(b)return x.contents=l.subarray(h,h+d),x.usedBytes=d,d;if(x.usedBytes===0&&m===0)return x.contents=l.slice(h,h+d),x.usedBytes=d,d;if(m+d<=x.usedBytes)return x.contents.set(l.subarray(h,h+d),m),d}if(ne.expandFileStorage(x,m+d),x.contents.subarray&&l.subarray)x.contents.set(l.subarray(h,h+d),m);else for(var _=0;_<d;_++)x.contents[m+_]=l[h+_];return x.usedBytes=Math.max(x.usedBytes,m+d),d},llseek:function(u,l,h){var d=l;if(h===1?d+=u.position:h===2&&w.isFile(u.node.mode)&&(d+=u.node.usedBytes),d<0)throw new w.ErrnoError(28);return d},allocate:function(u,l,h){ne.expandFileStorage(u.node,l+h),u.node.usedBytes=Math.max(u.node.usedBytes,l+h)},mmap:function(u,l,h,d,m){if(!w.isFile(u.node.mode))throw new w.ErrnoError(43);var b,x,_=u.node.contents;if(!(m&2)&&_.buffer===Nt)x=!1,b=_.byteOffset;else{if((h>0||h+l<_.length)&&(_.subarray?_=_.subarray(h,h+l):_=Array.prototype.slice.call(_,h,h+l)),x=!0,b=bl(l),!b)throw new w.ErrnoError(48);je.set(_,b)}return{ptr:b,allocated:x}},msync:function(u,l,h,d,m){if(!w.isFile(u.node.mode))throw new w.ErrnoError(43);return m&2||ne.stream_ops.write(u,l,0,d,h,!1),0}}};function zg(u,l,h,d){var m=d?"":"al "+u;E(u,function(b){pe(b,'Loading data file "'+u+'" failed (no arrayBuffer).'),l(new Uint8Array(b)),m&&Di()},function(b){if(h)h();else throw'Loading data file "'+u+'" failed.'}),m&&Jo()}var w={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(u,l={})=>{if(u=Ht.resolve(w.cwd(),u),!u)return{path:"",node:null};var h={follow_mount:!0,recurse_count:0};if(l=Object.assign(h,l),l.recurse_count>8)throw new w.ErrnoError(32);for(var d=le.normalizeArray(u.split("/").filter(I=>!!I),!1),m=w.root,b="/",x=0;x<d.length;x++){var _=x===d.length-1;if(_&&l.parent)break;if(m=w.lookupNode(m,d[x]),b=le.join2(b,d[x]),w.isMountpoint(m)&&(!_||_&&l.follow_mount)&&(m=m.mounted.root),!_||l.follow)for(var T=0;w.isLink(m.mode);){var M=w.readlink(b);b=Ht.resolve(le.dirname(b),M);var B=w.lookupPath(b,{recurse_count:l.recurse_count+1});if(m=B.node,T++>40)throw new w.ErrnoError(32)}}return{path:b,node:m}},getPath:u=>{for(var l;;){if(w.isRoot(u)){var h=u.mount.mountpoint;return l?h[h.length-1]!=="/"?h+"/"+l:h+l:h}l=l?u.name+"/"+l:u.name,u=u.parent}},hashName:(u,l)=>{for(var h=0,d=0;d<l.length;d++)h=(h<<5)-h+l.charCodeAt(d)|0;return(u+h>>>0)%w.nameTable.length},hashAddNode:u=>{var l=w.hashName(u.parent.id,u.name);u.name_next=w.nameTable[l],w.nameTable[l]=u},hashRemoveNode:u=>{var l=w.hashName(u.parent.id,u.name);if(w.nameTable[l]===u)w.nameTable[l]=u.name_next;else for(var h=w.nameTable[l];h;){if(h.name_next===u){h.name_next=u.name_next;break}h=h.name_next}},lookupNode:(u,l)=>{var h=w.mayLookup(u);if(h)throw new w.ErrnoError(h,u);for(var d=w.hashName(u.id,l),m=w.nameTable[d];m;m=m.name_next){var b=m.name;if(m.parent.id===u.id&&b===l)return m}return w.lookup(u,l)},createNode:(u,l,h,d)=>{var m=new w.FSNode(u,l,h,d);return w.hashAddNode(m),m},destroyNode:u=>{w.hashRemoveNode(u)},isRoot:u=>u===u.parent,isMountpoint:u=>!!u.mounted,isFile:u=>(u&61440)===32768,isDir:u=>(u&61440)===16384,isLink:u=>(u&61440)===40960,isChrdev:u=>(u&61440)===8192,isBlkdev:u=>(u&61440)===24576,isFIFO:u=>(u&61440)===4096,isSocket:u=>(u&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:u=>{var l=w.flagModes[u];if(typeof l>"u")throw new Error("Unknown file open mode: "+u);return l},flagsToPermissionString:u=>{var l=["r","w","rw"][u&3];return u&512&&(l+="w"),l},nodePermissions:(u,l)=>w.ignorePermissions?0:l.includes("r")&&!(u.mode&292)||l.includes("w")&&!(u.mode&146)||l.includes("x")&&!(u.mode&73)?2:0,mayLookup:u=>{var l=w.nodePermissions(u,"x");return l||(u.node_ops.lookup?0:2)},mayCreate:(u,l)=>{try{var h=w.lookupNode(u,l);return 20}catch{}return w.nodePermissions(u,"wx")},mayDelete:(u,l,h)=>{var d;try{d=w.lookupNode(u,l)}catch(b){return b.errno}var m=w.nodePermissions(u,"wx");if(m)return m;if(h){if(!w.isDir(d.mode))return 54;if(w.isRoot(d)||w.getPath(d)===w.cwd())return 10}else if(w.isDir(d.mode))return 31;return 0},mayOpen:(u,l)=>u?w.isLink(u.mode)?32:w.isDir(u.mode)&&(w.flagsToPermissionString(l)!=="r"||l&512)?31:w.nodePermissions(u,w.flagsToPermissionString(l)):44,MAX_OPEN_FDS:4096,nextfd:(u=0,l=w.MAX_OPEN_FDS)=>{for(var h=u;h<=l;h++)if(!w.streams[h])return h;throw new w.ErrnoError(33)},getStream:u=>w.streams[u],createStream:(u,l,h)=>{w.FSStream||(w.FSStream=function(){this.shared={}},w.FSStream.prototype={},Object.defineProperties(w.FSStream.prototype,{object:{get:function(){return this.node},set:function(m){this.node=m}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(m){this.shared.flags=m}},position:{get:function(){return this.shared.position},set:function(m){this.shared.position=m}}})),u=Object.assign(new w.FSStream,u);var d=w.nextfd(l,h);return u.fd=d,w.streams[d]=u,u},closeStream:u=>{w.streams[u]=null},chrdev_stream_ops:{open:u=>{var l=w.getDevice(u.node.rdev);u.stream_ops=l.stream_ops,u.stream_ops.open&&u.stream_ops.open(u)},llseek:()=>{throw new w.ErrnoError(70)}},major:u=>u>>8,minor:u=>u&255,makedev:(u,l)=>u<<8|l,registerDevice:(u,l)=>{w.devices[u]={stream_ops:l}},getDevice:u=>w.devices[u],getMounts:u=>{for(var l=[],h=[u];h.length;){var d=h.pop();l.push(d),h.push.apply(h,d.mounts)}return l},syncfs:(u,l)=>{typeof u=="function"&&(l=u,u=!1),w.syncFSRequests++,w.syncFSRequests>1&&D("warning: "+w.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var h=w.getMounts(w.root.mount),d=0;function m(x){return w.syncFSRequests--,l(x)}function b(x){if(x)return b.errored?void 0:(b.errored=!0,m(x));++d>=h.length&&m(null)}h.forEach(x=>{if(!x.type.syncfs)return b(null);x.type.syncfs(x,u,b)})},mount:(u,l,h)=>{var d=h==="/",m=!h,b;if(d&&w.root)throw new w.ErrnoError(10);if(!d&&!m){var x=w.lookupPath(h,{follow_mount:!1});if(h=x.path,b=x.node,w.isMountpoint(b))throw new w.ErrnoError(10);if(!w.isDir(b.mode))throw new w.ErrnoError(54)}var _={type:u,opts:l,mountpoint:h,mounts:[]},T=u.mount(_);return T.mount=_,_.root=T,d?w.root=T:b&&(b.mounted=_,b.mount&&b.mount.mounts.push(_)),T},unmount:u=>{var l=w.lookupPath(u,{follow_mount:!1});if(!w.isMountpoint(l.node))throw new w.ErrnoError(28);var h=l.node,d=h.mounted,m=w.getMounts(d);Object.keys(w.nameTable).forEach(x=>{for(var _=w.nameTable[x];_;){var T=_.name_next;m.includes(_.mount)&&w.destroyNode(_),_=T}}),h.mounted=null;var b=h.mount.mounts.indexOf(d);h.mount.mounts.splice(b,1)},lookup:(u,l)=>u.node_ops.lookup(u,l),mknod:(u,l,h)=>{var d=w.lookupPath(u,{parent:!0}),m=d.node,b=le.basename(u);if(!b||b==="."||b==="..")throw new w.ErrnoError(28);var x=w.mayCreate(m,b);if(x)throw new w.ErrnoError(x);if(!m.node_ops.mknod)throw new w.ErrnoError(63);return m.node_ops.mknod(m,b,l,h)},create:(u,l)=>(l=l!==void 0?l:438,l&=4095,l|=32768,w.mknod(u,l,0)),mkdir:(u,l)=>(l=l!==void 0?l:511,l&=1023,l|=16384,w.mknod(u,l,0)),mkdirTree:(u,l)=>{for(var h=u.split("/"),d="",m=0;m<h.length;++m)if(h[m]){d+="/"+h[m];try{w.mkdir(d,l)}catch(b){if(b.errno!=20)throw b}}},mkdev:(u,l,h)=>(typeof h>"u"&&(h=l,l=438),l|=8192,w.mknod(u,l,h)),symlink:(u,l)=>{if(!Ht.resolve(u))throw new w.ErrnoError(44);var h=w.lookupPath(l,{parent:!0}),d=h.node;if(!d)throw new w.ErrnoError(44);var m=le.basename(l),b=w.mayCreate(d,m);if(b)throw new w.ErrnoError(b);if(!d.node_ops.symlink)throw new w.ErrnoError(63);return d.node_ops.symlink(d,m,u)},rename:(u,l)=>{var h=le.dirname(u),d=le.dirname(l),m=le.basename(u),b=le.basename(l),x,_,T;if(x=w.lookupPath(u,{parent:!0}),_=x.node,x=w.lookupPath(l,{parent:!0}),T=x.node,!_||!T)throw new w.ErrnoError(44);if(_.mount!==T.mount)throw new w.ErrnoError(75);var M=w.lookupNode(_,m),B=Ht.relative(u,d);if(B.charAt(0)!==".")throw new w.ErrnoError(28);if(B=Ht.relative(l,h),B.charAt(0)!==".")throw new w.ErrnoError(55);var I;try{I=w.lookupNode(T,b)}catch{}if(M!==I){var U=w.isDir(M.mode),N=w.mayDelete(_,m,U);if(N)throw new w.ErrnoError(N);if(N=I?w.mayDelete(T,b,U):w.mayCreate(T,b),N)throw new w.ErrnoError(N);if(!_.node_ops.rename)throw new w.ErrnoError(63);if(w.isMountpoint(M)||I&&w.isMountpoint(I))throw new w.ErrnoError(10);if(T!==_&&(N=w.nodePermissions(_,"w"),N))throw new w.ErrnoError(N);w.hashRemoveNode(M);try{_.node_ops.rename(M,T,b)}catch(j){throw j}finally{w.hashAddNode(M)}}},rmdir:u=>{var l=w.lookupPath(u,{parent:!0}),h=l.node,d=le.basename(u),m=w.lookupNode(h,d),b=w.mayDelete(h,d,!0);if(b)throw new w.ErrnoError(b);if(!h.node_ops.rmdir)throw new w.ErrnoError(63);if(w.isMountpoint(m))throw new w.ErrnoError(10);h.node_ops.rmdir(h,d),w.destroyNode(m)},readdir:u=>{var l=w.lookupPath(u,{follow:!0}),h=l.node;if(!h.node_ops.readdir)throw new w.ErrnoError(54);return h.node_ops.readdir(h)},unlink:u=>{var l=w.lookupPath(u,{parent:!0}),h=l.node;if(!h)throw new w.ErrnoError(44);var d=le.basename(u),m=w.lookupNode(h,d),b=w.mayDelete(h,d,!1);if(b)throw new w.ErrnoError(b);if(!h.node_ops.unlink)throw new w.ErrnoError(63);if(w.isMountpoint(m))throw new w.ErrnoError(10);h.node_ops.unlink(h,d),w.destroyNode(m)},readlink:u=>{var l=w.lookupPath(u),h=l.node;if(!h)throw new w.ErrnoError(44);if(!h.node_ops.readlink)throw new w.ErrnoError(28);return Ht.resolve(w.getPath(h.parent),h.node_ops.readlink(h))},stat:(u,l)=>{var h=w.lookupPath(u,{follow:!l}),d=h.node;if(!d)throw new w.ErrnoError(44);if(!d.node_ops.getattr)throw new w.ErrnoError(63);return d.node_ops.getattr(d)},lstat:u=>w.stat(u,!0),chmod:(u,l,h)=>{var d;if(typeof u=="string"){var m=w.lookupPath(u,{follow:!h});d=m.node}else d=u;if(!d.node_ops.setattr)throw new w.ErrnoError(63);d.node_ops.setattr(d,{mode:l&4095|d.mode&-4096,timestamp:Date.now()})},lchmod:(u,l)=>{w.chmod(u,l,!0)},fchmod:(u,l)=>{var h=w.getStream(u);if(!h)throw new w.ErrnoError(8);w.chmod(h.node,l)},chown:(u,l,h,d)=>{var m;if(typeof u=="string"){var b=w.lookupPath(u,{follow:!d});m=b.node}else m=u;if(!m.node_ops.setattr)throw new w.ErrnoError(63);m.node_ops.setattr(m,{timestamp:Date.now()})},lchown:(u,l,h)=>{w.chown(u,l,h,!0)},fchown:(u,l,h)=>{var d=w.getStream(u);if(!d)throw new w.ErrnoError(8);w.chown(d.node,l,h)},truncate:(u,l)=>{if(l<0)throw new w.ErrnoError(28);var h;if(typeof u=="string"){var d=w.lookupPath(u,{follow:!0});h=d.node}else h=u;if(!h.node_ops.setattr)throw new w.ErrnoError(63);if(w.isDir(h.mode))throw new w.ErrnoError(31);if(!w.isFile(h.mode))throw new w.ErrnoError(28);var m=w.nodePermissions(h,"w");if(m)throw new w.ErrnoError(m);h.node_ops.setattr(h,{size:l,timestamp:Date.now()})},ftruncate:(u,l)=>{var h=w.getStream(u);if(!h)throw new w.ErrnoError(8);if(!(h.flags&2097155))throw new w.ErrnoError(28);w.truncate(h.node,l)},utime:(u,l,h)=>{var d=w.lookupPath(u,{follow:!0}),m=d.node;m.node_ops.setattr(m,{timestamp:Math.max(l,h)})},open:(u,l,h)=>{if(u==="")throw new w.ErrnoError(44);l=typeof l=="string"?w.modeStringToFlags(l):l,h=typeof h>"u"?438:h,l&64?h=h&4095|32768:h=0;var d;if(typeof u=="object")d=u;else{u=le.normalize(u);try{var m=w.lookupPath(u,{follow:!(l&131072)});d=m.node}catch{}}var b=!1;if(l&64)if(d){if(l&128)throw new w.ErrnoError(20)}else d=w.mknod(u,h,0),b=!0;if(!d)throw new w.ErrnoError(44);if(w.isChrdev(d.mode)&&(l&=-513),l&65536&&!w.isDir(d.mode))throw new w.ErrnoError(54);if(!b){var x=w.mayOpen(d,l);if(x)throw new w.ErrnoError(x)}l&512&&!b&&w.truncate(d,0),l&=-131713;var _=w.createStream({node:d,path:w.getPath(d),flags:l,seekable:!0,position:0,stream_ops:d.stream_ops,ungotten:[],error:!1});return _.stream_ops.open&&_.stream_ops.open(_),n.logReadFiles&&!(l&1)&&(w.readFiles||(w.readFiles={}),u in w.readFiles||(w.readFiles[u]=1)),_},close:u=>{if(w.isClosed(u))throw new w.ErrnoError(8);u.getdents&&(u.getdents=null);try{u.stream_ops.close&&u.stream_ops.close(u)}catch(l){throw l}finally{w.closeStream(u.fd)}u.fd=null},isClosed:u=>u.fd===null,llseek:(u,l,h)=>{if(w.isClosed(u))throw new w.ErrnoError(8);if(!u.seekable||!u.stream_ops.llseek)throw new w.ErrnoError(70);if(h!=0&&h!=1&&h!=2)throw new w.ErrnoError(28);return u.position=u.stream_ops.llseek(u,l,h),u.ungotten=[],u.position},read:(u,l,h,d,m)=>{if(d<0||m<0)throw new w.ErrnoError(28);if(w.isClosed(u))throw new w.ErrnoError(8);if((u.flags&2097155)===1)throw new w.ErrnoError(8);if(w.isDir(u.node.mode))throw new w.ErrnoError(31);if(!u.stream_ops.read)throw new w.ErrnoError(28);var b=typeof m<"u";if(!b)m=u.position;else if(!u.seekable)throw new w.ErrnoError(70);var x=u.stream_ops.read(u,l,h,d,m);return b||(u.position+=x),x},write:(u,l,h,d,m,b)=>{if(d<0||m<0)throw new w.ErrnoError(28);if(w.isClosed(u))throw new w.ErrnoError(8);if(!(u.flags&2097155))throw new w.ErrnoError(8);if(w.isDir(u.node.mode))throw new w.ErrnoError(31);if(!u.stream_ops.write)throw new w.ErrnoError(28);u.seekable&&u.flags&1024&&w.llseek(u,0,2);var x=typeof m<"u";if(!x)m=u.position;else if(!u.seekable)throw new w.ErrnoError(70);var _=u.stream_ops.write(u,l,h,d,m,b);return x||(u.position+=_),_},allocate:(u,l,h)=>{if(w.isClosed(u))throw new w.ErrnoError(8);if(l<0||h<=0)throw new w.ErrnoError(28);if(!(u.flags&2097155))throw new w.ErrnoError(8);if(!w.isFile(u.node.mode)&&!w.isDir(u.node.mode))throw new w.ErrnoError(43);if(!u.stream_ops.allocate)throw new w.ErrnoError(138);u.stream_ops.allocate(u,l,h)},mmap:(u,l,h,d,m)=>{if(d&2&&!(m&2)&&(u.flags&2097155)!==2)throw new w.ErrnoError(2);if((u.flags&2097155)===1)throw new w.ErrnoError(2);if(!u.stream_ops.mmap)throw new w.ErrnoError(43);return u.stream_ops.mmap(u,l,h,d,m)},msync:(u,l,h,d,m)=>!u||!u.stream_ops.msync?0:u.stream_ops.msync(u,l,h,d,m),munmap:u=>0,ioctl:(u,l,h)=>{if(!u.stream_ops.ioctl)throw new w.ErrnoError(59);return u.stream_ops.ioctl(u,l,h)},readFile:(u,l={})=>{if(l.flags=l.flags||0,l.encoding=l.encoding||"binary",l.encoding!=="utf8"&&l.encoding!=="binary")throw new Error('Invalid encoding type "'+l.encoding+'"');var h,d=w.open(u,l.flags),m=w.stat(u),b=m.size,x=new Uint8Array(b);return w.read(d,x,0,b,0),l.encoding==="utf8"?h=we(x,0):l.encoding==="binary"&&(h=x),w.close(d),h},writeFile:(u,l,h={})=>{h.flags=h.flags||577;var d=w.open(u,h.flags,h.mode);if(typeof l=="string"){var m=new Uint8Array(be(l)+1),b=Ee(l,m,0,m.length);w.write(d,m,0,b,void 0,h.canOwn)}else if(ArrayBuffer.isView(l))w.write(d,l,0,l.byteLength,void 0,h.canOwn);else throw new Error("Unsupported data type");w.close(d)},cwd:()=>w.currentPath,chdir:u=>{var l=w.lookupPath(u,{follow:!0});if(l.node===null)throw new w.ErrnoError(44);if(!w.isDir(l.node.mode))throw new w.ErrnoError(54);var h=w.nodePermissions(l.node,"x");if(h)throw new w.ErrnoError(h);w.currentPath=l.path},createDefaultDirectories:()=>{w.mkdir("/tmp"),w.mkdir("/home"),w.mkdir("/home/web_user")},createDefaultDevices:()=>{w.mkdir("/dev"),w.registerDevice(w.makedev(1,3),{read:()=>0,write:(l,h,d,m,b)=>m}),w.mkdev("/dev/null",w.makedev(1,3)),wr.register(w.makedev(5,0),wr.default_tty_ops),wr.register(w.makedev(6,0),wr.default_tty1_ops),w.mkdev("/dev/tty",w.makedev(5,0)),w.mkdev("/dev/tty1",w.makedev(6,0));var u=Ig();w.createDevice("/dev","random",u),w.createDevice("/dev","urandom",u),w.mkdir("/dev/shm"),w.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{w.mkdir("/proc");var u=w.mkdir("/proc/self");w.mkdir("/proc/self/fd"),w.mount({mount:()=>{var l=w.createNode(u,"fd",16895,73);return l.node_ops={lookup:(h,d)=>{var m=+d,b=w.getStream(m);if(!b)throw new w.ErrnoError(8);var x={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>b.path}};return x.parent=x,x}},l}},{},"/proc/self/fd")},createStandardStreams:()=>{n.stdin?w.createDevice("/dev","stdin",n.stdin):w.symlink("/dev/tty","/dev/stdin"),n.stdout?w.createDevice("/dev","stdout",null,n.stdout):w.symlink("/dev/tty","/dev/stdout"),n.stderr?w.createDevice("/dev","stderr",null,n.stderr):w.symlink("/dev/tty1","/dev/stderr"),w.open("/dev/stdin",0),w.open("/dev/stdout",1),w.open("/dev/stderr",1)},ensureErrnoError:()=>{w.ErrnoError||(w.ErrnoError=function(l,h){this.node=h,this.setErrno=function(d){this.errno=d},this.setErrno(l),this.message="FS error"},w.ErrnoError.prototype=new Error,w.ErrnoError.prototype.constructor=w.ErrnoError,[44].forEach(u=>{w.genericErrors[u]=new w.ErrnoError(u),w.genericErrors[u].stack="<generic error, no stack>"}))},staticInit:()=>{w.ensureErrnoError(),w.nameTable=new Array(4096),w.mount(ne,{},"/"),w.createDefaultDirectories(),w.createDefaultDevices(),w.createSpecialDirectories(),w.filesystems={MEMFS:ne}},init:(u,l,h)=>{w.init.initialized=!0,w.ensureErrnoError(),n.stdin=u||n.stdin,n.stdout=l||n.stdout,n.stderr=h||n.stderr,w.createStandardStreams()},quit:()=>{w.init.initialized=!1;for(var u=0;u<w.streams.length;u++){var l=w.streams[u];l&&w.close(l)}},getMode:(u,l)=>{var h=0;return u&&(h|=365),l&&(h|=146),h},findObject:(u,l)=>{var h=w.analyzePath(u,l);return h.exists?h.object:null},analyzePath:(u,l)=>{try{var h=w.lookupPath(u,{follow:!l});u=h.path}catch{}var d={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var h=w.lookupPath(u,{parent:!0});d.parentExists=!0,d.parentPath=h.path,d.parentObject=h.node,d.name=le.basename(u),h=w.lookupPath(u,{follow:!l}),d.exists=!0,d.path=h.path,d.object=h.node,d.name=h.node.name,d.isRoot=h.path==="/"}catch(m){d.error=m.errno}return d},createPath:(u,l,h,d)=>{u=typeof u=="string"?u:w.getPath(u);for(var m=l.split("/").reverse();m.length;){var b=m.pop();if(b){var x=le.join2(u,b);try{w.mkdir(x)}catch{}u=x}}return x},createFile:(u,l,h,d,m)=>{var b=le.join2(typeof u=="string"?u:w.getPath(u),l),x=w.getMode(d,m);return w.create(b,x)},createDataFile:(u,l,h,d,m,b)=>{var x=l;u&&(u=typeof u=="string"?u:w.getPath(u),x=l?le.join2(u,l):u);var _=w.getMode(d,m),T=w.create(x,_);if(h){if(typeof h=="string"){for(var M=new Array(h.length),B=0,I=h.length;B<I;++B)M[B]=h.charCodeAt(B);h=M}w.chmod(T,_|146);var U=w.open(T,577);w.write(U,h,0,h.length,0,b),w.close(U),w.chmod(T,_)}return T},createDevice:(u,l,h,d)=>{var m=le.join2(typeof u=="string"?u:w.getPath(u),l),b=w.getMode(!!h,!!d);w.createDevice.major||(w.createDevice.major=64);var x=w.makedev(w.createDevice.major++,0);return w.registerDevice(x,{open:_=>{_.seekable=!1},close:_=>{d&&d.buffer&&d.buffer.length&&d(10)},read:(_,T,M,B,I)=>{for(var U=0,N=0;N<B;N++){var j;try{j=h()}catch{throw new w.ErrnoError(29)}if(j===void 0&&U===0)throw new w.ErrnoError(6);if(j==null)break;U++,T[M+N]=j}return U&&(_.node.timestamp=Date.now()),U},write:(_,T,M,B,I)=>{for(var U=0;U<B;U++)try{d(T[M+U])}catch{throw new w.ErrnoError(29)}return B&&(_.node.timestamp=Date.now()),U}}),w.mkdev(m,b,x)},forceLoadFile:u=>{if(u.isDevice||u.isFolder||u.link||u.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(S)try{u.contents=Zi(S(u.url),!0),u.usedBytes=u.contents.length}catch{throw new w.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(u,l,h,d,m)=>{function b(){this.lengthKnown=!1,this.chunks=[]}if(b.prototype.get=function(N){if(!(N>this.length-1||N<0)){var j=N%this.chunkSize,he=N/this.chunkSize|0;return this.getter(he)[j]}},b.prototype.setDataGetter=function(N){this.getter=N},b.prototype.cacheLength=function(){var N=new XMLHttpRequest;if(N.open("HEAD",h,!1),N.send(null),!(N.status>=200&&N.status<300||N.status===304))throw new Error("Couldn't load "+h+". Status: "+N.status);var j=Number(N.getResponseHeader("Content-length")),he,Ce=(he=N.getResponseHeader("Accept-Ranges"))&&he==="bytes",Re=(he=N.getResponseHeader("Content-Encoding"))&&he==="gzip",F=1024*1024;Ce||(F=j);var X=(me,at)=>{if(me>at)throw new Error("invalid range ("+me+", "+at+") or no bytes requested!");if(at>j-1)throw new Error("only "+j+" bytes available! programmer error!");var Oe=new XMLHttpRequest;if(Oe.open("GET",h,!1),j!==F&&Oe.setRequestHeader("Range","bytes="+me+"-"+at),Oe.responseType="arraybuffer",Oe.overrideMimeType&&Oe.overrideMimeType("text/plain; charset=x-user-defined"),Oe.send(null),!(Oe.status>=200&&Oe.status<300||Oe.status===304))throw new Error("Couldn't load "+h+". Status: "+Oe.status);return Oe.response!==void 0?new Uint8Array(Oe.response||[]):Zi(Oe.responseText||"",!0)},He=this;He.setDataGetter(me=>{var at=me*F,Oe=(me+1)*F-1;if(Oe=Math.min(Oe,j-1),typeof He.chunks[me]>"u"&&(He.chunks[me]=X(at,Oe)),typeof He.chunks[me]>"u")throw new Error("doXHR failed!");return He.chunks[me]}),(Re||!j)&&(F=j=1,j=this.getter(0).length,F=j,q("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=j,this._chunkSize=F,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var x=new b;Object.defineProperties(x,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var _={isDevice:!1,contents:x}}else var _={isDevice:!1,url:h};var T=w.createFile(u,l,_,d,m);_.contents?T.contents=_.contents:_.url&&(T.contents=null,T.url=_.url),Object.defineProperties(T,{usedBytes:{get:function(){return this.contents.length}}});var M={},B=Object.keys(T.stream_ops);B.forEach(U=>{var N=T.stream_ops[U];M[U]=function(){return w.forceLoadFile(T),N.apply(null,arguments)}});function I(U,N,j,he,Ce){var Re=U.node.contents;if(Ce>=Re.length)return 0;var F=Math.min(Re.length-Ce,he);if(Re.slice)for(var X=0;X<F;X++)N[j+X]=Re[Ce+X];else for(var X=0;X<F;X++)N[j+X]=Re.get(Ce+X);return F}return M.read=(U,N,j,he,Ce)=>(w.forceLoadFile(T),I(U,N,j,he,Ce)),M.mmap=(U,N,j,he,Ce)=>{w.forceLoadFile(T);var Re=bl(N);if(!Re)throw new w.ErrnoError(48);return I(U,je,Re,N,j),{ptr:Re,allocated:!0}},T.stream_ops=M,T},createPreloadedFile:(u,l,h,d,m,b,x,_,T,M)=>{var B=l?Ht.resolve(le.join2(u,l)):u;function I(U){function N(j){M&&M(),_||w.createDataFile(u,l,j,d,m,T),b&&b(),Di()}Browser.handledByPreloadPlugin(U,B,N,()=>{x&&x(),Di()})||N(U)}Jo(),typeof h=="string"?zg(h,U=>I(U),x):I(h)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(u,l,h)=>{l=l||(()=>{}),h=h||(()=>{});var d=w.indexedDB();try{var m=d.open(w.DB_NAME(),w.DB_VERSION)}catch(b){return h(b)}m.onupgradeneeded=()=>{q("creating db");var b=m.result;b.createObjectStore(w.DB_STORE_NAME)},m.onsuccess=()=>{var b=m.result,x=b.transaction([w.DB_STORE_NAME],"readwrite"),_=x.objectStore(w.DB_STORE_NAME),T=0,M=0,B=u.length;function I(){M==0?l():h()}u.forEach(U=>{var N=_.put(w.analyzePath(U).object.contents,U);N.onsuccess=()=>{T++,T+M==B&&I()},N.onerror=()=>{M++,T+M==B&&I()}}),x.onerror=h},m.onerror=h},loadFilesFromDB:(u,l,h)=>{l=l||(()=>{}),h=h||(()=>{});var d=w.indexedDB();try{var m=d.open(w.DB_NAME(),w.DB_VERSION)}catch(b){return h(b)}m.onupgradeneeded=h,m.onsuccess=()=>{var b=m.result;try{var x=b.transaction([w.DB_STORE_NAME],"readonly")}catch(U){h(U);return}var _=x.objectStore(w.DB_STORE_NAME),T=0,M=0,B=u.length;function I(){M==0?l():h()}u.forEach(U=>{var N=_.get(U);N.onsuccess=()=>{w.analyzePath(U).exists&&w.unlink(U),w.createDataFile(le.dirname(U),le.basename(U),N.result,!0,!0,!0),T++,T+M==B&&I()},N.onerror=()=>{M++,T+M==B&&I()}}),x.onerror=h},m.onerror=h}},ce={DEFAULT_POLLMASK:5,calculateAt:function(u,l,h){if(le.isAbs(l))return l;var d;if(u===-100)d=w.cwd();else{var m=w.getStream(u);if(!m)throw new w.ErrnoError(8);d=m.path}if(l.length==0){if(!h)throw new w.ErrnoError(44);return d}return le.join2(d,l)},doStat:function(u,l,h){try{var d=u(l)}catch(m){if(m&&m.node&&le.normalize(l)!==le.normalize(w.getPath(m.node)))return-54;throw m}return G[h>>2]=d.dev,G[h+4>>2]=0,G[h+8>>2]=d.ino,G[h+12>>2]=d.mode,G[h+16>>2]=d.nlink,G[h+20>>2]=d.uid,G[h+24>>2]=d.gid,G[h+28>>2]=d.rdev,G[h+32>>2]=0,zt=[d.size>>>0,(Xe=d.size,+Math.abs(Xe)>=1?Xe>0?(Math.min(+Math.floor(Xe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Xe-+(~~Xe>>>0))/4294967296)>>>0:0)],G[h+40>>2]=zt[0],G[h+44>>2]=zt[1],G[h+48>>2]=4096,G[h+52>>2]=d.blocks,G[h+56>>2]=d.atime.getTime()/1e3|0,G[h+60>>2]=0,G[h+64>>2]=d.mtime.getTime()/1e3|0,G[h+68>>2]=0,G[h+72>>2]=d.ctime.getTime()/1e3|0,G[h+76>>2]=0,zt=[d.ino>>>0,(Xe=d.ino,+Math.abs(Xe)>=1?Xe>0?(Math.min(+Math.floor(Xe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Xe-+(~~Xe>>>0))/4294967296)>>>0:0)],G[h+80>>2]=zt[0],G[h+84>>2]=zt[1],0},doMsync:function(u,l,h,d,m){var b=tt.slice(u,u+h);w.msync(l,b,m,h,d)},varargs:void 0,get:function(){ce.varargs+=4;var u=G[ce.varargs-4>>2];return u},getStr:function(u){var l=se(u);return l},getStreamFromFD:function(u){var l=w.getStream(u);if(!l)throw new w.ErrnoError(8);return l}};function Hg(u,l){try{return u=ce.getStr(u),w.chmod(u,l),0}catch(h){if(typeof w>"u"||!(h instanceof w.ErrnoError))throw h;return-h.errno}}function Wg(u,l,h,d){try{if(l=ce.getStr(l),l=ce.calculateAt(u,l),h&-8)return-28;var m=w.lookupPath(l,{follow:!0}),b=m.node;if(!b)return-44;var x="";return h&4&&(x+="r"),h&2&&(x+="w"),h&1&&(x+="x"),x&&w.nodePermissions(b,x)?-2:0}catch(_){if(typeof w>"u"||!(_ instanceof w.ErrnoError))throw _;return-_.errno}}function Vg(u){return G[Nl()>>2]=u,u}function $g(u,l,h){ce.varargs=h;try{var d=ce.getStreamFromFD(u);switch(l){case 0:{var m=ce.get();if(m<0)return-28;var b;return b=w.createStream(d,m),b.fd}case 1:case 2:return 0;case 3:return d.flags;case 4:{var m=ce.get();return d.flags|=m,0}case 5:{var m=ce.get(),x=0;return ar[m+x>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Vg(28),-1;default:return-28}}catch(_){if(typeof w>"u"||!(_ instanceof w.ErrnoError))throw _;return-_.errno}}function Yg(u,l){try{var h=ce.getStreamFromFD(u);return ce.doStat(w.stat,h.path,l)}catch(d){if(typeof w>"u"||!(d instanceof w.ErrnoError))throw d;return-d.errno}}function Xg(u,l,h){ce.varargs=h;try{var d=ce.getStreamFromFD(u);switch(l){case 21509:case 21505:return d.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return d.tty?0:-59;case 21519:{if(!d.tty)return-59;var m=ce.get();return G[m>>2]=0,0}case 21520:return d.tty?-28:-59;case 21531:{var m=ce.get();return w.ioctl(d,l,m)}case 21523:return d.tty?0:-59;case 21524:return d.tty?0:-59;default:ur("bad ioctl syscall "+l)}}catch(b){if(typeof w>"u"||!(b instanceof w.ErrnoError))throw b;return-b.errno}}function qg(u,l){try{return u=ce.getStr(u),ce.doStat(w.lstat,u,l)}catch(h){if(typeof w>"u"||!(h instanceof w.ErrnoError))throw h;return-h.errno}}function jg(u,l,h,d){try{l=ce.getStr(l);var m=d&256,b=d&4096;return d=d&-4353,l=ce.calculateAt(u,l,b),ce.doStat(m?w.lstat:w.stat,l,h)}catch(x){if(typeof w>"u"||!(x instanceof w.ErrnoError))throw x;return-x.errno}}function Zg(u,l,h,d){ce.varargs=d;try{l=ce.getStr(l),l=ce.calculateAt(u,l);var m=d?ce.get():0;return w.open(l,h,m).fd}catch(b){if(typeof w>"u"||!(b instanceof w.ErrnoError))throw b;return-b.errno}}function Kg(u,l){try{return u=ce.getStr(u),ce.doStat(w.stat,u,l)}catch(h){if(typeof w>"u"||!(h instanceof w.ErrnoError))throw h;return-h.errno}}function Qg(u,l,h,d,m){}function Li(u){switch(u){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+u)}}function Jg(){for(var u=new Array(256),l=0;l<256;++l)u[l]=String.fromCharCode(l);Sl=u}var Sl=void 0;function rt(u){for(var l="",h=u;tt[h];)l+=Sl[tt[h++]];return l}var Yr={},br={},Bi={},e0=48,t0=57;function Ii(u){if(u===void 0)return"_unknown";u=u.replace(/[^a-zA-Z0-9_]/g,"$");var l=u.charCodeAt(0);return l>=e0&&l<=t0?"_"+u:u}function Gi(u,l){return u=Ii(u),new Function("body","return function "+u+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(l)}function ts(u,l){var h=Gi(l,function(d){this.name=l,this.message=d;var m=new Error(d).stack;m!==void 0&&(this.stack=this.toString()+`
`+m.replace(/^Error(:[^\n]*)?\n/,""))});return h.prototype=Object.create(u.prototype),h.prototype.constructor=h,h.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},h}var Xr=void 0;function fe(u){throw new Xr(u)}var xl=void 0;function Ni(u){throw new xl(u)}function Sr(u,l,h){u.forEach(function(_){Bi[_]=l});function d(_){var T=h(_);T.length!==u.length&&Ni("Mismatched type converter count");for(var M=0;M<u.length;++M)At(u[M],T[M])}var m=new Array(l.length),b=[],x=0;l.forEach((_,T)=>{br.hasOwnProperty(_)?m[T]=br[_]:(b.push(_),Yr.hasOwnProperty(_)||(Yr[_]=[]),Yr[_].push(()=>{m[T]=br[_],++x,x===b.length&&d(m)}))}),b.length===0&&d(m)}function At(u,l,h={}){if(!("argPackAdvance"in l))throw new TypeError("registerType registeredInstance requires argPackAdvance");var d=l.name;if(u||fe('type "'+d+'" must have a positive integer typeid pointer'),br.hasOwnProperty(u)){if(h.ignoreDuplicateRegistrations)return;fe("Cannot register type '"+d+"' twice")}if(br[u]=l,delete Bi[u],Yr.hasOwnProperty(u)){var m=Yr[u];delete Yr[u],m.forEach(b=>b())}}function r0(u,l,h,d,m){var b=Li(h);l=rt(l),At(u,{name:l,fromWireType:function(x){return!!x},toWireType:function(x,_){return _?d:m},argPackAdvance:8,readValueFromPointer:function(x){var _;if(h===1)_=je;else if(h===2)_=ar;else if(h===4)_=G;else throw new TypeError("Unknown boolean type size: "+l);return this.fromWireType(_[x>>b])},destructorFunction:null})}function n0(u){if(!(this instanceof lr)||!(u instanceof lr))return!1;for(var l=this.$$.ptrType.registeredClass,h=this.$$.ptr,d=u.$$.ptrType.registeredClass,m=u.$$.ptr;l.baseClass;)h=l.upcast(h),l=l.baseClass;for(;d.baseClass;)m=d.upcast(m),d=d.baseClass;return l===d&&h===m}function i0(u){return{count:u.count,deleteScheduled:u.deleteScheduled,preservePointerOnDelete:u.preservePointerOnDelete,ptr:u.ptr,ptrType:u.ptrType,smartPtr:u.smartPtr,smartPtrType:u.smartPtrType}}function rs(u){function l(h){return h.$$.ptrType.registeredClass.name}fe(l(u)+" instance already deleted")}var ns=!1;function _l(u){}function o0(u){u.smartPtr?u.smartPtrType.rawDestructor(u.smartPtr):u.ptrType.registeredClass.rawDestructor(u.ptr)}function El(u){u.count.value-=1;var l=u.count.value===0;l&&o0(u)}function Tl(u,l,h){if(l===h)return u;if(h.baseClass===void 0)return null;var d=Tl(u,l,h.baseClass);return d===null?null:h.downcast(d)}var kl={};function s0(){return Object.keys(Un).length}function a0(){var u=[];for(var l in Un)Un.hasOwnProperty(l)&&u.push(Un[l]);return u}var Dn=[];function is(){for(;Dn.length;){var u=Dn.pop();u.$$.deleteScheduled=!1,u.delete()}}var Fn=void 0;function u0(u){Fn=u,Dn.length&&Fn&&Fn(is)}function l0(){n.getInheritedInstanceCount=s0,n.getLiveInheritedInstances=a0,n.flushPendingDeletes=is,n.setDelayFunction=u0}var Un={};function c0(u,l){for(l===void 0&&fe("ptr should not be undefined");u.baseClass;)l=u.upcast(l),u=u.baseClass;return l}function f0(u,l){return l=c0(u,l),Un[l]}function zi(u,l){(!l.ptrType||!l.ptr)&&Ni("makeClassHandle requires ptr and ptrType");var h=!!l.smartPtrType,d=!!l.smartPtr;return h!==d&&Ni("Both smartPtrType and smartPtr must be specified"),l.count={value:1},Ln(Object.create(u,{$$:{value:l}}))}function h0(u){var l=this.getPointee(u);if(!l)return this.destructor(u),null;var h=f0(this.registeredClass,l);if(h!==void 0){if(h.$$.count.value===0)return h.$$.ptr=l,h.$$.smartPtr=u,h.clone();var d=h.clone();return this.destructor(u),d}function m(){return this.isSmartPointer?zi(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:l,smartPtrType:this,smartPtr:u}):zi(this.registeredClass.instancePrototype,{ptrType:this,ptr:u})}var b=this.registeredClass.getActualType(l),x=kl[b];if(!x)return m.call(this);var _;this.isConst?_=x.constPointerType:_=x.pointerType;var T=Tl(l,this.registeredClass,_.registeredClass);return T===null?m.call(this):this.isSmartPointer?zi(_.registeredClass.instancePrototype,{ptrType:_,ptr:T,smartPtrType:this,smartPtr:u}):zi(_.registeredClass.instancePrototype,{ptrType:_,ptr:T})}function Ln(u){return typeof FinalizationRegistry>"u"?(Ln=l=>l,u):(ns=new FinalizationRegistry(l=>{El(l.$$)}),Ln=l=>{var h=l.$$,d=!!h.smartPtr;if(d){var m={$$:h};ns.register(l,m,l)}return l},_l=l=>ns.unregister(l),Ln(u))}function p0(){if(this.$$.ptr||rs(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var u=Ln(Object.create(Object.getPrototypeOf(this),{$$:{value:i0(this.$$)}}));return u.$$.count.value+=1,u.$$.deleteScheduled=!1,u}function d0(){this.$$.ptr||rs(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&fe("Object already scheduled for deletion"),_l(this),El(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function v0(){return!this.$$.ptr}function g0(){return this.$$.ptr||rs(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&fe("Object already scheduled for deletion"),Dn.push(this),Dn.length===1&&Fn&&Fn(is),this.$$.deleteScheduled=!0,this}function m0(){lr.prototype.isAliasOf=n0,lr.prototype.clone=p0,lr.prototype.delete=d0,lr.prototype.isDeleted=v0,lr.prototype.deleteLater=g0}function lr(){}function os(u,l,h){if(u[l].overloadTable===void 0){var d=u[l];u[l]=function(){return u[l].overloadTable.hasOwnProperty(arguments.length)||fe("Function '"+h+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+u[l].overloadTable+")!"),u[l].overloadTable[arguments.length].apply(this,arguments)},u[l].overloadTable=[],u[l].overloadTable[d.argCount]=d}}function Cl(u,l,h){n.hasOwnProperty(u)?((h===void 0||n[u].overloadTable!==void 0&&n[u].overloadTable[h]!==void 0)&&fe("Cannot register public name '"+u+"' twice"),os(n,u,u),n.hasOwnProperty(h)&&fe("Cannot register multiple overloads of a function with the same number of arguments ("+h+")!"),n[u].overloadTable[h]=l):(n[u]=l,h!==void 0&&(n[u].numArguments=h))}function y0(u,l,h,d,m,b,x,_){this.name=u,this.constructor=l,this.instancePrototype=h,this.rawDestructor=d,this.baseClass=m,this.getActualType=b,this.upcast=x,this.downcast=_,this.pureVirtualFunctions=[]}function ss(u,l,h){for(;l!==h;)l.upcast||fe("Expected null or instance of "+h.name+", got an instance of "+l.name),u=l.upcast(u),l=l.baseClass;return u}function w0(u,l){if(l===null)return this.isReference&&fe("null is not a valid "+this.name),0;l.$$||fe('Cannot pass "'+fs(l)+'" as a '+this.name),l.$$.ptr||fe("Cannot pass deleted object as a pointer of type "+this.name);var h=l.$$.ptrType.registeredClass,d=ss(l.$$.ptr,h,this.registeredClass);return d}function b0(u,l){var h;if(l===null)return this.isReference&&fe("null is not a valid "+this.name),this.isSmartPointer?(h=this.rawConstructor(),u!==null&&u.push(this.rawDestructor,h),h):0;l.$$||fe('Cannot pass "'+fs(l)+'" as a '+this.name),l.$$.ptr||fe("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&l.$$.ptrType.isConst&&fe("Cannot convert argument of type "+(l.$$.smartPtrType?l.$$.smartPtrType.name:l.$$.ptrType.name)+" to parameter type "+this.name);var d=l.$$.ptrType.registeredClass;if(h=ss(l.$$.ptr,d,this.registeredClass),this.isSmartPointer)switch(l.$$.smartPtr===void 0&&fe("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:l.$$.smartPtrType===this?h=l.$$.smartPtr:fe("Cannot convert argument of type "+(l.$$.smartPtrType?l.$$.smartPtrType.name:l.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:h=l.$$.smartPtr;break;case 2:if(l.$$.smartPtrType===this)h=l.$$.smartPtr;else{var m=l.clone();h=this.rawShare(h,ze.toHandle(function(){m.delete()})),u!==null&&u.push(this.rawDestructor,h)}break;default:fe("Unsupporting sharing policy")}return h}function S0(u,l){if(l===null)return this.isReference&&fe("null is not a valid "+this.name),0;l.$$||fe('Cannot pass "'+fs(l)+'" as a '+this.name),l.$$.ptr||fe("Cannot pass deleted object as a pointer of type "+this.name),l.$$.ptrType.isConst&&fe("Cannot convert argument of type "+l.$$.ptrType.name+" to parameter type "+this.name);var h=l.$$.ptrType.registeredClass,d=ss(l.$$.ptr,h,this.registeredClass);return d}function Hi(u){return this.fromWireType(ue[u>>2])}function x0(u){return this.rawGetPointee&&(u=this.rawGetPointee(u)),u}function _0(u){this.rawDestructor&&this.rawDestructor(u)}function E0(u){u!==null&&u.delete()}function T0(){Wt.prototype.getPointee=x0,Wt.prototype.destructor=_0,Wt.prototype.argPackAdvance=8,Wt.prototype.readValueFromPointer=Hi,Wt.prototype.deleteObject=E0,Wt.prototype.fromWireType=h0}function Wt(u,l,h,d,m,b,x,_,T,M,B){this.name=u,this.registeredClass=l,this.isReference=h,this.isConst=d,this.isSmartPointer=m,this.pointeeType=b,this.sharingPolicy=x,this.rawGetPointee=_,this.rawConstructor=T,this.rawShare=M,this.rawDestructor=B,!m&&l.baseClass===void 0?d?(this.toWireType=w0,this.destructorFunction=null):(this.toWireType=S0,this.destructorFunction=null):this.toWireType=b0}function k0(u,l,h){n.hasOwnProperty(u)||Ni("Replacing nonexistant public symbol"),n[u].overloadTable!==void 0&&h!==void 0?n[u].overloadTable[h]=l:(n[u]=l,n[u].argCount=h)}function C0(u,l,h){var d=n["dynCall_"+u];return h&&h.length?d.apply(null,[l].concat(h)):d.call(null,l)}function P0(u,l,h){return u.includes("j")?C0(u,l,h):Ui(l).apply(null,h)}function A0(u,l){var h=[];return function(){return h.length=0,Object.assign(h,arguments),P0(u,l,h)}}function xr(u,l){u=rt(u);function h(){return u.includes("j")?A0(u,l):Ui(l)}var d=h();return typeof d!="function"&&fe("unknown function pointer with signature "+u+": "+l),d}var Pl=void 0;function Al(u){var l=zl(u),h=rt(l);return Yt(l),h}function Wi(u,l){var h=[],d={};function m(b){if(!d[b]&&!br[b]){if(Bi[b]){Bi[b].forEach(m);return}h.push(b),d[b]=!0}}throw l.forEach(m),new Pl(u+": "+h.map(Al).join([", "]))}function M0(u,l,h,d,m,b,x,_,T,M,B,I,U){B=rt(B),b=xr(m,b),_&&(_=xr(x,_)),M&&(M=xr(T,M)),U=xr(I,U);var N=Ii(B);Cl(N,function(){Wi("Cannot construct "+B+" due to unbound types",[d])}),Sr([u,l,h],d?[d]:[],function(j){j=j[0];var he,Ce;d?(he=j.registeredClass,Ce=he.instancePrototype):Ce=lr.prototype;var Re=Gi(N,function(){if(Object.getPrototypeOf(this)!==F)throw new Xr("Use 'new' to construct "+B);if(X.constructor_body===void 0)throw new Xr(B+" has no accessible constructor");var Oe=X.constructor_body[arguments.length];if(Oe===void 0)throw new Xr("Tried to invoke ctor of "+B+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(X.constructor_body).toString()+") parameters instead!");return Oe.apply(this,arguments)}),F=Object.create(Ce,{constructor:{value:Re}});Re.prototype=F;var X=new y0(B,Re,F,U,he,b,_,M),He=new Wt(B,X,!0,!1,!1),me=new Wt(B+"*",X,!1,!1,!1),at=new Wt(B+" const*",X,!1,!0,!1);return kl[u]={pointerType:me,constPointerType:at},k0(N,Re),[He,me,at]})}function Ml(u,l){if(!(u instanceof Function))throw new TypeError("new_ called with constructor type "+typeof u+" which is not a function");var h=Gi(u.name||"unknownFunctionName",function(){});h.prototype=u.prototype;var d=new h,m=u.apply(d,l);return m instanceof Object?m:d}function Rl(u){for(;u.length;){var l=u.pop(),h=u.pop();h(l)}}function as(u,l,h,d,m){var b=l.length;b<2&&fe("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var x=l[1]!==null&&h!==null,_=!1,T=1;T<l.length;++T)if(l[T]!==null&&l[T].destructorFunction===void 0){_=!0;break}for(var M=l[0].name!=="void",B="",I="",T=0;T<b-2;++T)B+=(T!==0?", ":"")+"arg"+T,I+=(T!==0?", ":"")+"arg"+T+"Wired";var U="return function "+Ii(u)+"("+B+`) {
if (arguments.length !== `+(b-2)+`) {
throwBindingError('function `+u+" called with ' + arguments.length + ' arguments, expected "+(b-2)+` args!');
}
`;_&&(U+=`var destructors = [];
`);var N=_?"destructors":"null",j=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],he=[fe,d,m,Rl,l[0],l[1]];x&&(U+="var thisWired = classParam.toWireType("+N+`, this);
`);for(var T=0;T<b-2;++T)U+="var arg"+T+"Wired = argType"+T+".toWireType("+N+", arg"+T+"); // "+l[T+2].name+`
`,j.push("argType"+T),he.push(l[T+2]);if(x&&(I="thisWired"+(I.length>0?", ":"")+I),U+=(M?"var rv = ":"")+"invoker(fn"+(I.length>0?", ":"")+I+`);
`,_)U+=`runDestructors(destructors);
`;else for(var T=x?1:2;T<l.length;++T){var Ce=T===1?"thisWired":"arg"+(T-2)+"Wired";l[T].destructorFunction!==null&&(U+=Ce+"_dtor("+Ce+"); // "+l[T].name+`
`,j.push(Ce+"_dtor"),he.push(l[T].destructorFunction))}M&&(U+=`var ret = retType.fromWireType(rv);
return ret;
`),U+=`}
`,j.push(U);var Re=Ml(Function,j).apply(null,he);return Re}function us(u,l){for(var h=[],d=0;d<u;d++)h.push(G[(l>>2)+d]);return h}function R0(u,l,h,d,m,b,x){var _=us(h,d);l=rt(l),b=xr(m,b),Sr([],[u],function(T){T=T[0];var M=T.name+"."+l;function B(){Wi("Cannot call "+M+" due to unbound types",_)}l.startsWith("@@")&&(l=Symbol[l.substring(2)]);var I=T.registeredClass.constructor;return I[l]===void 0?(B.argCount=h-1,I[l]=B):(os(I,l,M),I[l].overloadTable[h-1]=B),Sr([],_,function(U){var N=[U[0],null].concat(U.slice(1)),j=as(M,N,null,b,x);return I[l].overloadTable===void 0?(j.argCount=h-1,I[l]=j):I[l].overloadTable[h-1]=j,[]}),[]})}function O0(u,l,h,d,m,b){pe(l>0);var x=us(l,h);m=xr(d,m),Sr([],[u],function(_){_=_[0];var T="constructor "+_.name;if(_.registeredClass.constructor_body===void 0&&(_.registeredClass.constructor_body=[]),_.registeredClass.constructor_body[l-1]!==void 0)throw new Xr("Cannot register multiple constructors with identical number of parameters ("+(l-1)+") for class '"+_.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return _.registeredClass.constructor_body[l-1]=()=>{Wi("Cannot construct "+_.name+" due to unbound types",x)},Sr([],x,function(M){return M.splice(1,0,null),_.registeredClass.constructor_body[l-1]=as(T,M,null,m,b),[]}),[]})}function D0(u,l,h,d,m,b,x,_){var T=us(h,d);l=rt(l),b=xr(m,b),Sr([],[u],function(M){M=M[0];var B=M.name+"."+l;l.startsWith("@@")&&(l=Symbol[l.substring(2)]),_&&M.registeredClass.pureVirtualFunctions.push(l);function I(){Wi("Cannot call "+B+" due to unbound types",T)}var U=M.registeredClass.instancePrototype,N=U[l];return N===void 0||N.overloadTable===void 0&&N.className!==M.name&&N.argCount===h-2?(I.argCount=h-2,I.className=M.name,U[l]=I):(os(U,l,B),U[l].overloadTable[h-2]=I),Sr([],T,function(j){var he=as(B,j,M,b,x);return U[l].overloadTable===void 0?(he.argCount=h-2,U[l]=he):U[l].overloadTable[h-2]=he,[]}),[]})}var ls=[],_t=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function cs(u){u>4&&--_t[u].refcount===0&&(_t[u]=void 0,ls.push(u))}function F0(){for(var u=0,l=5;l<_t.length;++l)_t[l]!==void 0&&++u;return u}function U0(){for(var u=5;u<_t.length;++u)if(_t[u]!==void 0)return _t[u];return null}function L0(){n.count_emval_handles=F0,n.get_first_emval=U0}var ze={toValue:u=>(u||fe("Cannot use deleted val. handle = "+u),_t[u].value),toHandle:u=>{switch(u){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var l=ls.length?ls.pop():_t.length;return _t[l]={refcount:1,value:u},l}}}};function B0(u,l){l=rt(l),At(u,{name:l,fromWireType:function(h){var d=ze.toValue(h);return cs(h),d},toWireType:function(h,d){return ze.toHandle(d)},argPackAdvance:8,readValueFromPointer:Hi,destructorFunction:null})}function I0(u,l,h){switch(l){case 0:return function(d){var m=h?je:tt;return this.fromWireType(m[d])};case 1:return function(d){var m=h?ar:Rn;return this.fromWireType(m[d>>1])};case 2:return function(d){var m=h?G:ue;return this.fromWireType(m[d>>2])};default:throw new TypeError("Unknown integer type: "+u)}}function G0(u,l,h,d){var m=Li(h);l=rt(l);function b(){}b.values={},At(u,{name:l,constructor:b,fromWireType:function(x){return this.constructor.values[x]},toWireType:function(x,_){return _.value},argPackAdvance:8,readValueFromPointer:I0(l,m,d),destructorFunction:null}),Cl(l,b)}function Vi(u,l){var h=br[u];return h===void 0&&fe(l+" has unknown type "+Al(u)),h}function N0(u,l,h){var d=Vi(u,"enum");l=rt(l);var m=d.constructor,b=Object.create(d.constructor.prototype,{value:{value:h},constructor:{value:Gi(d.name+"_"+l,function(){})}});m.values[h]=b,m[l]=b}function fs(u){if(u===null)return"null";var l=typeof u;return l==="object"||l==="array"||l==="function"?u.toString():""+u}function z0(u,l){switch(l){case 2:return function(h){return this.fromWireType(xt[h>>2])};case 3:return function(h){return this.fromWireType(cl[h>>3])};default:throw new TypeError("Unknown float type: "+u)}}function H0(u,l,h){var d=Li(h);l=rt(l),At(u,{name:l,fromWireType:function(m){return m},toWireType:function(m,b){return b},argPackAdvance:8,readValueFromPointer:z0(l,d),destructorFunction:null})}function W0(u,l,h){switch(l){case 0:return h?function(m){return je[m]}:function(m){return tt[m]};case 1:return h?function(m){return ar[m>>1]}:function(m){return Rn[m>>1]};case 2:return h?function(m){return G[m>>2]}:function(m){return ue[m>>2]};default:throw new TypeError("Unknown integer type: "+u)}}function V0(u,l,h,d,m){l=rt(l);var b=Li(h),x=I=>I;if(d===0){var _=32-8*h;x=I=>I<<_>>>_}var T=l.includes("unsigned"),M=(I,U)=>{},B;T?B=function(I,U){return M(U,this.name),U>>>0}:B=function(I,U){return M(U,this.name),U},At(u,{name:l,fromWireType:x,toWireType:B,argPackAdvance:8,readValueFromPointer:W0(l,b,d!==0),destructorFunction:null})}function $0(u,l,h){var d=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],m=d[l];function b(x){x=x>>2;var _=ue,T=_[x],M=_[x+1];return new m(Nt,M,T)}h=rt(h),At(u,{name:h,fromWireType:b,argPackAdvance:8,readValueFromPointer:b},{ignoreDuplicateRegistrations:!0})}function Y0(u,l){l=rt(l);var h=l==="std::string";At(u,{name:l,fromWireType:function(d){var m=ue[d>>2],b;if(h)for(var x=d+4,_=0;_<=m;++_){var T=d+4+_;if(_==m||tt[T]==0){var M=T-x,B=se(x,M);b===void 0?b=B:(b+=String.fromCharCode(0),b+=B),x=T+1}}else{for(var I=new Array(m),_=0;_<m;++_)I[_]=String.fromCharCode(tt[d+4+_]);b=I.join("")}return Yt(d),b},toWireType:function(d,m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));var b,x=typeof m=="string";x||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int8Array||fe("Cannot pass non-string to std::string"),h&&x?b=()=>be(m):b=()=>m.length;var _=b(),T=$t(4+_+1);if(ue[T>>2]=_,h&&x)Ne(m,T+4,_+1);else if(x)for(var M=0;M<_;++M){var B=m.charCodeAt(M);B>255&&(Yt(T),fe("String has UTF-16 code units that do not fit in 8 bits")),tt[T+4+M]=B}else for(var M=0;M<_;++M)tt[T+4+M]=m[M];return d!==null&&d.push(Yt,T),T},argPackAdvance:8,readValueFromPointer:Hi,destructorFunction:function(d){Yt(d)}})}function X0(u,l,h){h=rt(h);var d,m,b,x,_;l===2?(d=Ye,m=it,x=ke,b=()=>Rn,_=1):l===4&&(d=Ve,m=An,x=Qo,b=()=>ue,_=2),At(u,{name:h,fromWireType:function(T){for(var M=ue[T>>2],B=b(),I,U=T+4,N=0;N<=M;++N){var j=T+4+N*l;if(N==M||B[j>>_]==0){var he=j-U,Ce=d(U,he);I===void 0?I=Ce:(I+=String.fromCharCode(0),I+=Ce),U=j+l}}return Yt(T),I},toWireType:function(T,M){typeof M!="string"&&fe("Cannot pass non-string to C++ string type "+h);var B=x(M),I=$t(4+B+l);return ue[I>>2]=B>>_,m(M,I+4,B+l),T!==null&&T.push(Yt,I),I},argPackAdvance:8,readValueFromPointer:Hi,destructorFunction:function(T){Yt(T)}})}function q0(u,l){l=rt(l),At(u,{isVoid:!0,name:l,argPackAdvance:0,fromWireType:function(){},toWireType:function(h,d){}})}function j0(){return Date.now()}var Z0=!0;function K0(){return Z0}function Q0(u,l,h){u=ze.toValue(u),l=Vi(l,"emval::as");var d=[],m=ze.toHandle(d);return G[h>>2]=m,l.toWireType(d,u)}function J0(u){var l=[];return G[u>>2]=ze.toHandle(l),l}var em={};function hs(u){var l=em[u];return l===void 0?rt(u):l}var ps=[];function tm(u,l,h,d,m){return u=ps[u],l=ze.toValue(l),h=hs(h),u(l,h,J0(d),m)}function Ol(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function rm(u){return u===0?ze.toHandle(Ol()):(u=hs(u),ze.toHandle(Ol()[u]))}function nm(u){var l=ps.length;return ps.push(u),l}function im(u,l){for(var h=new Array(u),d=0;d<u;++d)h[d]=Vi(ue[l+d*K>>2],"parameter "+d);return h}var Dl=[];function om(u,l){var h=im(u,l),d=h[0],m=d.name+"_$"+h.slice(1).map(function(j){return j.name}).join("_")+"$",b=Dl[m];if(b!==void 0)return b;for(var x=["retType"],_=[d],T="",M=0;M<u-1;++M)T+=(M!==0?", ":"")+"arg"+M,x.push("argType"+M),_.push(h[1+M]);for(var B=Ii("methodCaller_"+m),I="return function "+B+`(handle, name, destructors, args) {
`,U=0,M=0;M<u-1;++M)I+="    var arg"+M+" = argType"+M+".readValueFromPointer(args"+(U?"+"+U:"")+`);
`,U+=h[M+1].argPackAdvance;I+="    var rv = handle[name]("+T+`);
`;for(var M=0;M<u-1;++M)h[M+1].deleteObject&&(I+="    argType"+M+".deleteObject(arg"+M+`);
`);d.isVoid||(I+=`    return retType.toWireType(destructors, rv);
`),I+=`};
`,x.push(I);var N=Ml(Function,x).apply(null,_);return b=nm(N),Dl[m]=b,b}function sm(u,l){return u=ze.toValue(u),l=ze.toValue(l),ze.toHandle(u[l])}function am(u){u>4&&(_t[u].refcount+=1)}function um(u){return ze.toHandle(hs(u))}function lm(u){var l=ze.toValue(u);Rl(l),cs(u)}function cm(u,l,h){u=ze.toValue(u),l=ze.toValue(l),h=ze.toValue(h),u[l]=h}function fm(u,l){u=Vi(u,"_emval_take_value");var h=u.readValueFromPointer(l);return ze.toHandle(h)}function hm(u){return u=ze.toValue(u),ze.toHandle(typeof u)}function pm(u,l){var h=new Date(G[u>>2]*1e3);G[l>>2]=h.getSeconds(),G[l+4>>2]=h.getMinutes(),G[l+8>>2]=h.getHours(),G[l+12>>2]=h.getDate(),G[l+16>>2]=h.getMonth(),G[l+20>>2]=h.getFullYear()-1900,G[l+24>>2]=h.getDay();var d=new Date(h.getFullYear(),0,1),m=(h.getTime()-d.getTime())/(1e3*60*60*24)|0;G[l+28>>2]=m,G[l+36>>2]=-(h.getTimezoneOffset()*60);var b=new Date(h.getFullYear(),6,1).getTimezoneOffset(),x=d.getTimezoneOffset(),_=(b!=x&&h.getTimezoneOffset()==Math.min(x,b))|0;G[l+32>>2]=_}function dm(u,l,h,d,m,b){try{var x=w.getStream(m);x&&(h&2&&ce.doMsync(u,x,l,d,b),w.munmap(x))}catch(_){if(typeof w>"u"||!(_ instanceof w.ErrnoError))throw _;return-_.errno}}function vm(u,l,h){var d=new Date().getFullYear(),m=new Date(d,0,1),b=new Date(d,6,1),x=m.getTimezoneOffset(),_=b.getTimezoneOffset(),T=Math.max(x,_);G[u>>2]=T*60,G[l>>2]=+(x!=_);function M(j){var he=j.toTimeString().match(/\(([A-Za-z ]+)\)$/);return he?he[1]:"GMT"}var B=M(m),I=M(b),U=Ri(B),N=Ri(I);_<x?(ue[h>>2]=U,ue[h+4>>2]=N):(ue[h>>2]=N,ue[h+4>>2]=U)}function ds(u,l,h){ds.called||(ds.called=!0,vm(u,l,h))}function gm(){ur("")}function Fl(){return 2147483648}function mm(){return Fl()}function ym(u,l,h){tt.copyWithin(u,l,l+h)}function wm(u){try{return ee.grow(u-Nt.byteLength+65535>>>16),fl(ee.buffer),1}catch{}}function bm(u){var l=tt.length;u=u>>>0;var h=Fl();if(u>h)return!1;let d=(T,M)=>T+(M-T%M)%M;for(var m=1;m<=4;m*=2){var b=l*(1+.2/m);b=Math.min(b,u+100663296);var x=Math.min(h,d(Math.max(u,b),65536)),_=wm(x);if(_)return!0}return!1}var vs={};function Sm(){return a||"./this.program"}function Bn(){if(!Bn.strings){var u=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",l={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:u,_:Sm()};for(var h in vs)vs[h]===void 0?delete l[h]:l[h]=vs[h];var d=[];for(var h in l)d.push(h+"="+l[h]);Bn.strings=d}return Bn.strings}function xm(u,l){var h=0;return Bn().forEach(function(d,m){var b=l+h;ue[u+m*4>>2]=b,Oi(d,b),h+=d.length+1}),0}function _m(u,l){var h=Bn();ue[u>>2]=h.length;var d=0;return h.forEach(function(m){d+=m.length+1}),ue[l>>2]=d,0}function Em(u){n1(u)}function Tm(u){try{var l=ce.getStreamFromFD(u);return w.close(l),0}catch(h){if(typeof w>"u"||!(h instanceof w.ErrnoError))throw h;return h.errno}}function km(u,l,h,d){for(var m=0,b=0;b<h;b++){var x=ue[l>>2],_=ue[l+4>>2];l+=8;var T=w.read(u,je,x,_,d);if(T<0)return-1;if(m+=T,T<_)break}return m}function Cm(u,l,h,d){try{var m=ce.getStreamFromFD(u),b=km(m,l,h);return G[d>>2]=b,0}catch(x){if(typeof w>"u"||!(x instanceof w.ErrnoError))throw x;return x.errno}}function Pm(u,l){return l+2097152>>>0<4194305-!!u?(u>>>0)+l*4294967296:NaN}function Am(u,l,h,d,m){try{var b=Pm(l,h);if(isNaN(b))return 61;var x=ce.getStreamFromFD(u);return w.llseek(x,b,d),zt=[x.position>>>0,(Xe=x.position,+Math.abs(Xe)>=1?Xe>0?(Math.min(+Math.floor(Xe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Xe-+(~~Xe>>>0))/4294967296)>>>0:0)],G[m>>2]=zt[0],G[m+4>>2]=zt[1],x.getdents&&b===0&&d===0&&(x.getdents=null),0}catch(_){if(typeof w>"u"||!(_ instanceof w.ErrnoError))throw _;return _.errno}}function Mm(u,l,h,d){for(var m=0,b=0;b<h;b++){var x=ue[l>>2],_=ue[l+4>>2];l+=8;var T=w.write(u,je,x,_,d);if(T<0)return-1;m+=T}return m}function Rm(u,l,h,d){try{var m=ce.getStreamFromFD(u),b=Mm(m,l,h);return ue[d>>2]=b,0}catch(x){if(typeof w>"u"||!(x instanceof w.ErrnoError))throw x;return x.errno}}function Ul(u){for(var l=u.split("."),h=0;h<4;h++){var d=Number(l[h]);if(isNaN(d))return null;l[h]=d}return(l[0]|l[1]<<8|l[2]<<16|l[3]<<24)>>>0}function In(u){return parseInt(u)}function Om(u){var l,h,d,m,b=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,x=[];if(!b.test(u))return null;if(u==="::")return[0,0,0,0,0,0,0,0];for(u.startsWith("::")?u=u.replace("::","Z:"):u=u.replace("::",":Z:"),u.indexOf(".")>0?(u=u.replace(new RegExp("[.]","g"),":"),l=u.split(":"),l[l.length-4]=In(l[l.length-4])+In(l[l.length-3])*256,l[l.length-3]=In(l[l.length-2])+In(l[l.length-1])*256,l=l.slice(0,l.length-2)):l=u.split(":"),d=0,m=0,h=0;h<l.length;h++)if(typeof l[h]=="string")if(l[h]==="Z"){for(m=0;m<8-l.length+1;m++)x[h+m]=0;d=m-1}else x[h+d]=Hl(parseInt(l[h],16));else x[h+d]=l[h];return[x[1]<<16|x[0],x[3]<<16|x[2],x[5]<<16|x[4],x[7]<<16|x[6]]}var cr={address_map:{id:1,addrs:{},names:{}},lookup_name:function(u){var l=Ul(u);if(l!==null||(l=Om(u),l!==null))return u;var h;if(cr.address_map.addrs[u])h=cr.address_map.addrs[u];else{var d=cr.address_map.id++;pe(d<65535,"exceeded max address mappings of 65535"),h="172.29."+(d&255)+"."+(d&65280),cr.address_map.names[h]=u,cr.address_map.addrs[u]=h}return h},lookup_addr:function(u){return cr.address_map.names[u]?cr.address_map.names[u]:null}};function Dm(u){var l=$t(20),h=$t(u.length+1);Ne(u,h,u.length+1),ue[l>>2]=h;var d=$t(4);ue[d>>2]=0,ue[l+4>>2]=d;var m=2;G[l+8>>2]=m,G[l+12>>2]=4;var b=$t(12);return ue[b>>2]=b+8,ue[b+4>>2]=0,G[b+8>>2]=Ul(cr.lookup_name(u)),ue[l+16>>2]=b,l}function Fm(u){return Dm(se(u))}function Um(u){var l=u.getExtension("ANGLE_instanced_arrays");if(l)return u.vertexAttribDivisor=function(h,d){l.vertexAttribDivisorANGLE(h,d)},u.drawArraysInstanced=function(h,d,m,b){l.drawArraysInstancedANGLE(h,d,m,b)},u.drawElementsInstanced=function(h,d,m,b,x){l.drawElementsInstancedANGLE(h,d,m,b,x)},1}function Lm(u){var l=u.getExtension("OES_vertex_array_object");if(l)return u.createVertexArray=function(){return l.createVertexArrayOES()},u.deleteVertexArray=function(h){l.deleteVertexArrayOES(h)},u.bindVertexArray=function(h){l.bindVertexArrayOES(h)},u.isVertexArray=function(h){return l.isVertexArrayOES(h)},1}function Bm(u){var l=u.getExtension("WEBGL_draw_buffers");if(l)return u.drawBuffers=function(h,d){l.drawBuffersWEBGL(h,d)},1}function Im(u){return!!(u.multiDrawWebgl=u.getExtension("WEBGL_multi_draw"))}var xe={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(l){xe.lastError||(xe.lastError=l)},getNewId:function(u){for(var l=xe.counter++,h=u.length;h<l;h++)u[h]=null;return l},getSource:function(u,l,h,d){for(var m="",b=0;b<l;++b){var x=d?G[d+b*4>>2]:-1;m+=se(G[h+b*4>>2],x<0?void 0:x)}return m},createContext:function(u,l){if(!u.getContextSafariWebGL2Fixed){let m=function(b,x){var _=u.getContextSafariWebGL2Fixed(b,x);return b=="webgl"==_ instanceof WebGLRenderingContext?_:null};u.getContextSafariWebGL2Fixed=u.getContext,u.getContext=m}var h=u.getContext("webgl",l);if(!h)return 0;var d=xe.registerContext(h,l);return d},registerContext:function(u,l){var h=xe.getNewId(xe.contexts),d={handle:h,attributes:l,version:l.majorVersion,GLctx:u};return u.canvas&&(u.canvas.GLctxObject=d),xe.contexts[h]=d,(typeof l.enableExtensionsByDefault>"u"||l.enableExtensionsByDefault)&&xe.initExtensions(d),h},makeContextCurrent:function(u){return xe.currentContext=xe.contexts[u],n.ctx=ot=xe.currentContext&&xe.currentContext.GLctx,!(u&&!ot)},getContext:function(u){return xe.contexts[u]},deleteContext:function(u){xe.currentContext===xe.contexts[u]&&(xe.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(xe.contexts[u].GLctx.canvas),xe.contexts[u]&&xe.contexts[u].GLctx.canvas&&(xe.contexts[u].GLctx.canvas.GLctxObject=void 0),xe.contexts[u]=null},initExtensions:function(u){if(u||(u=xe.currentContext),!u.initExtensionsDone){u.initExtensionsDone=!0;var l=u.GLctx;Um(l),Lm(l),Bm(l),l.disjointTimerQueryExt=l.getExtension("EXT_disjoint_timer_query"),Im(l);var h=l.getSupportedExtensions()||[];h.forEach(function(d){!d.includes("lose_context")&&!d.includes("debug")&&l.getExtension(d)})}}};function Ll(u){return u.slice(-1)=="]"&&u.lastIndexOf("[")}function Gm(u){var l=u.uniformLocsById,h=u.uniformSizeAndIdsByName,d,m;if(!l)for(u.uniformLocsById=l={},u.uniformArrayNamesById={},d=0;d<ot.getProgramParameter(u,35718);++d){var b=ot.getActiveUniform(u,d),x=b.name,_=b.size,T=Ll(x),M=T>0?x.slice(0,T):x,B=u.uniformIdCounter;for(u.uniformIdCounter+=_,h[M]=[_,B],m=0;m<_;++m)l[B]=m,u.uniformArrayNamesById[B++]=M}}function Nm(u,l){if(l=se(l),u=xe.programs[u]){Gm(u);var h=u.uniformLocsById,d=0,m=l,b=Ll(l);b>0&&(d=In(l.slice(b+1))>>>0,m=l.slice(0,b));var x=u.uniformSizeAndIdsByName[m];if(x&&d<x[0]&&(d+=x[1],h[d]=h[d]||ot.getUniformLocation(u,l)))return d}else xe.recordError(1281);return-1}function fr(u){var l=ot.currentProgram;if(l){var h=l.uniformLocsById[u];return typeof h=="number"&&(l.uniformLocsById[u]=h=ot.getUniformLocation(l,l.uniformArrayNamesById[u]+(h>0?"["+h+"]":""))),h}else xe.recordError(1282)}function zm(u,l){ot.uniform1f(fr(u),l)}function Hm(u,l){ot.uniform1i(fr(u),l)}var $i=[];function Wm(u,l,h){if(l<=144)for(var d=$i[2*l-1],m=0;m<2*l;m+=2)d[m]=xt[h+4*m>>2],d[m+1]=xt[h+(4*m+4)>>2];else var d=xt.subarray(h>>2,h+l*8>>2);ot.uniform2fv(fr(u),d)}var Yi=[];function Vm(u,l,h){if(l<=144)for(var d=Yi[2*l-1],m=0;m<2*l;m+=2)d[m]=G[h+4*m>>2],d[m+1]=G[h+(4*m+4)>>2];else var d=G.subarray(h>>2,h+l*8>>2);ot.uniform2iv(fr(u),d)}function $m(u,l,h){if(l<=96)for(var d=$i[3*l-1],m=0;m<3*l;m+=3)d[m]=xt[h+4*m>>2],d[m+1]=xt[h+(4*m+4)>>2],d[m+2]=xt[h+(4*m+8)>>2];else var d=xt.subarray(h>>2,h+l*12>>2);ot.uniform3fv(fr(u),d)}function Ym(u,l,h){if(l<=96)for(var d=Yi[3*l-1],m=0;m<3*l;m+=3)d[m]=G[h+4*m>>2],d[m+1]=G[h+(4*m+4)>>2],d[m+2]=G[h+(4*m+8)>>2];else var d=G.subarray(h>>2,h+l*12>>2);ot.uniform3iv(fr(u),d)}function Xm(u,l,h){if(l<=72){var d=$i[4*l-1],m=xt;h>>=2;for(var b=0;b<4*l;b+=4){var x=h+b;d[b]=m[x],d[b+1]=m[x+1],d[b+2]=m[x+2],d[b+3]=m[x+3]}}else var d=xt.subarray(h>>2,h+l*16>>2);ot.uniform4fv(fr(u),d)}function qm(u,l,h){if(l<=72)for(var d=Yi[4*l-1],m=0;m<4*l;m+=4)d[m]=G[h+4*m>>2],d[m+1]=G[h+(4*m+4)>>2],d[m+2]=G[h+(4*m+8)>>2],d[m+3]=G[h+(4*m+12)>>2];else var d=G.subarray(h>>2,h+l*16>>2);ot.uniform4iv(fr(u),d)}function jm(u){}function Xi(u){return u%4===0&&(u%100!==0||u%400===0)}function Zm(u,l){for(var h=0,d=0;d<=l;h+=u[d++]);return h}var Bl=[31,29,31,30,31,30,31,31,30,31,30,31],Il=[31,28,31,30,31,30,31,31,30,31,30,31];function Km(u,l){for(var h=new Date(u.getTime());l>0;){var d=Xi(h.getFullYear()),m=h.getMonth(),b=(d?Bl:Il)[m];if(l>b-h.getDate())l-=b-h.getDate()+1,h.setDate(1),m<11?h.setMonth(m+1):(h.setMonth(0),h.setFullYear(h.getFullYear()+1));else return h.setDate(h.getDate()+l),h}return h}function Qm(u,l,h,d){var m=G[d+40>>2],b={tm_sec:G[d>>2],tm_min:G[d+4>>2],tm_hour:G[d+8>>2],tm_mday:G[d+12>>2],tm_mon:G[d+16>>2],tm_year:G[d+20>>2],tm_wday:G[d+24>>2],tm_yday:G[d+28>>2],tm_isdst:G[d+32>>2],tm_gmtoff:G[d+36>>2],tm_zone:m?se(m):""},x=se(h),_={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var T in _)x=x.replace(new RegExp(T,"g"),_[T]);var M=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=["January","February","March","April","May","June","July","August","September","October","November","December"];function I(F,X,He){for(var me=typeof F=="number"?F.toString():F||"";me.length<X;)me=He[0]+me;return me}function U(F,X){return I(F,X,"0")}function N(F,X){function He(at){return at<0?-1:at>0?1:0}var me;return(me=He(F.getFullYear()-X.getFullYear()))===0&&(me=He(F.getMonth()-X.getMonth()))===0&&(me=He(F.getDate()-X.getDate())),me}function j(F){switch(F.getDay()){case 0:return new Date(F.getFullYear()-1,11,29);case 1:return F;case 2:return new Date(F.getFullYear(),0,3);case 3:return new Date(F.getFullYear(),0,2);case 4:return new Date(F.getFullYear(),0,1);case 5:return new Date(F.getFullYear()-1,11,31);case 6:return new Date(F.getFullYear()-1,11,30)}}function he(F){var X=Km(new Date(F.tm_year+1900,0,1),F.tm_yday),He=new Date(X.getFullYear(),0,4),me=new Date(X.getFullYear()+1,0,4),at=j(He),Oe=j(me);return N(at,X)<=0?N(Oe,X)<=0?X.getFullYear()+1:X.getFullYear():X.getFullYear()-1}var Ce={"%a":function(F){return M[F.tm_wday].substring(0,3)},"%A":function(F){return M[F.tm_wday]},"%b":function(F){return B[F.tm_mon].substring(0,3)},"%B":function(F){return B[F.tm_mon]},"%C":function(F){var X=F.tm_year+1900;return U(X/100|0,2)},"%d":function(F){return U(F.tm_mday,2)},"%e":function(F){return I(F.tm_mday,2," ")},"%g":function(F){return he(F).toString().substring(2)},"%G":function(F){return he(F)},"%H":function(F){return U(F.tm_hour,2)},"%I":function(F){var X=F.tm_hour;return X==0?X=12:X>12&&(X-=12),U(X,2)},"%j":function(F){return U(F.tm_mday+Zm(Xi(F.tm_year+1900)?Bl:Il,F.tm_mon-1),3)},"%m":function(F){return U(F.tm_mon+1,2)},"%M":function(F){return U(F.tm_min,2)},"%n":function(){return`
`},"%p":function(F){return F.tm_hour>=0&&F.tm_hour<12?"AM":"PM"},"%S":function(F){return U(F.tm_sec,2)},"%t":function(){return"	"},"%u":function(F){return F.tm_wday||7},"%U":function(F){var X=F.tm_yday+7-F.tm_wday;return U(Math.floor(X/7),2)},"%V":function(F){var X=Math.floor((F.tm_yday+7-(F.tm_wday+6)%7)/7);if((F.tm_wday+371-F.tm_yday-2)%7<=2&&X++,X){if(X==53){var me=(F.tm_wday+371-F.tm_yday)%7;me!=4&&(me!=3||!Xi(F.tm_year))&&(X=1)}}else{X=52;var He=(F.tm_wday+7-F.tm_yday-1)%7;(He==4||He==5&&Xi(F.tm_year%400-1))&&X++}return U(X,2)},"%w":function(F){return F.tm_wday},"%W":function(F){var X=F.tm_yday+7-(F.tm_wday+6)%7;return U(Math.floor(X/7),2)},"%y":function(F){return(F.tm_year+1900).toString().substring(2)},"%Y":function(F){return F.tm_year+1900},"%z":function(F){var X=F.tm_gmtoff,He=X>=0;return X=Math.abs(X)/60,X=X/60*100+X%60,(He?"+":"-")+("0000"+X).slice(-4)},"%Z":function(F){return F.tm_zone},"%%":function(){return"%"}};x=x.replace(/%%/g,"\0\0");for(var T in Ce)x.includes(T)&&(x=x.replace(new RegExp(T,"g"),Ce[T](b)));x=x.replace(/\0\0/g,"%");var Re=Zi(x,!1);return Re.length>l?0:(Mn(Re,u),Re.length-1)}function Jm(u,l,h,d){return Qm(u,l,h,d)}var Gl=function(u,l,h,d){u||(u=this),this.parent=u,this.mount=u.mount,this.mounted=null,this.id=w.nextInode++,this.name=l,this.mode=h,this.node_ops={},this.stream_ops={},this.rdev=d},qi=365,ji=146;Object.defineProperties(Gl.prototype,{read:{get:function(){return(this.mode&qi)===qi},set:function(u){u?this.mode|=qi:this.mode&=~qi}},write:{get:function(){return(this.mode&ji)===ji},set:function(u){u?this.mode|=ji:this.mode&=~ji}},isFolder:{get:function(){return w.isDir(this.mode)}},isDevice:{get:function(){return w.isChrdev(this.mode)}}}),w.FSNode=Gl,w.staticInit(),Jg(),Xr=n.BindingError=ts(Error,"BindingError"),xl=n.InternalError=ts(Error,"InternalError"),m0(),l0(),T0(),Pl=n.UnboundTypeError=ts(Error,"UnboundTypeError"),L0();for(var ot,e1=new Float32Array(288),Vt=0;Vt<288;++Vt)$i[Vt]=e1.subarray(0,Vt+1);for(var t1=new Int32Array(288),Vt=0;Vt<288;++Vt)Yi[Vt]=t1.subarray(0,Vt+1);function Zi(u,l,h){var d=h>0?h:be(u)+1,m=new Array(d),b=Ee(u,m,0,m.length);return l&&(m.length=b),m}var r1={_:Dg,k:Fg,a:Ug,b:Bg,S:Hg,T:Wg,p:$g,M:Yg,V:Xg,J:qg,K:jg,t:Zg,L:Kg,B:Qg,X:r0,d:M0,f:R0,e:O0,c:D0,W:B0,i:G0,h:N0,w:H0,j:V0,g:$0,v:Y0,q:X0,Y:q0,P:j0,O:K0,m:Q0,la:tm,y:cs,ma:rm,ka:om,r:sm,z:am,ja:um,na:lm,n:cm,l:fm,x:hm,Q:pm,G:dm,R:ds,s:gm,F:mm,N:ym,E:bm,H:xm,I:_m,$:Em,o:Tm,U:Cm,A:Am,u:Rm,Z:Fm,ia:Nm,ga:zm,ha:Hm,ca:Wm,fa:Vm,ba:$m,ea:Ym,aa:Xm,da:qm,C:jm,D:Jm};Og(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.pa).apply(null,arguments)};var $t=n._malloc=function(){return($t=n._malloc=n.asm.qa).apply(null,arguments)},Yt=n._free=function(){return(Yt=n._free=n.asm.ra).apply(null,arguments)},Nl=n.___errno_location=function(){return(Nl=n.___errno_location=n.asm.sa).apply(null,arguments)},zl=n.___getTypeName=function(){return(zl=n.___getTypeName=n.asm.ta).apply(null,arguments)};n.___embind_register_native_and_builtin_types=function(){return(n.___embind_register_native_and_builtin_types=n.asm.ua).apply(null,arguments)};var Hl=n._htons=function(){return(Hl=n._htons=n.asm.wa).apply(null,arguments)},Wl=n._emscripten_builtin_memalign=function(){return(Wl=n._emscripten_builtin_memalign=n.asm.xa).apply(null,arguments)},Vl=n.___cxa_is_pointer_type=function(){return(Vl=n.___cxa_is_pointer_type=n.asm.ya).apply(null,arguments)};n.dynCall_jiji=function(){return(n.dynCall_jiji=n.asm.za).apply(null,arguments)},n.dynCall_viijii=function(){return(n.dynCall_viijii=n.asm.Aa).apply(null,arguments)},n.dynCall_iiiiij=function(){return(n.dynCall_iiiiij=n.asm.Ba).apply(null,arguments)},n.dynCall_iiiiijj=function(){return(n.dynCall_iiiiijj=n.asm.Ca).apply(null,arguments)},n.dynCall_iiiiiijj=function(){return(n.dynCall_iiiiiijj=n.asm.Da).apply(null,arguments)},n.dynCall_viiiiji=function(){return(n.dynCall_viiiiji=n.asm.Ea).apply(null,arguments)},n.FS=w;var Ki;function gs(u){this.name="ExitStatus",this.message="Program terminated with exit("+u+")",this.status=u}On=function u(){Ki||ms(),Ki||(On=u)};function ms(u){if(yr>0||(Eg(),yr>0))return;function l(){Ki||(Ki=!0,n.calledRun=!0,!te&&(Tg(),i(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),kg()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),l()},1)):l()}n.run=ms;function n1(u,l){i1(u)}function i1(u){gl()||(n.onExit&&n.onExit(u),te=!0),c(u,new gs(u))}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return ms(),n.ready}})(),Pe="/assets/replicad_single-356dd161.wasm";const Le={library:null},Gn=r=>{Le.library=r},W=()=>{if(!Le.library)throw new Error("oppencascade has not been loaded");return Le.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const _r=new globalThis.FinalizationRegistry(r=>{try{r.delete()}catch(e){console.error(e)}});class Mt{constructor(e){this.oc=W(),e&&_r.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(_r.unregister(this._wrapped),this._wrapped.delete()),_r.register(this,e,e),this._wrapped=e}delete(){var e;_r.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const Fe=()=>{function r(e){return _r.register(r,e),e}return r},ws=r=>{function e(n){return _r.register(r,n),n}return e},Be=r=>{const e=new Set;return[n=>(e.add(n),n),()=>{[...e.values()].forEach(n=>n.delete()),e.clear()},r?e:void 0]},bs=2147483647,gt=Math.PI/180,qr=180/Math.PI,Qi=r=>Math.round(r*1e3)/1e3,jr=(r,e,n)=>{const i=W(),o=ut(r),s=Er(e);let a;if(n){const c=Er(n);a=new i.gp_Ax3_3(o,s,c),c.delete()}else a=new i.gp_Ax3_4(o,s);return o.delete(),s.delete(),a},Ss=(r,e,n)=>{const i=W(),o=ut(r),s=Er(e);let a;if(n){const c=Er(n);a=new i.gp_Ax2_2(o,s,c),c.delete()}else a=new i.gp_Ax2_3(o,s);return o.delete(),s.delete(),a},xs=(r,e)=>{const n=W(),i=ut(r),o=Er(e),s=new n.gp_Ax1_2(i,o);return i.delete(),o.delete(),s},Yl=(r=[0,0,0])=>{const e=W();if(Array.isArray(r)){if(r.length===3)return new e.gp_Vec_4(...r);if(r.length===2)return new e.gp_Vec_4(...r,0)}else{if(r instanceof oe)return new e.gp_Vec_3(r.wrapped.XYZ());if(r.XYZ)return new e.gp_Vec_3(r.XYZ())}return new e.gp_Vec_4(0,0,0)};class oe extends Mt{constructor(e=[0,0,0]){super(Yl(e))}get repr(){return`x: ${Qi(this.x)}, y: ${Qi(this.y)}, z: ${Qi(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new oe(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new oe(this.wrapped.Subtracted(e.wrapped))}add(e){return new oe(this.wrapped.Added(e.wrapped))}multiply(e){return new oe(this.wrapped.Multiplied(e))}normalized(){return new oe(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*qr}projectToPlane(e){const n=e.origin,i=e.zDir,o=this.sub(n),s=i.multiply(o.dot(i)/i.Length**2),a=this.sub(s);return o.delete(),s.delete(),a}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,n=[0,0,0],i=[0,0,1]){const o=xs(n,i);return this.wrapped.Rotate(o,e*gt),o.delete(),this}}const Xl={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function ql(r){return r==="X"||r==="Y"||r==="Z"?Xl[r]:r}function ut(r){const e=new oe(r),n=e.toPnt();return e.delete(),n}function Er(r){const e=new oe(r),n=e.toDir();return e.delete(),n}class Tr extends Mt{constructor(e){const n=W();super(e||new n.gp_Trsf_1)}translate(e,n=0,i=0){const o=new oe(typeof e=="number"?[e,n,i]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,n=[0,0,0],i=[0,0,1]){const o=Er(i),s=ut(n),a=new this.oc.gp_Ax1_2(s,o);return this.wrapped.SetRotation_1(a,e*gt),a.delete(),o.delete(),s.delete(),this}mirror(e="YZ",n){const i=Fe();let o,s;if(typeof e=="string"){const c=i(_s(e,n));o=c.origin,s=c.zDir}else e instanceof nt?(o=n||e.origin,s=e.zDir):(o=n||[0,0,0],s=e);const a=i(Ss(o,s));return this.wrapped.SetMirror_3(a),this}scale(e,n){const i=ut(e);return this.wrapped.SetScale(i,n),i.delete(),this}coordSystemChange(e,n){const i=Fe(),o=i(e==="reference"?new this.oc.gp_Ax3_1:jr(e.origin,e.zDir,e.xDir)),s=i(n==="reference"?new this.oc.gp_Ax3_1:jr(n.origin,n.zDir,n.xDir));return this.wrapped.SetTransformation_1(o,s),this}transformPoint(e){const n=ut(e),i=n.Transformed(this.wrapped);return n.delete(),i}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class nt{constructor(e,n=null,i=[0,0,1]){this.oc=W();const o=new oe(i);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let s;if(n)s=new oe(n);else{const a=jr(e,o);s=new oe(a.XDirection()),a.delete()}if(s.Length===0)throw new Error("xDir should be non null");this.xDir=s.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new oe(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new nt(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const n=this.clone();return n.origin=new oe(e),n}translate(e,n=0,i=0){const o=new oe(typeof e=="number"?[e,n,i]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,n=[1,0,0]){const i=ql(n),o=new oe(this.zDir).rotate(e,[0,0,0],i),s=new oe(this.xDir).rotate(e,[0,0,0],i);return new nt(this.origin,s,o)}rotate2DAxes(e){const n=new oe(this.xDir).rotate(e,[0,0,0],this.zDir);return new nt(this.origin,n,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,n=jr(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,n),this.globalToLocal=new Tr,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new Tr,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,n){this.origin=this.toWorldCoords([e,n])}toLocalCoords(e){const n=this.globalToLocal.transformPoint(e),i=new oe(n);return n.delete(),i}toWorldCoords(e){const n=this.localToGlobal.transformPoint(e),i=new oe(n);return n.delete(),i}}const jl={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},_s=(r,e=[0,0,0])=>{const n=jl[r];if(!n)throw new Error(`Could not find plane ${r}`);let i;return typeof e=="number"?i=n.normal.map(o=>o*e):i=e,new nt(i,n.xDir,n.normal)};let Zl=class extends Mt{constructor(e){const n=W();let i=e;i||(i=new n.Bnd_Box_1),super(i)}get repr(){const[e,n]=this.bounds;return`${new oe(e).repr} - ${new oe(n).repr}`}get bounds(){const e={current:0},n={current:0},i={current:0},o={current:0},s={current:0},a={current:0};return this.wrapped.Get(e,n,i,o,s,a),[[e.current,n.current,i.current],[o.current,s.current,a.current]]}get center(){const[[e,n,i],[o,s,a]]=this.bounds;return[e+(o-e)/2,n+(s-n)/2,i+(a-i)/2]}get width(){const[[e],[n]]=this.bounds;return Math.abs(n-e)}get height(){const[[,e],[,n]]=this.bounds;return Math.abs(n-e)}get depth(){const[[,,e],[,,n]]=this.bounds;return Math.abs(n-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function Et(r="XY",e=[0,0,0]){return r instanceof nt?r.clone():_s(r,e)}function Kl(r,e,n=[0,0,0],i=[0,0,1]){const o=new Tr;o.rotate(e,n,i);const s=o.transform(r);return o.delete(),s}function Ql(r,e){const n=new Tr;n.translate(e);const i=n.transform(r);return n.delete(),i}function Jl(r,e,n){const i=new Tr;i.mirror(e,n);const o=i.transform(r);return i.delete(),o}function ec(r,e,n){const i=new Tr;i.scale(e,n);const o=i.transform(r);return i.delete(),o}function Nn(r){return Array.isArray(r)&&r.length===2}let zn=null;const Es=r=>{if(zn&&!r)return zn;const n=W().GeomAbs_CurveType;return zn=new Map([[n.GeomAbs_Line,"LINE"],[n.GeomAbs_Circle,"CIRCLE"],[n.GeomAbs_Ellipse,"ELLIPSE"],[n.GeomAbs_Hyperbola,"HYPERBOLA"],[n.GeomAbs_Parabola,"PARABOLA"],[n.GeomAbs_BezierCurve,"BEZIER_CURVE"],[n.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[n.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[n.GeomAbs_OtherCurve,"OTHER_CURVE"]]),zn},Hn=r=>{let e=Es().get(r);if(e||(e=Es(!0).get(r)),!e)throw new Error("unknown type");return e};function tc(r,e){const n=Math.pow(10,e),i=e<0?r:.01/n+r;return Math.round(i*n)/n}function rc(r){return Array.from(Array(r).keys())}function kr(r){const e=Math.min(...r.map(n=>n.length));return rc(e).map(n=>r.map(i=>i[n]))}function Wn(r){return Math.round(r*100)/100}const Zr=([r,e])=>`(${Wn(r)},${Wn(e)})`,Ts=(r,e=1e-9)=>{let n=r;return Math.abs(r)<e&&(n=0),n.toFixed(-Math.log10(e))},ks=(r,e=1e-9)=>Array.from(new Map(r.map(([n,i])=>[`[${Ts(n,e)},${Ts(i,e)}]`,[n,i]])).values()),qe=([r,e])=>{const n=W();return new n.gp_Pnt2d_3(r,e)},nc=([r,e])=>{const n=W();return new n.gp_Dir2d_4(r,e)},Cs=([r,e])=>{const n=W();return new n.gp_Vec2d_4(r,e)},Cr=(r,e)=>{const n=W(),[i,o]=Be(),s=new n.gp_Ax2d_2(i(qe(r)),i(nc(e)));return o(),s};class Kr extends Mt{constructor(e){const n=W();let i=e;i||(i=new n.Bnd_Box2d),super(i)}get repr(){const[e,n]=this.bounds;return`${Zr(e)} - ${Zr(n)}`}get bounds(){const e={current:0},n={current:0},i={current:0},o={current:0};return this.wrapped.Get(e,n,i,o),[[e.current,n.current],[i.current,o.current]]}get center(){const[[e,n],[i,o]]=this.bounds;return[e+(i-e)/2,n+(o-n)/2]}get width(){const[[e],[n]]=this.bounds;return Math.abs(n-e)}get height(){const[[,e],[,n]]=this.bounds;return Math.abs(n-e)}outsidePoint(e=1){const[n,i]=this.bounds,o=i[0]-n[0],s=i[1]-n[1];return[i[0]+o/100*e,i[1]+s/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const i=Fe()(qe(e));return!this.wrapped.IsOut_1(i)}}const Ze=([r,e],[n,i],o=1e-6)=>Math.abs(r-n)<=o&&Math.abs(e-i)<=o,Pr=([r,e],[n,i])=>[r+n,e+i],Ji=([r,e],[n,i])=>[r-n,e-i],eo=([r,e],n)=>[r*n,e*n],Tt=([r,e],[n,i]=[0,0])=>Math.sqrt((r-n)**2+(e-i)**2),ic=([r,e],[n,i]=[0,0])=>(r-n)**2+(e-i)**2;function oc([r,e],[n,i]){return r*i-e*n}const sc=([r,e],[n,i]=[0,0])=>Math.atan2(i*r-e*n,r*n+e*i),ac=([r,e],[n,i]=[0,0])=>Math.atan2(i-e,n-r),Xt=([r,e])=>{const n=Tt([r,e]);return[r/n,e/n]},uc=(r,e,n=[0,0])=>{const[i,o]=r,[s,a]=n,c=i-s,f=o-a,p=Math.sin(e),v=Math.cos(e),y=c*v-f*p,g=c*p+f*v;return[y+s,g+a]},Ar=(r,e)=>{const n=Math.cos(e)*r,i=Math.sin(e)*r;return[n,i]},lc=([r,e])=>{const n=Tt([r,e]),i=Math.atan2(e,r);return[n,i]};class Ae extends Mt{constructor(e){const n=W(),i=e.get();super(new n.Handle_Geom2d_Curve_2(i)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=W(),n=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,n),this._boundingBox=new Kr(n),this._boundingBox}get repr(){return`${this.geomType} ${Zr(this.firstPoint)} - ${Zr(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const n=this.innerCurve.Value(e),i=[n.X(),n.Y()];return n.delete(),i}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=W();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),n=Hn(e.GetType());return e.delete(),n}clone(){return new Ae(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const n=W(),i=Fe(),o=i(new n.Geom2dAPI_ProjectPointOnCurve_2(i(qe(e)),this.wrapped));let s=1/0;try{s=o.LowerDistance()}catch{s=1/0}return Math.min(s,Tt(e,this.firstPoint),Tt(e,this.lastPoint))}distanceFromCurve(e){const n=W(),i=Fe();let o=1/0;const s=i(new n.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=s.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return Nn(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,n=1e-9){const i=W(),o=Fe();let s,a;try{const c=o(new i.Geom2dAPI_ProjectPointOnCurve_2(o(qe(e)),this.wrapped));s=c.LowerDistance(),a=c.LowerDistanceParameter()}catch{if(Ze(e,this.firstPoint,n))return this.firstParameter;if(Ze(e,this.lastPoint,n))return this.lastParameter;throw new Error("Failed to find parameter")}if(s>n)throw new Error(`Point ${Zr(e)} not on curve ${this.repr}, ${s.toFixed(9)}`);return a}tangentAt(e){const n=W(),[i,o]=Be();let s;Array.isArray(e)?s=this.parameter(e):s=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const a=i(new n.gp_Pnt2d_1),c=i(new n.gp_Vec2d_1);this.innerCurve.D1(s,a,c);const f=[c.X(),c.Y()];return o(),f}splitAt(e,n=1e-9){const i=W(),o=Fe();let s=e.map(f=>Nn(f)?this.parameter(f,n):f);s=Array.from(new Map(s.map(f=>[tc(f,-Math.log10(n)),f])).values()).sort((f,p)=>f-p);const a=this.firstParameter,c=this.lastParameter;return a>c&&s.reverse(),Math.abs(s[0]-a)<n*100&&(s=s.slice(1)),s.length?(Math.abs(s[s.length-1]-c)<n*100&&(s=s.slice(0,-1)),s.length?kr([[a,...s],[...s,c]]).map(([f,p])=>{try{if(this.geomType==="BEZIER_CURVE"){const y=new i.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return y.Segment(f,p),new Ae(new i.Handle_Geom2d_Curve_2(y))}if(this.geomType==="BSPLINE_CURVE"){const y=o(this.adaptor()).BSpline().get(),g=new i.Geom2d_BSplineCurve_1(y.Poles_2(),y.Knots_2(),y.Multiplicities_2(),y.Degree(),y.IsPeriodic());return g.Segment(f,p,n),new Ae(new i.Handle_Geom2d_Curve_2(g))}const v=new i.Geom2d_TrimmedCurve(this.wrapped,f,p,!0,!0);return new Ae(new i.Handle_Geom2d_Curve_2(v))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const Ps=(r,e=1e-8)=>{const n=W(),o=Fe()(new n.Geom2dConvert_ApproxCurve_2(r.ShallowCopy(),e,n.GeomAbs_Shape.GeomAbs_C0,30,3));return new Ae(o.Curve())},As=r=>{if(Hn(r.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=r.BSpline(),n=W(),i=new n.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const a=i.NbArcs();if(a)for(let c=1;c<=a;c++){const f=i.Arc(c);yield new Ae(f)}}const s=Array.from(o());return i.delete(),s};function*Ms(r){const e=r.NbPoints();if(e)for(let n=1;n<=e;n++){const i=r.Point(n);yield[i.X(),i.Y()]}}function*cc(r){const e=r.NbSegments();if(!e)return;const n=W();for(let i=1;i<=e;i++){const o=new n.Handle_Geom2d_Curve_1,s=new n.Handle_Geom2d_Curve_1;try{r.Segment(i,o,s)}catch{continue}yield new Ae(o),s.delete()}}const Qr=(r,e,n=1e-9)=>{if(r.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const i=W(),o=new i.Geom2dAPI_InterCurveCurve_1;let s,a;try{o.Init_1(r.wrapped,e.wrapped,n),s=Array.from(Ms(o)),a=Array.from(cc(o))}catch(p){throw console.error(r,e,p),new Error("Intersections failed between curves")}finally{o.delete()}const c=a.filter(p=>Ze(p.firstPoint,p.lastPoint,n)).map(p=>p.firstPoint);c.length&&(s.push(...c),a=a.filter(p=>!Ze(p.firstPoint,p.lastPoint,n)));const f=a.flatMap(p=>[p.firstPoint,p.lastPoint]);return{intersections:s,commonSegments:a,commonSegmentsPoints:f}},fc=(r,e=1e-9)=>{const n=W(),i=new n.Geom2dAPI_InterCurveCurve_1;let o;try{i.Init_1(r.wrapped,r.wrapped,e),o=Array.from(Ms(i))}catch{throw new Error("Self intersection failed")}finally{i.delete()}return o},Jr=(r,e)=>{const n=W(),[i,o]=Be(),s=i(new n.GCE2d_MakeSegment_1(i(qe(r)),i(qe(e)))).Value(),a=new Ae(s);return Ze(a.firstPoint,r)||a.reverse(),o(),a},to=(r,e,n)=>{const i=W(),[o,s]=Be(),a=o(new i.GCE2d_MakeArcOfCircle_4(o(qe(r)),o(qe(e)),o(qe(n)))).Value();s();const c=new Ae(a);return Ze(c.firstPoint,r)||c.wrapped.get().SetTrim(c.lastParameter,c.firstParameter,!0,!0),c},hc=(r,e,n)=>{const i=W(),[o,s]=Be(),a=o(new i.GCE2d_MakeArcOfCircle_5(o(qe(r)),o(Cs(e)),o(qe(n)))).Value();s();const c=new Ae(a);return Ze(c.firstPoint,r)||c.wrapped.get().SetTrim(c.lastParameter,c.firstParameter,!0,!0),c},pc=(r,e,n,i,o=[0,0],s,a=!0)=>{const c=W(),[f,p]=Be(),v=f(new c.gp_Elips2d_2(f(Cr(o,s)),r,e,!0)),y=f(new c.GCE2d_MakeArcOfEllipse_1(v,n,i,a)).Value();return p(),new Ae(y)},dc=(r,e,n)=>{const i=W(),[o,s]=Be(),a=o(new i.TColgp_Array1OfPnt2d_2(1,e.length+2));a.SetValue(1,o(qe(r))),e.forEach((f,p)=>{a.SetValue(p+2,o(qe(f)))}),a.SetValue(e.length+2,o(qe(n)));const c=new i.Geom2d_BezierCurve_1(a);return s(),new Ae(new i.Handle_Geom2d_Curve_2(c))},Rs=(r,e,n)=>{const i=eo(Pr(r,e),.5),o=Tt(n,r),s=Xt(Ji(i,n));return to(r,Pr(eo(s,o),n),e)},vc=(r,e,n)=>{const i=Xt(Ji(e,r)),o=[i[1],-i[0]],s=[o[0]*n,o[1]*n];return{firstPoint:Pr(r,s),lastPoint:Pr(e,s)}},ro=(r,e)=>{const n=Fe(),i=r.geomType;if(i==="CIRCLE"){const f=n(n(r.adaptor()).Circle()),p=f.Radius(),v=f.IsDirect()?1:-1,y=e*v,g=p+y;if(g<1e-10){const P=n(f.Location()),R=[P.X(),P.Y()],O=q=>{const[D,K]=Xt(Ji(q,R));return Pr(q,[y*D,y*K])};return{collapsed:!0,firstPoint:O(r.firstPoint),lastPoint:O(r.lastPoint)}}const S=W(),E=new S.gp_Circ2d_3(f.Axis(),g),k=new S.Geom2d_Circle_1(E),C=new S.Geom2d_TrimmedCurve(new S.Handle_Geom2d_Curve_2(k),r.firstParameter,r.lastParameter,!0,!0);return new Ae(new S.Handle_Geom2d_Curve_2(C))}if(i==="LINE"){const{firstPoint:f,lastPoint:p}=vc(r.firstPoint,r.lastPoint,e);return Jr(f,p)}const o=W(),s=new Ae(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(r.wrapped,e,!0))),a=Ps(s.adaptor());return fc(a).length?{collapsed:!0,firstPoint:a.firstPoint,lastPoint:a.lastPoint}:a};function Os(r,e,n){const i=oc(r.tangentAt(1),e.tangentAt(0));if(Math.abs(i)<1e-10)return null;const o=i>0?-1:1,s=Math.abs(n)*o,a=ro(r,s),c=ro(e,s);if(!(a instanceof Ae)||!(c instanceof Ae))return null;let f;try{const{intersections:S}=Qr(a,c,1e-9);f=S.at(-1)}catch{return null}if(!Nn(f))return null;const p=f,v=(S,E)=>{const[k,C]=E.tangentAt(p),P=Xt([-C,k]),R=Pr(p,eo(P,s)),O=S.parameter(R,1e-6);return S.splitAt([O])},[y]=v(r,a),[,g]=v(e,c);return{first:y,second:g,center:p}}function no(r,e,n){const i=Os(r,e,n);if(!i)return console.warn("Cannot fillet between curves",r.repr,e.repr),[r,e];const{first:o,second:s,center:a}=i;return[o,Rs(o.lastPoint,s.firstPoint,a),s]}function io(r,e,n){const i=Os(r,e,n);if(!i)return console.warn("Cannot chamfer between curves",r.repr,e.repr),[r,e];const{first:o,second:s}=i;return[o,Jr(o.lastPoint,s.firstPoint),s]}class gc{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,n){let i=this.length++;for(;i>0;){const o=i-1>>1,s=this.values[o];if(n>=s)break;this.ids[i]=this.ids[o],this.values[i]=s,i=o}this.ids[i]=e,this.values[i]=n}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],o=this.length>>1;let s=0;for(;s<o;){let a=(s<<1)+1;const c=a+1;let f=this.ids[a],p=this.values[a];const v=this.values[c];if(c<this.length&&v<p&&(a=c,f=this.ids[c],p=v),p>=i)break;this.ids[s]=f,this.values[s]=p,s=a}this.ids[s]=n,this.values[s]=i}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Ds=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],oo=3;class so{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,i]=new Uint8Array(e,0,2);if(n!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(i>>4!==oo)throw new Error(`Got v${i>>4} data when expected v${oo}.`);const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new so(s,o,Ds[i&15],e)}constructor(e,n=16,i=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535);let s=e,a=s;this._levelBounds=[s*4];do s=Math.ceil(s/this.nodeSize),a+=s,this._levelBounds.push(a*4);while(s!==1);this.ArrayType=i||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const c=Ds.indexOf(this.ArrayType),f=a*4*this.ArrayType.BYTES_PER_ELEMENT;if(c<0)throw new Error(`Unexpected typed array class: ${i}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+f,a),this._pos=a*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+f+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+f,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(oo<<4)+c]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e),this._queue=new gc}add(e,n,i,o){const s=this._pos>>2;return this._indices[s]=s,this._boxes[this._pos++]=e,this._boxes[this._pos++]=n,this._boxes[this._pos++]=i,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),n<this.minY&&(this.minY=n),i>this.maxX&&(this.maxX=i),o>this.maxY&&(this.maxY=o),s}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,n=this.maxY-this.minY||1,i=new Uint32Array(this.numItems),o=65536-1;for(let s=0;s<this.numItems;s++){let a=4*s;const c=this._boxes[a++],f=this._boxes[a++],p=this._boxes[a++],v=this._boxes[a++],y=Math.floor(o*((c+p)/2-this.minX)/e),g=Math.floor(o*((f+v)/2-this.minY)/n);i[s]=yc(y,g)}ao(i,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let s=0,a=0;s<this._levelBounds.length-1;s++){const c=this._levelBounds[s];for(;a<c;){const f=a;let p=1/0,v=1/0,y=-1/0,g=-1/0;for(let S=0;S<this.nodeSize&&a<c;S++)p=Math.min(p,this._boxes[a++]),v=Math.min(v,this._boxes[a++]),y=Math.max(y,this._boxes[a++]),g=Math.max(g,this._boxes[a++]);this._indices[this._pos>>2]=f,this._boxes[this._pos++]=p,this._boxes[this._pos++]=v,this._boxes[this._pos++]=y,this._boxes[this._pos++]=g}}}search(e,n,i,o,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const c=[],f=[];for(;a!==void 0;){const p=Math.min(a+this.nodeSize*4,Us(a,this._levelBounds));for(let v=a;v<p;v+=4){if(i<this._boxes[v]||o<this._boxes[v+1]||e>this._boxes[v+2]||n>this._boxes[v+3])continue;const y=this._indices[v>>2]|0;a<this.numItems*4?(s===void 0||s(y))&&f.push(y):c.push(y)}a=c.pop()}return f}neighbors(e,n,i=1/0,o=1/0,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const c=this._queue,f=[],p=o*o;for(;a!==void 0;){const v=Math.min(a+this.nodeSize*4,Us(a,this._levelBounds));for(let y=a;y<v;y+=4){const g=this._indices[y>>2]|0,S=Fs(e,this._boxes[y],this._boxes[y+2]),E=Fs(n,this._boxes[y+1],this._boxes[y+3]),k=S*S+E*E;a<this.numItems*4?(s===void 0||s(g))&&c.push((g<<1)+1,k):c.push(g<<1,k)}for(;c.length&&c.peek()&1;)if(c.peekValue()>p||(f.push(c.pop()>>1),f.length===i))return c.clear(),f;a=c.pop()>>1}return c.clear(),f}}function Fs(r,e,n){return r<e?e-r:r<=n?0:r-n}function Us(r,e){let n=0,i=e.length-1;for(;n<i;){const o=n+i>>1;e[o]>r?i=o:n=o+1}return e[n]}function ao(r,e,n,i,o,s){if(Math.floor(i/s)>=Math.floor(o/s))return;const a=r[i+o>>1];let c=i-1,f=o+1;for(;;){do c++;while(r[c]<a);do f--;while(r[f]>a);if(c>=f)break;mc(r,e,n,c,f)}ao(r,e,n,i,f,s),ao(r,e,n,f+1,o,s)}function mc(r,e,n,i,o){const s=r[i];r[i]=r[o],r[o]=s;const a=4*i,c=4*o,f=e[a],p=e[a+1],v=e[a+2],y=e[a+3];e[a]=e[c],e[a+1]=e[c+1],e[a+2]=e[c+2],e[a+3]=e[c+3],e[c]=f,e[c+1]=p,e[c+2]=v,e[c+3]=y;const g=n[i];n[i]=n[o],n[o]=g}function yc(r,e){let n=r^e,i=65535^n,o=65535^(r|e),s=r&(e^65535),a=n|i>>1,c=n>>1^n,f=o>>1^i&s>>1^o,p=n&o>>1^s>>1^s;n=a,i=c,o=f,s=p,a=n&n>>2^i&i>>2,c=n&i>>2^i&(n^i)>>2,f^=n&o>>2^i&s>>2,p^=i&o>>2^(n^i)&s>>2,n=a,i=c,o=f,s=p,a=n&n>>4^i&i>>4,c=n&i>>4^i&(n^i)>>4,f^=n&o>>4^i&s>>4,p^=i&o>>4^(n^i)&s>>4,n=a,i=c,o=f,s=p,f^=n&o>>8^i&s>>8,p^=i&o>>8^(n^i)&s>>8,n=f^f>>1,i=p^p>>1;let v=r^e,y=i|65535^(v|n);return v=(v|v<<8)&16711935,v=(v|v<<4)&252645135,v=(v|v<<2)&858993459,v=(v|v<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|v)>>>0}const wc=(r,e=1e-7)=>{const n=new so(r.length);r.forEach(s=>{const[a,c]=s.firstPoint;n.add(a-e,c-e,a+e,c+e)}),n.finish();const i=[],o=new Set;return r.forEach((s,a)=>{if(o.has(a))return;const c=[s];let f=a;o.add(a);let p=r.length;for(;;){if(p--<0)throw new Error("Infinite loop detected");const v=c[c.length-1].lastPoint,[y,g]=v,S=n.search(y-e,g-e,y+e,g+e),E=R=>Math.abs((f-R)%r.length),k=S.filter(R=>!o.has(R)).map(R=>[r[R],R,E(R)]).sort(([,,R],[,,O])=>E(R)-E(O));if(k.length===0){i.push(c);break}const[C,P]=k[0];c.push(C),o.add(P),f=P}}),i};function mt(r){return Math.round(r*1e5)/1e5}const uo=r=>`${Wn(r.X())} ${Wn(r.Y())}`,en=(r,e)=>{const n=W(),i=Hn(r.GetType()),[o,s]=e,a=`${mt(o)} ${mt(s)}`;if(i==="LINE")return`L ${a}`;if(i==="BEZIER_CURVE"){const p=r.Bezier().get(),v=p.Degree();if(v===1)return`L ${a}`;if(v===2)return`Q ${uo(p.Pole(2))} ${a}`;if(v===3){const y=uo(p.Pole(2)),g=uo(p.Pole(3));return`C ${y} ${g} ${a}`}}if(i==="CIRCLE"){const p=r.Circle(),v=p.Radius(),y=r.FirstParameter(),S=(r.LastParameter()-y)*qr,E=S!==360?a:`${mt(o)} ${mt(s+1e-4)}`;return`A ${v} ${v} 0 ${Math.abs(S)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${E}`}if(i==="ELLIPSE"){const p=r.Ellipse(),v=p.MajorRadius(),y=p.MinorRadius(),g=r.FirstParameter(),E=(r.LastParameter()-g)*qr,k=E!==360?a:`${mt(o)} ${mt(s+1e-4)}`,C=new n.gp_Dir2d_1,P=180-p.XAxis().Direction().Angle(C)*qr;return C.delete(),`A ${mt(v)} ${mt(y)} ${mt(P)} ${Math.abs(E)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${k}`}if(i==="BSPLINE_CURVE"&&r.BSpline().get().Degree()<4)return As(r).map(y=>en(y.adaptor(),y.lastPoint)).join(" ");const c=Ps(r);return As(c.adaptor()).map(p=>en(p.adaptor(),p.lastPoint)).join(" ")},bc={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},Vn={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Ls{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(n=>n(this)),this}not(e){const n=new this.constructor;e(n);const i=({element:o})=>!n.shouldKeep(o);return this.filters.push(i),this}either(e){const n=e.map(o=>{const s=new this.constructor;return o(s),s}),i=({element:o})=>n.some(s=>s.shouldKeep(o));return this.filters.push(i),this}find(e,{unique:n=!1}={}){const i=this.applyFilter(e);if(n){if(i.length!==1)throw console.error(i),new Error("Finder has not found a unique solution");return i[0]}return i}}class Bs extends Ls{inList(e){const n=({element:i})=>!!e.find(o=>o.isSame(i));return this.filters.push(n),this}atAngleWith(e="Z",n=0){let i;typeof e=="string"?i=new oe(bc[e]):i=new oe(e);const o=({normal:s})=>{if(!s)return!1;const a=Math.acos(Math.abs(s.dot(i)));return Math.abs(a-gt*n)<1e-6};return this.filters.push(o),this}atDistance(e,n=[0,0,0]){const i=ut(n),o=W(),s=new o.BRepBuilderAPI_MakeVertex(i),a=s.Vertex();s.delete();const c=new o.BRepExtrema_DistShapeShape_1;c.LoadS1(a);const f=({element:p})=>{const v=Fe();c.LoadS2(p.wrapped);const y=v(new o.Message_ProgressRange_1);return c.Perform(y),Math.abs(c.Value()-e)<1e-6};return this.filters.push(f),ws(f)(c),this}containsPoint(e){return this.atDistance(0,e)}inBox(e,n){const i=W(),o=new i.BRepPrimAPI_MakeBox_4(ut(e),ut(n)),s=o.Solid();o.delete();const a=new i.BRepExtrema_DistShapeShape_1;a.LoadS1(s);const c=({element:p})=>{const v=Fe();a.LoadS2(p.wrapped);const y=v(new i.Message_ProgressRange_1);return a.Perform(y),a.Value()<1e-6},f=ws(c);return f(s),f(a),this.filters.push(c),this}}class $n extends Bs{clone(){const e=new $n;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const n=({element:i})=>typeof e=="number"?Math.abs(i.length-e)<1e-9:e(i.length);return this.filters.push(n),this}ofCurveType(e){const n=({element:i})=>i.geomType===e;return this.filters.push(n),this}parallelTo(e){if(typeof e=="string"&&Vn[e])return this.atAngleWith(Vn[e],90);if(typeof e!="string"&&e instanceof nt)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const n=e.normalAt();return this.atAngleWith(n,90),this}return this}inPlane(e,n){const i=e instanceof nt?Et(e):Et(e,n);this.parallelTo(i);const o=({element:s})=>{const a=s.startPoint,c=a.projectToPlane(i);return a.equals(c)};return this.filters.push(o),this}shouldKeep(e){let n=null;try{n=e.tangentAt().normalized()}catch(i){console.error("failed to compute a normal",i)}return this.filters.every(i=>i({normal:n,element:e}))}applyFilter(e){return e.edges.filter(n=>this.shouldKeep(n))}}class lo extends Bs{clone(){const e=new lo;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&Vn[e])return this.atAngleWith(Vn[e]);if(typeof e!="string"&&e instanceof nt)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const n=e.normalAt();return this.atAngleWith(n),this}return this}ofSurfaceType(e){const n=({element:i})=>i.geomType===e;return this.filters.push(n),this}inPlane(e,n){const i=e instanceof nt?Et(e):Et(e,n);this.parallelTo(i);const o=({element:s})=>{const a=s.center,c=a.projectToPlane(i);return a.equals(c)};return this.filters.push(o),this}shouldKeep(e){const n=e.normalAt();return this.filters.every(o=>o({normal:n,element:e}))}applyFilter(e){return e.faces.filter(n=>this.shouldKeep(n))}}const Sc=function(r){return r.curves.map((e,n)=>({firstCurve:e,secondCurve:r.curves[(n+1)%r.curves.length],point:e.lastPoint}))},co=2*Math.PI,Is=r=>{const e=r%co,n=e<0?e+co:e;return n<Math.PI?n:n===Math.PI?0:Math.abs(n-co)};class Yn extends Ls{clone(){const e=new Yn;return e.filters=[...this.filters],e}inList(e){const n=({element:i})=>!!e.find(o=>Ze(o,i.point));return this.filters.push(n),this}atDistance(e,n=[0,0]){function i({element:o}){return Math.abs(Tt(n,o.point)-e)<1e-9}return this.filters.push(i),this}atPoint(e){function n({element:i}){return Ze(e,i.point)}return this.filters.push(n),this}inBox(e,n){const[i,o]=e,[s,a]=n,c=Math.min(i,s),f=Math.max(i,s),p=Math.min(o,a),v=Math.max(o,a);function y({element:g}){const[S,E]=g.point;return S>=c&&S<=f&&E>=p&&E<=v}return this.filters.push(y),this}ofAngle(e){function n({element:i}){const o=i.firstCurve.tangentAt(1),s=i.secondCurve.tangentAt(0);return Math.abs(Is(sc(o,s))-Is(gt*e))<1e-9}return this.filters.push(n),this}shouldKeep(e){return this.filters.every(i=>i({normal:null,element:e}))}applyFilter(e){return Sc(e).filter(n=>this.shouldKeep(n))}}const Gs=r=>{const e=W();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[r]},xc=function*(e,n){const i=W(),o=new i.TopExp_Explorer_2(e,Gs(n),Gs("shape")),s=new Map;for(;o.More();){const a=o.Current(),c=a.HashCode(bs);s.get(c)||(s.set(c,!0),yield a),o.Next()}o.delete()},Ns=r=>{if(r.IsNull())throw new Error("This shape has not type, it is null");return r.ShapeType()};class Xn extends Mt{constructor(e){super(e)}clone(){return new this.constructor(hr(this.wrapped))}get hashCode(){return this.wrapped.HashCode(bs)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=W(),n=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);n.Build();const i=Ie(n.Shape());if(n.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translate(e,n=0,i=0){const o=typeof e=="number"?[e,n,i]:e,s=Ie(Ql(this.wrapped,o));if(this.delete(),this.constructor!==s.constructor)throw new Error("unexpected types mismatch");return s}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,n=[0,0,0],i=[0,0,1]){const o=Ie(Kl(this.wrapped,e,n,i));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,n){const i=Ie(Jl(this.wrapped,e,n));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}scale(e,n=[0,0,0]){const i=Ie(ec(this.wrapped,n,e));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}_iterTopo(e){return xc(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(n=>hr(n))}get edges(){return this._listTopo("edge").map(e=>new qt(e))}get faces(){return this._listTopo("face").map(e=>new Mr(e))}get wires(){return this._listTopo("wire").map(e=>new jt(e))}get boundingBox(){const e=new Zl;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:n=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,n,!1)}mesh({tolerance:e=.001,angularTolerance:n=.1}={}){this._mesh({tolerance:e,angularTolerance:n});let i=[],o=[],s=[];const a=[];for(const c of this.faces){const f=c.triangulation(o.length/3);if(!f)continue;const{trianglesIndexes:p,vertices:v,verticesNormals:y}=f;a.push({start:i.length,count:p.length,faceId:c.hashCode}),i=i.concat(p),o=o.concat(v),s=s.concat(y)}return{triangles:i,vertices:o,normals:s,faceGroups:a}}meshEdges({tolerance:e=.001,angularTolerance:n=.1}={}){var i;const o=Fe(),s=new Set,a=[],c=[],f=()=>{const v=a.length;let y=null;return[g=>{y?(a.push(...y),y=[g.X(),g.Y(),g.Z()],a.push(...y)):y=[g.X(),g.Y(),g.Z()]},g=>{c.push({start:v/3,count:(a.length-v)/3,edgeId:g}),s.add(g)}]},p=o(new this.oc.TopLoc_Location_1);for(const v of this.faces){const y=o(this.oc.BRep_Tool.Triangulation(v.wrapped,p,0));if(y.IsNull())continue;const g=y.get();for(const S of v.edges){if(o(S),s.has(S.hashCode))continue;const E=o(new this.oc.TopLoc_Location_1),k=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(S.wrapped,y,E)),C=(i=k==null?void 0:k.get())==null?void 0:i.Nodes();if(!C)continue;o(C);const[P,R]=f();for(let O=C.Lower();O<=C.Upper();O++){const q=o(o(g.Node(C.Value(O))).Transformed(E.Transformation()));P(q)}R(S.hashCode)}}for(const v of this.edges){o(v);const y=v.hashCode;if(s.has(y))continue;const g=o(new this.oc.BRepAdaptor_Curve_2(v.wrapped)),S=o(new this.oc.GCPnts_TangentialDeflection_2(g,e,n,2,1e-9,1e-7)),[E,k]=f();for(let C=0;C<S.NbPoints();C++){const P=o(S.Value(C+1).Transformed(p.Transformation()));E(P)}k(y)}return{lines:a,edgeGroups:c}}blobSTEP(){const e="blob.step",n=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),n.Model(!0).delete();const i=new this.oc.Message_ProgressRange_1;n.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,i);const o=n.Write(e);if(n.delete(),i.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const s=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([s],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:n=.1,binary:i=!1}={}){this._mesh({tolerance:e,angularTolerance:n});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!i)){const a=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([a],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class zs extends Xn{}class Hs extends Xn{get repr(){const{startPoint:e,endPoint:n}=this,i=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),n.delete(),i}get curve(){return new _c(this._geomAdaptor())}get startPoint(){const e=this.curve,n=e.startPoint;return e.delete(),n}get endPoint(){const e=this.curve,n=e.endPoint;return e.delete(),n}tangentAt(e=0){const n=this.curve,i=n.tangentAt(e);return n.delete(),i}get isClosed(){const e=this.curve,n=e.isClosed;return e.delete(),n}get isPeriodic(){const e=this.curve,n=e.isPeriodic;return e.delete(),n}get period(){const e=this.curve,n=e.period;return e.delete(),n}get geomType(){const e=this.curve,n=e.curveType;return e.delete(),n}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const n=e.Mass();return e.delete(),n}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class _c extends Mt{get repr(){const{startPoint:e,endPoint:n}=this,i=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),n.delete(),i}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return Hn(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new oe(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new oe(e)}tangentAt(e){let n=e;e||(n=(this.wrapped.LastParameter()-this.wrapped.FirstParameter())/2);const i=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(n,i,o);const s=new oe(o);return i.delete(),o.delete(),s}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class qt extends Hs{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class jt extends Hs{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,n="arc"){const i={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,i[n],!1);o.Perform(e,0);const s=Ie(o.Shape());if(o.delete(),this.delete(),!(s instanceof jt))throw new Error("Could not offset with a wire");return s}}class Ec extends Mt{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,i=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!i)throw new Error("surface type not found");return i}}class Mr extends Xn{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Ec(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,n=e.surfaceType;return e.delete(),n}get UVBounds(){const e={current:0},n={current:0},i={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,n,i,o),{uMin:e.current,uMax:n.current,vMin:i.current,vMax:o.current}}pointOnSurface(e,n){const{uMin:i,uMax:o,vMin:s,vMax:a}=this.UVBounds,c=this._geomAdaptor(),f=new this.oc.gp_Pnt_1,p=e*(o-i)+i,v=n*(a-s)+s;c.D0(p,v,f);const y=new oe(f);return c.delete(),f.delete(),y}normalAt(e){let n=0,i=0;const o=Fe();if(e){const p=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),v=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(ut(e)),p,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),y={current:0},g={current:0};v.LowerDistanceParameters(y,g),n=y.current,i=g.current}else{const{uMin:p,uMax:v,vMin:y,vMax:g}=this.UVBounds;n=.5*(p+v),i=.5*(y+g)}const s=o(new this.oc.gp_Pnt_1),a=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(n,i,s,a),new oe(a)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const n=new oe(e.CentreOfMass());return e.delete(),n}outerWire(){const e=new jt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),n=this.wires.filter(i=>!e.isSame(i));return e.delete(),this.delete(),n}triangulation(e=0){const n=Fe(),i=n(new this.oc.TopLoc_Location_1),o=n(this.oc.BRep_Tool.Triangulation(this.wrapped,i,0));if(o.IsNull())return null;const s=n(i.Transformation()),a={vertices:[],trianglesIndexes:[],verticesNormals:[]},c=o.get(),f=c.NbNodes();a.vertices=new Array(f*3);for(let E=1;E<=f;E++){const k=n(n(c.Node(E)).Transformed(s));a.vertices[(E-1)*3+0]=k.X(),a.vertices[(E-1)*3+1]=k.Y(),a.vertices[(E-1)*3+2]=k.Z()}const p=n(new this.oc.TColgp_Array1OfDir_2(1,f)),v=n(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,v,p),a.verticesNormals=new Array(p.Length()*3);for(let E=p.Lower();E<=p.Upper();E++){const k=n(n(p.Value(E)).Transformed(s));a.verticesNormals[(E-1)*3+0]=k.X(),a.verticesNormals[(E-1)*3+1]=k.Y(),a.verticesNormals[(E-1)*3+2]=k.Z()}const y=this.orientation,g=c.NbTriangles();a.trianglesIndexes=new Array(g*3);let S=0;for(let E=1;E<=g;E++){const k=n(c.Triangle(E));let C=k.Value(1),P=k.Value(2);const R=k.Value(3);if(y==="backward"){const O=C;C=P,P=O}a.trianglesIndexes[S*3+0]=C-1+e,a.trianglesIndexes[S*3+1]=P-1+e,a.trianglesIndexes[S*3+2]=R-1+e,S++}return a}}class qn extends Xn{fuse(e,{optimisation:n="none"}={}){const i=Fe(),o=i(new this.oc.Message_ProgressRange_1),s=i(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));n==="commonFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),n==="sameFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),s.Build(o),s.SimplifyResult(!0,!0,.001);const a=Ie(s.Shape());if(!Rt(a))throw new Error("Could not fuse as a 3d shape");return a}cut(e,{optimisation:n="none"}={}){const i=Fe(),o=i(new this.oc.Message_ProgressRange_1),s=i(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));n==="commonFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),n==="sameFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),s.Build(o),s.SimplifyResult(!0,!0,.001);const a=Ie(s.Shape());if(!Rt(a))throw new Error("Could not cut as a 3d shape");return a}intersect(e){const n=Fe(),i=n(new this.oc.Message_ProgressRange_1),o=n(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,i));o.Build(i),o.SimplifyResult(!0,!0,.001);const s=Ie(o.Shape());if(!Rt(s))throw new Error("Could not intersect as a 3d shape");return s}shell(e,n=null,i=.001){const o=typeof n=="number"?n:i;let s,a;if(typeof e=="number"){a=e;const S=new lo;s=typeof n=="function"?n(S):S}else a=e.thickness,s=e.filter;const c=Fe(),f=s.find(this),p=c(new this.oc.TopTools_ListOfShape_1);f.forEach(S=>{p.Append_1(S.wrapped)});const v=c(new this.oc.Message_ProgressRange_1),y=c(new this.oc.BRepOffsetAPI_MakeThickSolid);y.MakeThickSolidByJoin(this.wrapped,p,-Math.abs(a),o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,v);const g=Ie(y.Shape());if(!Rt(g))throw new Error("Could not shell as a 3d shape");return g}_builderIter(e,n){if(typeof e=="number"){let a=0;for(const c of this._iterTopo("edge"))n(e,hr(c)),a+=1;return a}let i,o=null;typeof e=="function"?i=e:(i=a=>e.filter.shouldKeep(a)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let s=0;for(const a of this._iterTopo("edge")){const c=hr(a),f=new qt(c),p=i(f);p&&(n(p,c),s+=1),f.delete()}return o&&o(),s}fillet(e,n){const o=Fe()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let s=e;if(typeof e=="number"&&n&&(s={radius:e,filter:n(new $n)}),!this._builderIter(s,(f,p)=>o.Add_2(f,p)))throw new Error("Could not fillet, no edge was selected");const c=Ie(o.Shape());if(!Rt(c))throw new Error("Could not fillet as a 3d shape");return c}chamfer(e,n){const o=Fe()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let s=e;if(typeof e=="number"&&n&&(s={radius:e,filter:n(new $n)}),!this._builderIter(s,(f,p)=>o.Add_2(f,p)))throw new Error("Could not chamfer, no edge was selected");const c=Ie(o.Shape());if(!Rt(c))throw new Error("Could not chamfer as a 3d shape");return c}}class Ws extends qn{}class jn extends qn{}class Vs extends qn{}class $s extends qn{}function Rt(r){return r instanceof Ws||r instanceof jn||r instanceof Vs||r instanceof $s}function Ys(r){return r instanceof jt}function hr(r){const e=W(),n=e.TopAbs_ShapeEnum,i=new Map([[n.TopAbs_EDGE,e.TopoDS.Edge_1],[n.TopAbs_WIRE,e.TopoDS.Wire_1],[n.TopAbs_FACE,e.TopoDS.Face_1],[n.TopAbs_SHELL,e.TopoDS.Shell_1],[n.TopAbs_SOLID,e.TopoDS.Solid_1],[n.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[n.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=Ns(r),s=i.get(o);if(!s)throw new Error("Could not find a wrapper for this shape type");return s(r)}function Ie(r){const n=W().TopAbs_ShapeEnum,o=new Map([[n.TopAbs_VERTEX,zs],[n.TopAbs_EDGE,qt],[n.TopAbs_WIRE,jt],[n.TopAbs_FACE,Mr],[n.TopAbs_SHELL,Ws],[n.TopAbs_SOLID,jn],[n.TopAbs_COMPSOLID,Vs],[n.TopAbs_COMPOUND,$s]]).get(Ns(r));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(hr(r))}const Xs=(r,e)=>{const n=W();return new qt(new n.BRepBuilderAPI_MakeEdge_3(ut(r),ut(e)).Edge())},Tc=(r,e,n,i=[0,0,0],o=[0,0,1],s=!1)=>{const a=W(),[c,f]=Be();let p=2*Math.PI;s&&(p=-2*Math.PI);const v=c(new a.Geom2d_Line_3(c(new a.gp_Pnt2d_3(0,0)),c(new a.gp_Dir2d_4(p,r)))),y=e/r,g=v.Value(0),S=v.Value(y*Math.sqrt((2*Math.PI)**2+r**2)),E=c(new a.GCE2d_MakeSegment_1(g,S)),k=new a.Geom_CylindricalSurface_1(c(jr(i,o)),n),C=c(new a.BRepBuilderAPI_MakeEdge_30(c(new a.Handle_Geom2d_Curve_2(E.Value().get())),c(new a.Handle_Geom_Surface_2(k)))).Edge(),P=c(new a.BRepBuilderAPI_MakeWire_2(C)).Wire();return a.BRepLib.BuildCurves3d_2(P),f(),new qt(P)},Zn=r=>{const e=W(),n=new e.BRepBuilderAPI_MakeWire_1;r.forEach(a=>{a instanceof qt&&n.Add_1(a.wrapped),a instanceof jt&&n.Add_2(a.wrapped)});const i=new e.Message_ProgressRange_1;n.Build(i);const o=n.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const a=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${a.get(o)||"unknown error"}`)}const s=new jt(n.Wire());return n.delete(),i.delete(),s},Kn=(r,e)=>{const n=W(),i=new n.BRepBuilderAPI_MakeFace_15(r.wrapped,!1);if(e==null||e.forEach(s=>{i.Add(s.wrapped)}),!i.IsDone())throw i.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=i.Face();return i.delete(),new Mr(o)},kc=(r,e)=>{const n=W(),[i,o]=Be(),s=i(n.BRep_Tool.Surface_2(r.wrapped)),c=i(new n.BRepBuilderAPI_MakeFace_21(s,e.wrapped,!0)).Face();return o(),new Mr(c)},qs=r=>{const e=W(),n=ut(r),i=new e.BRepBuilderAPI_MakeVertex(n),o=i.Vertex();return i.delete(),new zs(o)},tn=r=>{const e=W(),n=new e.TopoDS_Builder,i=new e.TopoDS_Compound;return n.MakeCompound(i),r.forEach(s=>{n.Add(i,s.wrapped),s.delete()}),Ie(i)};function js(r){const e=W(),[n,i]=Be(),o=n(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));r.forEach(({wrapped:c})=>{o.Add(c)}),o.Perform(n(new e.Message_ProgressRange_1));const s=n(hr(o.SewedShape())),a=Ie(n(new e.ShapeFix_Solid_1).SolidFromShell(s));if(i(),!(a instanceof jn))throw new Error("Could not make a solid of faces and shells");return a}const Zs=(r,e)=>{const n=W(),[i,o]=Be(),s=i(new n.BRepBuilderAPI_MakeFace_2(r.wrapped));e.forEach(p=>{s.Add(p.wrapped)});const a=i(s.Face()),c=i(new n.ShapeFix_Face_2(a));c.FixOrientation_1();const f=c.Face();return o(),new Mr(f)},Cc=r=>r==="symmetric"||typeof r=="number"||Array.isArray(r)&&r.length===2,Pc=r=>{let e;r?Cc(r)?e={endTangent:r}:e={endTangent:0,...r}:e={endTangent:[1,0]};const{endTangent:n,startFactor:i=1,endFactor:o=1,startTangent:s}=e;let a;typeof n=="number"?a=Ar(1,n*gt):a=n;let c;return typeof s=="number"?c=Ar(1,s*gt):c=s,{endTangent:a,startFactor:i,endFactor:o,startTangent:c}};function Ks(r,e,n,i){const o=r*n+e*i,s=Math.sqrt((r*r+e*e)*(n*n+i*i));let a=Math.acos(o/s);return r*i-e*n<0&&(a=-a),a}function Ac([r,e],[n,i],o,s,a,c,f){const p=Math.PI*2;if(o<0&&(o=-o),s<0&&(s=-s),o==0||s==0)throw Error("rx and ry can not be 0");const v=Math.sin(a),y=Math.cos(a),g=(r-n)/2,S=(e-i)/2,E=(r+n)/2,k=(e+i)/2,C=y*g+v*S,P=y*S-v*g,R=C*C/(o*o)+P*P/(s*s);R>1&&(o=o*Math.sqrt(R),s=s*Math.sqrt(R));const O=o*s,q=o*P,D=s*C,K=q*q+D*D;if(!K)throw Error("start point can not be same as end point");let H=Math.sqrt(Math.abs((O*O-K)/K));c==f&&(H=-H);const V=H*q/s,ee=-H*D/o,te=y*V-v*ee+E,pe=v*V+y*ee+k,de=(C-V)/o,we=(C+V)/o,se=(P-ee)/s,Ee=(P+ee)/s,Ne=Ks(1,0,de,se);let be=Ks(de,se,-we,-Ee);for(;be>p;)be-=p;for(;be<0;)be+=p;f||(be-=p);let Te=Ne+be;for(;Te>p;)Te-=p;for(;Te<0;)Te+=p;return{cx:te,cy:pe,startAngle:Ne,deltaAngle:be,endAngle:Te,clockwise:!!f,rx:o,ry:s}}const Qs=(r,e)=>{const n=W(),i=new n.BRepPrimAPI_MakePrism_1(r.wrapped,e.wrapped,!1,!0),o=new jn(hr(i.Shape()));return i.delete(),o},Js=(r,e=[0,0,0],n=[0,0,1],i=360)=>{const o=W(),s=xs(e,n),a=new o.BRepPrimAPI_MakeRevol_1(r.wrapped,s,i*gt,!1),c=Ie(a.Shape());if(s.delete(),a.delete(),!Rt(c))throw new Error("Could not revolve to a 3d shape");return c};function rn(r,e,{frenet:n=!1,auxiliarySpine:i,law:o=null,transitionMode:s="right",withContact:a,support:c,forceProfileSpineOthogonality:f}={},p=!1){const v=W(),y=s==="round"?!0:!!f,g=new v.BRepOffsetAPI_MakePipeShell(e.wrapped);if(s){const k={transformed:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[s];k&&g.SetTransitionMode(k)}c?g.SetMode_4(c):n&&g.SetMode_1(n),i&&g.SetMode_5(i.wrapped,!1,v.BRepFill_TypeOfContact.BRepFill_NoContact),o?g.SetLaw_1(r.wrapped,o,!!a,y):g.Add_1(r.wrapped,!!a,y);const S=new v.Message_ProgressRange_1;g.Build(S),p||g.MakeSolid();const E=Ie(g.Shape());if(!Rt(E))throw new Error("Could not sweep to a 3d shape");if(p){const k=Ie(g.FirstShape()),C=Ie(g.LastShape());if(!Ys(k))throw new Error("Could not sweep with one start wire");if(!Ys(C))throw new Error("Could not sweep with one end wire");return g.delete(),[E,k,C]}return g.delete(),S.delete(),E}const ea=(r,{profile:e,endFactor:n=1})=>{let i;const o=W();if(e==="s-curve")i=new o.Law_S,i.Set_1(0,1,r,n);else if(e==="linear")i=new o.Law_Linear,i.Set(0,1,r,n);else throw new Error("Could not generate a law function");return i.Trim(0,r,1e-6)};function ta(r,e,n,i,o=!1){const s=new oe(e),a=new oe(n),c=Xs(s,s.add(a)),f=Zn([c]),p=i?ea(a.Length,i):null;return o?rn(r,f,{law:p},o):rn(r,f,{law:p},o)}function ra(r,e,n,i,o,s=!1){const a=new oe(n),c=new oe(i),f=Xs(a,a.add(c)),p=Zn([f]),v=360/e*c.Length,y=1,g=Tc(v,c.Length,y,n,i),S=o?ea(c.Length,o):null;return s?rn(r,p,{auxiliarySpine:g,law:S},s):rn(r,p,{auxiliarySpine:g,law:S},s)}const Mc=(r,{ruled:e=!0,startPoint:n,endPoint:i}={},o=!1)=>{const s=W(),[a,c]=Be(),f=a(new s.BRepOffsetAPI_ThruSections(!o,e,1e-6));n&&f.AddVertex(a(qs(n)).wrapped),r.forEach(y=>f.AddWire(y.wrapped)),i&&f.AddVertex(a(qs(i)).wrapped);const p=a(new s.Message_ProgressRange_1);f.Build(p);const v=Ie(f.Shape());if(c(),!Rt(v))throw new Error("Could not loft to a 3d shape");return v};class nn{constructor(e,{defaultOrigin:n=[0,0,0],defaultDirection:i=[0,0,1]}={}){this.wire=e,this.defaultOrigin=n,this.defaultDirection=i,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new nn(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new oe(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new oe(e)}face(){let e;return this.baseFace?e=kc(this.baseFace,this.wire):e=Kn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:n}={}){const i=Kn(this.wire),o=Js(i,n||this.defaultOrigin,e);return i.delete(),this.delete(),o}extrude(e,{extrusionDirection:n,extrusionProfile:i,twistAngle:o,origin:s}={}){const[a,c]=Be(),f=a(new oe(n||this.defaultDirection).normalized().multiply(e));if(i&&!o){const y=ta(this.wire,s||this.defaultOrigin,f,i);return c(),this.delete(),y}if(o){const y=ra(this.wire,o,s||this.defaultOrigin,f,i);return c(),this.delete(),y}const p=Kn(this.wire),v=Qs(p,f);return c(),this.delete(),v}sweepSketch(e,n={}){const i=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),s=o.cross(this.defaultDirection).multiply(-1),a=e(new nt(i,s,o),i),c={forceProfileSpineOthogonality:!0,...n};this.baseFace&&(c.support=this.baseFace.wrapped);const f=rn(a.wire,this.wire,c);return this.delete(),f}loftWith(e,n={},i=!1){const o=Array.isArray(e)?[this,...e]:[this,e],s=Mc(o.map(a=>a.wire),n,i);return o.forEach(a=>a.delete()),s}}const Rc=r=>{const e=W(),n=new e.Bnd_Box2d;return r.forEach(i=>{e.BndLib_Add2dCurve.Add_3(i.wrapped,1e-6,n)}),new Kr(n)};function Oc(r,e){const[n,i]=Be(),o=n(Ss(e.origin,e.zDir,e.xDir)),s=W(),a=r.map(c=>{const f=s.GeomLib.To3d(o,c.wrapped);return new qt(new s.BRepBuilderAPI_MakeEdge_24(f).Edge())});return i(),a}const Dc=(r,e)=>{const[n,i]=Be(),o=W(),s=r.map(a=>{const c=n(new o.BRepBuilderAPI_MakeEdge_30(a.wrapped,e));return new qt(c.Edge())});return i(),s},na=(r,e)=>{const n=W();return r.map(o=>e?new Ae(n.GeomLib.GTransform(o.wrapped,e)):o.clone())};class on extends Mt{transformCurves(e){return na(e,this.wrapped)}}const ia=(r,e,n=[0,0])=>{const i=W(),o=Cr(n,e),s=new i.gp_GTrsf2d_1;return s.SetAffinity(o,r),o.delete(),new on(s)},Fc=r=>{const e=W(),[n,i]=Be(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(n(Cs(r)));const s=new e.gp_GTrsf2d_2(o);return i(),new on(s)},Uc=(r,e=[0,0],n="center")=>{const i=W(),[o,s]=Be(),a=new i.gp_Trsf2d_1;n==="center"?a.SetMirror_1(o(qe(r))):a.SetMirror_2(o(Cr(e,r)));const c=new i.gp_GTrsf2d_2(a);return s(),new on(c)},Lc=(r,e=[0,0])=>{const n=W(),[i,o]=Be(),s=new n.gp_Trsf2d_1;s.SetRotation(i(qe(e)),r);const a=new n.gp_GTrsf2d_2(s);return o(),new on(a)},Bc=(r,e=[0,0])=>{const n=W(),[i,o]=Be(),s=new n.gp_Trsf2d_1;s.SetScale(i(qe(e)),r);const a=new n.gp_GTrsf2d_2(s);return o(),new on(a)};function Ic(r,e,n="original"){const[i,o]=Be(),s=W();let a=i(s.BRep_Tool.Surface_2(e.wrapped));const c=e.UVBounds;let f=null;const p=i(Cr([0,0],[0,1])),v=i(Cr([0,0],[1,0]));if(n==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const S=i(a.get().Cylinder());S.Direct()||(a=a.get().UReversed());const E=S.Radius();f=ia(1/E,[0,1]).wrapped}if(n==="bounds"){if(f=i(new s.gp_GTrsf2d_1),f.SetAffinity(p,c.uMax-c.uMin),c.uMin!==0){const E=i(new s.gp_GTrsf2d_1);E.SetTranslationPart(new s.gp_XY_2(0,-c.uMin)),f.Multiply(E)}const S=i(new s.gp_GTrsf2d_1);if(S.SetAffinity(v,c.vMax-c.vMin),f.Multiply(S),c.vMin!==0){const E=i(new s.gp_GTrsf2d_1);E.SetTranslationPart(i(new s.gp_XY_2(0,-c.vMin))),f.Multiply(E)}}const y=na(r,f),g=Dc(y,a);return o(),g}const Qn=(r,e=1)=>{const n=r.bounds[0][0]-e,i=-r.bounds[1][1]-e;return`${n} ${i} ${r.width+2*e} ${r.height+2*e}`},fo=(r,e,n=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${Qn(e,n)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${r}
</svg>`;class ae{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new ae(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=Rc(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(i=>i.geomType!=="LINE"?[i.firstPoint,i.value(.5)]:[i.firstPoint]),n=e.map((i,o)=>{const s=e[(o+1)%e.length];return(s[0]-i[0])*(s[1]+i[1])}).reduce((i,o)=>i+o,0);return this._guessedOrientation=n>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,n,i=[0,0]){const o=ia(e,n,i).transformCurves(this.curves);return new ae(o)}scale(e,n){const i=n||this.boundingBox.center,o=Bc(e,i).transformCurves(this.curves);return new ae(o)}rotate(e,n){const i=Lc(e*gt,n).transformCurves(this.curves);return new ae(i)}translate(e,n=0){const i=Nn(e)?e:[e,n],o=Fc(i).transformCurves(this.curves);return new ae(o)}mirror(e,n=[0,0],i="center"){const o=Uc(e,n,i).transformCurves(this.curves);return new ae(o)}sketchOnPlane(e,n){const i=e instanceof nt?Et(e):Et(e,n),o=Oc(this.curves,i),s=Zn(o);return new nn(s,{defaultOrigin:i.origin,defaultDirection:i.zDir})}sketchOnFace(e,n){const i=W(),o=Ic(this.curves,e,n),s=Zn(o);i.BRepLib.BuildCurves3d_2(s.wrapped);const a=new i.ShapeFix_Wire_2(s.wrapped,e.wrapped,1e-9);a.FixEdgeCurves(),a.delete();const c=new nn(s);if(s.isClosed){const f=c.clone().face();c.defaultOrigin=f.pointOnSurface(.5,.5),c.defaultDirection=f.normalAt(),f.orientation!==e.orientation&&(c.defaultDirection=c.defaultDirection.multiply(-1)),c.baseFace=e}else{const f=s.startPoint;c.defaultOrigin=f,c.defaultDirection=e.normalAt(f),c.baseFace=e}return c}toSVGPathD(){const e=Fe(),n=this.clone().mirror([1,0],[0,0],"plane"),i=n.curves.flatMap(a=>{if((a.geomType==="ELLIPSE"||a.geomType==="CIRCLE")&&Ze(a.firstPoint,a.lastPoint)){const[c,f]=a.splitAt([.5]);return[en(e(c.adaptor()),c.lastPoint),en(e(f.adaptor()),f.lastPoint)]}return en(e(a.adaptor()),a.lastPoint)}),[o,s]=n.curves[0].firstPoint;return`M ${mt(o)} ${mt(s)} ${i.join(" ")}${n.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return Qn(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return fo(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const n=W(),i=new n.Geom2dAPI_InterCurveCurve_1,o=Jr(e,this.boundingBox.outsidePoint());let s=0;return this.curves.find(c=>c.isOnCurve(e))?!1:(this.curves.forEach(c=>{c.boundingBox.isOut(o.boundingBox)||(i.Init_1(o.wrapped,c.wrapped,1e-9),s+=i.NbPoints())}),i.delete(),!!(s%2))}isClosed(){return Ze(this.firstPoint,this.lastPoint)}intersects(e){const n=W(),i=new n.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const s of e.curves)if(!o.boundingBox.isOut(s.boundingBox)&&(i.Init_1(o.wrapped,s.wrapped,1e-9),i.NbPoints()||i.NbSegments()))return!0;return i.delete(),!1}}class oa{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,n]){return[e,n]}_convertFromUV([e,n]){return[e,n]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const n=this.pendingCurves.pop();if(!n)throw new Error("bug in the custom corner algorithm");const i=this._nextCorner.mode==="chamfer"?io:no;this.pendingCurves.push(...i(n,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const n=Jr(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(n),this}line(e,n){return this.lineTo([this.pointer[0]+e,this.pointer[1]+n])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,n]){const i=n*gt,o=Ar(e,i);return this.lineTo(o)}polarLine(e,n){const i=n*gt,[o,s]=Ar(e,i);return this.line(o,s)}tangentLine(e){const n=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!n)throw new Error("You need a previous curve to sketch a tangent line");const i=Xt(this._convertFromUV(n.tangentAt(1)));return this.line(i[0]*e,i[1]*e)}threePointsArcTo(e,n){return this.saveCurve(to(this._convertToUV(this.pointer),this._convertToUV(n),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,n,i,o){const[s,a]=this.pointer;return this.threePointsArcTo([s+e,a+n],[s+i,a+o])}sagittaArcTo(e,n){const[i,o]=this.pointer,[s,a]=e,c=[(i+s)/2,(o+a)/2],f=[-(a-o),s-i],p=Math.sqrt(f[0]**2+f[1]**2),v=[c[0]+f[0]/p*n,c[1]+f[1]/p*n];return this.saveCurve(to(this._convertToUV(this.pointer),this._convertToUV(v),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,n,i){return this.sagittaArcTo([e+this.pointer[0],n+this.pointer[1]],i)}vSagittaArc(e,n){return this.sagittaArc(0,e,n)}hSagittaArc(e,n){return this.sagittaArc(e,0,n)}bulgeArcTo(e,n){if(!n)return this.lineTo(e);const i=Tt(this.pointer,e)/2,o=-n*i;return this.sagittaArcTo(e,o)}bulgeArc(e,n,i){return this.bulgeArcTo([e+this.pointer[0],n+this.pointer[1]],i)}vBulgeArc(e,n){return this.bulgeArc(0,e,n)}hBulgeArc(e,n){return this.bulgeArc(e,0,n)}tangentArcTo(e){const n=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!n)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(hc(this._convertToUV(this.pointer),n.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,n){const[i,o]=this.pointer;return this.tangentArcTo([e+i,n+o])}ellipseTo(e,n,i,o=0,s=!1,a=!1){let c=o,f=n,p=i;n<i&&(c=o+90,f=i,p=n);const v=c*gt,y=V=>Tt(this._convertToUV(V)),g=y(Ar(f,v)),S=y(Ar(p,v+Math.PI/2)),E=Xt(this._convertToUV(uc([1,0],v))),[,k]=lc(E),{cx:C,cy:P,startAngle:R,endAngle:O,clockwise:q,rx:D,ry:K}=Ac(this._convertToUV(this.pointer),this._convertToUV(e),g,S,k,s,a),H=pc(D,K,q?R:O,q?O:R,[C,P],E);return q||H.reverse(),this.saveCurve(H),this.pointer=e,this}ellipse(e,n,i,o,s=0,a=!1,c=!1){const[f,p]=this.pointer;return this.ellipseTo([e+f,n+p],i,o,s,a,c)}halfEllipseTo(e,n,i=!1){const o=ac(e,this.pointer),s=Tt(e,this.pointer);return this.ellipseTo(e,s/2,n,o*qr,!0,i)}halfEllipse(e,n,i,o=!1){const[s,a]=this.pointer;return this.halfEllipseTo([s+e,a+n],i,o)}bezierCurveTo(e,n){let i;return n.length===2&&!Array.isArray(n[0])?i=[n]:i=n,this.saveCurve(dc(this._convertToUV(this.pointer),i.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,n){return this.bezierCurveTo(e,[n])}cubicBezierCurveTo(e,n,i){return this.bezierCurveTo(e,[n,i])}smoothSplineTo(e,n){const{endTangent:i,startTangent:o,startFactor:s,endFactor:a}=Pc(n),c=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,f=Tt(this.pointer,e)*.25;let p;o?p=o:c?p=this._convertFromUV(c.tangentAt(1)):p=[1,0],p=Xt(p);const v=[this.pointer[0]+p[0]*s*f,this.pointer[1]+p[1]*s*f];let y;i==="symmetric"?y=[-p[0],-p[1]]:y=i,y=Xt(y);const g=[e[0]-y[0]*a*f,e[1]-y[1]*a*f];return this.cubicBezierCurveTo(e,v,g)}smoothSpline(e,n,i){return this.smoothSplineTo([e+this.pointer[0],n+this.pointer[1]],i)}customCorner(e,n="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:n,radius:e},this}_customCornerLastWithFirst(e,n="fillet"){if(!e)return;const i=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!i||!o)throw new Error("Not enough curves to close and fillet");const s=n==="chamfer"?io:no;this.pendingCurves.push(...s(i,o,e))}_closeSketch(){Ze(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(Ze(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],n=Cr(this._convertToUV(this.pointer),this._convertToUV(e)),i=this.pendingCurves.map(o=>new Ae(o.innerCurve.Mirrored_2(n)));i.reverse(),i.map(o=>o.reverse()),this.pendingCurves.push(...i),this.pointer=this.firstPoint}}class Gc extends oa{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new ae(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,n="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,n),this.done()}}const Nc=r=>{const e=W(),n=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);r.forEach((s,a)=>{s.edges.forEach(c=>{n.Add_1(c.wrapped,e.GeomAbs_Shape.GeomAbs_C0,a===0)})});const i=new e.Message_ProgressRange_1;n.Build(i),i.delete();const o=Ie(n.Shape());if(n.delete(),!(o instanceof Mr))throw new Error("Failed to create a face");return o},zc=(r,e)=>{const n=W(),i=new n.ShapeFix_Wire_2(r.wrapped,e.wrapped,1e-9);return i.FixEdgeCurves(),i.delete(),r},sa=r=>{let e,n;try{e=Kn(r[0]),n=r.slice(1)}catch{e=Nc(r),n=r.slice(1).map(o=>zc(o,e))}return Zs(e,n)},aa=(r,e)=>{const n=[],i=[],o=[];r.forEach(f=>{const[p,v,y]=e(f);n.push(p),i.push(v),o.push(y)});const s=sa(i),a=sa(o);return js([s,...n,a])};class ua{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(n=>n.wire);return tn(e)}face(){const e=this.outerSketch.face();return Zs(e,this.innerSketches.map(i=>i.wire))}extrude(e,{extrusionDirection:n,extrusionProfile:i,twistAngle:o,origin:s}={}){const a=new oe(n||this.outerSketch.defaultDirection).normalized().multiply(e);return i&&!o?aa(this.sketches,p=>ta(p.wire,s||this.outerSketch.defaultOrigin,a,i,!0)):o?aa(this.sketches,p=>ra(p.wire,o,s||this.outerSketch.defaultOrigin,a,i,!0)):Qs(this.face(),a)}revolve(e,{origin:n}={}){return Js(this.face(),n||this.outerSketch.defaultOrigin,e)}loftWith(e,n){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const i=this.sketches.map((s,a)=>{const c=e.sketches[a];return s.clone().loftWith(c.clone(),{ruled:n.ruled},!0)}),o=this.face().clone();return i.push(o,e.face()),js(i)}}class ve{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new ve(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Kr;this.blueprints.forEach(n=>e.add(n.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,n,i){return new ve(this.blueprints.map(o=>o.stretch(e,n,i)))}rotate(e,n){return new ve(this.blueprints.map(i=>i.rotate(e,n)))}scale(e,n){const i=n||this.boundingBox.center;return new ve(this.blueprints.map(o=>o.scale(e,i)))}translate(e,n=0){return new ve(this.blueprints.map(i=>i.translate(e,n)))}mirror(e,n,i){return new ve(this.blueprints.map(o=>o.mirror(e,n,i)))}sketchOnPlane(e,n){const i=this.blueprints.map(o=>o.sketchOnPlane(e,n));return new ua(i)}sketchOnFace(e,n){const i=this.blueprints.map(o=>o.sketchOnFace(e,n));return new ua(i)}toSVGViewBox(e=1){return Qn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return fo(this.toSVGGroup(),this.boundingBox,e)}}class la{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(n=>n instanceof nn?n.wire:n.wires);return tn(e)}faces(){const e=this.sketches.map(n=>n.face());return tn(e)}extrude(e,n={}){const i=this.sketches.map(o=>o.extrude(e,n));return tn(i)}revolve(e,n){return tn(this.sketches.map(i=>i.revolve(e,n)))}}class ie{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new ie(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Kr;this.blueprints.forEach(n=>e.add(n.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,n,i){return new ie(this.blueprints.map(o=>o.stretch(e,n,i)))}rotate(e,n){return new ie(this.blueprints.map(i=>i.rotate(e,n)))}scale(e,n){const i=n||this.boundingBox.center;return new ie(this.blueprints.map(o=>o.scale(e,i)))}translate(e,n=0){return new ie(this.blueprints.map(i=>i.translate(e,n)))}mirror(e,n,i){return new ie(this.blueprints.map(o=>o.mirror(e,n,i)))}sketchOnPlane(e,n){return new la(this.blueprints.map(i=>i.sketchOnPlane(e,n)))}sketchOnFace(e,n){return new la(this.blueprints.map(i=>i.sketchOnFace(e,n)))}toSVGViewBox(e=1){return Qn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const n=this.blueprints.map(i=>i instanceof ae?i.toSVGPath():i.toSVGGroup());return fo(n.join(`
    `),this.boundingBox,e)}}const Hc=r=>{const e=r.map((o,s)=>r.slice(s+1).map((a,c)=>[c+s+1,a]).filter(([,a])=>!o.boundingBox.isOut(a.boundingBox)).map(([a])=>a)),n=[],i=Array(e.length);return e.forEach((o,s)=>{let a=i[s];a||(a=[],n.push(a)),a.push(r[s]),o.length&&o.forEach(c=>{i[c]=a})}),n},ca=r=>r.map((e,n)=>{const i=e.curves[0],o=i.value((i.lastParameter+i.firstParameter)/2),s=r.filter((a,c)=>n===c?!1:a.isInside(o));return{blueprint:e,isIn:s}}),Wc=(r,e)=>r.flatMap(({blueprint:n})=>ho(e.filter(({blueprint:i,isIn:o})=>i===n||o.indexOf(n)!==-1))),Vc=(r,e)=>{const n=e.filter(({isIn:o})=>o.length<=1),i=ho(ca(r.map(({blueprint:o})=>o)));return[n,...i]},ho=r=>{if(!r.length)return[];const e=r.filter(({isIn:i})=>!i.length),n=r.filter(({isIn:i})=>i.length>1);return e.length===1&&n.length===0?[r]:e.length>1?Wc(e,r):Vc(n,r)},sn=r=>{const e=Hc(r).map(ca);return new ie(e.flatMap(ho).map(n=>n.length===1?n[0].blueprint:(n.sort((i,o)=>i.isIn.length-o.isIn.length),new ve(n.map(({blueprint:i})=>i)))))},$c=(r,e,n=0)=>{const{rx:i=0,ry:o=0}=typeof n=="number"?{ry:n,rx:n}:n;let s=Math.min(i,r/2),a=Math.min(o,e/2);const c=s&&a;c||(s=0,a=0);const f=s===a,p=new Gc([Math.min(0,-(r/2-s)),-e/2]),v=(y,g)=>{c&&(f?p.tangentArc(y,g):p.ellipse(y,g,s,a,0,!1,!0))};return s<r/2&&p.hLine(r-2*s),v(s,a),a<e/2&&p.vLine(e-2*a),v(-s,a),s<r/2&&p.hLine(-(r-2*s)),v(-s,-a),a<e/2&&p.vLine(-(e-2*a)),v(s,-a),p.close()},Jn=1e-9,Ke=(r,e)=>Ze(r,e,Jn),an=r=>{const e=(r.lastParameter+r.firstParameter)/2;return r.value(e)},fa=(r,e)=>{const n=r.findIndex(s=>Ke(e,s.firstPoint)),i=r.slice(0,n);return r.slice(n).concat(i)},ha=(r,e)=>{const n=a=>Ke(e.firstPoint,a.firstPoint)&&Ke(e.lastPoint,a.lastPoint);let i=r.findIndex(n);if(i===-1&&(r=vo(r),i=r.findIndex(n),i===-1))throw console.error(r.map(a=>a.repr),e.repr),new Error("Failed to rotate to segment start");const o=r.slice(0,i);return r.slice(i).concat(o)};function*pa(r,e,n){const i=a=>!!e.find(c=>Ke(c,a.lastPoint)),o=a=>!!n.find(c=>Ke(c.firstPoint,a.firstPoint)&&Ke(c.lastPoint,a.lastPoint)||Ke(c.firstPoint,a.lastPoint)&&Ke(c.lastPoint,a.firstPoint));let s=[];for(const a of r)i(a)?(s.push(a),yield s,s=[]):o(a)?(s.length&&(yield s,s=[]),yield[a]):s.push(a);s.length&&(yield s)}const Yc=r=>r[0].firstPoint,po=r=>r[r.length-1].lastPoint,vo=r=>(r.reverse(),r.map(e=>{const n=e.clone();return n.reverse(),n})),Xc=r=>(r.reverse(),r.map(vo));function qc(r,e,n){return r.filter(i=>{const o=e.filter(c=>Ke(c.firstPoint,i)||Ke(c.lastPoint,i));if(o.length%2)throw console.error(o,i),new Error("Bug in the intersection algo on non crossing point");const s=o.map(c=>n.isInside(an(c)));return!(s.every(c=>c)||!s.some(c=>c))})}function jc(r,e){let n=[];const i=[],o=new Array(r.curves.length).fill(0).map(()=>[]),s=new Array(e.curves.length).fill(0).map(()=>[]);if(r.curves.forEach((g,S)=>{e.curves.forEach((E,k)=>{const{intersections:C,commonSegments:P,commonSegmentsPoints:R}=Qr(g,E,Jn/100);n.push(...C),o[S].push(...C),s[k].push(...C),i.push(...P),n.push(...R),o[S].push(...R),s[k].push(...R)})}),n=ks(n,Jn),!n.length||n.length===1)return null;const a=([g,S])=>S.length?g.splitAt(S,Jn/100):[g];let c=kr([r.curves,o]).flatMap(a),f=kr([e.curves,s]).flatMap(a);const p=i.map(g=>[g.firstPoint,g.lastPoint]);if(n=qc(n,c,e),!n.length&&!i.length)return null;if(i.length){const g=i[0];c=ha(c,g),f=ha(f,g)}else{const g=n[0];c=fa(c,g),f=fa(f,g)}const v=Array.from(pa(c,n,i));let y=Array.from(pa(f,n,i));return(!Ke(po(y[0]),po(v[0]))||i.length>0&&y[0].length!==1)&&(y=Xc(y)),kr([v,y]).map(([g,S])=>{const E=Yc(g),k=po(g);return p.find(([C,P])=>Ke(C,E)&&Ke(P,k)||Ke(C,k)&&Ke(C,E))?[g,"same"]:[g,S]})}const Zc=r=>{const e=r.map(a=>a.firstPoint);let n=r.map(a=>a.lastPoint);n=n.slice(-1).concat(n.slice(0,-1));const i=kr([e,n]).map(([a,c],f)=>Ke(a,c)?null:f).filter(a=>a!==null);if(!i.length)return[r];const o=kr([i.slice(0,-1),i.slice(1)]).map(([a,c])=>r.slice(a,c));let s=r.slice(i[i.length-1]);return i[0]!==0&&(s=s.concat(r.slice(0,i[0]))),o.push(s),o};function go(r,e,{firstInside:n,secondInside:i}){const o=jc(r,e);if(!o){const p=an(r.curves[0]),v=e.isInside(p),y=an(e.curves[0]),g=r.isInside(y);return{identical:!1,firstCurveInSecond:v,secondCurveInFirst:g}}if(o.every(([,p])=>p==="same"))return{identical:!0};let s=null,a=null;const c=o.flatMap(([p,v])=>{let y=[],g=0;if(v==="same")return a===1?(a=1,[...p]):a===2||a===0?(a=null,[]):a===null?(s?s=[...s,...p]:s=p,[]):(console.error("weird situation"),[]);const S=an(p[0]),E=e.isInside(S);(n==="keep"&&E||n==="remove"&&!E)&&(g+=1,y.push(...p));const k=an(v[0]),C=r.isInside(k);if(i==="keep"&&C||i==="remove"&&!C){let P=v;g===1&&(P=vo(v)),g+=1,y.push(...P)}return a===null&&g===1&&s&&(y=[...s,...y]),g===1&&(a=g,s=null),y}),f=Zc(c).filter(p=>p.length).map(p=>new ae(p));return f.length===0?null:f.length===1?f[0]:sn(f)}const ei=(r,e)=>{const n=go(r,e,{firstInside:"remove",secondInside:"remove"});return n===null||n instanceof ae||n instanceof ie?n:n.identical?r.clone():n.firstCurveInSecond?e.clone():n.secondCurveInFirst?r.clone():new ie([r,e])},un=(r,e)=>{const n=go(r,e,{firstInside:"remove",secondInside:"keep"});return n===null||n instanceof ae||n instanceof ie?n:n.identical||n.firstCurveInSecond?null:n.secondCurveInFirst?new ie([new ve([r,e])]):r.clone()},mo=(r,e)=>{const n=go(r,e,{firstInside:"keep",secondInside:"keep"});return n===null||n instanceof ae||n instanceof ie?n:n.identical||n.firstCurveInSecond?r.clone():n.secondCurveInFirst?e.clone():null},yo=(r,e)=>{if(r instanceof ae&&e instanceof ae){let n=[];return r.curves.forEach(i=>{e.curves.forEach(o=>{const{intersections:s,commonSegmentsPoints:a}=Qr(i,o);n.push(...s),n.push(...a)})}),n=ks(n),n.length>1}if(r instanceof ve||r instanceof ie)return r.blueprints.some(n=>yo(n,e));if(e instanceof ve||e instanceof ie)return e.blueprints.some(n=>yo(r,n));throw new Error("Bug in the generic intersects algorithm")},Kc=(r,e)=>{if(r instanceof ve){if(e instanceof ae)return ti(e,r);if(e instanceof ve)return ri(r,e)}if(e instanceof ve){if(r instanceof ae)return ti(r,e);if(r instanceof ve)return ri(r,e)}if(r instanceof ae&&e instanceof ae)return ei(r,e);throw new Error("Bug in the generic fuse algorithm")},da=r=>{const e=new Map,n=[];return r.forEach((i,o)=>{let s;e.has(o)?s=e.get(o):(s={current:i,fusedWith:new Set([o])},n.push(s)),r.slice(o+1).forEach((a,c)=>{const f=s.current,p=o+c+1;if(s.fusedWith.has(p))return;let v=a,y=!1;if(e.has(p)&&(v=e.get(p).current,y=!0),f.boundingBox.isOut(v.boundingBox)||!yo(f,v))return;let g;if(f instanceof ie||v instanceof ie?g=Dt(f,v):g=Kc(f,v),!(g instanceof ae||g instanceof ve)){if(g instanceof ie&&g.blueprints.length===2)return;if(g instanceof ie&&g.blueprints.length===1)g=g.blueprints[0];else if(!(g instanceof ie))throw console.error(g),new Error("Bug in blueprint fusing algorigthm")}s.fusedWith.add(p),s.current=g,y||e.set(p,s)})}),sn(n.map(({current:i})=>i).filter(i=>i).flatMap(i=>Ot(i)))},Ot=r=>r instanceof ae?[r]:r instanceof ve?r.blueprints:r instanceof ie?r.blueprints.flatMap(e=>Ot(e)):[],ti=(r,e)=>{const n=ei(r,e.blueprints[0]),i=e.blueprints.slice(1).map(o=>un(o,r));return sn([...Ot(n),...i.flatMap(o=>Ot(o))])};function Qc(r,e){const n=[];for(const i of r)for(const o of e)n.push([i,o]);return n}const ri=(r,e)=>{const n=ei(r.blueprints[0],e.blueprints[0]),i=e.blueprints.slice(1).map(a=>un(a,r.blueprints[0])),o=r.blueprints.slice(1).map(a=>un(a,e.blueprints[0])),s=Qc(r.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([a,c])=>Ot(mo(a,c)));return sn([...Ot(n),...i.flatMap(a=>Ot(a)),...o.flatMap(a=>Ot(a)),...s])},Dt=(r,e)=>{if(r===null)return e&&e.clone();if(e===null)return r&&r.clone();if(!(r instanceof ie)&&e instanceof ie)return da([r,...e.blueprints]);if(!(e instanceof ie)&&r instanceof ie)return da([e,...r.blueprints]);if(r instanceof ie&&e instanceof ie){let n=Dt(r.blueprints[0],e);return r.blueprints.slice(1).forEach(i=>{n=Dt(i,n)}),n}if(r instanceof ve){if(e instanceof ie)return Dt(e,r);if(e instanceof ae)return ti(e,r);if(e instanceof ve)return ri(r,e)}if(e instanceof ve){if(r instanceof ie)return Dt(r,e);if(r instanceof ae)return ti(r,e);if(r instanceof ve)return ri(r,e)}return r instanceof ae&&e instanceof ae?ei(r,e):null},ni=r=>{const e=r.flatMap(n=>n===null?[]:n instanceof ie?n.blueprints:n);return e.length===1?e[0]:new ie(e)},Zt=(r,e)=>{if(r===null)return null;if(e===null)return r.clone();if(r instanceof ie)return ni(r.blueprints.map(i=>Zt(i,e)));if(r instanceof ve){const i=r.blueprints[0];if(e instanceof ae&&!e.intersects(i)){if(!i.isInside(e.firstPoint))return null;const o=Dt(e,new ie(r.blueprints.slice(1)));return sn([i,...Ot(o)])}else{let o=Zt(r.blueprints[0],e);return r.blueprints.slice(1).forEach(s=>{o=Zt(o,s)}),o}}if(e instanceof ie)return ni(e.blueprints.map(i=>Zt(r,i)));if(e instanceof ve){let i=un(r,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{i=Dt(i,mo(o,r))}),i}return un(r,e)};function ln(r,e){if(r===null||e===null)return null;if(r instanceof ae&&e instanceof ae)return mo(r,e);if(r instanceof ie)return ni(r.blueprints.map(n=>ln(n,e)));if(r instanceof ve){const n=r.blueprints[0],i=r.blueprints[1];return Zt(ln(n,e),i)}if(e instanceof ie)return ni(e.blueprints.map(n=>ln(r,n)));if(e instanceof ve){const n=e.blueprints[0],i=e.blueprints[1];return Zt(ln(n,r),i)}throw new Error("intersct 2D algorithm error")}/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var r=function(){try{var n={},i=Object.defineProperty,o=i(n,n,n)&&i}catch{}return o}(),e=function(n){if(this==null)throw TypeError();var i=String(this),o=i.length,s=n?Number(n):0;if(s!=s&&(s=0),!(s<0||s>=o)){var a=i.charCodeAt(s),c;return a>=55296&&a<=56319&&o>s+1&&(c=i.charCodeAt(s+1),c>=56320&&c<=57343)?(a-55296)*1024+c-56320+65536:a}};r?r(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function va(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var Jc=new va,ef=new va,ga=new Uint8Array(30),ma=new Uint16Array(30),tf=new Uint8Array(30),rf=new Uint16Array(30);function ya(r,e,n,i){var o,s;for(o=0;o<n;++o)r[o]=0;for(o=0;o<30-n;++o)r[o+n]=o/n|0;for(s=i,o=0;o<30;++o)e[o]=s,s+=1<<r[o]}function nf(r,e){var n;for(n=0;n<7;++n)r.table[n]=0;for(r.table[7]=24,r.table[8]=152,r.table[9]=112,n=0;n<24;++n)r.trans[n]=256+n;for(n=0;n<144;++n)r.trans[24+n]=n;for(n=0;n<8;++n)r.trans[24+144+n]=280+n;for(n=0;n<112;++n)r.trans[24+144+8+n]=144+n;for(n=0;n<5;++n)e.table[n]=0;for(e.table[5]=32,n=0;n<32;++n)e.trans[n]=n}nf(Jc,ef),ya(ga,ma,4,3),ya(tf,rf,2,1),ga[28]=0,ma[28]=258;function Rr(r,e,n,i,o){return Math.pow(1-o,3)*r+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*n+Math.pow(o,3)*i}function Kt(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Kt.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Kt.prototype.addPoint=function(r,e){typeof r=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=r,this.x2=r),r<this.x1&&(this.x1=r),r>this.x2&&(this.x2=r)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},Kt.prototype.addX=function(r){this.addPoint(r,null)},Kt.prototype.addY=function(r){this.addPoint(null,r)},Kt.prototype.addBezier=function(r,e,n,i,o,s,a,c){var f=[r,e],p=[n,i],v=[o,s],y=[a,c];this.addPoint(r,e),this.addPoint(a,c);for(var g=0;g<=1;g++){var S=6*f[g]-12*p[g]+6*v[g],E=-3*f[g]+9*p[g]-9*v[g]+3*y[g],k=3*p[g]-3*f[g];if(E===0){if(S===0)continue;var C=-k/S;0<C&&C<1&&(g===0&&this.addX(Rr(f[g],p[g],v[g],y[g],C)),g===1&&this.addY(Rr(f[g],p[g],v[g],y[g],C)));continue}var P=Math.pow(S,2)-4*k*E;if(!(P<0)){var R=(-S+Math.sqrt(P))/(2*E);0<R&&R<1&&(g===0&&this.addX(Rr(f[g],p[g],v[g],y[g],R)),g===1&&this.addY(Rr(f[g],p[g],v[g],y[g],R)));var O=(-S-Math.sqrt(P))/(2*E);0<O&&O<1&&(g===0&&this.addX(Rr(f[g],p[g],v[g],y[g],O)),g===1&&this.addY(Rr(f[g],p[g],v[g],y[g],O)))}}},Kt.prototype.addQuad=function(r,e,n,i,o,s){var a=r+.6666666666666666*(n-r),c=e+2/3*(i-e),f=a+1/3*(o-r),p=c+1/3*(s-e);this.addBezier(r,e,a,c,f,p,o,s)};function We(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}We.prototype.moveTo=function(r,e){this.commands.push({type:"M",x:r,y:e})},We.prototype.lineTo=function(r,e){this.commands.push({type:"L",x:r,y:e})},We.prototype.curveTo=We.prototype.bezierCurveTo=function(r,e,n,i,o,s){this.commands.push({type:"C",x1:r,y1:e,x2:n,y2:i,x:o,y:s})},We.prototype.quadTo=We.prototype.quadraticCurveTo=function(r,e,n,i){this.commands.push({type:"Q",x1:r,y1:e,x:n,y:i})},We.prototype.close=We.prototype.closePath=function(){this.commands.push({type:"Z"})},We.prototype.extend=function(r){if(r.commands)r=r.commands;else if(r instanceof Kt){var e=r;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,r)},We.prototype.getBoundingBox=function(){for(var r=new Kt,e=0,n=0,i=0,o=0,s=0;s<this.commands.length;s++){var a=this.commands[s];switch(a.type){case"M":r.addPoint(a.x,a.y),e=i=a.x,n=o=a.y;break;case"L":r.addPoint(a.x,a.y),i=a.x,o=a.y;break;case"Q":r.addQuad(i,o,a.x1,a.y1,a.x,a.y),i=a.x,o=a.y;break;case"C":r.addBezier(i,o,a.x1,a.y1,a.x2,a.y2,a.x,a.y),i=a.x,o=a.y;break;case"Z":i=e,o=n;break;default:throw new Error("Unexpected path command "+a.type)}}return r.isEmpty()&&r.addPoint(0,0),r},We.prototype.draw=function(r){r.beginPath();for(var e=0;e<this.commands.length;e+=1){var n=this.commands[e];n.type==="M"?r.moveTo(n.x,n.y):n.type==="L"?r.lineTo(n.x,n.y):n.type==="C"?r.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y):n.type==="Q"?r.quadraticCurveTo(n.x1,n.y1,n.x,n.y):n.type==="Z"&&r.closePath()}this.fill&&(r.fillStyle=this.fill,r.fill()),this.stroke&&(r.strokeStyle=this.stroke,r.lineWidth=this.strokeWidth,r.stroke())},We.prototype.toPathData=function(r){r=r!==void 0?r:2;function e(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(r)}function n(){for(var a=arguments,c="",f=0;f<arguments.length;f+=1){var p=a[f];p>=0&&f>0&&(c+=" "),c+=e(p)}return c}for(var i="",o=0;o<this.commands.length;o+=1){var s=this.commands[o];s.type==="M"?i+="M"+n(s.x,s.y):s.type==="L"?i+="L"+n(s.x,s.y):s.type==="C"?i+="C"+n(s.x1,s.y1,s.x2,s.y2,s.x,s.y):s.type==="Q"?i+="Q"+n(s.x1,s.y1,s.x,s.y):s.type==="Z"&&(i+="Z")}return i},We.prototype.toSVG=function(r){var e='<path d="';return e+=this.toPathData(r),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},We.prototype.toDOMElement=function(r){var e=this.toPathData(r),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n};function wa(r){throw new Error(r)}function ba(r,e){r||wa(e)}var J={fail:wa,argument:ba,assert:ba},Sa=32768,xa=2147483648,Or={},z={},Q={};function yt(r){return function(){return r}}z.BYTE=function(r){return J.argument(r>=0&&r<=255,"Byte value should be between 0 and 255."),[r]},Q.BYTE=yt(1),z.CHAR=function(r){return[r.charCodeAt(0)]},Q.CHAR=yt(1),z.CHARARRAY=function(r){typeof r>"u"&&(r="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],n=0;n<r.length;n+=1)e[n]=r.charCodeAt(n);return e},Q.CHARARRAY=function(r){return typeof r>"u"?0:r.length},z.USHORT=function(r){return[r>>8&255,r&255]},Q.USHORT=yt(2),z.SHORT=function(r){return r>=Sa&&(r=-(2*Sa-r)),[r>>8&255,r&255]},Q.SHORT=yt(2),z.UINT24=function(r){return[r>>16&255,r>>8&255,r&255]},Q.UINT24=yt(3),z.ULONG=function(r){return[r>>24&255,r>>16&255,r>>8&255,r&255]},Q.ULONG=yt(4),z.LONG=function(r){return r>=xa&&(r=-(2*xa-r)),[r>>24&255,r>>16&255,r>>8&255,r&255]},Q.LONG=yt(4),z.FIXED=z.ULONG,Q.FIXED=Q.ULONG,z.FWORD=z.SHORT,Q.FWORD=Q.SHORT,z.UFWORD=z.USHORT,Q.UFWORD=Q.USHORT,z.LONGDATETIME=function(r){return[0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255]},Q.LONGDATETIME=yt(8),z.TAG=function(r){return J.argument(r.length===4,"Tag should be exactly 4 ASCII characters."),[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3)]},Q.TAG=yt(4),z.Card8=z.BYTE,Q.Card8=Q.BYTE,z.Card16=z.USHORT,Q.Card16=Q.USHORT,z.OffSize=z.BYTE,Q.OffSize=Q.BYTE,z.SID=z.USHORT,Q.SID=Q.USHORT,z.NUMBER=function(r){return r>=-107&&r<=107?[r+139]:r>=108&&r<=1131?(r=r-108,[(r>>8)+247,r&255]):r>=-1131&&r<=-108?(r=-r-108,[(r>>8)+251,r&255]):r>=-32768&&r<=32767?z.NUMBER16(r):z.NUMBER32(r)},Q.NUMBER=function(r){return z.NUMBER(r).length},z.NUMBER16=function(r){return[28,r>>8&255,r&255]},Q.NUMBER16=yt(3),z.NUMBER32=function(r){return[29,r>>24&255,r>>16&255,r>>8&255,r&255]},Q.NUMBER32=yt(5),z.REAL=function(r){var e=r.toString(),n=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(n){var i=parseFloat("1e"+((n[2]?+n[2]:0)+n[1].length));e=(Math.round(r*i)/i).toString()}for(var o="",s=0,a=e.length;s<a;s+=1){var c=e[s];c==="e"?o+=e[++s]==="-"?"c":"b":c==="."?o+="a":c==="-"?o+="e":o+=c}o+=o.length&1?"f":"ff";for(var f=[30],p=0,v=o.length;p<v;p+=2)f.push(parseInt(o.substr(p,2),16));return f},Q.REAL=function(r){return z.REAL(r).length},z.NAME=z.CHARARRAY,Q.NAME=Q.CHARARRAY,z.STRING=z.CHARARRAY,Q.STRING=Q.CHARARRAY,Or.UTF8=function(r,e,n){for(var i=[],o=n,s=0;s<o;s++,e+=1)i[s]=r.getUint8(e);return String.fromCharCode.apply(null,i)},Or.UTF16=function(r,e,n){for(var i=[],o=n/2,s=0;s<o;s++,e+=2)i[s]=r.getUint16(e);return String.fromCharCode.apply(null,i)},z.UTF16=function(r){for(var e=[],n=0;n<r.length;n+=1){var i=r.charCodeAt(n);e[e.length]=i>>8&255,e[e.length]=i&255}return e},Q.UTF16=function(r){return r.length*2};var wo={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};Or.MACSTRING=function(r,e,n,i){var o=wo[i];if(o!==void 0){for(var s="",a=0;a<n;a++){var c=r.getUint8(e+a);c<=127?s+=String.fromCharCode(c):s+=o[c&127]}return s}};var ii=typeof WeakMap=="function"&&new WeakMap,oi,of=function(r){if(!oi){oi={};for(var e in wo)oi[e]=new String(e)}var n=oi[r];if(n!==void 0){if(ii){var i=ii.get(n);if(i!==void 0)return i}var o=wo[r];if(o!==void 0){for(var s={},a=0;a<o.length;a++)s[o.charCodeAt(a)]=a+128;return ii&&ii.set(n,s),s}}};z.MACSTRING=function(r,e){var n=of(e);if(n!==void 0){for(var i=[],o=0;o<r.length;o++){var s=r.charCodeAt(o);if(s>=128&&(s=n[s],s===void 0))return;i[o]=s}return i}},Q.MACSTRING=function(r,e){var n=z.MACSTRING(r,e);return n!==void 0?n.length:0};function bo(r){return r>=-128&&r<=127}function sf(r,e,n){for(var i=0,o=r.length;e<o&&i<64&&r[e]===0;)++e,++i;return n.push(128|i-1),e}function af(r,e,n){for(var i=0,o=r.length,s=e;s<o&&i<64;){var a=r[s];if(!bo(a)||a===0&&s+1<o&&r[s+1]===0)break;++s,++i}n.push(i-1);for(var c=e;c<s;++c)n.push(r[c]+256&255);return s}function uf(r,e,n){for(var i=0,o=r.length,s=e;s<o&&i<64;){var a=r[s];if(a===0||bo(a)&&s+1<o&&bo(r[s+1]))break;++s,++i}n.push(64|i-1);for(var c=e;c<s;++c){var f=r[c];n.push(f+65536>>8&255,f+256&255)}return s}z.VARDELTAS=function(r){for(var e=0,n=[];e<r.length;){var i=r[e];i===0?e=sf(r,e,n):i>=-128&&i<=127?e=af(r,e,n):e=uf(r,e,n)}return n},z.INDEX=function(r){for(var e=1,n=[e],i=[],o=0;o<r.length;o+=1){var s=z.OBJECT(r[o]);Array.prototype.push.apply(i,s),e+=s.length,n.push(e)}if(i.length===0)return[0,0];for(var a=[],c=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,z.BYTE,z.USHORT,z.UINT24,z.ULONG][c],p=0;p<n.length;p+=1){var v=f(n[p]);Array.prototype.push.apply(a,v)}return Array.prototype.concat(z.Card16(r.length),z.OffSize(c),a,i)},Q.INDEX=function(r){return z.INDEX(r).length},z.DICT=function(r){for(var e=[],n=Object.keys(r),i=n.length,o=0;o<i;o+=1){var s=parseInt(n[o],0),a=r[s];e=e.concat(z.OPERAND(a.value,a.type)),e=e.concat(z.OPERATOR(s))}return e},Q.DICT=function(r){return z.DICT(r).length},z.OPERATOR=function(r){return r<1200?[r]:[12,r-1200]},z.OPERAND=function(r,e){var n=[];if(Array.isArray(e))for(var i=0;i<e.length;i+=1)J.argument(r.length===e.length,"Not enough arguments given for type"+e),n=n.concat(z.OPERAND(r[i],e[i]));else if(e==="SID")n=n.concat(z.NUMBER(r));else if(e==="offset")n=n.concat(z.NUMBER32(r));else if(e==="number")n=n.concat(z.NUMBER(r));else if(e==="real")n=n.concat(z.REAL(r));else throw new Error("Unknown operand type "+e);return n},z.OP=z.BYTE,Q.OP=Q.BYTE;var si=typeof WeakMap=="function"&&new WeakMap;z.CHARSTRING=function(r){if(si){var e=si.get(r);if(e!==void 0)return e}for(var n=[],i=r.length,o=0;o<i;o+=1){var s=r[o];n=n.concat(z[s.type](s.value))}return si&&si.set(r,n),n},Q.CHARSTRING=function(r){return z.CHARSTRING(r).length},z.OBJECT=function(r){var e=z[r.type];return J.argument(e!==void 0,"No encoding function for type "+r.type),e(r.value)},Q.OBJECT=function(r){var e=Q[r.type];return J.argument(e!==void 0,"No sizeOf function for type "+r.type),e(r.value)},z.TABLE=function(r){for(var e=[],n=r.fields.length,i=[],o=[],s=0;s<n;s+=1){var a=r.fields[s],c=z[a.type];J.argument(c!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var f=r[a.name];f===void 0&&(f=a.value);var p=c(f);a.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),i.push(p)):e=e.concat(p)}for(var v=0;v<i.length;v+=1){var y=o[v],g=e.length;J.argument(g<65536,"Table "+r.tableName+" too big."),e[y]=g>>8,e[y+1]=g&255,e=e.concat(i[v])}return e},Q.TABLE=function(r){for(var e=0,n=r.fields.length,i=0;i<n;i+=1){var o=r.fields[i],s=Q[o.type];J.argument(s!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var a=r[o.name];a===void 0&&(a=o.value),e+=s(a),o.type==="TABLE"&&(e+=2)}return e},z.RECORD=z.TABLE,Q.RECORD=Q.TABLE,z.LITERAL=function(r){return r},Q.LITERAL=function(r){return r.length};function $e(r,e,n){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var i=0;i<e.length;i+=1){var o=e[i];this[o.name]=o.value}if(this.tableName=r,this.fields=e,n)for(var s=Object.keys(n),a=0;a<s.length;a+=1){var c=s[a],f=n[c];this[c]!==void 0&&(this[c]=f)}}$e.prototype.encode=function(){return z.TABLE(this)},$e.prototype.sizeOf=function(){return Q.TABLE(this)};function cn(r,e,n){n===void 0&&(n=e.length);var i=new Array(e.length+1);i[0]={name:r+"Count",type:"USHORT",value:n};for(var o=0;o<e.length;o++)i[o+1]={name:r+o,type:"USHORT",value:e[o]};return i}function So(r,e,n){var i=e.length,o=new Array(i+1);o[0]={name:r+"Count",type:"USHORT",value:i};for(var s=0;s<i;s++)o[s+1]={name:r+s,type:"TABLE",value:n(e[s],s)};return o}function fn(r,e,n){var i=e.length,o=[];o[0]={name:r+"Count",type:"USHORT",value:i};for(var s=0;s<i;s++)o=o.concat(n(e[s],s));return o}function ai(r){r.format===1?$e.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(cn("glyph",r.glyphs))):r.format===2?$e.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(fn("rangeRecord",r.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):J.assert(!1,"Coverage format must be 1 or 2.")}ai.prototype=Object.create($e.prototype),ai.prototype.constructor=ai;function ui(r){$e.call(this,"scriptListTable",fn("scriptRecord",r,function(e,n){var i=e.script,o=i.defaultLangSys;return J.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+n,type:"TAG",value:e.tag},{name:"script"+n,type:"TABLE",value:new $e("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new $e("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(cn("featureIndex",o.featureIndexes)))}].concat(fn("langSys",i.langSysRecords,function(s,a){var c=s.langSys;return[{name:"langSysTag"+a,type:"TAG",value:s.tag},{name:"langSys"+a,type:"TABLE",value:new $e("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:c.reqFeatureIndex}].concat(cn("featureIndex",c.featureIndexes)))}]})))}]}))}ui.prototype=Object.create($e.prototype),ui.prototype.constructor=ui;function li(r){$e.call(this,"featureListTable",fn("featureRecord",r,function(e,n){var i=e.feature;return[{name:"featureTag"+n,type:"TAG",value:e.tag},{name:"feature"+n,type:"TABLE",value:new $e("featureTable",[{name:"featureParams",type:"USHORT",value:i.featureParams}].concat(cn("lookupListIndex",i.lookupListIndexes)))}]}))}li.prototype=Object.create($e.prototype),li.prototype.constructor=li;function ci(r,e){$e.call(this,"lookupListTable",So("lookup",r,function(n){var i=e[n.lookupType];return J.assert(!!i,"Unable to write GSUB lookup type "+n.lookupType+" tables."),new $e("lookupTable",[{name:"lookupType",type:"USHORT",value:n.lookupType},{name:"lookupFlag",type:"USHORT",value:n.lookupFlag}].concat(So("subtable",n.subtables,i)))}))}ci.prototype=Object.create($e.prototype),ci.prototype.constructor=ci;var Y={Table:$e,Record:$e,Coverage:ai,ScriptList:ui,FeatureList:li,LookupList:ci,ushortList:cn,tableList:So,recordList:fn};function _a(r,e){return r.getUint8(e)}function fi(r,e){return r.getUint16(e,!1)}function lf(r,e){return r.getInt16(e,!1)}function xo(r,e){return r.getUint32(e,!1)}function Ea(r,e){var n=r.getInt16(e,!1),i=r.getUint16(e+2,!1);return n+i/65535}function cf(r,e){for(var n="",i=e;i<e+4;i+=1)n+=String.fromCharCode(r.getInt8(i));return n}function ff(r,e,n){for(var i=0,o=0;o<n;o+=1)i<<=8,i+=r.getUint8(e+o);return i}function hf(r,e,n){for(var i=[],o=e;o<n;o+=1)i.push(r.getUint8(o));return i}function pf(r){for(var e="",n=0;n<r.length;n+=1)e+=String.fromCharCode(r[n]);return e}var df={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function A(r,e){this.data=r,this.offset=e,this.relativeOffset=0}A.prototype.parseByte=function(){var r=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,r},A.prototype.parseChar=function(){var r=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,r},A.prototype.parseCard8=A.prototype.parseByte,A.prototype.parseUShort=function(){var r=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,r},A.prototype.parseCard16=A.prototype.parseUShort,A.prototype.parseSID=A.prototype.parseUShort,A.prototype.parseOffset16=A.prototype.parseUShort,A.prototype.parseShort=function(){var r=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,r},A.prototype.parseF2Dot14=function(){var r=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,r},A.prototype.parseULong=function(){var r=xo(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,r},A.prototype.parseOffset32=A.prototype.parseULong,A.prototype.parseFixed=function(){var r=Ea(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,r},A.prototype.parseString=function(r){var e=this.data,n=this.offset+this.relativeOffset,i="";this.relativeOffset+=r;for(var o=0;o<r;o++)i+=String.fromCharCode(e.getUint8(n+o));return i},A.prototype.parseTag=function(){return this.parseString(4)},A.prototype.parseLongDateTime=function(){var r=xo(this.data,this.offset+this.relativeOffset+4);return r-=2082844800,this.relativeOffset+=8,r},A.prototype.parseVersion=function(r){var e=fi(this.data,this.offset+this.relativeOffset),n=fi(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,r===void 0&&(r=4096),e+n/r/10},A.prototype.skip=function(r,e){e===void 0&&(e=1),this.relativeOffset+=df[r]*e},A.prototype.parseULongList=function(r){r===void 0&&(r=this.parseULong());for(var e=new Array(r),n=this.data,i=this.offset+this.relativeOffset,o=0;o<r;o++)e[o]=n.getUint32(i),i+=4;return this.relativeOffset+=r*4,e},A.prototype.parseOffset16List=A.prototype.parseUShortList=function(r){r===void 0&&(r=this.parseUShort());for(var e=new Array(r),n=this.data,i=this.offset+this.relativeOffset,o=0;o<r;o++)e[o]=n.getUint16(i),i+=2;return this.relativeOffset+=r*2,e},A.prototype.parseShortList=function(r){for(var e=new Array(r),n=this.data,i=this.offset+this.relativeOffset,o=0;o<r;o++)e[o]=n.getInt16(i),i+=2;return this.relativeOffset+=r*2,e},A.prototype.parseByteList=function(r){for(var e=new Array(r),n=this.data,i=this.offset+this.relativeOffset,o=0;o<r;o++)e[o]=n.getUint8(i++);return this.relativeOffset+=r,e},A.prototype.parseList=function(r,e){e||(e=r,r=this.parseUShort());for(var n=new Array(r),i=0;i<r;i++)n[i]=e.call(this);return n},A.prototype.parseList32=function(r,e){e||(e=r,r=this.parseULong());for(var n=new Array(r),i=0;i<r;i++)n[i]=e.call(this);return n},A.prototype.parseRecordList=function(r,e){e||(e=r,r=this.parseUShort());for(var n=new Array(r),i=Object.keys(e),o=0;o<r;o++){for(var s={},a=0;a<i.length;a++){var c=i[a],f=e[c];s[c]=f.call(this)}n[o]=s}return n},A.prototype.parseRecordList32=function(r,e){e||(e=r,r=this.parseULong());for(var n=new Array(r),i=Object.keys(e),o=0;o<r;o++){for(var s={},a=0;a<i.length;a++){var c=i[a],f=e[c];s[c]=f.call(this)}n[o]=s}return n},A.prototype.parseStruct=function(r){if(typeof r=="function")return r.call(this);for(var e=Object.keys(r),n={},i=0;i<e.length;i++){var o=e[i],s=r[o];n[o]=s.call(this)}return n},A.prototype.parseValueRecord=function(r){if(r===void 0&&(r=this.parseUShort()),r!==0){var e={};return r&1&&(e.xPlacement=this.parseShort()),r&2&&(e.yPlacement=this.parseShort()),r&4&&(e.xAdvance=this.parseShort()),r&8&&(e.yAdvance=this.parseShort()),r&16&&(e.xPlaDevice=void 0,this.parseShort()),r&32&&(e.yPlaDevice=void 0,this.parseShort()),r&64&&(e.xAdvDevice=void 0,this.parseShort()),r&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},A.prototype.parseValueRecordList=function(){for(var r=this.parseUShort(),e=this.parseUShort(),n=new Array(e),i=0;i<e;i++)n[i]=this.parseValueRecord(r);return n},A.prototype.parsePointer=function(r){var e=this.parseOffset16();if(e>0)return new A(this.data,this.offset+e).parseStruct(r)},A.prototype.parsePointer32=function(r){var e=this.parseOffset32();if(e>0)return new A(this.data,this.offset+e).parseStruct(r)},A.prototype.parseListOfLists=function(r){for(var e=this.parseOffset16List(),n=e.length,i=this.relativeOffset,o=new Array(n),s=0;s<n;s++){var a=e[s];if(a===0){o[s]=void 0;continue}if(this.relativeOffset=a,r){for(var c=this.parseOffset16List(),f=new Array(c.length),p=0;p<c.length;p++)this.relativeOffset=a+c[p],f[p]=r.call(this);o[s]=f}else o[s]=this.parseUShortList()}return this.relativeOffset=i,o},A.prototype.parseCoverage=function(){var r=this.offset+this.relativeOffset,e=this.parseUShort(),n=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(n)};if(e===2){for(var i=new Array(n),o=0;o<n;o++)i[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:i}}throw new Error("0x"+r.toString(16)+": Coverage format must be 1 or 2.")},A.prototype.parseClassDef=function(){var r=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:A.uShort,end:A.uShort,classId:A.uShort})};throw new Error("0x"+r.toString(16)+": ClassDef format must be 1 or 2.")},A.list=function(r,e){return function(){return this.parseList(r,e)}},A.list32=function(r,e){return function(){return this.parseList32(r,e)}},A.recordList=function(r,e){return function(){return this.parseRecordList(r,e)}},A.recordList32=function(r,e){return function(){return this.parseRecordList32(r,e)}},A.pointer=function(r){return function(){return this.parsePointer(r)}},A.pointer32=function(r){return function(){return this.parsePointer32(r)}},A.tag=A.prototype.parseTag,A.byte=A.prototype.parseByte,A.uShort=A.offset16=A.prototype.parseUShort,A.uShortList=A.prototype.parseUShortList,A.uLong=A.offset32=A.prototype.parseULong,A.uLongList=A.prototype.parseULongList,A.struct=A.prototype.parseStruct,A.coverage=A.prototype.parseCoverage,A.classDef=A.prototype.parseClassDef;var Ta={reserved:A.uShort,reqFeatureIndex:A.uShort,featureIndexes:A.uShortList};A.prototype.parseScriptList=function(){return this.parsePointer(A.recordList({tag:A.tag,script:A.pointer({defaultLangSys:A.pointer(Ta),langSysRecords:A.recordList({tag:A.tag,langSys:A.pointer(Ta)})})}))||[]},A.prototype.parseFeatureList=function(){return this.parsePointer(A.recordList({tag:A.tag,feature:A.pointer({featureParams:A.offset16,lookupListIndexes:A.uShortList})}))||[]},A.prototype.parseLookupList=function(r){return this.parsePointer(A.list(A.pointer(function(){var e=this.parseUShort();J.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var n=this.parseUShort(),i=n&16;return{lookupType:e,lookupFlag:n,subtables:this.parseList(A.pointer(r[e])),markFilteringSet:i?this.parseUShort():void 0}})))||[]},A.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var r=this.parseUShort(),e=this.parseUShort();J.argument(r===1&&e<1,"GPOS/GSUB feature variations table unknown.");var n=this.parseRecordList32({conditionSetOffset:A.offset32,featureTableSubstitutionOffset:A.offset32});return n})||[]};var re={getByte:_a,getCard8:_a,getUShort:fi,getCard16:fi,getShort:lf,getULong:xo,getFixed:Ea,getTag:cf,getOffset:ff,getBytes:hf,bytesToString:pf,Parser:A};function vf(r,e){e.parseUShort(),r.length=e.parseULong(),r.language=e.parseULong();var n;r.groupCount=n=e.parseULong(),r.glyphIndexMap={};for(var i=0;i<n;i+=1)for(var o=e.parseULong(),s=e.parseULong(),a=e.parseULong(),c=o;c<=s;c+=1)r.glyphIndexMap[c]=a,a++}function gf(r,e,n,i,o){r.length=e.parseUShort(),r.language=e.parseUShort();var s;r.segCount=s=e.parseUShort()>>1,e.skip("uShort",3),r.glyphIndexMap={};for(var a=new re.Parser(n,i+o+14),c=new re.Parser(n,i+o+16+s*2),f=new re.Parser(n,i+o+16+s*4),p=new re.Parser(n,i+o+16+s*6),v=i+o+16+s*8,y=0;y<s-1;y+=1)for(var g=void 0,S=a.parseUShort(),E=c.parseUShort(),k=f.parseShort(),C=p.parseUShort(),P=E;P<=S;P+=1)C!==0?(v=p.offset+p.relativeOffset-2,v+=C,v+=(P-E)*2,g=re.getUShort(n,v),g!==0&&(g=g+k&65535)):g=P+k&65535,r.glyphIndexMap[P]=g}function mf(r,e){var n={};n.version=re.getUShort(r,e),J.argument(n.version===0,"cmap table version should be 0."),n.numTables=re.getUShort(r,e+2);for(var i=-1,o=n.numTables-1;o>=0;o-=1){var s=re.getUShort(r,e+4+o*8),a=re.getUShort(r,e+4+o*8+2);if(s===3&&(a===0||a===1||a===10)||s===0&&(a===0||a===1||a===2||a===3||a===4)){i=re.getULong(r,e+4+o*8+4);break}}if(i===-1)throw new Error("No valid cmap sub-tables found.");var c=new re.Parser(r,e+i);if(n.format=c.parseUShort(),n.format===12)vf(n,c);else if(n.format===4)gf(n,c,r,e,i);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+n.format+").");return n}function yf(r,e,n){r.segments.push({end:e,start:e,delta:-(e-n),offset:0,glyphIndex:n})}function wf(r){r.segments.push({end:65535,start:65535,delta:1,offset:0})}function bf(r){var e=!0,n;for(n=r.length-1;n>0;n-=1){var i=r.get(n);if(i.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var s=new Y.Table("cmap",o);for(s.segments=[],n=0;n<r.length;n+=1){for(var a=r.get(n),c=0;c<a.unicodes.length;c+=1)yf(s,a.unicodes[c],n);s.segments=s.segments.sort(function(R,O){return R.start-O.start})}wf(s);var f=s.segments.length,p=0,v=[],y=[],g=[],S=[],E=[],k=[];for(n=0;n<f;n+=1){var C=s.segments[n];C.end<=65535&&C.start<=65535?(v=v.concat({name:"end_"+n,type:"USHORT",value:C.end}),y=y.concat({name:"start_"+n,type:"USHORT",value:C.start}),g=g.concat({name:"idDelta_"+n,type:"SHORT",value:C.delta}),S=S.concat({name:"idRangeOffset_"+n,type:"USHORT",value:C.offset}),C.glyphId!==void 0&&(E=E.concat({name:"glyph_"+n,type:"USHORT",value:C.glyphId}))):p+=1,!e&&C.glyphIndex!==void 0&&(k=k.concat({name:"cmap12Start_"+n,type:"ULONG",value:C.start}),k=k.concat({name:"cmap12End_"+n,type:"ULONG",value:C.end}),k=k.concat({name:"cmap12Glyph_"+n,type:"ULONG",value:C.glyphIndex}))}if(s.segCountX2=(f-p)*2,s.searchRange=Math.pow(2,Math.floor(Math.log(f-p)/Math.log(2)))*2,s.entrySelector=Math.log(s.searchRange/2)/Math.log(2),s.rangeShift=s.segCountX2-s.searchRange,s.fields=s.fields.concat(v),s.fields.push({name:"reservedPad",type:"USHORT",value:0}),s.fields=s.fields.concat(y),s.fields=s.fields.concat(g),s.fields=s.fields.concat(S),s.fields=s.fields.concat(E),s.cmap4Length=14+v.length*2+2+y.length*2+g.length*2+S.length*2+E.length*2,!e){var P=16+k.length*4;s.cmap12Offset=12+2*2+4+s.cmap4Length,s.fields=s.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:P},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:k.length/3}]),s.fields=s.fields.concat(k)}return s}var Sf={parse:mf,make:bf},hi=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],xf=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],_f=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],ka=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Ca(r){this.font=r}Ca.prototype.charToGlyphIndex=function(r){var e=r.codePointAt(0),n=this.font.glyphs;if(n){for(var i=0;i<n.length;i+=1)for(var o=n.get(i),s=0;s<o.unicodes.length;s+=1)if(o.unicodes[s]===e)return i}return null};function pi(r,e){this.encoding=r,this.charset=e}pi.prototype.charToGlyphIndex=function(r){var e=r.codePointAt(0),n=this.encoding[e];return this.charset.indexOf(n)};function Ef(r,e,n,i,o){r.beginPath(),r.moveTo(e,n),r.lineTo(i,o),r.stroke()}var pr={line:Ef};function Tf(r,e){var n=e||new We;return{configurable:!0,get:function(){return typeof n=="function"&&(n=n()),n},set:function(i){n=i}}}function ht(r){this.bindConstructorValues(r)}ht.prototype.bindConstructorValues=function(r){this.index=r.index||0,this.name=r.name||null,this.unicode=r.unicode||void 0,this.unicodes=r.unicodes||r.unicode!==void 0?[r.unicode]:[],"xMin"in r&&(this.xMin=r.xMin),"yMin"in r&&(this.yMin=r.yMin),"xMax"in r&&(this.xMax=r.xMax),"yMax"in r&&(this.yMax=r.yMax),"advanceWidth"in r&&(this.advanceWidth=r.advanceWidth),Object.defineProperty(this,"path",Tf(this,r.path))},ht.prototype.addUnicode=function(r){this.unicodes.length===0&&(this.unicode=r),this.unicodes.push(r)},ht.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},ht.prototype.getPath=function(r,e,n,i,o){r=r!==void 0?r:0,e=e!==void 0?e:0,n=n!==void 0?n:72;var s,a;i||(i={});var c=i.xScale,f=i.yScale;if(i.hinting&&o&&o.hinting&&(a=this.path&&o.hinting.exec(this,n)),a)s=o.hinting.getCommands(a),r=Math.round(r),e=Math.round(e),c=f=1;else{s=this.path.commands;var p=1/(this.path.unitsPerEm||1e3)*n;c===void 0&&(c=p),f===void 0&&(f=p)}for(var v=new We,y=0;y<s.length;y+=1){var g=s[y];g.type==="M"?v.moveTo(r+g.x*c,e+-g.y*f):g.type==="L"?v.lineTo(r+g.x*c,e+-g.y*f):g.type==="Q"?v.quadraticCurveTo(r+g.x1*c,e+-g.y1*f,r+g.x*c,e+-g.y*f):g.type==="C"?v.curveTo(r+g.x1*c,e+-g.y1*f,r+g.x2*c,e+-g.y2*f,r+g.x*c,e+-g.y*f):g.type==="Z"&&v.closePath()}return v},ht.prototype.getContours=function(){if(this.points===void 0)return[];for(var r=[],e=[],n=0;n<this.points.length;n+=1){var i=this.points[n];e.push(i),i.lastPointOfContour&&(r.push(e),e=[])}return J.argument(e.length===0,"There are still points left in the current contour."),r},ht.prototype.getMetrics=function(){for(var r=this.path.commands,e=[],n=[],i=0;i<r.length;i+=1){var o=r[i];o.type!=="Z"&&(e.push(o.x),n.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),n.push(o.y1)),o.type==="C"&&(e.push(o.x2),n.push(o.y2))}var s={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,n),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},ht.prototype.draw=function(r,e,n,i,o){this.getPath(e,n,i,o).draw(r)},ht.prototype.drawPoints=function(r,e,n,i){function o(y,g,S,E){r.beginPath();for(var k=0;k<y.length;k+=1)r.moveTo(g+y[k].x*E,S+y[k].y*E),r.arc(g+y[k].x*E,S+y[k].y*E,2,0,Math.PI*2,!1);r.closePath(),r.fill()}e=e!==void 0?e:0,n=n!==void 0?n:0,i=i!==void 0?i:24;for(var s=1/this.path.unitsPerEm*i,a=[],c=[],f=this.path,p=0;p<f.commands.length;p+=1){var v=f.commands[p];v.x!==void 0&&a.push({x:v.x,y:-v.y}),v.x1!==void 0&&c.push({x:v.x1,y:-v.y1}),v.x2!==void 0&&c.push({x:v.x2,y:-v.y2})}r.fillStyle="blue",o(a,e,n,s),r.fillStyle="red",o(c,e,n,s)},ht.prototype.drawMetrics=function(r,e,n,i){var o;e=e!==void 0?e:0,n=n!==void 0?n:0,i=i!==void 0?i:24,o=1/this.path.unitsPerEm*i,r.lineWidth=1,r.strokeStyle="black",pr.line(r,e,-1e4,e,1e4),pr.line(r,-1e4,n,1e4,n);var s=this.xMin||0,a=this.yMin||0,c=this.xMax||0,f=this.yMax||0,p=this.advanceWidth||0;r.strokeStyle="blue",pr.line(r,e+s*o,-1e4,e+s*o,1e4),pr.line(r,e+c*o,-1e4,e+c*o,1e4),pr.line(r,-1e4,n+-a*o,1e4,n+-a*o),pr.line(r,-1e4,n+-f*o,1e4,n+-f*o),r.strokeStyle="green",pr.line(r,e+p*o,-1e4,e+p*o,1e4)};function di(r,e,n){Object.defineProperty(r,e,{get:function(){return r.path,r[n]},set:function(i){r[n]=i},enumerable:!0,configurable:!0})}function _o(r,e){if(this.font=r,this.glyphs={},Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];i.path.unitsPerEm=r.unitsPerEm,this.glyphs[n]=i}this.length=e&&e.length||0}_o.prototype.get=function(r){if(this.glyphs[r]===void 0){this.font._push(r),typeof this.glyphs[r]=="function"&&(this.glyphs[r]=this.glyphs[r]());var e=this.glyphs[r],n=this.font._IndexToUnicodeMap[r];if(n)for(var i=0;i<n.unicodes.length;i++)e.addUnicode(n.unicodes[i]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+r:e.name=this.font.cffEncoding.charset[r]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(r)),this.glyphs[r].advanceWidth=this.font._hmtxTableData[r].advanceWidth,this.glyphs[r].leftSideBearing=this.font._hmtxTableData[r].leftSideBearing}else typeof this.glyphs[r]=="function"&&(this.glyphs[r]=this.glyphs[r]());return this.glyphs[r]},_o.prototype.push=function(r,e){this.glyphs[r]=e,this.length++};function kf(r,e){return new ht({index:e,font:r})}function Cf(r,e,n,i,o,s){return function(){var a=new ht({index:e,font:r});return a.path=function(){n(a,i,o);var c=s(r.glyphs,a);return c.unitsPerEm=r.unitsPerEm,c},di(a,"xMin","_xMin"),di(a,"xMax","_xMax"),di(a,"yMin","_yMin"),di(a,"yMax","_yMax"),a}}function Pf(r,e,n,i){return function(){var o=new ht({index:e,font:r});return o.path=function(){var s=n(r,o,i);return s.unitsPerEm=r.unitsPerEm,s},o}}var kt={GlyphSet:_o,glyphLoader:kf,ttfGlyphLoader:Cf,cffGlyphLoader:Pf};function Pa(r,e){if(r===e)return!0;if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;for(var n=0;n<r.length;n+=1)if(!Pa(r[n],e[n]))return!1;return!0}else return!1}function Eo(r){var e;return r.length<1240?e=107:r.length<33900?e=1131:e=32768,e}function Qt(r,e,n){var i=[],o=[],s=re.getCard16(r,e),a,c;if(s!==0){var f=re.getByte(r,e+2);a=e+(s+1)*f+2;for(var p=e+3,v=0;v<s+1;v+=1)i.push(re.getOffset(r,p,f)),p+=f;c=a+i[s]}else c=e+2;for(var y=0;y<i.length-1;y+=1){var g=re.getBytes(r,a+i[y],a+i[y+1]);n&&(g=n(g)),o.push(g)}return{objects:o,startOffset:e,endOffset:c}}function Af(r,e){var n=[],i=re.getCard16(r,e),o,s;if(i!==0){var a=re.getByte(r,e+2);o=e+(i+1)*a+2;for(var c=e+3,f=0;f<i+1;f+=1)n.push(re.getOffset(r,c,a)),c+=a;s=o+n[i]}else s=e+2;return{offsets:n,startOffset:e,endOffset:s}}function Mf(r,e,n,i,o){var s=re.getCard16(n,i),a=0;if(s!==0){var c=re.getByte(n,i+2);a=i+(s+1)*c+2}var f=re.getBytes(n,a+e[r],a+e[r+1]);return o&&(f=o(f)),f}function Rf(r){for(var e="",n=15,i=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=r.parseByte(),s=o>>4,a=o&15;if(s===n||(e+=i[s],a===n))break;e+=i[a]}return parseFloat(e)}function Of(r,e){var n,i,o,s;if(e===28)return n=r.parseByte(),i=r.parseByte(),n<<8|i;if(e===29)return n=r.parseByte(),i=r.parseByte(),o=r.parseByte(),s=r.parseByte(),n<<24|i<<16|o<<8|s;if(e===30)return Rf(r);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return n=r.parseByte(),(e-247)*256+n+108;if(e>=251&&e<=254)return n=r.parseByte(),-(e-251)*256-n-108;throw new Error("Invalid b0 "+e)}function Df(r){for(var e={},n=0;n<r.length;n+=1){var i=r[n][0],o=r[n][1],s=void 0;if(o.length===1?s=o[0]:s=o,e.hasOwnProperty(i)&&!isNaN(e[i]))throw new Error("Object "+e+" already has key "+i);e[i]=s}return e}function Aa(r,e,n){e=e!==void 0?e:0;var i=new re.Parser(r,e),o=[],s=[];for(n=n!==void 0?n:r.length;i.relativeOffset<n;){var a=i.parseByte();a<=21?(a===12&&(a=1200+i.parseByte()),o.push([a,s]),s=[]):s.push(Of(i,a))}return Df(o)}function hn(r,e){return e<=390?e=hi[e]:e=r[e-391],e}function Ma(r,e,n){for(var i={},o,s=0;s<e.length;s+=1){var a=e[s];if(Array.isArray(a.type)){var c=[];c.length=a.type.length;for(var f=0;f<a.type.length;f++)o=r[a.op]!==void 0?r[a.op][f]:void 0,o===void 0&&(o=a.value!==void 0&&a.value[f]!==void 0?a.value[f]:null),a.type[f]==="SID"&&(o=hn(n,o)),c[f]=o;i[a.name]=c}else o=r[a.op],o===void 0&&(o=a.value!==void 0?a.value:null),a.type==="SID"&&(o=hn(n,o)),i[a.name]=o}return i}function Ff(r,e){var n={};return n.formatMajor=re.getCard8(r,e),n.formatMinor=re.getCard8(r,e+1),n.size=re.getCard8(r,e+2),n.offsetSize=re.getCard8(r,e+3),n.startOffset=e,n.endOffset=e+4,n}var Ra=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Oa=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Uf(r,e){var n=Aa(r,0,r.byteLength);return Ma(n,Ra,e)}function Da(r,e,n,i){var o=Aa(r,e,n);return Ma(o,Oa,i)}function Fa(r,e,n,i){for(var o=[],s=0;s<n.length;s+=1){var a=new DataView(new Uint8Array(n[s]).buffer),c=Uf(a,i);c._subrs=[],c._subrsBias=0,c._defaultWidthX=0,c._nominalWidthX=0;var f=c.private[0],p=c.private[1];if(f!==0&&p!==0){var v=Da(r,p+e,f,i);if(c._defaultWidthX=v.defaultWidthX,c._nominalWidthX=v.nominalWidthX,v.subrs!==0){var y=p+v.subrs,g=Qt(r,y+e);c._subrs=g.objects,c._subrsBias=Eo(c._subrs)}c._privateDict=v}o.push(c)}return o}function Lf(r,e,n,i){var o,s,a=new re.Parser(r,e);n-=1;var c=[".notdef"],f=a.parseCard8();if(f===0)for(var p=0;p<n;p+=1)o=a.parseSID(),c.push(hn(i,o));else if(f===1)for(;c.length<=n;){o=a.parseSID(),s=a.parseCard8();for(var v=0;v<=s;v+=1)c.push(hn(i,o)),o+=1}else if(f===2)for(;c.length<=n;){o=a.parseSID(),s=a.parseCard16();for(var y=0;y<=s;y+=1)c.push(hn(i,o)),o+=1}else throw new Error("Unknown charset format "+f);return c}function Bf(r,e,n){var i,o={},s=new re.Parser(r,e),a=s.parseCard8();if(a===0)for(var c=s.parseCard8(),f=0;f<c;f+=1)i=s.parseCard8(),o[i]=f;else if(a===1){var p=s.parseCard8();i=1;for(var v=0;v<p;v+=1)for(var y=s.parseCard8(),g=s.parseCard8(),S=y;S<=y+g;S+=1)o[S]=i,i+=1}else throw new Error("Unknown encoding format "+a);return new pi(o,n)}function Ua(r,e,n){var i,o,s,a,c=new We,f=[],p=0,v=!1,y=!1,g=0,S=0,E,k,C,P;if(r.isCIDFont){var R=r.tables.cff.topDict._fdSelect[e.index],O=r.tables.cff.topDict._fdArray[R];E=O._subrs,k=O._subrsBias,C=O._defaultWidthX,P=O._nominalWidthX}else E=r.tables.cff.topDict._subrs,k=r.tables.cff.topDict._subrsBias,C=r.tables.cff.topDict._defaultWidthX,P=r.tables.cff.topDict._nominalWidthX;var q=C;function D(V,ee){y&&c.closePath(),c.moveTo(V,ee),y=!0}function K(){var V;V=f.length%2!==0,V&&!v&&(q=f.shift()+P),p+=f.length>>1,f.length=0,v=!0}function H(V){for(var ee,te,pe,de,we,se,Ee,Ne,be,Te,Ye,it,ke=0;ke<V.length;){var Ve=V[ke];switch(ke+=1,Ve){case 1:K();break;case 3:K();break;case 4:f.length>1&&!v&&(q=f.shift()+P,v=!0),S+=f.pop(),D(g,S);break;case 5:for(;f.length>0;)g+=f.shift(),S+=f.shift(),c.lineTo(g,S);break;case 6:for(;f.length>0&&(g+=f.shift(),c.lineTo(g,S),f.length!==0);)S+=f.shift(),c.lineTo(g,S);break;case 7:for(;f.length>0&&(S+=f.shift(),c.lineTo(g,S),f.length!==0);)g+=f.shift(),c.lineTo(g,S);break;case 8:for(;f.length>0;)i=g+f.shift(),o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),g=s+f.shift(),S=a+f.shift(),c.curveTo(i,o,s,a,g,S);break;case 10:we=f.pop()+k,se=E[we],se&&H(se);break;case 11:return;case 12:switch(Ve=V[ke],ke+=1,Ve){case 35:i=g+f.shift(),o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),Ee=s+f.shift(),Ne=a+f.shift(),be=Ee+f.shift(),Te=Ne+f.shift(),Ye=be+f.shift(),it=Te+f.shift(),g=Ye+f.shift(),S=it+f.shift(),f.shift(),c.curveTo(i,o,s,a,Ee,Ne),c.curveTo(be,Te,Ye,it,g,S);break;case 34:i=g+f.shift(),o=S,s=i+f.shift(),a=o+f.shift(),Ee=s+f.shift(),Ne=a,be=Ee+f.shift(),Te=a,Ye=be+f.shift(),it=S,g=Ye+f.shift(),c.curveTo(i,o,s,a,Ee,Ne),c.curveTo(be,Te,Ye,it,g,S);break;case 36:i=g+f.shift(),o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),Ee=s+f.shift(),Ne=a,be=Ee+f.shift(),Te=a,Ye=be+f.shift(),it=Te+f.shift(),g=Ye+f.shift(),c.curveTo(i,o,s,a,Ee,Ne),c.curveTo(be,Te,Ye,it,g,S);break;case 37:i=g+f.shift(),o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),Ee=s+f.shift(),Ne=a+f.shift(),be=Ee+f.shift(),Te=Ne+f.shift(),Ye=be+f.shift(),it=Te+f.shift(),Math.abs(Ye-g)>Math.abs(it-S)?g=Ye+f.shift():S=it+f.shift(),c.curveTo(i,o,s,a,Ee,Ne),c.curveTo(be,Te,Ye,it,g,S);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+Ve),f.length=0}break;case 14:f.length>0&&!v&&(q=f.shift()+P,v=!0),y&&(c.closePath(),y=!1);break;case 18:K();break;case 19:case 20:K(),ke+=p+7>>3;break;case 21:f.length>2&&!v&&(q=f.shift()+P,v=!0),S+=f.pop(),g+=f.pop(),D(g,S);break;case 22:f.length>1&&!v&&(q=f.shift()+P,v=!0),g+=f.pop(),D(g,S);break;case 23:K();break;case 24:for(;f.length>2;)i=g+f.shift(),o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),g=s+f.shift(),S=a+f.shift(),c.curveTo(i,o,s,a,g,S);g+=f.shift(),S+=f.shift(),c.lineTo(g,S);break;case 25:for(;f.length>6;)g+=f.shift(),S+=f.shift(),c.lineTo(g,S);i=g+f.shift(),o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),g=s+f.shift(),S=a+f.shift(),c.curveTo(i,o,s,a,g,S);break;case 26:for(f.length%2&&(g+=f.shift());f.length>0;)i=g,o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),g=s,S=a+f.shift(),c.curveTo(i,o,s,a,g,S);break;case 27:for(f.length%2&&(S+=f.shift());f.length>0;)i=g+f.shift(),o=S,s=i+f.shift(),a=o+f.shift(),g=s+f.shift(),S=a,c.curveTo(i,o,s,a,g,S);break;case 28:ee=V[ke],te=V[ke+1],f.push((ee<<24|te<<16)>>16),ke+=2;break;case 29:we=f.pop()+r.gsubrsBias,se=r.gsubrs[we],se&&H(se);break;case 30:for(;f.length>0&&(i=g,o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),g=s+f.shift(),S=a+(f.length===1?f.shift():0),c.curveTo(i,o,s,a,g,S),f.length!==0);)i=g+f.shift(),o=S,s=i+f.shift(),a=o+f.shift(),S=a+f.shift(),g=s+(f.length===1?f.shift():0),c.curveTo(i,o,s,a,g,S);break;case 31:for(;f.length>0&&(i=g+f.shift(),o=S,s=i+f.shift(),a=o+f.shift(),S=a+f.shift(),g=s+(f.length===1?f.shift():0),c.curveTo(i,o,s,a,g,S),f.length!==0);)i=g,o=S+f.shift(),s=i+f.shift(),a=o+f.shift(),g=s+f.shift(),S=a+(f.length===1?f.shift():0),c.curveTo(i,o,s,a,g,S);break;default:Ve<32?console.log("Glyph "+e.index+": unknown operator "+Ve):Ve<247?f.push(Ve-139):Ve<251?(ee=V[ke],ke+=1,f.push((Ve-247)*256+ee+108)):Ve<255?(ee=V[ke],ke+=1,f.push(-(Ve-251)*256-ee-108)):(ee=V[ke],te=V[ke+1],pe=V[ke+2],de=V[ke+3],ke+=4,f.push((ee<<24|te<<16|pe<<8|de)/65536))}}}return H(n),e.advanceWidth=q,c}function If(r,e,n,i){var o=[],s,a=new re.Parser(r,e),c=a.parseCard8();if(c===0)for(var f=0;f<n;f++){if(s=a.parseCard8(),s>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+i+")");o.push(s)}else if(c===3){var p=a.parseCard16(),v=a.parseCard16();if(v!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+v);for(var y,g=0;g<p;g++){if(s=a.parseCard8(),y=a.parseCard16(),s>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+i+")");if(y>n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+y);for(;v<y;v++)o.push(s);v=y}if(y!==n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+y)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+c);return o}function Gf(r,e,n,i){n.tables.cff={};var o=Ff(r,e),s=Qt(r,o.endOffset,re.bytesToString),a=Qt(r,s.endOffset),c=Qt(r,a.endOffset,re.bytesToString),f=Qt(r,c.endOffset);n.gsubrs=f.objects,n.gsubrsBias=Eo(n.gsubrs);var p=Fa(r,e,a.objects,c.objects);if(p.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+p.length);var v=p[0];if(n.tables.cff.topDict=v,v._privateDict&&(n.defaultWidthX=v._privateDict.defaultWidthX,n.nominalWidthX=v._privateDict.nominalWidthX),v.ros[0]!==void 0&&v.ros[1]!==void 0&&(n.isCIDFont=!0),n.isCIDFont){var y=v.fdArray,g=v.fdSelect;if(y===0||g===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");y+=e;var S=Qt(r,y),E=Fa(r,e,S.objects,c.objects);v._fdArray=E,g+=e,v._fdSelect=If(r,g,n.numGlyphs,E.length)}var k=e+v.private[1],C=Da(r,k,v.private[0],c.objects);if(n.defaultWidthX=C.defaultWidthX,n.nominalWidthX=C.nominalWidthX,C.subrs!==0){var P=k+C.subrs,R=Qt(r,P);n.subrs=R.objects,n.subrsBias=Eo(n.subrs)}else n.subrs=[],n.subrsBias=0;var O;i.lowMemory?(O=Af(r,e+v.charStrings),n.nGlyphs=O.offsets.length):(O=Qt(r,e+v.charStrings),n.nGlyphs=O.objects.length);var q=Lf(r,e+v.charset,n.nGlyphs,c.objects);if(v.encoding===0?n.cffEncoding=new pi(xf,q):v.encoding===1?n.cffEncoding=new pi(_f,q):n.cffEncoding=Bf(r,e+v.encoding,q),n.encoding=n.encoding||n.cffEncoding,n.glyphs=new kt.GlyphSet(n),i.lowMemory)n._push=function(H){var V=Mf(H,O.offsets,r,e+v.charStrings);n.glyphs.push(H,kt.cffGlyphLoader(n,H,Ua,V))};else for(var D=0;D<n.nGlyphs;D+=1){var K=O.objects[D];n.glyphs.push(D,kt.cffGlyphLoader(n,D,Ua,K))}}function La(r,e){var n,i=hi.indexOf(r);return i>=0&&(n=i),i=e.indexOf(r),i>=0?n=i+hi.length:(n=hi.length+e.length,e.push(r)),n}function Nf(){return new Y.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function zf(r){var e=new Y.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var n=0;n<r.length;n+=1)e.names.push({name:"name_"+n,type:"NAME",value:r[n]});return e}function Ba(r,e,n){for(var i={},o=0;o<r.length;o+=1){var s=r[o],a=e[s.name];a!==void 0&&!Pa(a,s.value)&&(s.type==="SID"&&(a=La(a,n)),i[s.op]={name:s.name,type:s.type,value:a})}return i}function Ia(r,e){var n=new Y.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=Ba(Ra,r,e),n}function Ga(r){var e=new Y.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:r}],e}function Hf(r){var e=new Y.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var n=0;n<r.length;n+=1)e.strings.push({name:"string_"+n,type:"STRING",value:r[n]});return e}function Wf(){return new Y.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Vf(r,e){for(var n=new Y.Record("Charsets",[{name:"format",type:"Card8",value:0}]),i=0;i<r.length;i+=1){var o=r[i],s=La(o,e);n.fields.push({name:"glyph_"+i,type:"SID",value:s})}return n}function $f(r){var e=[],n=r.path;e.push({name:"width",type:"NUMBER",value:r.advanceWidth});for(var i=0,o=0,s=0;s<n.commands.length;s+=1){var a=void 0,c=void 0,f=n.commands[s];if(f.type==="Q"){var p=.3333333333333333,v=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(p*i+v*f.x1),y1:Math.round(p*o+v*f.y1),x2:Math.round(p*f.x+v*f.x1),y2:Math.round(p*f.y+v*f.y1)}}if(f.type==="M")a=Math.round(f.x-i),c=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rmoveto",type:"OP",value:21}),i=Math.round(f.x),o=Math.round(f.y);else if(f.type==="L")a=Math.round(f.x-i),c=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rlineto",type:"OP",value:5}),i=Math.round(f.x),o=Math.round(f.y);else if(f.type==="C"){var y=Math.round(f.x1-i),g=Math.round(f.y1-o),S=Math.round(f.x2-f.x1),E=Math.round(f.y2-f.y1);a=Math.round(f.x-f.x2),c=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:y}),e.push({name:"dy1",type:"NUMBER",value:g}),e.push({name:"dx2",type:"NUMBER",value:S}),e.push({name:"dy2",type:"NUMBER",value:E}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rrcurveto",type:"OP",value:8}),i=Math.round(f.x),o=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function Yf(r){for(var e=new Y.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),n=0;n<r.length;n+=1){var i=r.get(n),o=$f(i);e.charStrings.push({name:i.name,type:"CHARSTRING",value:o})}return e}function Xf(r,e){var n=new Y.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=Ba(Oa,r,e),n}function qf(r,e){for(var n=new Y.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),i=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[i,0,0,i,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s={},a=[],c,f=1;f<r.length;f+=1)c=r.get(f),a.push(c.name);var p=[];n.header=Nf(),n.nameIndex=zf([e.postScriptName]);var v=Ia(o,p);n.topDictIndex=Ga(v),n.globalSubrIndex=Wf(),n.charsets=Vf(a,p),n.charStringsIndex=Yf(r),n.privateDict=Xf(s,p),n.stringIndex=Hf(p);var y=n.header.sizeOf()+n.nameIndex.sizeOf()+n.topDictIndex.sizeOf()+n.stringIndex.sizeOf()+n.globalSubrIndex.sizeOf();return o.charset=y,o.encoding=0,o.charStrings=o.charset+n.charsets.sizeOf(),o.private[1]=o.charStrings+n.charStringsIndex.sizeOf(),v=Ia(o,p),n.topDictIndex=Ga(v),n}var jf={parse:Gf,make:qf};function Zf(r,e){var n={},i=new re.Parser(r,e);return n.version=i.parseVersion(),n.fontRevision=Math.round(i.parseFixed()*1e3)/1e3,n.checkSumAdjustment=i.parseULong(),n.magicNumber=i.parseULong(),J.argument(n.magicNumber===1594834165,"Font header has wrong magic number."),n.flags=i.parseUShort(),n.unitsPerEm=i.parseUShort(),n.created=i.parseLongDateTime(),n.modified=i.parseLongDateTime(),n.xMin=i.parseShort(),n.yMin=i.parseShort(),n.xMax=i.parseShort(),n.yMax=i.parseShort(),n.macStyle=i.parseUShort(),n.lowestRecPPEM=i.parseUShort(),n.fontDirectionHint=i.parseShort(),n.indexToLocFormat=i.parseShort(),n.glyphDataFormat=i.parseShort(),n}function Kf(r){var e=Math.round(new Date().getTime()/1e3)+2082844800,n=e;return r.createdTimestamp&&(n=r.createdTimestamp+2082844800),new Y.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:n},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],r)}var Qf={parse:Zf,make:Kf};function Jf(r,e){var n={},i=new re.Parser(r,e);return n.version=i.parseVersion(),n.ascender=i.parseShort(),n.descender=i.parseShort(),n.lineGap=i.parseShort(),n.advanceWidthMax=i.parseUShort(),n.minLeftSideBearing=i.parseShort(),n.minRightSideBearing=i.parseShort(),n.xMaxExtent=i.parseShort(),n.caretSlopeRise=i.parseShort(),n.caretSlopeRun=i.parseShort(),n.caretOffset=i.parseShort(),i.relativeOffset+=8,n.metricDataFormat=i.parseShort(),n.numberOfHMetrics=i.parseUShort(),n}function eh(r){return new Y.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],r)}var th={parse:Jf,make:eh};function rh(r,e,n,i,o){for(var s,a,c=new re.Parser(r,e),f=0;f<i;f+=1){f<n&&(s=c.parseUShort(),a=c.parseShort());var p=o.get(f);p.advanceWidth=s,p.leftSideBearing=a}}function nh(r,e,n,i,o){r._hmtxTableData={};for(var s,a,c=new re.Parser(e,n),f=0;f<o;f+=1)f<i&&(s=c.parseUShort(),a=c.parseShort()),r._hmtxTableData[f]={advanceWidth:s,leftSideBearing:a}}function ih(r,e,n,i,o,s,a){a.lowMemory?nh(r,e,n,i,o):rh(e,n,i,o,s)}function oh(r){for(var e=new Y.Table("hmtx",[]),n=0;n<r.length;n+=1){var i=r.get(n),o=i.advanceWidth||0,s=i.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+n,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+n,type:"SHORT",value:s})}return e}var sh={parse:ih,make:oh};function ah(r){for(var e=new Y.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:r.length}]),n="",i=12+r.length*4,o=0;o<r.length;++o){var s=n.indexOf(r[o]);s<0&&(s=n.length,n+=r[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:i+s}),e.fields.push({name:"length "+o,type:"USHORT",value:r[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),e}function uh(r,e){var n=new re.Parser(r,e),i=n.parseULong();J.argument(i===1,"Unsupported ltag table version."),n.skip("uLong",1);for(var o=n.parseULong(),s=[],a=0;a<o;a++){for(var c="",f=e+n.parseUShort(),p=n.parseUShort(),v=f;v<f+p;++v)c+=String.fromCharCode(r.getInt8(v));s.push(c)}return s}var lh={make:ah,parse:uh};function ch(r,e){var n={},i=new re.Parser(r,e);return n.version=i.parseVersion(),n.numGlyphs=i.parseUShort(),n.version===1&&(n.maxPoints=i.parseUShort(),n.maxContours=i.parseUShort(),n.maxCompositePoints=i.parseUShort(),n.maxCompositeContours=i.parseUShort(),n.maxZones=i.parseUShort(),n.maxTwilightPoints=i.parseUShort(),n.maxStorage=i.parseUShort(),n.maxFunctionDefs=i.parseUShort(),n.maxInstructionDefs=i.parseUShort(),n.maxStackElements=i.parseUShort(),n.maxSizeOfInstructions=i.parseUShort(),n.maxComponentElements=i.parseUShort(),n.maxComponentDepth=i.parseUShort()),n}function fh(r){return new Y.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:r}])}var hh={parse:ch,make:fh},Na=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],za={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},ph={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Ha={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function dh(r,e,n){switch(r){case 0:if(e===65535)return"und";if(n)return n[e];break;case 1:return za[e];case 3:return Ha[e]}}var To="utf-16",vh={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},gh={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Wa(r,e,n){switch(r){case 0:return To;case 1:return gh[n]||vh[e];case 3:if(e===1||e===10)return To;break}}function mh(r,e,n){for(var i={},o=new re.Parser(r,e),s=o.parseUShort(),a=o.parseUShort(),c=o.offset+o.parseUShort(),f=0;f<a;f++){var p=o.parseUShort(),v=o.parseUShort(),y=o.parseUShort(),g=o.parseUShort(),S=Na[g]||g,E=o.parseUShort(),k=o.parseUShort(),C=dh(p,y,n),P=Wa(p,v,y);if(P!==void 0&&C!==void 0){var R=void 0;if(P===To?R=Or.UTF16(r,c+k,E):R=Or.MACSTRING(r,c+k,E,P),R){var O=i[S];O===void 0&&(O=i[S]={}),O[C]=R}}}return s===1&&o.parseUShort(),i}function ko(r){var e={};for(var n in r)e[r[n]]=parseInt(n);return e}function Va(r,e,n,i,o,s){return new Y.Record("NameRecord",[{name:"platformID",type:"USHORT",value:r},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:n},{name:"nameID",type:"USHORT",value:i},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:s}])}function yh(r,e){var n=r.length,i=e.length-n+1;e:for(var o=0;o<i;o++)for(;o<i;o++){for(var s=0;s<n;s++)if(e[o+s]!==r[s])continue e;return o}return-1}function $a(r,e){var n=yh(r,e);if(n<0){n=e.length;for(var i=0,o=r.length;i<o;++i)e.push(r[i])}return n}function wh(r,e){var n,i=[],o={},s=ko(Na);for(var a in r){var c=s[a];if(c===void 0&&(c=a),n=parseInt(c),isNaN(n))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');o[n]=r[a],i.push(n)}for(var f=ko(za),p=ko(Ha),v=[],y=[],g=0;g<i.length;g++){n=i[g];var S=o[n];for(var E in S){var k=S[E],C=1,P=f[E],R=ph[P],O=Wa(C,R,P),q=z.MACSTRING(k,O);q===void 0&&(C=0,P=e.indexOf(E),P<0&&(P=e.length,e.push(E)),R=4,q=z.UTF16(k));var D=$a(q,y);v.push(Va(C,R,P,n,q.length,D));var K=p[E];if(K!==void 0){var H=z.UTF16(k),V=$a(H,y);v.push(Va(3,1,K,n,H.length,V))}}}v.sort(function(pe,de){return pe.platformID-de.platformID||pe.encodingID-de.encodingID||pe.languageID-de.languageID||pe.nameID-de.nameID});for(var ee=new Y.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:v.length},{name:"stringOffset",type:"USHORT",value:6+v.length*12}]),te=0;te<v.length;te++)ee.fields.push({name:"record_"+te,type:"RECORD",value:v[te]});return ee.fields.push({name:"strings",type:"LITERAL",value:y}),ee}var bh={parse:mh,make:wh},Co=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Sh(r){for(var e=0;e<Co.length;e+=1){var n=Co[e];if(r>=n.begin&&r<n.end)return e}return-1}function xh(r,e){var n={},i=new re.Parser(r,e);n.version=i.parseUShort(),n.xAvgCharWidth=i.parseShort(),n.usWeightClass=i.parseUShort(),n.usWidthClass=i.parseUShort(),n.fsType=i.parseUShort(),n.ySubscriptXSize=i.parseShort(),n.ySubscriptYSize=i.parseShort(),n.ySubscriptXOffset=i.parseShort(),n.ySubscriptYOffset=i.parseShort(),n.ySuperscriptXSize=i.parseShort(),n.ySuperscriptYSize=i.parseShort(),n.ySuperscriptXOffset=i.parseShort(),n.ySuperscriptYOffset=i.parseShort(),n.yStrikeoutSize=i.parseShort(),n.yStrikeoutPosition=i.parseShort(),n.sFamilyClass=i.parseShort(),n.panose=[];for(var o=0;o<10;o++)n.panose[o]=i.parseByte();return n.ulUnicodeRange1=i.parseULong(),n.ulUnicodeRange2=i.parseULong(),n.ulUnicodeRange3=i.parseULong(),n.ulUnicodeRange4=i.parseULong(),n.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),n.fsSelection=i.parseUShort(),n.usFirstCharIndex=i.parseUShort(),n.usLastCharIndex=i.parseUShort(),n.sTypoAscender=i.parseShort(),n.sTypoDescender=i.parseShort(),n.sTypoLineGap=i.parseShort(),n.usWinAscent=i.parseUShort(),n.usWinDescent=i.parseUShort(),n.version>=1&&(n.ulCodePageRange1=i.parseULong(),n.ulCodePageRange2=i.parseULong()),n.version>=2&&(n.sxHeight=i.parseShort(),n.sCapHeight=i.parseShort(),n.usDefaultChar=i.parseUShort(),n.usBreakChar=i.parseUShort(),n.usMaxContent=i.parseUShort()),n}function _h(r){return new Y.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],r)}var Ya={parse:xh,make:_h,unicodeRanges:Co,getUnicodeRange:Sh};function Eh(r,e){var n={},i=new re.Parser(r,e);switch(n.version=i.parseVersion(),n.italicAngle=i.parseFixed(),n.underlinePosition=i.parseShort(),n.underlineThickness=i.parseShort(),n.isFixedPitch=i.parseULong(),n.minMemType42=i.parseULong(),n.maxMemType42=i.parseULong(),n.minMemType1=i.parseULong(),n.maxMemType1=i.parseULong(),n.version){case 1:n.names=ka.slice();break;case 2:n.numberOfGlyphs=i.parseUShort(),n.glyphNameIndex=new Array(n.numberOfGlyphs);for(var o=0;o<n.numberOfGlyphs;o++)n.glyphNameIndex[o]=i.parseUShort();n.names=[];for(var s=0;s<n.numberOfGlyphs;s++)if(n.glyphNameIndex[s]>=ka.length){var a=i.parseChar();n.names.push(i.parseString(a))}break;case 2.5:n.numberOfGlyphs=i.parseUShort(),n.offset=new Array(n.numberOfGlyphs);for(var c=0;c<n.numberOfGlyphs;c++)n.offset[c]=i.parseChar();break}return n}function Th(){return new Y.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var kh={parse:Eh,make:Th},wt=new Array(9);wt[1]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:1,coverage:this.parsePointer(A.coverage),deltaGlyphId:this.parseUShort()};if(n===2)return{substFormat:2,coverage:this.parsePointer(A.coverage),substitute:this.parseOffset16List()};J.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},wt[2]=function(){var e=this.parseUShort();return J.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),sequences:this.parseListOfLists()}},wt[3]=function(){var e=this.parseUShort();return J.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),alternateSets:this.parseListOfLists()}},wt[4]=function(){var e=this.parseUShort();return J.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Dr={sequenceIndex:A.uShort,lookupListIndex:A.uShort};wt[5]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:n,coverage:this.parsePointer(A.coverage),ruleSets:this.parseListOfLists(function(){var s=this.parseUShort(),a=this.parseUShort();return{input:this.parseUShortList(s-1),lookupRecords:this.parseRecordList(a,Dr)}})};if(n===2)return{substFormat:n,coverage:this.parsePointer(A.coverage),classDef:this.parsePointer(A.classDef),classSets:this.parseListOfLists(function(){var s=this.parseUShort(),a=this.parseUShort();return{classes:this.parseUShortList(s-1),lookupRecords:this.parseRecordList(a,Dr)}})};if(n===3){var i=this.parseUShort(),o=this.parseUShort();return{substFormat:n,coverages:this.parseList(i,A.pointer(A.coverage)),lookupRecords:this.parseRecordList(o,Dr)}}J.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},wt[6]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{substFormat:1,coverage:this.parsePointer(A.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Dr)}})};if(n===2)return{substFormat:2,coverage:this.parsePointer(A.coverage),backtrackClassDef:this.parsePointer(A.classDef),inputClassDef:this.parsePointer(A.classDef),lookaheadClassDef:this.parsePointer(A.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Dr)}})};if(n===3)return{substFormat:3,backtrackCoverage:this.parseList(A.pointer(A.coverage)),inputCoverage:this.parseList(A.pointer(A.coverage)),lookaheadCoverage:this.parseList(A.pointer(A.coverage)),lookupRecords:this.parseRecordList(Dr)};J.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},wt[7]=function(){var e=this.parseUShort();J.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var n=this.parseUShort(),i=new A(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:n,extension:wt[n].call(i)}},wt[8]=function(){var e=this.parseUShort();return J.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),backtrackCoverage:this.parseList(A.pointer(A.coverage)),lookaheadCoverage:this.parseList(A.pointer(A.coverage)),substitutes:this.parseUShortList()}};function Ch(r,e){e=e||0;var n=new A(r,e),i=n.parseVersion(1);return J.argument(i===1||i===1.1,"Unsupported GSUB table version."),i===1?{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(wt)}:{version:i,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(wt),variations:n.parseFeatureVariationsList()}}var Fr=new Array(9);Fr[1]=function(e){return e.substFormat===1?new Y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Y.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Y.Coverage(e.coverage)}].concat(Y.ushortList("substitute",e.substitute)))},Fr[2]=function(e){return J.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Y.Coverage(e.coverage)}].concat(Y.tableList("seqSet",e.sequences,function(n){return new Y.Table("sequenceSetTable",Y.ushortList("sequence",n))})))},Fr[3]=function(e){return J.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Y.Coverage(e.coverage)}].concat(Y.tableList("altSet",e.alternateSets,function(n){return new Y.Table("alternateSetTable",Y.ushortList("alternate",n))})))},Fr[4]=function(e){return J.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Y.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Y.Coverage(e.coverage)}].concat(Y.tableList("ligSet",e.ligatureSets,function(n){return new Y.Table("ligatureSetTable",Y.tableList("ligature",n,function(i){return new Y.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:i.ligGlyph}].concat(Y.ushortList("component",i.components,i.components.length+1)))}))})))},Fr[6]=function(e){if(e.substFormat===1){var n=new Y.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Y.Coverage(e.coverage)}].concat(Y.tableList("chainRuleSet",e.chainRuleSets,function(s){return new Y.Table("chainRuleSetTable",Y.tableList("chainRule",s,function(a){var c=Y.ushortList("backtrackGlyph",a.backtrack,a.backtrack.length).concat(Y.ushortList("inputGlyph",a.input,a.input.length+1)).concat(Y.ushortList("lookaheadGlyph",a.lookahead,a.lookahead.length)).concat(Y.ushortList("substitution",[],a.lookupRecords.length));return a.lookupRecords.forEach(function(f,p){c=c.concat({name:"sequenceIndex"+p,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+p,type:"USHORT",value:f.lookupListIndex})}),new Y.Table("chainRuleTable",c)}))})));return n}else if(e.substFormat===2)J.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var i=[{name:"substFormat",type:"USHORT",value:e.substFormat}];i.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(s,a){i.push({name:"backtrackCoverage"+a,type:"TABLE",value:new Y.Coverage(s)})}),i.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(s,a){i.push({name:"inputCoverage"+a,type:"TABLE",value:new Y.Coverage(s)})}),i.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(s,a){i.push({name:"lookaheadCoverage"+a,type:"TABLE",value:new Y.Coverage(s)})}),i.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(s,a){i=i.concat({name:"sequenceIndex"+a,type:"USHORT",value:s.sequenceIndex}).concat({name:"lookupListIndex"+a,type:"USHORT",value:s.lookupListIndex})});var o=new Y.Table("chainContextTable",i);return o}J.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Ph(r){return new Y.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Y.ScriptList(r.scripts)},{name:"features",type:"TABLE",value:new Y.FeatureList(r.features)},{name:"lookups",type:"TABLE",value:new Y.LookupList(r.lookups,Fr)}])}var Ah={parse:Ch,make:Ph};function Mh(r,e){var n=new re.Parser(r,e),i=n.parseULong();J.argument(i===1,"Unsupported META table version."),n.parseULong(),n.parseULong();for(var o=n.parseULong(),s={},a=0;a<o;a++){var c=n.parseTag(),f=n.parseULong(),p=n.parseULong(),v=Or.UTF8(r,e+f,p);s[c]=v}return s}function Rh(r){var e=Object.keys(r).length,n="",i=16+e*12,o=new Y.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:i},{name:"numTags",type:"ULONG",value:e}]);for(var s in r){var a=n.length;n+=r[s],o.fields.push({name:"tag "+s,type:"TAG",value:s}),o.fields.push({name:"offset "+s,type:"ULONG",value:i+a}),o.fields.push({name:"length "+s,type:"ULONG",value:r[s].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),o}var Oh={parse:Mh,make:Rh};function Xa(r){return Math.log(r)/Math.log(2)|0}function Po(r){for(;r.length%4!==0;)r.push(0);for(var e=0,n=0;n<r.length;n+=4)e+=(r[n]<<24)+(r[n+1]<<16)+(r[n+2]<<8)+r[n+3];return e%=Math.pow(2,32),e}function qa(r,e,n,i){return new Y.Record("Table Record",[{name:"tag",type:"TAG",value:r!==void 0?r:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:n!==void 0?n:0},{name:"length",type:"ULONG",value:i!==void 0?i:0}])}function ja(r){var e=new Y.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=r,e.numTables=r.length;var n=Math.pow(2,Xa(e.numTables));e.searchRange=16*n,e.entrySelector=Xa(n),e.rangeShift=e.numTables*16-e.searchRange;for(var i=[],o=[],s=e.sizeOf()+qa().sizeOf()*e.numTables;s%4!==0;)s+=1,o.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<r.length;a+=1){var c=r[a];J.argument(c.tableName.length===4,"Table name"+c.tableName+" is invalid.");var f=c.sizeOf(),p=qa(c.tableName,Po(c.encode()),s,f);for(i.push({name:p.tag+" Table Record",type:"RECORD",value:p}),o.push({name:c.tableName+" table",type:"RECORD",value:c}),s+=f,J.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!==0;)s+=1,o.push({name:"padding",type:"BYTE",value:0})}return i.sort(function(v,y){return v.value.tag>y.value.tag?1:-1}),e.fields=e.fields.concat(i),e.fields=e.fields.concat(o),e}function Za(r,e,n){for(var i=0;i<e.length;i+=1){var o=r.charToGlyphIndex(e[i]);if(o>0){var s=r.glyphs.get(o);return s.getMetrics()}}return n}function Dh(r){for(var e=0,n=0;n<r.length;n+=1)e+=r[n];return e/r.length}function Fh(r){for(var e=[],n=[],i=[],o=[],s=[],a=[],c=[],f,p=0,v=0,y=0,g=0,S=0,E=0;E<r.glyphs.length;E+=1){var k=r.glyphs.get(E),C=k.unicode|0;if(isNaN(k.advanceWidth))throw new Error("Glyph "+k.name+" ("+E+"): advanceWidth is not a number.");(f>C||f===void 0)&&C>0&&(f=C),p<C&&(p=C);var P=Ya.getUnicodeRange(C);if(P<32)v|=1<<P;else if(P<64)y|=1<<P-32;else if(P<96)g|=1<<P-64;else if(P<123)S|=1<<P-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(k.name!==".notdef"){var R=k.getMetrics();e.push(R.xMin),n.push(R.yMin),i.push(R.xMax),o.push(R.yMax),a.push(R.leftSideBearing),c.push(R.rightSideBearing),s.push(k.advanceWidth)}}var O={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,s),advanceWidthAvg:Dh(s),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,c)};O.ascender=r.ascender,O.descender=r.descender;var q=Qf.make({flags:3,unitsPerEm:r.unitsPerEm,xMin:O.xMin,yMin:O.yMin,xMax:O.xMax,yMax:O.yMax,lowestRecPPEM:3,createdTimestamp:r.createdTimestamp}),D=th.make({ascender:O.ascender,descender:O.descender,advanceWidthMax:O.advanceWidthMax,minLeftSideBearing:O.minLeftSideBearing,minRightSideBearing:O.minRightSideBearing,xMaxExtent:O.maxLeftSideBearing+(O.xMax-O.xMin),numberOfHMetrics:r.glyphs.length}),K=hh.make(r.glyphs.length),H=Ya.make(Object.assign({xAvgCharWidth:Math.round(O.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:p,ulUnicodeRange1:v,ulUnicodeRange2:y,ulUnicodeRange3:g,ulUnicodeRange4:S,sTypoAscender:O.ascender,sTypoDescender:O.descender,sTypoLineGap:0,usWinAscent:O.yMax,usWinDescent:Math.abs(O.yMin),ulCodePageRange1:1,sxHeight:Za(r,"xyvw",{yMax:Math.round(O.ascender/2)}).yMax,sCapHeight:Za(r,"HIKLEFJMNTZBDPRAGOQSUVWXY",O).yMax,usDefaultChar:r.hasChar(" ")?32:0,usBreakChar:r.hasChar(" ")?32:0},r.tables.os2)),V=sh.make(r.glyphs),ee=Sf.make(r.glyphs),te=r.getEnglishName("fontFamily"),pe=r.getEnglishName("fontSubfamily"),de=te+" "+pe,we=r.getEnglishName("postScriptName");we||(we=te.replace(/\s/g,"")+"-"+pe);var se={};for(var Ee in r.names)se[Ee]=r.names[Ee];se.uniqueID||(se.uniqueID={en:r.getEnglishName("manufacturer")+":"+de}),se.postScriptName||(se.postScriptName={en:we}),se.preferredFamily||(se.preferredFamily=r.names.fontFamily),se.preferredSubfamily||(se.preferredSubfamily=r.names.fontSubfamily);var Ne=[],be=bh.make(se,Ne),Te=Ne.length>0?lh.make(Ne):void 0,Ye=kh.make(),it=jf.make(r.glyphs,{version:r.getEnglishName("version"),fullName:de,familyName:te,weightName:pe,postScriptName:we,unitsPerEm:r.unitsPerEm,fontBBox:[0,O.yMin,O.ascender,O.advanceWidthMax]}),ke=r.metas&&Object.keys(r.metas).length>0?Oh.make(r.metas):void 0,Ve=[q,D,K,H,be,ee,Ye,it,V];Te&&Ve.push(Te),r.tables.gsub&&Ve.push(Ah.make(r.tables.gsub)),ke&&Ve.push(ke);for(var An=ja(Ve),Qo=An.encode(),Ri=Po(Qo),Mn=An.fields,Oi=!1,Nt=0;Nt<Mn.length;Nt+=1)if(Mn[Nt].name==="head table"){Mn[Nt].value.checkSumAdjustment=2981146554-Ri,Oi=!0;break}if(!Oi)throw new Error("Could not find head table with checkSum to adjust.");return An}var Uh={make:ja,fontToTable:Fh,computeCheckSum:Po};function Ao(r,e){for(var n=0,i=r.length-1;n<=i;){var o=n+i>>>1,s=r[o].tag;if(s===e)return o;s<e?n=o+1:i=o-1}return-n-1}function Ka(r,e){for(var n=0,i=r.length-1;n<=i;){var o=n+i>>>1,s=r[o];if(s===e)return o;s<e?n=o+1:i=o-1}return-n-1}function Qa(r,e){for(var n,i=0,o=r.length-1;i<=o;){var s=i+o>>>1;n=r[s];var a=n.start;if(a===e)return n;a<e?i=s+1:o=s-1}if(i>0)return n=r[i-1],e>n.end?0:n}function pn(r,e){this.font=r,this.tableName=e}pn.prototype={searchTag:Ao,binSearch:Ka,getTable:function(r){var e=this.font.tables[this.tableName];return!e&&r&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var r=this.getTable();return r?r.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var r=this.getTable();if(r){for(var e=!1,n=0;n<r.scripts.length;n++){var i=r.scripts[n].tag;if(i==="DFLT")return i;i==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(r,e){var n=this.getTable(e);if(n){r=r||"DFLT";var i=n.scripts,o=Ao(n.scripts,r);if(o>=0)return i[o].script;if(e){var s={tag:r,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return i.splice(-1-o,0,s),s.script}}},getLangSysTable:function(r,e,n){var i=this.getScriptTable(r,n);if(i){if(!e||e==="dflt"||e==="DFLT")return i.defaultLangSys;var o=Ao(i.langSysRecords,e);if(o>=0)return i.langSysRecords[o].langSys;if(n){var s={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return i.langSysRecords.splice(-1-o,0,s),s.langSys}}},getFeatureTable:function(r,e,n,i){var o=this.getLangSysTable(r,e,i);if(o){for(var s,a=o.featureIndexes,c=this.font.tables[this.tableName].features,f=0;f<a.length;f++)if(s=c[a[f]],s.tag===n)return s.feature;if(i){var p=c.length;return J.assert(p===0||n>=c[p-1].tag,"Features must be added in alphabetical order."),s={tag:n,feature:{params:0,lookupListIndexes:[]}},c.push(s),a.push(p),s.feature}}},getLookupTables:function(r,e,n,i,o){var s=this.getFeatureTable(r,e,n,o),a=[];if(s){for(var c,f=s.lookupListIndexes,p=this.font.tables[this.tableName].lookups,v=0;v<f.length;v++)c=p[f[v]],c.lookupType===i&&a.push(c);if(a.length===0&&o){c={lookupType:i,lookupFlag:0,subtables:[],markFilteringSet:void 0};var y=p.length;return p.push(c),f.push(y),[c]}}return a},getGlyphClass:function(r,e){switch(r.format){case 1:return r.startGlyph<=e&&e<r.startGlyph+r.classes.length?r.classes[e-r.startGlyph]:0;case 2:var n=Qa(r.ranges,e);return n?n.classId:0}},getCoverageIndex:function(r,e){switch(r.format){case 1:var n=Ka(r.glyphs,e);return n>=0?n:-1;case 2:var i=Qa(r.ranges,e);return i?i.index+e-i.start:-1}},expandCoverage:function(r){if(r.format===1)return r.glyphs;for(var e=[],n=r.ranges,i=0;i<n.length;i++)for(var o=n[i],s=o.start,a=o.end,c=s;c<=a;c++)e.push(c);return e}};function dn(r){pn.call(this,r,"gpos")}dn.prototype=pn.prototype,dn.prototype.init=function(){var r=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(r)},dn.prototype.getKerningValue=function(r,e,n){for(var i=0;i<r.length;i++)for(var o=r[i].subtables,s=0;s<o.length;s++){var a=o[s],c=this.getCoverageIndex(a.coverage,e);if(!(c<0))switch(a.posFormat){case 1:for(var f=a.pairSets[c],p=0;p<f.length;p++){var v=f[p];if(v.secondGlyph===n)return v.value1&&v.value1.xAdvance||0}break;case 2:var y=this.getGlyphClass(a.classDef1,e),g=this.getGlyphClass(a.classDef2,n),S=a.classRecords[y][g];return S.value1&&S.value1.xAdvance||0}}return 0},dn.prototype.getKerningTables=function(r,e){if(this.font.tables.gpos)return this.getLookupTables(r,e,"kern",2)};function lt(r){pn.call(this,r,"gsub")}function Lh(r,e){var n=r.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(r[i]!==e[i])return!1;return!0}function Mo(r,e,n){for(var i=r.subtables,o=0;o<i.length;o++){var s=i[o];if(s.substFormat===e)return s}if(n)return i.push(n),n}lt.prototype=pn.prototype,lt.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},lt.prototype.getSingle=function(r,e,n){for(var i=[],o=this.getLookupTables(e,n,r,1),s=0;s<o.length;s++)for(var a=o[s].subtables,c=0;c<a.length;c++){var f=a[c],p=this.expandCoverage(f.coverage),v=void 0;if(f.substFormat===1){var y=f.deltaGlyphId;for(v=0;v<p.length;v++){var g=p[v];i.push({sub:g,by:g+y})}}else{var S=f.substitute;for(v=0;v<p.length;v++)i.push({sub:p[v],by:S[v]})}}return i},lt.prototype.getMultiple=function(r,e,n){for(var i=[],o=this.getLookupTables(e,n,r,2),s=0;s<o.length;s++)for(var a=o[s].subtables,c=0;c<a.length;c++){var f=a[c],p=this.expandCoverage(f.coverage),v=void 0;for(v=0;v<p.length;v++){var y=p[v],g=f.sequences[v];i.push({sub:y,by:g})}}return i},lt.prototype.getAlternates=function(r,e,n){for(var i=[],o=this.getLookupTables(e,n,r,3),s=0;s<o.length;s++)for(var a=o[s].subtables,c=0;c<a.length;c++)for(var f=a[c],p=this.expandCoverage(f.coverage),v=f.alternateSets,y=0;y<p.length;y++)i.push({sub:p[y],by:v[y]});return i},lt.prototype.getLigatures=function(r,e,n){for(var i=[],o=this.getLookupTables(e,n,r,4),s=0;s<o.length;s++)for(var a=o[s].subtables,c=0;c<a.length;c++)for(var f=a[c],p=this.expandCoverage(f.coverage),v=f.ligatureSets,y=0;y<p.length;y++)for(var g=p[y],S=v[y],E=0;E<S.length;E++){var k=S[E];i.push({sub:[g].concat(k.components),by:k.ligGlyph})}return i},lt.prototype.addSingle=function(r,e,n,i){var o=this.getLookupTables(n,i,r,1,!0)[0],s=Mo(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});J.assert(s.coverage.format===1,"Single: unable to modify coverage table format "+s.coverage.format);var a=e.sub,c=this.binSearch(s.coverage.glyphs,a);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,a),s.substitute.splice(c,0,0)),s.substitute[c]=e.by},lt.prototype.addMultiple=function(r,e,n,i){J.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(n,i,r,2,!0)[0],s=Mo(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});J.assert(s.coverage.format===1,"Multiple: unable to modify coverage table format "+s.coverage.format);var a=e.sub,c=this.binSearch(s.coverage.glyphs,a);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,a),s.sequences.splice(c,0,0)),s.sequences[c]=e.by},lt.prototype.addAlternate=function(r,e,n,i){var o=this.getLookupTables(n,i,r,3,!0)[0],s=Mo(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});J.assert(s.coverage.format===1,"Alternate: unable to modify coverage table format "+s.coverage.format);var a=e.sub,c=this.binSearch(s.coverage.glyphs,a);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,a),s.alternateSets.splice(c,0,0)),s.alternateSets[c]=e.by},lt.prototype.addLigature=function(r,e,n,i){var o=this.getLookupTables(n,i,r,4,!0)[0],s=o.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=s),J.assert(s.coverage.format===1,"Ligature: unable to modify coverage table format "+s.coverage.format);var a=e.sub[0],c=e.sub.slice(1),f={ligGlyph:e.by,components:c},p=this.binSearch(s.coverage.glyphs,a);if(p>=0){for(var v=s.ligatureSets[p],y=0;y<v.length;y++)if(Lh(v[y].components,c))return;v.push(f)}else p=-1-p,s.coverage.glyphs.splice(p,0,a),s.ligatureSets.splice(p,0,[f])},lt.prototype.getFeature=function(r,e,n){if(/ss\d\d/.test(r))return this.getSingle(r,e,n);switch(r){case"aalt":case"salt":return this.getSingle(r,e,n).concat(this.getAlternates(r,e,n));case"dlig":case"liga":case"rlig":return this.getLigatures(r,e,n);case"ccmp":return this.getMultiple(r,e,n).concat(this.getLigatures(r,e,n));case"stch":return this.getMultiple(r,e,n)}},lt.prototype.add=function(r,e,n,i){if(/ss\d\d/.test(r))return this.addSingle(r,e,n,i);switch(r){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(r,e,n,i):this.addAlternate(r,e,n,i);case"dlig":case"liga":case"rlig":return this.addLigature(r,e,n,i);case"ccmp":return e.by instanceof Array?this.addMultiple(r,e,n,i):this.addLigature(r,e,n,i)}};function Bh(){return typeof window<"u"}function Ih(r){for(var e=new Buffer(r.byteLength),n=new Uint8Array(r),i=0;i<e.length;++i)e[i]=n[i];return e}function vn(r,e){if(!r)throw e}function Ja(r,e,n,i,o){var s;return(e&i)>0?(s=r.parseByte(),e&o||(s=-s),s=n+s):(e&o)>0?s=n:s=n+r.parseShort(),s}function eu(r,e,n){var i=new re.Parser(e,n);r.numberOfContours=i.parseShort(),r._xMin=i.parseShort(),r._yMin=i.parseShort(),r._xMax=i.parseShort(),r._yMax=i.parseShort();var o,s;if(r.numberOfContours>0){for(var a=r.endPointIndices=[],c=0;c<r.numberOfContours;c+=1)a.push(i.parseUShort());r.instructionLength=i.parseUShort(),r.instructions=[];for(var f=0;f<r.instructionLength;f+=1)r.instructions.push(i.parseByte());var p=a[a.length-1]+1;o=[];for(var v=0;v<p;v+=1)if(s=i.parseByte(),o.push(s),(s&8)>0)for(var y=i.parseByte(),g=0;g<y;g+=1)o.push(s),v+=1;if(J.argument(o.length===p,"Bad flags."),a.length>0){var S=[],E;if(p>0){for(var k=0;k<p;k+=1)s=o[k],E={},E.onCurve=!!(s&1),E.lastPointOfContour=a.indexOf(k)>=0,S.push(E);for(var C=0,P=0;P<p;P+=1)s=o[P],E=S[P],E.x=Ja(i,s,C,2,16),C=E.x;for(var R=0,O=0;O<p;O+=1)s=o[O],E=S[O],E.y=Ja(i,s,R,4,32),R=E.y}r.points=S}else r.points=[]}else if(r.numberOfContours===0)r.points=[];else{r.isComposite=!0,r.points=[],r.components=[];for(var q=!0;q;){o=i.parseUShort();var D={glyphIndex:i.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(D.dx=i.parseShort(),D.dy=i.parseShort()):D.matchedPoints=[i.parseUShort(),i.parseUShort()]:(o&2)>0?(D.dx=i.parseChar(),D.dy=i.parseChar()):D.matchedPoints=[i.parseByte(),i.parseByte()],(o&8)>0?D.xScale=D.yScale=i.parseF2Dot14():(o&64)>0?(D.xScale=i.parseF2Dot14(),D.yScale=i.parseF2Dot14()):(o&128)>0&&(D.xScale=i.parseF2Dot14(),D.scale01=i.parseF2Dot14(),D.scale10=i.parseF2Dot14(),D.yScale=i.parseF2Dot14()),r.components.push(D),q=!!(o&32)}if(o&256){r.instructionLength=i.parseUShort(),r.instructions=[];for(var K=0;K<r.instructionLength;K+=1)r.instructions.push(i.parseByte())}}}function Ro(r,e){for(var n=[],i=0;i<r.length;i+=1){var o=r[i],s={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};n.push(s)}return n}function Gh(r){for(var e=[],n=[],i=0;i<r.length;i+=1){var o=r[i];n.push(o),o.lastPointOfContour&&(e.push(n),n=[])}return J.argument(n.length===0,"There are still points left in the current contour."),e}function tu(r){var e=new We;if(!r)return e;for(var n=Gh(r),i=0;i<n.length;++i){var o=n[i],s=null,a=o[o.length-1],c=o[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(c.onCurve)e.moveTo(c.x,c.y);else{var f={x:(a.x+c.x)*.5,y:(a.y+c.y)*.5};e.moveTo(f.x,f.y)}for(var p=0;p<o.length;++p)if(s=a,a=c,c=o[(p+1)%o.length],a.onCurve)e.lineTo(a.x,a.y);else{var v=c;s.onCurve||((a.x+s.x)*.5,(a.y+s.y)*.5),c.onCurve||(v={x:(a.x+c.x)*.5,y:(a.y+c.y)*.5}),e.quadraticCurveTo(a.x,a.y,v.x,v.y)}e.closePath()}return e}function ru(r,e){if(e.isComposite)for(var n=0;n<e.components.length;n+=1){var i=e.components[n],o=r.get(i.glyphIndex);if(o.getPath(),o.points){var s=void 0;if(i.matchedPoints===void 0)s=Ro(o.points,i);else{if(i.matchedPoints[0]>e.points.length-1||i.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[i.matchedPoints[0]],c=o.points[i.matchedPoints[1]],f={xScale:i.xScale,scale01:i.scale01,scale10:i.scale10,yScale:i.yScale,dx:0,dy:0};c=Ro([c],f)[0],f.dx=a.x-c.x,f.dy=a.y-c.y,s=Ro(o.points,f)}e.points=e.points.concat(s)}}return tu(e.points)}function Nh(r,e,n,i){for(var o=new kt.GlyphSet(i),s=0;s<n.length-1;s+=1){var a=n[s],c=n[s+1];a!==c?o.push(s,kt.ttfGlyphLoader(i,s,eu,r,e+a,ru)):o.push(s,kt.glyphLoader(i,s))}return o}function zh(r,e,n,i){var o=new kt.GlyphSet(i);return i._push=function(s){var a=n[s],c=n[s+1];a!==c?o.push(s,kt.ttfGlyphLoader(i,s,eu,r,e+a,ru)):o.push(s,kt.glyphLoader(i,s))},o}function Hh(r,e,n,i,o){return o.lowMemory?zh(r,e,n,i):Nh(r,e,n,i)}var Wh={getPath:tu,parse:Hh},nu,dr,iu,Oo;function ou(r){this.font=r,this.getCommands=function(e){return Wh.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Vh(r){return r}function su(r){return Math.sign(r)*Math.round(Math.abs(r))}function $h(r){return Math.sign(r)*Math.round(Math.abs(r*2))/2}function Yh(r){return Math.sign(r)*(Math.round(Math.abs(r)+.5)-.5)}function Xh(r){return Math.sign(r)*Math.ceil(Math.abs(r))}function qh(r){return Math.sign(r)*Math.floor(Math.abs(r))}var au=function(r){var e=this.srPeriod,n=this.srPhase,i=this.srThreshold,o=1;return r<0&&(r=-r,o=-1),r+=i-n,r=Math.trunc(r/e)*e,r+=n,r<0?n*o:r*o},Ct={x:1,y:0,axis:"x",distance:function(r,e,n,i){return(n?r.xo:r.x)-(i?e.xo:e.x)},interpolate:function(r,e,n,i){var o,s,a,c,f,p,v;if(!i||i===this){if(o=r.xo-e.xo,s=r.xo-n.xo,f=e.x-e.xo,p=n.x-n.xo,a=Math.abs(o),c=Math.abs(s),v=a+c,v===0){r.x=r.xo+(f+p)/2;return}r.x=r.xo+(f*c+p*a)/v;return}if(o=i.distance(r,e,!0,!0),s=i.distance(r,n,!0,!0),f=i.distance(e,e,!1,!0),p=i.distance(n,n,!1,!0),a=Math.abs(o),c=Math.abs(s),v=a+c,v===0){Ct.setRelative(r,r,(f+p)/2,i,!0);return}Ct.setRelative(r,r,(f*c+p*a)/v,i,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(r,e,n,i,o){if(!i||i===this){r.x=(o?e.xo:e.x)+n;return}var s=o?e.xo:e.x,a=o?e.yo:e.y,c=s+n*i.x,f=a+n*i.y;r.x=c+(r.y-f)/i.normalSlope},slope:0,touch:function(r){r.xTouched=!0},touched:function(r){return r.xTouched},untouch:function(r){r.xTouched=!1}},Ft={x:0,y:1,axis:"y",distance:function(r,e,n,i){return(n?r.yo:r.y)-(i?e.yo:e.y)},interpolate:function(r,e,n,i){var o,s,a,c,f,p,v;if(!i||i===this){if(o=r.yo-e.yo,s=r.yo-n.yo,f=e.y-e.yo,p=n.y-n.yo,a=Math.abs(o),c=Math.abs(s),v=a+c,v===0){r.y=r.yo+(f+p)/2;return}r.y=r.yo+(f*c+p*a)/v;return}if(o=i.distance(r,e,!0,!0),s=i.distance(r,n,!0,!0),f=i.distance(e,e,!1,!0),p=i.distance(n,n,!1,!0),a=Math.abs(o),c=Math.abs(s),v=a+c,v===0){Ft.setRelative(r,r,(f+p)/2,i,!0);return}Ft.setRelative(r,r,(f*c+p*a)/v,i,!0)},normalSlope:0,setRelative:function(r,e,n,i,o){if(!i||i===this){r.y=(o?e.yo:e.y)+n;return}var s=o?e.xo:e.x,a=o?e.yo:e.y,c=s+n*i.x,f=a+n*i.y;r.y=f+i.normalSlope*(r.x-c)},slope:Number.POSITIVE_INFINITY,touch:function(r){r.yTouched=!0},touched:function(r){return r.yTouched},untouch:function(r){r.yTouched=!1}};Object.freeze(Ct),Object.freeze(Ft);function gn(r,e){this.x=r,this.y=e,this.axis=void 0,this.slope=e/r,this.normalSlope=-r/e,Object.freeze(this)}gn.prototype.distance=function(r,e,n,i){return this.x*Ct.distance(r,e,n,i)+this.y*Ft.distance(r,e,n,i)},gn.prototype.interpolate=function(r,e,n,i){var o,s,a,c,f,p,v;if(a=i.distance(r,e,!0,!0),c=i.distance(r,n,!0,!0),o=i.distance(e,e,!1,!0),s=i.distance(n,n,!1,!0),f=Math.abs(a),p=Math.abs(c),v=f+p,v===0){this.setRelative(r,r,(o+s)/2,i,!0);return}this.setRelative(r,r,(o*p+s*f)/v,i,!0)},gn.prototype.setRelative=function(r,e,n,i,o){i=i||this;var s=o?e.xo:e.x,a=o?e.yo:e.y,c=s+n*i.x,f=a+n*i.y,p=i.normalSlope,v=this.slope,y=r.x,g=r.y;r.x=(v*y-p*c+f-g)/(v-p),r.y=v*(r.x-y)+g},gn.prototype.touch=function(r){r.xTouched=!0,r.yTouched=!0};function mn(r,e){var n=Math.sqrt(r*r+e*e);return r/=n,e/=n,r===1&&e===0?Ct:r===0&&e===1?Ft:new gn(r,e)}function Ut(r,e,n,i){this.x=this.xo=Math.round(r*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=n,this.onCurve=i,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Ut.prototype.nextTouched=function(r){for(var e=this.nextPointOnContour;!r.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},Ut.prototype.prevTouched=function(r){for(var e=this.prevPointOnContour;!r.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var yn=Object.freeze(new Ut(0,0)),jh={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Jt(r,e){switch(this.env=r,this.stack=[],this.prog=e,r){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Ct,this.round=su}}ou.prototype.exec=function(r,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var n=this.font,i=this._prepState;if(!i||i.ppem!==e){var o=this._fpgmState;if(!o){Jt.prototype=jh,o=this._fpgmState=new Jt("fpgm",n.tables.fpgm),o.funcs=[],o.font=n,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{dr(o)}catch(p){console.log("Hinting error in FPGM:"+p),this._errorState=3;return}}Jt.prototype=o,i=this._prepState=new Jt("prep",n.tables.prep),i.ppem=e;var s=n.tables.cvt;if(s)for(var a=i.cvt=new Array(s.length),c=e/n.unitsPerEm,f=0;f<s.length;f++)a[f]=s[f]*c;else i.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),i.step=-1);try{dr(i)}catch(p){this._errorState<2&&console.log("Hinting error in PREP:"+p),this._errorState=2}}if(!(this._errorState>1))try{return iu(r,i)}catch(p){this._errorState<1&&(console.log("Hinting error:"+p),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},iu=function(r,e){var n=e.ppem/e.font.unitsPerEm,i=n,o=r.components,s,a,c;if(Jt.prototype=e,!o)c=new Jt("glyf",r.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),c.step=-1),Oo(r,c,n,i),a=c.gZone;else{var f=e.font;a=[],s=[];for(var p=0;p<o.length;p++){var v=o[p],y=f.glyphs.get(v.glyphIndex);c=new Jt("glyf",y.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+p+"---"),c.step=-1),Oo(y,c,n,i);for(var g=Math.round(v.dx*n),S=Math.round(v.dy*i),E=c.gZone,k=c.contours,C=0;C<E.length;C++){var P=E[C];P.xTouched=P.yTouched=!1,P.xo=P.x=P.x+g,P.yo=P.y=P.y+S}var R=a.length;a.push.apply(a,E);for(var O=0;O<k.length;O++)s.push(k[O]+R)}r.instructions&&!c.inhibitGridFit&&(c=new Jt("glyf",r.instructions),c.gZone=c.z0=c.z1=c.z2=a,c.contours=s,a.push(new Ut(0,0),new Ut(Math.round(r.advanceWidth*n),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),c.step=-1),dr(c),a.length-=2)}return a},Oo=function(r,e,n,i){for(var o=r.points||[],s=o.length,a=e.gZone=e.z0=e.z1=e.z2=[],c=e.contours=[],f,p=0;p<s;p++)f=o[p],a[p]=new Ut(f.x*n,f.y*i,f.lastPointOfContour,f.onCurve);for(var v,y,g=0;g<s;g++)f=a[g],v||(v=f,c.push(g)),f.lastPointOfContour?(f.nextPointOnContour=v,v.prevPointOnContour=f,v=void 0):(y=a[g+1],f.nextPointOnContour=y,y.prevPointOnContour=f);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var S=0;S<s;S++)console.log(S,a[S].x,a[S].y)}if(a.push(new Ut(0,0),new Ut(Math.round(r.advanceWidth*n),0)),dr(e),a.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var E=0;E<s;E++)console.log(E,a[E].x,a[E].y)}}},dr=function(r){var e=r.prog;if(e){var n=e.length,i;for(r.ip=0;r.ip<n;r.ip++){if(exports.DEBUG&&r.step++,i=nu[e[r.ip]],!i)throw new Error("unknown instruction: 0x"+Number(e[r.ip]).toString(16));i(r)}}};function vi(r){for(var e=r.tZone=new Array(r.gZone.length),n=0;n<e.length;n++)e[n]=new Ut(0,0)}function uu(r,e){var n=r.prog,i=r.ip,o=1,s;do if(s=n[++i],s===88)o++;else if(s===89)o--;else if(s===64)i+=n[i+1]+1;else if(s===65)i+=2*n[i+1]+1;else if(s>=176&&s<=183)i+=s-176+1;else if(s>=184&&s<=191)i+=(s-184+1)*2;else if(e&&o===1&&s===27)break;while(o>0);r.ip=i}function lu(r,e){exports.DEBUG&&console.log(e.step,"SVTCA["+r.axis+"]"),e.fv=e.pv=e.dpv=r}function cu(r,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+r.axis+"]"),e.pv=e.dpv=r}function fu(r,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+r.axis+"]"),e.fv=r}function hu(r,e){var n=e.stack,i=n.pop(),o=n.pop(),s=e.z2[i],a=e.z1[o];exports.DEBUG&&console.log("SPVTL["+r+"]",i,o);var c,f;r?(c=s.y-a.y,f=a.x-s.x):(c=a.x-s.x,f=a.y-s.y),e.pv=e.dpv=mn(c,f)}function pu(r,e){var n=e.stack,i=n.pop(),o=n.pop(),s=e.z2[i],a=e.z1[o];exports.DEBUG&&console.log("SFVTL["+r+"]",i,o);var c,f;r?(c=s.y-a.y,f=a.x-s.x):(c=a.x-s.x,f=a.y-s.y),e.fv=mn(c,f)}function Zh(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"SPVFS[]",n,i),r.pv=r.dpv=mn(i,n)}function Kh(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"SPVFS[]",n,i),r.fv=mn(i,n)}function Qh(r){var e=r.stack,n=r.pv;exports.DEBUG&&console.log(r.step,"GPV[]"),e.push(n.x*16384),e.push(n.y*16384)}function Jh(r){var e=r.stack,n=r.fv;exports.DEBUG&&console.log(r.step,"GFV[]"),e.push(n.x*16384),e.push(n.y*16384)}function ep(r){r.fv=r.pv,exports.DEBUG&&console.log(r.step,"SFVTPV[]")}function tp(r){var e=r.stack,n=e.pop(),i=e.pop(),o=e.pop(),s=e.pop(),a=e.pop(),c=r.z0,f=r.z1,p=c[n],v=c[i],y=f[o],g=f[s],S=r.z2[a];exports.DEBUG&&console.log("ISECT[], ",n,i,o,s,a);var E=p.x,k=p.y,C=v.x,P=v.y,R=y.x,O=y.y,q=g.x,D=g.y,K=(E-C)*(O-D)-(k-P)*(R-q),H=E*P-k*C,V=R*D-O*q;S.x=(H*(R-q)-V*(E-C))/K,S.y=(H*(O-D)-V*(k-P))/K}function rp(r){r.rp0=r.stack.pop(),exports.DEBUG&&console.log(r.step,"SRP0[]",r.rp0)}function np(r){r.rp1=r.stack.pop(),exports.DEBUG&&console.log(r.step,"SRP1[]",r.rp1)}function ip(r){r.rp2=r.stack.pop(),exports.DEBUG&&console.log(r.step,"SRP2[]",r.rp2)}function op(r){var e=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"SZP0[]",e),r.zp0=e,e){case 0:r.tZone||vi(r),r.z0=r.tZone;break;case 1:r.z0=r.gZone;break;default:throw new Error("Invalid zone pointer")}}function sp(r){var e=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"SZP1[]",e),r.zp1=e,e){case 0:r.tZone||vi(r),r.z1=r.tZone;break;case 1:r.z1=r.gZone;break;default:throw new Error("Invalid zone pointer")}}function ap(r){var e=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"SZP2[]",e),r.zp2=e,e){case 0:r.tZone||vi(r),r.z2=r.tZone;break;case 1:r.z2=r.gZone;break;default:throw new Error("Invalid zone pointer")}}function up(r){var e=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"SZPS[]",e),r.zp0=r.zp1=r.zp2=e,e){case 0:r.tZone||vi(r),r.z0=r.z1=r.z2=r.tZone;break;case 1:r.z0=r.z1=r.z2=r.gZone;break;default:throw new Error("Invalid zone pointer")}}function lp(r){r.loop=r.stack.pop(),exports.DEBUG&&console.log(r.step,"SLOOP[]",r.loop)}function cp(r){exports.DEBUG&&console.log(r.step,"RTG[]"),r.round=su}function fp(r){exports.DEBUG&&console.log(r.step,"RTHG[]"),r.round=Yh}function hp(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SMD[]",e),r.minDis=e/64}function pp(r){exports.DEBUG&&console.log(r.step,"ELSE[]"),uu(r,!1)}function dp(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"JMPR[]",e),r.ip+=e-1}function vp(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SCVTCI[]",e),r.cvCutIn=e/64}function gp(r){var e=r.stack;exports.DEBUG&&console.log(r.step,"DUP[]"),e.push(e[e.length-1])}function Do(r){exports.DEBUG&&console.log(r.step,"POP[]"),r.stack.pop()}function mp(r){exports.DEBUG&&console.log(r.step,"CLEAR[]"),r.stack.length=0}function yp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"SWAP[]"),e.push(n),e.push(i)}function wp(r){var e=r.stack;exports.DEBUG&&console.log(r.step,"DEPTH[]"),e.push(e.length)}function bp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"LOOPCALL[]",n,i);var o=r.ip,s=r.prog;r.prog=r.funcs[n];for(var a=0;a<i;a++)dr(r),exports.DEBUG&&console.log(++r.step,a+1<i?"next loopcall":"done loopcall",a);r.ip=o,r.prog=s}function Sp(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"CALL[]",e);var n=r.ip,i=r.prog;r.prog=r.funcs[e],dr(r),r.ip=n,r.prog=i,exports.DEBUG&&console.log(++r.step,"returning from",e)}function xp(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"CINDEX[]",n),e.push(e[e.length-n])}function _p(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"MINDEX[]",n),e.push(e.splice(e.length-n,1)[0])}function Ep(r){if(r.env!=="fpgm")throw new Error("FDEF not allowed here");var e=r.stack,n=r.prog,i=r.ip,o=e.pop(),s=i;for(exports.DEBUG&&console.log(r.step,"FDEF[]",o);n[++i]!==45;);r.ip=i,r.funcs[o]=n.slice(s+1,i)}function du(r,e){var n=e.stack.pop(),i=e.z0[n],o=e.fv,s=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+r+"]",n);var a=s.distance(i,yn);r&&(a=e.round(a)),o.setRelative(i,yn,a,s),o.touch(i),e.rp0=e.rp1=n}function vu(r,e){var n=e.z2,i=n.length-2,o,s,a;exports.DEBUG&&console.log(e.step,"IUP["+r.axis+"]");for(var c=0;c<i;c++)o=n[c],!r.touched(o)&&(s=o.prevTouched(r),s!==o&&(a=o.nextTouched(r),s===a&&r.setRelative(o,o,r.distance(s,s,!1,!0),r,!0),r.interpolate(o,s,a,r)))}function gu(r,e){for(var n=e.stack,i=r?e.rp1:e.rp2,o=(r?e.z0:e.z1)[i],s=e.fv,a=e.pv,c=e.loop,f=e.z2;c--;){var p=n.pop(),v=f[p],y=a.distance(o,o,!1,!0);s.setRelative(v,v,y,a),s.touch(v),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-c)+": ":"")+"SHP["+(r?"rp1":"rp2")+"]",p)}e.loop=1}function mu(r,e){var n=e.stack,i=r?e.rp1:e.rp2,o=(r?e.z0:e.z1)[i],s=e.fv,a=e.pv,c=n.pop(),f=e.z2[e.contours[c]],p=f;exports.DEBUG&&console.log(e.step,"SHC["+r+"]",c);var v=a.distance(o,o,!1,!0);do p!==o&&s.setRelative(p,p,v,a),p=p.nextPointOnContour;while(p!==f)}function yu(r,e){var n=e.stack,i=r?e.rp1:e.rp2,o=(r?e.z0:e.z1)[i],s=e.fv,a=e.pv,c=n.pop();exports.DEBUG&&console.log(e.step,"SHZ["+r+"]",c);var f;switch(c){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var p,v=a.distance(o,o,!1,!0),y=f.length-2,g=0;g<y;g++)p=f[g],s.setRelative(p,p,v,a)}function Tp(r){for(var e=r.stack,n=r.loop,i=r.fv,o=e.pop()/64,s=r.z2;n--;){var a=e.pop(),c=s[a];exports.DEBUG&&console.log(r.step,(r.loop>1?"loop "+(r.loop-n)+": ":"")+"SHPIX[]",a,o),i.setRelative(c,c,o),i.touch(c)}r.loop=1}function kp(r){for(var e=r.stack,n=r.rp1,i=r.rp2,o=r.loop,s=r.z0[n],a=r.z1[i],c=r.fv,f=r.dpv,p=r.z2;o--;){var v=e.pop(),y=p[v];exports.DEBUG&&console.log(r.step,(r.loop>1?"loop "+(r.loop-o)+": ":"")+"IP[]",v,n,"<->",i),c.interpolate(y,s,a,f),c.touch(y)}r.loop=1}function wu(r,e){var n=e.stack,i=n.pop()/64,o=n.pop(),s=e.z1[o],a=e.z0[e.rp0],c=e.fv,f=e.pv;c.setRelative(s,a,i,f),c.touch(s),exports.DEBUG&&console.log(e.step,"MSIRP["+r+"]",i,o),e.rp1=e.rp0,e.rp2=o,r&&(e.rp0=o)}function Cp(r){for(var e=r.stack,n=r.rp0,i=r.z0[n],o=r.loop,s=r.fv,a=r.pv,c=r.z1;o--;){var f=e.pop(),p=c[f];exports.DEBUG&&console.log(r.step,(r.loop>1?"loop "+(r.loop-o)+": ":"")+"ALIGNRP[]",f),s.setRelative(p,i,0,a),s.touch(p)}r.loop=1}function Pp(r){exports.DEBUG&&console.log(r.step,"RTDG[]"),r.round=$h}function bu(r,e){var n=e.stack,i=n.pop(),o=n.pop(),s=e.z0[o],a=e.fv,c=e.pv,f=e.cvt[i];exports.DEBUG&&console.log(e.step,"MIAP["+r+"]",i,"(",f,")",o);var p=c.distance(s,yn);r&&(Math.abs(p-f)<e.cvCutIn&&(p=f),p=e.round(p)),a.setRelative(s,yn,p,c),e.zp0===0&&(s.xo=s.x,s.yo=s.y),a.touch(s),e.rp0=e.rp1=o}function Ap(r){var e=r.prog,n=r.ip,i=r.stack,o=e[++n];exports.DEBUG&&console.log(r.step,"NPUSHB[]",o);for(var s=0;s<o;s++)i.push(e[++n]);r.ip=n}function Mp(r){var e=r.ip,n=r.prog,i=r.stack,o=n[++e];exports.DEBUG&&console.log(r.step,"NPUSHW[]",o);for(var s=0;s<o;s++){var a=n[++e]<<8|n[++e];a&32768&&(a=-((a^65535)+1)),i.push(a)}r.ip=e}function Rp(r){var e=r.stack,n=r.store;n||(n=r.store=[]);var i=e.pop(),o=e.pop();exports.DEBUG&&console.log(r.step,"WS",i,o),n[o]=i}function Op(r){var e=r.stack,n=r.store,i=e.pop();exports.DEBUG&&console.log(r.step,"RS",i);var o=n&&n[i]||0;e.push(o)}function Dp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"WCVTP",n,i),r.cvt[i]=n/64}function Fp(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"RCVT",n),e.push(r.cvt[n]*64)}function Su(r,e){var n=e.stack,i=n.pop(),o=e.z2[i];exports.DEBUG&&console.log(e.step,"GC["+r+"]",i),n.push(e.dpv.distance(o,yn,r,!1)*64)}function xu(r,e){var n=e.stack,i=n.pop(),o=n.pop(),s=e.z1[i],a=e.z0[o],c=e.dpv.distance(a,s,r,r);exports.DEBUG&&console.log(e.step,"MD["+r+"]",i,o,"->",c),e.stack.push(Math.round(c*64))}function Up(r){exports.DEBUG&&console.log(r.step,"MPPEM[]"),r.stack.push(r.ppem)}function Lp(r){exports.DEBUG&&console.log(r.step,"FLIPON[]"),r.autoFlip=!0}function Bp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"LT[]",n,i),e.push(i<n?1:0)}function Ip(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"LTEQ[]",n,i),e.push(i<=n?1:0)}function Gp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"GT[]",n,i),e.push(i>n?1:0)}function Np(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"GTEQ[]",n,i),e.push(i>=n?1:0)}function zp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"EQ[]",n,i),e.push(n===i?1:0)}function Hp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"NEQ[]",n,i),e.push(n!==i?1:0)}function Wp(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"ODD[]",n),e.push(Math.trunc(n)%2?1:0)}function Vp(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"EVEN[]",n),e.push(Math.trunc(n)%2?0:1)}function $p(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"IF[]",e),e||(uu(r,!0),exports.DEBUG&&console.log(r.step,"EIF[]"))}function Yp(r){exports.DEBUG&&console.log(r.step,"EIF[]")}function Xp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"AND[]",n,i),e.push(n&&i?1:0)}function qp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"OR[]",n,i),e.push(n||i?1:0)}function jp(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"NOT[]",n),e.push(n?0:1)}function Fo(r,e){var n=e.stack,i=n.pop(),o=e.fv,s=e.pv,a=e.ppem,c=e.deltaBase+(r-1)*16,f=e.deltaShift,p=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+r+"]",i,n);for(var v=0;v<i;v++){var y=n.pop(),g=n.pop(),S=c+((g&240)>>4);if(S===a){var E=(g&15)-8;E>=0&&E++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",y,"by",E*f);var k=p[y];o.setRelative(k,k,E*f,s)}}}function Zp(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"SDB[]",n),r.deltaBase=n}function Kp(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"SDS[]",n),r.deltaShift=Math.pow(.5,n)}function Qp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"ADD[]",n,i),e.push(i+n)}function Jp(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"SUB[]",n,i),e.push(i-n)}function ed(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"DIV[]",n,i),e.push(i*64/n)}function td(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"MUL[]",n,i),e.push(i*n/64)}function rd(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"ABS[]",n),e.push(Math.abs(n))}function nd(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"NEG[]",n),e.push(-n)}function id(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"FLOOR[]",n),e.push(Math.floor(n/64)*64)}function od(r){var e=r.stack,n=e.pop();exports.DEBUG&&console.log(r.step,"CEILING[]",n),e.push(Math.ceil(n/64)*64)}function gi(r,e){var n=e.stack,i=n.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),n.push(e.round(i/64)*64)}function sd(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"WCVTF[]",n,i),r.cvt[i]=n*r.ppem/r.font.unitsPerEm}function Uo(r,e){var n=e.stack,i=n.pop(),o=e.ppem,s=e.deltaBase+(r-1)*16,a=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+r+"]",i,n);for(var c=0;c<i;c++){var f=n.pop(),p=n.pop(),v=s+((p&240)>>4);if(v===o){var y=(p&15)-8;y>=0&&y++;var g=y*a;exports.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",g),e.cvt[f]+=g}}}function ad(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SROUND[]",e),r.round=au;var n;switch(e&192){case 0:n=.5;break;case 64:n=1;break;case 128:n=2;break;default:throw new Error("invalid SROUND value")}switch(r.srPeriod=n,e&48){case 0:r.srPhase=0;break;case 16:r.srPhase=.25*n;break;case 32:r.srPhase=.5*n;break;case 48:r.srPhase=.75*n;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?r.srThreshold=0:r.srThreshold=(e/8-.5)*n}function ud(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"S45ROUND[]",e),r.round=au;var n;switch(e&192){case 0:n=Math.sqrt(2)/2;break;case 64:n=Math.sqrt(2);break;case 128:n=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(r.srPeriod=n,e&48){case 0:r.srPhase=0;break;case 16:r.srPhase=.25*n;break;case 32:r.srPhase=.5*n;break;case 48:r.srPhase=.75*n;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?r.srThreshold=0:r.srThreshold=(e/8-.5)*n}function ld(r){exports.DEBUG&&console.log(r.step,"ROFF[]"),r.round=Vh}function cd(r){exports.DEBUG&&console.log(r.step,"RUTG[]"),r.round=Xh}function fd(r){exports.DEBUG&&console.log(r.step,"RDTG[]"),r.round=qh}function hd(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SCANCTRL[]",e)}function _u(r,e){var n=e.stack,i=n.pop(),o=n.pop(),s=e.z2[i],a=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+r+"]",i,o);var c,f;r?(c=s.y-a.y,f=a.x-s.x):(c=a.x-s.x,f=a.y-s.y),e.dpv=mn(c,f)}function pd(r){var e=r.stack,n=e.pop(),i=0;exports.DEBUG&&console.log(r.step,"GETINFO[]",n),n&1&&(i=35),n&32&&(i|=4096),e.push(i)}function dd(r){var e=r.stack,n=e.pop(),i=e.pop(),o=e.pop();exports.DEBUG&&console.log(r.step,"ROLL[]"),e.push(i),e.push(n),e.push(o)}function vd(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"MAX[]",n,i),e.push(Math.max(i,n))}function gd(r){var e=r.stack,n=e.pop(),i=e.pop();exports.DEBUG&&console.log(r.step,"MIN[]",n,i),e.push(Math.min(i,n))}function md(r){var e=r.stack.pop();exports.DEBUG&&console.log(r.step,"SCANTYPE[]",e)}function yd(r){var e=r.stack.pop(),n=r.stack.pop();switch(exports.DEBUG&&console.log(r.step,"INSTCTRL[]",e,n),e){case 1:r.inhibitGridFit=!!n;return;case 2:r.ignoreCvt=!!n;return;default:throw new Error("invalid INSTCTRL[] selector")}}function er(r,e){var n=e.stack,i=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+r+"]");for(var s=0;s<r;s++)n.push(i[++o]);e.ip=o}function tr(r,e){var n=e.ip,i=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+r+"]");for(var s=0;s<r;s++){var a=i[++n]<<8|i[++n];a&32768&&(a=-((a^65535)+1)),o.push(a)}e.ip=n}function $(r,e,n,i,o,s){var a=s.stack,c=r&&a.pop(),f=a.pop(),p=s.rp0,v=s.z0[p],y=s.z1[f],g=s.minDis,S=s.fv,E=s.dpv,k,C,P,R;C=k=E.distance(y,v,!0,!0),P=C>=0?1:-1,C=Math.abs(C),r&&(R=s.cvt[c],i&&Math.abs(C-R)<s.cvCutIn&&(C=R)),n&&C<g&&(C=g),i&&(C=s.round(C)),S.setRelative(y,v,P*C,E),S.touch(y),exports.DEBUG&&console.log(s.step,(r?"MIRP[":"MDRP[")+(e?"M":"m")+(n?">":"_")+(i?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",r?c+"("+s.cvt[c]+","+R+")":"",f,"(d =",k,"->",P*C,")"),s.rp1=s.rp0,s.rp2=f,e&&(s.rp0=f)}nu=[lu.bind(void 0,Ft),lu.bind(void 0,Ct),cu.bind(void 0,Ft),cu.bind(void 0,Ct),fu.bind(void 0,Ft),fu.bind(void 0,Ct),hu.bind(void 0,0),hu.bind(void 0,1),pu.bind(void 0,0),pu.bind(void 0,1),Zh,Kh,Qh,Jh,ep,tp,rp,np,ip,op,sp,ap,up,lp,cp,fp,hp,pp,dp,vp,void 0,void 0,gp,Do,mp,yp,wp,xp,_p,void 0,void 0,void 0,bp,Sp,Ep,void 0,du.bind(void 0,0),du.bind(void 0,1),vu.bind(void 0,Ft),vu.bind(void 0,Ct),gu.bind(void 0,0),gu.bind(void 0,1),mu.bind(void 0,0),mu.bind(void 0,1),yu.bind(void 0,0),yu.bind(void 0,1),Tp,kp,wu.bind(void 0,0),wu.bind(void 0,1),Cp,Pp,bu.bind(void 0,0),bu.bind(void 0,1),Ap,Mp,Rp,Op,Dp,Fp,Su.bind(void 0,0),Su.bind(void 0,1),void 0,xu.bind(void 0,0),xu.bind(void 0,1),Up,void 0,Lp,void 0,void 0,Bp,Ip,Gp,Np,zp,Hp,Wp,Vp,$p,Yp,Xp,qp,jp,Fo.bind(void 0,1),Zp,Kp,Qp,Jp,ed,td,rd,nd,id,od,gi.bind(void 0,0),gi.bind(void 0,1),gi.bind(void 0,2),gi.bind(void 0,3),void 0,void 0,void 0,void 0,sd,Fo.bind(void 0,2),Fo.bind(void 0,3),Uo.bind(void 0,1),Uo.bind(void 0,2),Uo.bind(void 0,3),ad,ud,void 0,void 0,ld,void 0,cd,fd,Do,Do,void 0,void 0,void 0,void 0,void 0,hd,_u.bind(void 0,0),_u.bind(void 0,1),pd,void 0,dd,vd,gd,md,yd,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,er.bind(void 0,1),er.bind(void 0,2),er.bind(void 0,3),er.bind(void 0,4),er.bind(void 0,5),er.bind(void 0,6),er.bind(void 0,7),er.bind(void 0,8),tr.bind(void 0,1),tr.bind(void 0,2),tr.bind(void 0,3),tr.bind(void 0,4),tr.bind(void 0,5),tr.bind(void 0,6),tr.bind(void 0,7),tr.bind(void 0,8),$.bind(void 0,0,0,0,0,0),$.bind(void 0,0,0,0,0,1),$.bind(void 0,0,0,0,0,2),$.bind(void 0,0,0,0,0,3),$.bind(void 0,0,0,0,1,0),$.bind(void 0,0,0,0,1,1),$.bind(void 0,0,0,0,1,2),$.bind(void 0,0,0,0,1,3),$.bind(void 0,0,0,1,0,0),$.bind(void 0,0,0,1,0,1),$.bind(void 0,0,0,1,0,2),$.bind(void 0,0,0,1,0,3),$.bind(void 0,0,0,1,1,0),$.bind(void 0,0,0,1,1,1),$.bind(void 0,0,0,1,1,2),$.bind(void 0,0,0,1,1,3),$.bind(void 0,0,1,0,0,0),$.bind(void 0,0,1,0,0,1),$.bind(void 0,0,1,0,0,2),$.bind(void 0,0,1,0,0,3),$.bind(void 0,0,1,0,1,0),$.bind(void 0,0,1,0,1,1),$.bind(void 0,0,1,0,1,2),$.bind(void 0,0,1,0,1,3),$.bind(void 0,0,1,1,0,0),$.bind(void 0,0,1,1,0,1),$.bind(void 0,0,1,1,0,2),$.bind(void 0,0,1,1,0,3),$.bind(void 0,0,1,1,1,0),$.bind(void 0,0,1,1,1,1),$.bind(void 0,0,1,1,1,2),$.bind(void 0,0,1,1,1,3),$.bind(void 0,1,0,0,0,0),$.bind(void 0,1,0,0,0,1),$.bind(void 0,1,0,0,0,2),$.bind(void 0,1,0,0,0,3),$.bind(void 0,1,0,0,1,0),$.bind(void 0,1,0,0,1,1),$.bind(void 0,1,0,0,1,2),$.bind(void 0,1,0,0,1,3),$.bind(void 0,1,0,1,0,0),$.bind(void 0,1,0,1,0,1),$.bind(void 0,1,0,1,0,2),$.bind(void 0,1,0,1,0,3),$.bind(void 0,1,0,1,1,0),$.bind(void 0,1,0,1,1,1),$.bind(void 0,1,0,1,1,2),$.bind(void 0,1,0,1,1,3),$.bind(void 0,1,1,0,0,0),$.bind(void 0,1,1,0,0,1),$.bind(void 0,1,1,0,0,2),$.bind(void 0,1,1,0,0,3),$.bind(void 0,1,1,0,1,0),$.bind(void 0,1,1,0,1,1),$.bind(void 0,1,1,0,1,2),$.bind(void 0,1,1,0,1,3),$.bind(void 0,1,1,1,0,0),$.bind(void 0,1,1,1,0,1),$.bind(void 0,1,1,1,0,2),$.bind(void 0,1,1,1,0,3),$.bind(void 0,1,1,1,1,0),$.bind(void 0,1,1,1,1,1),$.bind(void 0,1,1,1,1,2),$.bind(void 0,1,1,1,1,3)];function Ur(r){this.char=r,this.state={},this.activeState=null}function Lo(r,e,n){this.contextName=n,this.startIndex=r,this.endOffset=e}function wd(r,e,n){this.contextName=r,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=n}function bt(r,e){this.context=r,this.index=e,this.length=r.length,this.current=r[e],this.backtrack=r.slice(0,e),this.lookahead=r.slice(e+1)}function mi(r){this.eventId=r,this.subscribers=[]}function bd(r){var e=this,n=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];n.forEach(function(o){Object.defineProperty(e.events,o,{value:new mi(o)})}),r&&n.forEach(function(o){var s=r[o];typeof s=="function"&&e.events[o].subscribe(s)});var i=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];i.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Me(r){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],bd.call(this,r)}Ur.prototype.setState=function(r,e){return this.state[r]=e,this.activeState={key:r,value:this.state[r]},this.activeState},Ur.prototype.getState=function(r){return this.state[r]||null},Me.prototype.inboundIndex=function(r){return r>=0&&r<this.tokens.length},Me.prototype.composeRUD=function(r){var e=this,n=!0,i=r.map(function(s){return e[s[0]].apply(e,s.slice(1).concat(n))}),o=function(s){return typeof s=="object"&&s.hasOwnProperty("FAIL")};if(i.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:i.filter(o)};this.dispatch("composeRUD",[i.filter(function(s){return!o(s)})])},Me.prototype.replaceRange=function(r,e,n,i){e=e!==null?e:this.tokens.length;var o=n.every(function(a){return a instanceof Ur});if(!isNaN(r)&&this.inboundIndex(r)&&o){var s=this.tokens.splice.apply(this.tokens,[r,e].concat(n));return i||this.dispatch("replaceToken",[r,e,n]),[s,n]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Me.prototype.replaceToken=function(r,e,n){if(!isNaN(r)&&this.inboundIndex(r)&&e instanceof Ur){var i=this.tokens.splice(r,1,e);return n||this.dispatch("replaceToken",[r,e]),[i[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},Me.prototype.removeRange=function(r,e,n){e=isNaN(e)?this.tokens.length:e;var i=this.tokens.splice(r,e);return n||this.dispatch("removeRange",[i,r,e]),i},Me.prototype.removeToken=function(r,e){if(!isNaN(r)&&this.inboundIndex(r)){var n=this.tokens.splice(r,1);return e||this.dispatch("removeToken",[n,r]),n}else return{FAIL:"removeToken: invalid token index."}},Me.prototype.insertToken=function(r,e,n){var i=r.every(function(o){return o instanceof Ur});return i?(this.tokens.splice.apply(this.tokens,[e,0].concat(r)),n||this.dispatch("insertToken",[r,e]),r):{FAIL:"insertToken: invalid token(s)."}},Me.prototype.registerModifier=function(r,e,n){this.events.newToken.subscribe(function(i,o){var s=[i,o],a=e===null||e.apply(this,s)===!0,c=[i,o];if(a){var f=n.apply(this,c);i.setState(r,f)}}),this.registeredModifiers.push(r)},mi.prototype.subscribe=function(r){return typeof r=="function"?this.subscribers.push(r)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},mi.prototype.unsubscribe=function(r){this.subscribers.splice(r,1)},bt.prototype.setCurrentIndex=function(r){this.index=r,this.current=this.context[r],this.backtrack=this.context.slice(0,r),this.lookahead=this.context.slice(r+1)},bt.prototype.get=function(r){switch(!0){case r===0:return this.current;case(r<0&&Math.abs(r)<=this.backtrack.length):return this.backtrack.slice(r)[0];case(r>0&&r<=this.lookahead.length):return this.lookahead[r-1];default:return null}},Me.prototype.rangeToText=function(r){if(r instanceof Lo)return this.getRangeTokens(r).map(function(e){return e.char}).join("")},Me.prototype.getText=function(){return this.tokens.map(function(r){return r.char}).join("")},Me.prototype.getContext=function(r){var e=this.registeredContexts[r];return e||null},Me.prototype.on=function(r,e){var n=this.events[r];return n?n.subscribe(e):null},Me.prototype.dispatch=function(r,e){var n=this,i=this.events[r];i instanceof mi&&i.subscribers.forEach(function(o){o.apply(n,e||[])})},Me.prototype.registerContextChecker=function(r,e,n){if(this.getContext(r))return{FAIL:"context name '"+r+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof n!="function")return{FAIL:"missing context end check."};var i=new wd(r,e,n);return this.registeredContexts[r]=i,this.contextCheckers.push(i),i},Me.prototype.getRangeTokens=function(r){var e=r.startIndex+r.endOffset;return[].concat(this.tokens.slice(r.startIndex,e))},Me.prototype.getContextRanges=function(r){var e=this.getContext(r);return e?e.ranges:{FAIL:"context checker '"+r+"' is not registered."}},Me.prototype.resetContextsRanges=function(){var r=this.registeredContexts;for(var e in r)if(r.hasOwnProperty(e)){var n=r[e];n.ranges=[]}},Me.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var r=this.tokens.map(function(i){return i.char}),e=0;e<r.length;e++){var n=new bt(r,e);this.runContextCheck(n)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Me.prototype.setEndOffset=function(r,e){var n=this.getContext(e).openRange.startIndex,i=new Lo(n,r,e),o=this.getContext(e).ranges;return i.rangeId=e+"."+o.length,o.push(i),this.getContext(e).openRange=null,i},Me.prototype.runContextCheck=function(r){var e=this,n=r.index;this.contextCheckers.forEach(function(i){var o=i.contextName,s=e.getContext(o).openRange;if(!s&&i.checkStart(r)&&(s=new Lo(n,null,o),e.getContext(o).openRange=s,e.dispatch("contextStart",[o,n])),s&&i.checkEnd(r)){var a=n-s.startIndex+1,c=e.setEndOffset(a,o);e.dispatch("contextEnd",[o,c])}})},Me.prototype.tokenize=function(r){this.tokens=[],this.resetContextsRanges();var e=Array.from(r);this.dispatch("start");for(var n=0;n<e.length;n++){var i=e[n],o=new bt(e,n);this.dispatch("next",[o]),this.runContextCheck(o);var s=new Ur(i);this.tokens.push(s),this.dispatch("newToken",[s,o])}return this.dispatch("end",[this.tokens]),this.tokens};function rr(r){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(r)}function Eu(r){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(r)}function nr(r){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(r)}function yi(r){return/[A-z]/.test(r)}function Sd(r){return/\s/.test(r)}function ct(r){this.font=r,this.features={}}function vr(r){this.id=r.id,this.tag=r.tag,this.substitution=r.substitution}function wn(r,e){if(!r)return-1;switch(e.format){case 1:return e.glyphs.indexOf(r);case 2:for(var n=e.ranges,i=0;i<n.length;i++){var o=n[i];if(r>=o.start&&r<=o.end){var s=r-o.start;return o.index+s}}break;default:return-1}return-1}function xd(r,e){var n=wn(r,e.coverage);return n===-1?null:r+e.deltaGlyphId}function _d(r,e){var n=wn(r,e.coverage);return n===-1?null:e.substitute[n]}function Bo(r,e){for(var n=[],i=0;i<r.length;i++){var o=r[i],s=e.current;s=Array.isArray(s)?s[0]:s;var a=wn(s,o);a!==-1&&n.push(a)}return n.length!==r.length?-1:n}function Ed(r,e){var n=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(r.context.length<n)return[];var i=Bo(e.inputCoverage,r);if(i===-1)return[];var o=e.inputCoverage.length-1;if(r.lookahead.length<e.lookaheadCoverage.length)return[];for(var s=r.lookahead.slice(o);s.length&&nr(s[0].char);)s.shift();var a=new bt(s,0),c=Bo(e.lookaheadCoverage,a),f=[].concat(r.backtrack);for(f.reverse();f.length&&nr(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var p=new bt(f,0),v=Bo(e.backtrackCoverage,p),y=i.length===e.inputCoverage.length&&c.length===e.lookaheadCoverage.length&&v.length===e.backtrackCoverage.length,g=[];if(y)for(var S=0;S<e.lookupRecords.length;S++)for(var E=e.lookupRecords[S],k=E.lookupListIndex,C=this.getLookupByIndex(k),P=0;P<C.subtables.length;P++){var R=C.subtables[P],O=this.getLookupMethod(C,R),q=this.getSubstitutionType(C,R);if(q==="12")for(var D=0;D<i.length;D++){var K=r.get(D),H=O(K);H&&g.push(H)}}return g}function Td(r,e){var n=r.current,i=wn(n,e.coverage);if(i===-1)return null;for(var o,s=e.ligatureSets[i],a=0;a<s.length;a++){o=s[a];for(var c=0;c<o.components.length;c++){var f=r.lookahead[c],p=o.components[c];if(f!==p)break;if(c===o.components.length-1)return o}}return null}function kd(r,e){var n=wn(r,e.coverage);return n===-1?null:e.sequences[n]}ct.prototype.getDefaultScriptFeaturesIndexes=function(){for(var r=this.font.tables.gsub.scripts,e=0;e<r.length;e++){var n=r[e];if(n.tag==="DFLT")return n.script.defaultLangSys.featureIndexes}return[]},ct.prototype.getScriptFeaturesIndexes=function(r){var e=this.font.tables;if(!e.gsub)return[];if(!r)return this.getDefaultScriptFeaturesIndexes();for(var n=this.font.tables.gsub.scripts,i=0;i<n.length;i++){var o=n[i];if(o.tag===r&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var s=o.langSysRecords;if(s)for(var a=0;a<s.length;a++){var c=s[a];if(c.tag===r){var f=c.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},ct.prototype.mapTagsToFeatures=function(r,e){for(var n={},i=0;i<r.length;i++){var o=r[i].tag,s=r[i].feature;n[o]=s}this.features[e].tags=n},ct.prototype.getScriptFeatures=function(r){var e=this.features[r];if(this.features.hasOwnProperty(r))return e;var n=this.getScriptFeaturesIndexes(r);if(!n)return null;var i=this.font.tables.gsub;return e=n.map(function(o){return i.features[o]}),this.features[r]=e,this.mapTagsToFeatures(e,r),e},ct.prototype.getSubstitutionType=function(r,e){var n=r.lookupType.toString(),i=e.substFormat.toString();return n+i},ct.prototype.getLookupMethod=function(r,e){var n=this,i=this.getSubstitutionType(r,e);switch(i){case"11":return function(o){return xd.apply(n,[o,e])};case"12":return function(o){return _d.apply(n,[o,e])};case"63":return function(o){return Ed.apply(n,[o,e])};case"41":return function(o){return Td.apply(n,[o,e])};case"21":return function(o){return kd.apply(n,[o,e])};default:throw new Error("lookupType: "+r.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},ct.prototype.lookupFeature=function(r){var e=r.contextParams,n=e.index,i=this.getFeature({tag:r.tag,script:r.script});if(!i)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+r.tag+"' for script '"+r.script+"'.");for(var o=this.getFeatureLookups(i),s=[].concat(e.context),a=0;a<o.length;a++)for(var c=o[a],f=this.getLookupSubtables(c),p=0;p<f.length;p++){var v=f[p],y=this.getSubstitutionType(c,v),g=this.getLookupMethod(c,v),S=void 0;switch(y){case"11":S=g(e.current),S&&s.splice(n,1,new vr({id:11,tag:r.tag,substitution:S}));break;case"12":S=g(e.current),S&&s.splice(n,1,new vr({id:12,tag:r.tag,substitution:S}));break;case"63":S=g(e),Array.isArray(S)&&S.length&&s.splice(n,1,new vr({id:63,tag:r.tag,substitution:S}));break;case"41":S=g(e),S&&s.splice(n,1,new vr({id:41,tag:r.tag,substitution:S}));break;case"21":S=g(e.current),S&&s.splice(n,1,new vr({id:21,tag:r.tag,substitution:S}));break}e=new bt(s,n),!(Array.isArray(S)&&!S.length)&&(S=null)}return s.length?s:null},ct.prototype.supports=function(r){if(!r.script)return!1;this.getScriptFeatures(r.script);var e=this.features.hasOwnProperty(r.script);if(!r.tag)return e;var n=this.features[r.script].some(function(i){return i.tag===r.tag});return e&&n},ct.prototype.getLookupSubtables=function(r){return r.subtables||null},ct.prototype.getLookupByIndex=function(r){var e=this.font.tables.gsub.lookups;return e[r]||null},ct.prototype.getFeatureLookups=function(r){return r.lookupListIndexes.map(this.getLookupByIndex.bind(this))},ct.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var n=this.features[e.script];return n?n.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function Cd(r){var e=r.current,n=r.get(-1);return n===null&&rr(e)||!rr(n)&&rr(e)}function Pd(r){var e=r.get(1);return e===null||!rr(e)}var Ad={startCheck:Cd,endCheck:Pd};function Md(r){var e=r.current,n=r.get(-1);return(rr(e)||nr(e))&&!rr(n)}function Rd(r){var e=r.get(1);switch(!0){case e===null:return!0;case(!rr(e)&&!nr(e)):var n=Sd(e);if(!n)return!0;if(n){var i=!1;if(i=r.lookahead.some(function(o){return rr(o)||nr(o)}),!i)return!0}break;default:return!1}}var Od={startCheck:Md,endCheck:Rd};function Dd(r,e,n){e[n].setState(r.tag,r.substitution)}function Fd(r,e,n){e[n].setState(r.tag,r.substitution)}function Ud(r,e,n){r.substitution.forEach(function(i,o){var s=e[n+o];s.setState(r.tag,i)})}function Ld(r,e,n){var i=e[n];i.setState(r.tag,r.substitution.ligGlyph);for(var o=r.substitution.components.length,s=0;s<o;s++)i=e[n+s+1],i.setState("deleted",!0)}var Tu={11:Dd,12:Fd,63:Ud,41:Ld};function Io(r,e,n){r instanceof vr&&Tu[r.id]&&Tu[r.id](r,e,n)}function Bd(r){for(var e=[].concat(r.backtrack),n=e.length-1;n>=0;n--){var i=e[n],o=Eu(i),s=nr(i);if(!o&&!s)return!0;if(o)return!1}return!1}function Id(r){if(Eu(r.current))return!1;for(var e=0;e<r.lookahead.length;e++){var n=r.lookahead[e],i=nr(n);if(!i)return!0}return!1}function Gd(r){var e=this,n="arab",i=this.featuresTags[n],o=this.tokenizer.getRangeTokens(r);if(o.length!==1){var s=new bt(o.map(function(c){return c.getState("glyphIndex")}),0),a=new bt(o.map(function(c){return c.char}),0);o.forEach(function(c,f){if(!nr(c.char)){s.setCurrentIndex(f),a.setCurrentIndex(f);var p=0;Bd(a)&&(p|=1),Id(a)&&(p|=2);var v;switch(p){case 1:v="fina";break;case 2:v="init";break;case 3:v="medi";break}if(i.indexOf(v)!==-1){var y=e.query.lookupFeature({tag:v,script:n,contextParams:s});if(y instanceof Error)return console.info(y.message);y.forEach(function(g,S){g instanceof vr&&(Io(g,o,S),s.context[S]=g.substitution)})}}})}}function ku(r,e){var n=r.map(function(i){return i.activeState.value});return new bt(n,e||0)}function Nd(r){var e=this,n="arab",i=this.tokenizer.getRangeTokens(r),o=ku(i);o.context.forEach(function(s,a){o.setCurrentIndex(a);var c=e.query.lookupFeature({tag:"rlig",script:n,contextParams:o});c.length&&(c.forEach(function(f){return Io(f,i,a)}),o=ku(i))})}function zd(r){var e=r.current,n=r.get(-1);return n===null&&yi(e)||!yi(n)&&yi(e)}function Hd(r){var e=r.get(1);return e===null||!yi(e)}var Wd={startCheck:zd,endCheck:Hd};function Cu(r,e){var n=r.map(function(i){return i.activeState.value});return new bt(n,e||0)}function Vd(r){var e=this,n="latn",i=this.tokenizer.getRangeTokens(r),o=Cu(i);o.context.forEach(function(s,a){o.setCurrentIndex(a);var c=e.query.lookupFeature({tag:"liga",script:n,contextParams:o});c.length&&(c.forEach(function(f){return Io(f,i,a)}),o=Cu(i))})}function St(r){this.baseDir=r||"ltr",this.tokenizer=new Me,this.featuresTags={}}St.prototype.setText=function(r){this.text=r},St.prototype.contextChecks={latinWordCheck:Wd,arabicWordCheck:Ad,arabicSentenceCheck:Od};function Go(r){var e=this.contextChecks[r+"Check"];return this.tokenizer.registerContextChecker(r,e.startCheck,e.endCheck)}function $d(){return Go.call(this,"latinWord"),Go.call(this,"arabicWord"),Go.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Yd(){var r=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(n){var i=r.tokenizer.getRangeTokens(n);r.tokenizer.replaceRange(n.startIndex,n.endOffset,i.reverse())})}St.prototype.registerFeatures=function(r,e){var n=this,i=e.filter(function(o){return n.query.supports({script:r,tag:o})});this.featuresTags.hasOwnProperty(r)?this.featuresTags[r]=this.featuresTags[r].concat(i):this.featuresTags[r]=i},St.prototype.applyFeatures=function(r,e){if(!r)throw new Error("No valid font was provided to apply features");this.query||(this.query=new ct(r));for(var n=0;n<e.length;n++){var i=e[n];this.query.supports({script:i.script})&&this.registerFeatures(i.script,i.tags)}},St.prototype.registerModifier=function(r,e,n){this.tokenizer.registerModifier(r,e,n)};function No(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Xd(){var r=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){No.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){Gd.call(r,i)})}}function qd(){var r=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var n=this.featuresTags[e];if(n.indexOf("rlig")!==-1){No.call(this);var i=this.tokenizer.getContextRanges("arabicWord");i.forEach(function(o){Nd.call(r,o)})}}}function jd(){var r=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var n=this.featuresTags[e];if(n.indexOf("liga")!==-1){No.call(this);var i=this.tokenizer.getContextRanges("latinWord");i.forEach(function(o){Vd.call(r,o)})}}}St.prototype.checkContextReady=function(r){return!!this.tokenizer.getContext(r)},St.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Xd.call(this),qd.call(this)),this.checkContextReady("latinWord")&&jd.call(this),this.checkContextReady("arabicSentence")&&Yd.call(this)},St.prototype.processText=function(r){(!this.text||this.text!==r)&&(this.setText(r),$d.call(this),this.applyFeaturesToContexts())},St.prototype.getBidiText=function(r){return this.processText(r),this.tokenizer.getText()},St.prototype.getTextGlyphs=function(r){this.processText(r);for(var e=[],n=0;n<this.tokenizer.tokens.length;n++){var i=this.tokenizer.tokens[n];if(!i.state.deleted){var o=i.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function Se(r){r=r||{},r.tables=r.tables||{},r.empty||(vn(r.familyName,"When creating a new Font object, familyName is required."),vn(r.styleName,"When creating a new Font object, styleName is required."),vn(r.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),vn(r.ascender,"When creating a new Font object, ascender is required."),vn(r.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:r.familyName||" "},fontSubfamily:{en:r.styleName||" "},fullName:{en:r.fullName||r.familyName+" "+r.styleName},postScriptName:{en:r.postScriptName||(r.familyName+r.styleName).replace(/\s/g,"")},designer:{en:r.designer||" "},designerURL:{en:r.designerURL||" "},manufacturer:{en:r.manufacturer||" "},manufacturerURL:{en:r.manufacturerURL||" "},license:{en:r.license||" "},licenseURL:{en:r.licenseURL||" "},version:{en:r.version||"Version 0.1"},description:{en:r.description||" "},copyright:{en:r.copyright||" "},trademark:{en:r.trademark||" "}},this.unitsPerEm=r.unitsPerEm||1e3,this.ascender=r.ascender,this.descender=r.descender,this.createdTimestamp=r.createdTimestamp,this.tables=Object.assign(r.tables,{os2:Object.assign({usWeightClass:r.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:r.widthClass||this.usWidthClasses.MEDIUM,fsSelection:r.fsSelection||this.fsSelectionValues.REGULAR},r.tables.os2)})),this.supported=!0,this.glyphs=new kt.GlyphSet(this,r.glyphs||[]),this.encoding=new Ca(this),this.position=new dn(this),this.substitution=new lt(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new ou(this)}})}Se.prototype.hasChar=function(r){return this.encoding.charToGlyphIndex(r)!==null},Se.prototype.charToGlyphIndex=function(r){return this.encoding.charToGlyphIndex(r)},Se.prototype.charToGlyph=function(r){var e=this.charToGlyphIndex(r),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n},Se.prototype.updateFeatures=function(r){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(n){return r[n]})}:e})},Se.prototype.stringToGlyphs=function(r,e){var n=this,i=new St,o=function(y){return n.charToGlyphIndex(y.char)};i.registerModifier("glyphIndex",null,o);var s=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;i.applyFeatures(this,s);for(var a=i.getTextGlyphs(r),c=a.length,f=new Array(c),p=this.glyphs.get(0),v=0;v<c;v+=1)f[v]=this.glyphs.get(a[v])||p;return f},Se.prototype.nameToGlyphIndex=function(r){return this.glyphNames.nameToGlyphIndex(r)},Se.prototype.nameToGlyph=function(r){var e=this.nameToGlyphIndex(r),n=this.glyphs.get(e);return n||(n=this.glyphs.get(0)),n},Se.prototype.glyphIndexToName=function(r){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(r):""},Se.prototype.getKerningValue=function(r,e){r=r.index||r,e=e.index||e;var n=this.position.defaultKerningTables;return n?this.position.getKerningValue(n,r,e):this.kerningPairs[r+","+e]||0},Se.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Se.prototype.forEachGlyph=function(r,e,n,i,o,s){e=e!==void 0?e:0,n=n!==void 0?n:0,i=i!==void 0?i:72,o=Object.assign({},this.defaultRenderOptions,o);var a=1/this.unitsPerEm*i,c=this.stringToGlyphs(r,o),f;if(o.kerning){var p=o.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(p,o.language)}for(var v=0;v<c.length;v+=1){var y=c[v];if(s.call(this,y,e,n,i,o),y.advanceWidth&&(e+=y.advanceWidth*a),o.kerning&&v<c.length-1){var g=f?this.position.getKerningValue(f,y.index,c[v+1].index):this.getKerningValue(y,c[v+1]);e+=g*a}o.letterSpacing?e+=o.letterSpacing*i:o.tracking&&(e+=o.tracking/1e3*i)}return e},Se.prototype.getPath=function(r,e,n,i,o){var s=new We;return this.forEachGlyph(r,e,n,i,o,function(a,c,f,p){var v=a.getPath(c,f,p,o,this);s.extend(v)}),s},Se.prototype.getPaths=function(r,e,n,i,o){var s=[];return this.forEachGlyph(r,e,n,i,o,function(a,c,f,p){var v=a.getPath(c,f,p,o,this);s.push(v)}),s},Se.prototype.getAdvanceWidth=function(r,e,n){return this.forEachGlyph(r,0,0,e,n,function(){})},Se.prototype.draw=function(r,e,n,i,o,s){this.getPath(e,n,i,o,s).draw(r)},Se.prototype.drawPoints=function(r,e,n,i,o,s){this.forEachGlyph(e,n,i,o,s,function(a,c,f,p){a.drawPoints(r,c,f,p)})},Se.prototype.drawMetrics=function(r,e,n,i,o,s){this.forEachGlyph(e,n,i,o,s,function(a,c,f,p){a.drawMetrics(r,c,f,p)})},Se.prototype.getEnglishName=function(r){var e=this.names[r];if(e)return e.en},Se.prototype.validate=function(){var r=this;function e(i,o){}function n(i){var o=r.getEnglishName(i);o&&o.trim().length>0}n("fontFamily"),n("weightName"),n("manufacturer"),n("copyright"),n("version"),this.unitsPerEm>0},Se.prototype.toTables=function(){return Uh.fontToTable(this)},Se.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Se.prototype.toArrayBuffer=function(){for(var r=this.toTables(),e=r.encode(),n=new ArrayBuffer(e.length),i=new Uint8Array(n),o=0;o<e.length;o++)i[o]=e[o];return n},Se.prototype.download=function(r){var e=this.getEnglishName("fontFamily"),n=this.getEnglishName("fontSubfamily");r=r||e.replace(/\s/g,"")+"-"+n+".otf";var i=this.toArrayBuffer();if(Bh())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(i),s=new Blob([o],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(s),a.download=r;var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!1),a.dispatchEvent(c)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),p=Ih(i);f.writeFileSync(r,p)}},Se.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Se.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Se.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Lt=new Array(10);Lt[1]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();if(n===1)return{posFormat:1,coverage:this.parsePointer(A.coverage),value:this.parseValueRecord()};if(n===2)return{posFormat:2,coverage:this.parsePointer(A.coverage),values:this.parseValueRecordList()};J.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Lt[2]=function(){var e=this.offset+this.relativeOffset,n=this.parseUShort();J.assert(n===1||n===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var i=this.parsePointer(A.coverage),o=this.parseUShort(),s=this.parseUShort();if(n===1)return{posFormat:n,coverage:i,valueFormat1:o,valueFormat2:s,pairSets:this.parseList(A.pointer(A.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(s)}})))};if(n===2){var a=this.parsePointer(A.classDef),c=this.parsePointer(A.classDef),f=this.parseUShort(),p=this.parseUShort();return{posFormat:n,coverage:i,valueFormat1:o,valueFormat2:s,classDef1:a,classDef2:c,class1Count:f,class2Count:p,classRecords:this.parseList(f,A.list(p,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(s)}}))}}},Lt[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Lt[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Lt[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Lt[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Lt[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Lt[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Lt[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);const gr=1e-8,Lr=(r,e)=>Ze(r,e,gr*10);function Zd(r,e){const n=r.orientation==="clockwise"?-e:e,i=r.curves.map(p=>({offset:ro(p,n),original:p})),o=[];let s=null,a=i.at(-1);if(!a)return[];if(o.length===1)return o;const c=p=>{s?p.offset instanceof Ae?o.push(p.offset):Lr(p.offset.firstPoint,p.offset.lastPoint)||o.push(Jr(p.offset.firstPoint,p.offset.lastPoint)):s=p},f=function*(){for(const p of i.slice(0,-1))yield p;if(!s)throw new Error("Bug in the offset algorithm");yield s};for(const p of f()){const v=a.offset.lastPoint,y=p.offset.firstPoint;if(Lr(v,y)){c(a),a=p;continue}let g=[];if(a.offset instanceof Ae&&p.offset instanceof Ae){const{intersections:E,commonSegmentsPoints:k}=Qr(a.offset,p.offset,gr/100);g=[...E,...k]}if(g.length>0){let E=g[0];if(g.length>1){const P=a==null?void 0:a.original.lastPoint,R=g.map(O=>ic(O,P));E=g[R.indexOf(Math.min(...R))]}const k=a.offset.splitAt([E],gr)[0],C=p.offset.splitAt([E],gr).at(-1);if(!C)throw new Error("Bug in the splitting algo in offset");c({offset:k,original:a.original}),a={offset:C,original:p.original};continue}const S=Rs(v,y,a.original.lastPoint);c(a),o.push(S),a=p}return c(a),o}function Kd(r,e){const n=Zd(r,e);if(n.length<2)return null;const i=new Map,o=(p,v)=>{const y=i.get(p)||[];i.set(p,[...y,...v])};if(n.forEach((p,v)=>{n.slice(v+1).forEach((y,g)=>{const{intersections:S,commonSegmentsPoints:E}=Qr(p,y,gr),k=[...S,...E].filter(C=>{const P=Lr(C,p.firstPoint)||Lr(C,p.lastPoint),R=Lr(C,y.firstPoint)||Lr(C,y.lastPoint);return!(P&&R)});k.length&&(o(v,k),o(g+v+1,k))})}),!i.size){const p=new ae(n);return r.intersects(p)?null:p}const a=n.flatMap((p,v)=>{if(!i.has(v))return p;const y=i.get(v)||[];return p.splitAt(y,gr*100)}).filter(p=>!r.curves.find(y=>y.distanceFrom(p)<Math.abs(e)-gr));if(!a.length)return null;const f=wc(a).filter(p=>p.length>1).map(p=>new ae(p)).filter(p=>p.isClosed());return f.length?f.length===1?f[0]:new ie(f):null}const Pu=r=>{let e=r[0];for(let n=1;n<r.length;n++)e=Dt(e,r[n]);return e};function wi(r,e){if(r instanceof ae)return Kd(r,e);if(r instanceof ie)return Pu(r.blueprints.map(n=>wi(n,e)));if(r instanceof ve){const n=Pu(r.blueprints.slice(1).map(i=>wi(i,e)));return Zt(wi(r.blueprints[0],e),n)}return null}function Au(r,e,n,i){let o=()=>!0;i&&(o=i.shouldKeep.bind(i));const s=[e.curves[0]],a=(f,p)=>{o({firstCurve:f,secondCurve:p,point:f.lastPoint})?s.push(...r(f,p,n)):s.push(f,p)};e.curves.slice(1).forEach(f=>{const p=s.pop();if(!p)throw new Error("Bug in the blueprint filletting algo");a(p,f)});const c=s.at(-1);if(!c)throw new Error("Bug in the blueprint corner algo");if(Ze(s[0].firstPoint,c.lastPoint)&&s.length>1){const f=s.pop(),p=s.shift();if(!f||!p)throw new Error("Bug in the blueprint filletting algo");a(f,p)}return new ae(s)}function zo(r,e,n,i){if(e instanceof ae)return Au(r,e,n,i);if(e instanceof ve)return new ve(e.blueprints.map(o=>Au(r,o,n,i)));if(e instanceof ie){const o=e.blueprints.map(s=>zo(r,s,n,i)).filter(s=>s!==null);return new ie(o)}return null}function Qd(r,e,n){return zo(no,r,e,n)}function Jd(r,e,n){return zo(io,r,e,n)}class Ge{constructor(e=null){this.innerShape=e}clone(){var e;return new Ge(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new Kr}stretch(e,n,i){return this.innerShape?new Ge(this.innerShape.stretch(e,n,i)):new Ge}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,n){return this.innerShape?new Ge(this.innerShape.rotate(e,n)):new Ge}translate(e,n=0){return this.innerShape?new Ge(this.innerShape.translate(e,n)):new Ge}scale(e,n){return this.innerShape?new Ge(this.innerShape.scale(e,n)):new Ge}mirror(e,n,i){return this.innerShape?new Ge(this.innerShape.mirror(e,n,i)):new Ge}cut(e){return new Ge(Zt(this.innerShape,e.innerShape))}fuse(e){return new Ge(Dt(this.innerShape,e.innerShape))}intersect(e){return new Ge(ln(this.innerShape,e.innerShape))}fillet(e,n){const i=n&&n(new Yn);return new Ge(Qd(this.innerShape,e,i))}chamfer(e,n){const i=n&&n(new Yn);return new Ge(Jd(this.innerShape,e,i))}sketchOnPlane(e,n){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,n)}sketchOnFace(e,n){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,n)}toSVG(e){var n;return((n=this.innerShape)==null?void 0:n.toSVG(e))||""}toSVGViewBox(e=1){var n;return((n=this.innerShape)==null?void 0:n.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Ge(wi(this.innerShape,e))}get blueprint(){if(!(this.innerShape instanceof ae)){if(this.innerShape instanceof ie&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof ae)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class ev extends oa{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Ge(new ae(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,n="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,n),this.done()}}function ft(r){const e=new ev;return r&&e.movePointerTo(r),e}function tv(r,e,n=0){return new Ge($c(r,e,n))}const Mu=tv;function rv(r){return ft().movePointerTo([-r,0]).sagittaArc(2*r,0,r).sagittaArc(-2*r,0,r).close()}function bn(r,e,n){this.k=r,this.x=e,this.y=n}bn.prototype={constructor:bn,scale:function(r){return r===1?this:new bn(this.k*r,this.x,this.y)},translate:function(r,e){return r===0&e===0?this:new bn(this.k,this.x+this.k*r,this.y+this.k*e)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},bn.prototype;function nv(r=10){return Math.random().toString(36).substr(2,r)}function Ru(r,e){return new Array(e).fill(r)}function iv(r,e,n){const i=[];for(let o=0;o<e;++o)i.push(Ru(r,n));return i}function ov(r,e,n){const i=[];for(let o=0;o<e;++o){const s=[];for(let a=0;a<n;++a)s.push(r(o,a));i.push(s)}return i}function sv(r,e,n=1){const i=[];if(e===void 0&&r>=0)for(let o=0;o<r;o+=n)i.push(o);else if(e===void 0)for(let o=0;o>r;o-=n)i.push(o);else if(r<=e)for(let o=r;o<=e;o+=n)i.push(o);else for(let o=r;o>=e;o-=n)i.push(o);return i}function av(r){return r.reduce((e,n)=>e+n,0)}var uv=Object.defineProperty,Ho=(r,e)=>{for(var n in e)uv(r,n,{get:e[n],enumerable:!0})},lv=1e-6;function Ou(r,e,n=lv){return isNaN(r)||isNaN(e)?!1:Math.abs(r-e)<n}var cv={};Ho(cv,{determinant:()=>vv,fill:()=>Du,identity:()=>Fu,inverse:()=>Bu,product:()=>bi,reflection:()=>pv,rotation:()=>fv,scalarProduct:()=>dv,shear:()=>hv,sum:()=>Uu,transpose:()=>Lu});function Du(r,e,n){return iv(r,e,n)}function Fu(r=2){const e=Du(0,r,r);for(let n=0;n<r;++n)e[n][n]=1;return e}function fv(r){const e=Math.sin(r),n=Math.cos(r);return[[n,-e],[e,n]]}function hv(r){return[[1,r],[0,1]]}function pv(r){const e=Math.sin(2*r),n=Math.cos(2*r);return[[n,e],[e,-n]]}function Uu(...r){const[e,...n]=r,i=n.length>1?Uu(...n):n[0];if(e.length!==i.length||e[0].length!==i[0].length)throw new Error("Matrix sizes don’t match");const o=[];for(let s=0;s<e.length;++s){const a=[];for(let c=0;c<e[s].length;++c)a.push(e[s][c]+i[s][c]);o.push(a)}return o}function dv(r,e){return r.map(n=>n.map(i=>i*e))}function bi(...r){const[e,...n]=r,i=n.length>1?bi(...n):n[0];if(e[0].length!==i.length)throw new Error("Matrix sizes don’t match.");const o=[];for(let s=0;s<e.length;++s){const a=[];for(let c=0;c<i[0].length;++c){let f=0;for(let p=0;p<i.length;++p)f+=e[s][p]*i[p][c];a.push(f)}o.push(a)}return o}function Lu(r){const e=[];for(let n=0;n<r[0].length;++n){const i=[];for(let o=0;o<r.length;++o)i.push(r[o][n]);e.push(i)}return e}function vv(r){if(r.length!==r[0].length)throw new Error("Not a square matrix.");const e=r.length;if(e===1)return r[0][0];if(e===2)return r[0][0]*r[1][1]-r[0][1]*r[1][0];let n=0;for(let i=0;i<e;++i){let o=r[0][i],s=r[0][i];for(let a=1;a<e;++a)s*=r[a][(i+a)%e],o*=r[a][(i-a+e)%e];n+=s-o}return n}function Bu(r){const e=r.length;if(e!==r[0].length)throw new Error("Not a square matrix.");const n=Fu(e),i=ov((o,s)=>r[o][s],e,e);for(let o=0;o<e;++o){let s=i[o][o];if(Ou(s,0)){for(let a=o+1;a<e;++a)if(i[a][o]!==0){for(let c=0;c<e;++c)[i[a][c],i[o][c]]=[i[o][c],i[a][c]],[n[a][c],n[o][c]]=[n[o][c],n[a][c]];break}if(s=i[o][o],Ou(s,0))throw new Error("Matrix not invertible.")}for(let a=0;a<e;++a)i[o][a]=i[o][a]/s,n[o][a]=n[o][a]/s;for(let a=0;a<e;++a){if(a===o)continue;const c=i[a][o];for(let f=0;f<e;++f)i[a][f]-=c*i[o][f],n[a][f]-=c*n[o][f]}}return n}var gv={};Ho(gv,{bernoulli:()=>Gu,binomial:()=>Sv,cauchy:()=>Cv,chiCDF:()=>Av,exponential:()=>Tv,find:()=>wv,geometric:()=>kv,integer:()=>yv,integrate:()=>Wu,normal:()=>Ev,normalPDF:()=>Pv,poisson:()=>xv,shuffle:()=>mv,smart:()=>bv,uniform:()=>_v,weighted:()=>Iu});function mv(r){r=r.slice(0);for(let e=r.length-1;e>0;--e){const n=Math.floor(Math.random()*(e+1));[r[e],r[n]]=[r[n],r[e]]}return r}function yv(r,e){const n=e===void 0?0:r,i=e===void 0?r:e-r+1;return n+Math.floor(i*Math.random())}function Iu(r){const e=Math.random()*av(r);let n=0;return r.findIndex(i=>(n+=i)>=e)}function wv(r){return r[Math.floor(r.length*Math.random())]}var Si=new Map;function bv(r,e){e||(e=nv()),Si.has(e)||Si.set(e,Ru(1,r));const n=Si.get(e),i=Iu(n.map(o=>o*o));return n[i]-=1,n[i]<=0&&Si.set(e,n.map(o=>o+1)),i}function Gu(r=.5){return Math.random()<r?1:0}function Sv(r=1,e=.5){let n=0;for(let i=0;i<r;++i)n+=Gu(e);return n}function xv(r=1){if(r<=0)return 0;const e=Math.exp(-r);let n=1,i=0;for(;n>e;++i)n*=Math.random();return i-1}function _v(r=0,e=1){return r+(e-r)*Math.random()}function Ev(r=0,e=1){const n=Math.random(),i=Math.random();return Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*i)*Math.sqrt(e)+r}function Tv(r=1){return r<=0?0:-Math.log(Math.random())/r}function kv(r=.5){if(!(r<=0||r>1))return Math.floor(Math.log(Math.random())/Math.log(1-r))}function Cv(){let r,e,n;do e=2*Math.random()-1,n=2*Math.random()-1,r=e*e+n*n;while(r>=1);return e/n}function Pv(r,e=1,n=0){return Math.exp(-((r-e)**2)/(2*n))/Math.sqrt(2*Math.PI*n)}var Nu=7,zu=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function Hu(r){if(r<.5)return Math.PI/(Math.sin(Math.PI*r)*Hu(1-r));r-=1;let e=zu[0];for(let i=1;i<Nu+2;i++)e+=zu[i]/(r+i);const n=r+Nu+.5;return Math.sqrt(2*Math.PI)*Math.pow(n,r+.5)*Math.exp(-n)*e}function Wu(r,e,n,i=1){let o=0;for(let s=e;s<n;s+=i)o+=r(s)*i||0;return o}function Av(r,e){return 1-Wu(i=>Math.pow(i,(e-2)/2)*Math.exp(-i/2),0,r)/Math.pow(2,e/2)/Hu(e/2)}var Mv={};Ho(Mv,{bestPolynomial:()=>Lv,coefficient:()=>$u,exponential:()=>Dv,linear:()=>Ov,logarithmic:()=>Fv,polynomial:()=>Vu,power:()=>Uv});function Rv(r,e){let n=1,i=r[0];for(let o=1;o<r.length;++o)n*=e,i+=n*r[o];return i}function Ov(r,e=!1){let n=0,i=0,o=0,s=0;const a=r.length;for(let p=0;p<a;p++)n+=r[p][0],i+=r[p][1],o+=r[p][0]*r[p][0],s+=r[p][0]*r[p][1];if(e)return[0,s/o];const c=(a*s-n*i)/(a*o-n*n);return[i/a-c*n/a,c]}function Dv(r){const e=[0,0,0,0,0,0];for(const s of r)e[0]+=s[0],e[1]+=s[1],e[2]+=s[0]*s[0]*s[1],e[3]+=s[1]*Math.log(s[1]),e[4]+=s[0]*s[1]*Math.log(s[1]),e[5]+=s[0]*s[1];const n=e[1]*e[2]-e[5]*e[5],i=Math.exp((e[2]*e[3]-e[5]*e[4])/n),o=(e[1]*e[4]-e[5]*e[3])/n;return[i,o]}function Fv(r){const e=[0,0,0,0],n=r.length;for(const s of r)e[0]+=Math.log(s[0]),e[1]+=s[1]*Math.log(s[0]),e[2]+=s[1],e[3]+=Math.pow(Math.log(s[0]),2);const i=(n*e[1]-e[2]*e[0])/(n*e[3]-e[0]*e[0]);return[(e[2]-i*e[0])/n,i]}function Uv(r){const e=[0,0,0,0],n=r.length;for(const s of r)e[0]+=Math.log(s[0]),e[1]+=Math.log(s[1])*Math.log(s[0]),e[2]+=Math.log(s[1]),e[3]+=Math.pow(Math.log(s[0]),2);const i=(n*e[1]-e[2]*e[0])/(n*e[3]-e[0]*e[0]);return[Math.exp((e[2]-i*e[0])/n),i]}function Vu(r,e=2){const n=r.map(f=>sv(e+1).map(p=>Math.pow(f[0],p))),i=Lu(n),o=r.map(f=>[f[1]]),s=bi(i,n),a=Bu(s);return bi(a,i,o).map(f=>f[0])}function $u(r,e){const i=r.reduce((a,c)=>a+c[1],0)/r.length,o=r.reduce((a,c)=>a+(c[1]-i)**2,0);return 1-r.reduce((a,c)=>a+(c[1]-e(c[0]))**2,0)/o}function Lv(r,e=.85,n=8){if(!(r.length<=1))for(let i=1;i<n;++i){const o=Vu(r,i),s=c=>Rv(o,c);if($u(r,s)>=e)return{order:i,coefficients:o,fn:s}}}function Bt(r,e=3){const n=10**e;return Math.round(r*n)/n}const Pt=class Pt{constructor(e,n="rad"){n==="rad"&&(this.radian=e,this.degree=e*Pt.toDeg),n==="deg"&&(this.radian=e*Pt.toRad,this.degree=e)}get rad(){return this.radian}get deg(){return this.degree===void 0&&(this.degree=this.radian*Pt.toDeg),this.degree}set rad(e){this.radian=e>=0?e%(2*Math.PI):Math.PI*2+e%(2*Math.PI),this.degree=this.radian*Pt.toDeg}set deg(e){this.degree=e%360,this.radian=this.degree*Pt.toRad}static fromArc(e,n){return new Pt(2*(n/e))}static toArc(e,n){return n.rad/2*Math.PI*(e*Math.PI)}};ys(Pt,"toRad",Math.PI/180),ys(Pt,"toDeg",180/Math.PI);let Qe=Pt;class Je{constructor(e,n){this.radius=e,n instanceof Qe?this.angle=n:this.angle=new Qe(n,"rad")}underOrLeft(e){return e.radius<this.radius||e.angle>this.angle}static fromCartesian(e,n){let i=0;return e>0&&n>=0?i=Math.atan(n/e):e<=0&&n>0?i=Math.atan(-e/n)+Math.PI/2:e<0&&n<=0?i=Math.atan(-n/-e)+Math.PI:e>=0&&n<0&&(i=Math.atan(e/-n)+Math.PI*1.5),new Je(Math.hypot(e,n),new Qe(i))}static distance(e,n){return Math.sqrt(e.radius**2+n.radius**2-2*e.radius*n.radius*Math.cos(e.angle.rad-n.angle.rad))}toCartesian(e=0){return[Math.cos(this.angle.rad+e)*this.radius,Math.sin(this.angle.rad+e)*this.radius]}static arcMiddlePoint(e,n){return new Je(e.radius+(n.radius-e.radius)/2,new Qe(e.angle.rad+(n.angle.rad-e.angle.rad)/2))}log(){console.log(`Radius: ${this.radius}   Angle: ${this.angle.deg}`)}}function Bv(r,e){const n=r/2,i=e-n,o=Math.sqrt(n**2-i**2);return{radius:n,radiusFlat:i,chordHalfLength:o}}function Iv(r,e){const n=r/2;return{radius:n,radiusFlat:Math.sqrt(n**2-(e/2)**2)}}function ye(r,e,n,i){postMessage({type:"Progress",action:r,step:e,stepCount:n,slowSymbol:i})}function Wo(r,e){postMessage({type:"Warning",title:r,text:e})}function xi(r,e){postMessage({type:"Error",title:r,text:e})}typeof window>"u"||(ye=function(){});async function Br(r,e="stl",n="low"){if(!r)return console.error("No Geometry."),null;let i,o;switch(e){case"stl":return i=n=="low"?.5:.05,o=n=="low"?.5:.05,await r.blobSTL({tolerance:i,angularTolerance:o}).text();case"step":return await r.blobSTEP().text();default:return console.error("Unknown geometry format"),null}}function Yu(r,e){let n=Bv(r,e),i=ft();return i=i.movePointerTo([n.chordHalfLength,n.radiusFlat]).threePointsArcTo([-n.chordHalfLength,+n.radiusFlat],[0,-n.radius]).close(),i}function Gv({diameter:r,offset:e=0}){return rv((r+e)/2)}function Nv({width:r,height:e,cornerHoleRadius:n=0,rotate:i=0,cornerslots:o=0,offset:s=0}){r/=2,e/=2;const a=[];a[0]=[+r,+e],a[1]=[+r,-e],a[2]=[-r,-e],a[3]=[-r,+e];let c=ft(a[0]);for(let f=1;f<a.length;f++)c=c.lineTo(a[f]);return c.close().rotate(i)}function zv({diameter:r,diameterFlat:e,rotate:n=0,offset:i=0}){return Yu(r+i,e+i).rotate(n)}function Hv({diameter:r,width:e,height:n,cornerslots:i=0,rotate:o=0,offset:s=0}){if(e>r)return Wo("Bore can't be created","Keyway Width must be smaller than Bore Diameter"),null;r+=s,e+=s,n+=s;const a=Iv(r,e);let c=Yu(r,a.radius+a.radiusFlat);return c=c.fuse(Mu(e,n).translate(0,n/2+a.radiusFlat)),c.rotate(o)}function Wv({edgeToEdge:r,cornerslots:e=0,rotate:n=0,offset:i=0}){const o=r/2,s=Math.tan(30*Math.PI/180)*o,a=Math.sqrt(o**2+s**2),c=[];c[0]=[-s,-o],c[1]=[+s,-o],c[2]=[a,0],c[3]=[+s,+o],c[4]=[-s,+o],c[5]=[-a,0];let f=ft(c[0]);for(let p=5;p>=0;p--)f=f.lineTo(c[p]);return f.close().rotate(n)}class Xu{constructor(){}}function qu(r,e){function n({x:v,y}){return Math.sqrt(v**2+y**2)}const i=e/2;if(n(r.get(0))>i&&n(r.get(1))>i||n(r.get(0))<i&&n(r.get(1))<i)return null;let o=0,s=1,a,c=i,f,p=0;do f=c,a=(o+s)/2,c=i-n(r.get(a)),c>0?o=a:s=a,p++;while(Math.abs(c)<Math.abs(f)&&p<20);return r.split(a)}const{abs:Sn,cos:It,sin:Ir,acos:Vv,atan2:xn,sqrt:ir,pow:pt}=Math;function _n(r){return r<0?-pt(-r,1/3):pt(r,1/3)}const ju=Math.PI,_i=2*ju,or=ju/2,$v=1e-6,Vo=Number.MAX_SAFE_INTEGER||9007199254740991,$o=Number.MIN_SAFE_INTEGER||-9007199254740991,Yv={x:0,y:0,z:0},L={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(r,e){const n=e(r);let i=n.x*n.x+n.y*n.y;return typeof n.z<"u"&&(i+=n.z*n.z),ir(i)},compute:function(r,e,n){if(r===0)return e[0].t=0,e[0];const i=e.length-1;if(r===1)return e[i].t=1,e[i];const o=1-r;let s=e;if(i===0)return e[0].t=r,e[0];if(i===1){const c={x:o*s[0].x+r*s[1].x,y:o*s[0].y+r*s[1].y,t:r};return n&&(c.z=o*s[0].z+r*s[1].z),c}if(i<4){let c=o*o,f=r*r,p,v,y,g=0;i===2?(s=[s[0],s[1],s[2],Yv],p=c,v=o*r*2,y=f):i===3&&(p=c*o,v=c*r*3,y=o*f*3,g=r*f);const S={x:p*s[0].x+v*s[1].x+y*s[2].x+g*s[3].x,y:p*s[0].y+v*s[1].y+y*s[2].y+g*s[3].y,t:r};return n&&(S.z=p*s[0].z+v*s[1].z+y*s[2].z+g*s[3].z),S}const a=JSON.parse(JSON.stringify(e));for(;a.length>1;){for(let c=0;c<a.length-1;c++)a[c]={x:a[c].x+(a[c+1].x-a[c].x)*r,y:a[c].y+(a[c+1].y-a[c].y)*r},typeof a[c].z<"u"&&(a[c].z=a[c].z+(a[c+1].z-a[c].z)*r);a.splice(a.length-1,1)}return a[0].t=r,a[0]},computeWithRatios:function(r,e,n,i){const o=1-r,s=n,a=e;let c=s[0],f=s[1],p=s[2],v=s[3],y;if(c*=o,f*=r,a.length===2)return y=c+f,{x:(c*a[0].x+f*a[1].x)/y,y:(c*a[0].y+f*a[1].y)/y,z:i?(c*a[0].z+f*a[1].z)/y:!1,t:r};if(c*=o,f*=2*o,p*=r*r,a.length===3)return y=c+f+p,{x:(c*a[0].x+f*a[1].x+p*a[2].x)/y,y:(c*a[0].y+f*a[1].y+p*a[2].y)/y,z:i?(c*a[0].z+f*a[1].z+p*a[2].z)/y:!1,t:r};if(c*=o,f*=1.5*o,p*=3*o,v*=r*r*r,a.length===4)return y=c+f+p+v,{x:(c*a[0].x+f*a[1].x+p*a[2].x+v*a[3].x)/y,y:(c*a[0].y+f*a[1].y+p*a[2].y+v*a[3].y)/y,z:i?(c*a[0].z+f*a[1].z+p*a[2].z+v*a[3].z)/y:!1,t:r}},derive:function(r,e){const n=[];for(let i=r,o=i.length,s=o-1;o>1;o--,s--){const a=[];for(let c=0,f;c<s;c++)f={x:s*(i[c+1].x-i[c].x),y:s*(i[c+1].y-i[c].y)},e&&(f.z=s*(i[c+1].z-i[c].z)),a.push(f);n.push(a),i=a}return n},between:function(r,e,n){return e<=r&&r<=n||L.approximately(r,e)||L.approximately(r,n)},approximately:function(r,e,n){return Sn(r-e)<=(n||$v)},length:function(r){const n=L.Tvalues.length;let i=0;for(let o=0,s;o<n;o++)s=.5*L.Tvalues[o]+.5,i+=L.Cvalues[o]*L.arcfn(s,r);return .5*i},map:function(r,e,n,i,o){const s=n-e,a=o-i,c=r-e,f=c/s;return i+a*f},lerp:function(r,e,n){const i={x:e.x+r*(n.x-e.x),y:e.y+r*(n.y-e.y)};return e.z!==void 0&&n.z!==void 0&&(i.z=e.z+r*(n.z-e.z)),i},pointToString:function(r){let e=r.x+"/"+r.y;return typeof r.z<"u"&&(e+="/"+r.z),e},pointsToString:function(r){return"["+r.map(L.pointToString).join(", ")+"]"},copy:function(r){return JSON.parse(JSON.stringify(r))},angle:function(r,e,n){const i=e.x-r.x,o=e.y-r.y,s=n.x-r.x,a=n.y-r.y,c=i*a-o*s,f=i*s+o*a;return xn(c,f)},round:function(r,e){const n=""+r,i=n.indexOf(".");return parseFloat(n.substring(0,i+1+e))},dist:function(r,e){const n=r.x-e.x,i=r.y-e.y;return ir(n*n+i*i)},closest:function(r,e){let n=pt(2,63),i,o;return r.forEach(function(s,a){o=L.dist(e,s),o<n&&(n=o,i=a)}),{mdist:n,mpos:i}},abcratio:function(r,e){if(e!==2&&e!==3)return!1;if(typeof r>"u")r=.5;else if(r===0||r===1)return r;const n=pt(r,e)+pt(1-r,e),i=n-1;return Sn(i/n)},projectionratio:function(r,e){if(e!==2&&e!==3)return!1;if(typeof r>"u")r=.5;else if(r===0||r===1)return r;const n=pt(1-r,e),i=pt(r,e)+n;return n/i},lli8:function(r,e,n,i,o,s,a,c){const f=(r*i-e*n)*(o-a)-(r-n)*(o*c-s*a),p=(r*i-e*n)*(s-c)-(e-i)*(o*c-s*a),v=(r-n)*(s-c)-(e-i)*(o-a);return v==0?!1:{x:f/v,y:p/v}},lli4:function(r,e,n,i){const o=r.x,s=r.y,a=e.x,c=e.y,f=n.x,p=n.y,v=i.x,y=i.y;return L.lli8(o,s,a,c,f,p,v,y)},lli:function(r,e){return L.lli4(r,r.c,e,e.c)},makeline:function(r,e){return new _e(r.x,r.y,(r.x+e.x)/2,(r.y+e.y)/2,e.x,e.y)},findbbox:function(r){let e=Vo,n=Vo,i=$o,o=$o;return r.forEach(function(s){const a=s.bbox();e>a.x.min&&(e=a.x.min),n>a.y.min&&(n=a.y.min),i<a.x.max&&(i=a.x.max),o<a.y.max&&(o=a.y.max)}),{x:{min:e,mid:(e+i)/2,max:i,size:i-e},y:{min:n,mid:(n+o)/2,max:o,size:o-n}}},shapeintersections:function(r,e,n,i,o){if(!L.bboxoverlap(e,i))return[];const s=[],a=[r.startcap,r.forward,r.back,r.endcap],c=[n.startcap,n.forward,n.back,n.endcap];return a.forEach(function(f){f.virtual||c.forEach(function(p){if(p.virtual)return;const v=f.intersects(p,o);v.length>0&&(v.c1=f,v.c2=p,v.s1=r,v.s2=n,s.push(v))})}),s},makeshape:function(r,e,n){const i=e.points.length,o=r.points.length,s=L.makeline(e.points[i-1],r.points[0]),a=L.makeline(r.points[o-1],e.points[0]),c={startcap:s,forward:r,back:e,endcap:a,bbox:L.findbbox([s,r,e,a])};return c.intersections=function(f){return L.shapeintersections(c,c.bbox,f,f.bbox,n)},c},getminmax:function(r,e,n){if(!n)return{min:0,max:0};let i=Vo,o=$o,s,a;n.indexOf(0)===-1&&(n=[0].concat(n)),n.indexOf(1)===-1&&n.push(1);for(let c=0,f=n.length;c<f;c++)s=n[c],a=r.get(s),a[e]<i&&(i=a[e]),a[e]>o&&(o=a[e]);return{min:i,mid:(i+o)/2,max:o,size:o-i}},align:function(r,e){const n=e.p1.x,i=e.p1.y,o=-xn(e.p2.y-i,e.p2.x-n),s=function(a){return{x:(a.x-n)*It(o)-(a.y-i)*Ir(o),y:(a.x-n)*Ir(o)+(a.y-i)*It(o)}};return r.map(s)},roots:function(r,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=r.length-1,i=L.align(r,e),o=function(H){return 0<=H&&H<=1};if(n===2){const H=i[0].y,V=i[1].y,ee=i[2].y,te=H-2*V+ee;if(te!==0){const pe=-ir(V*V-H*ee),de=-H+V,we=-(pe+de)/te,se=-(-pe+de)/te;return[we,se].filter(o)}else if(V!==ee&&te===0)return[(2*V-ee)/(2*V-2*ee)].filter(o);return[]}const s=i[0].y,a=i[1].y,c=i[2].y,f=i[3].y;let p=-s+3*a-3*c+f,v=3*s-6*a+3*c,y=-3*s+3*a,g=s;if(L.approximately(p,0)){if(L.approximately(v,0))return L.approximately(y,0)?[]:[-g/y].filter(o);const H=ir(y*y-4*v*g),V=2*v;return[(H-y)/V,(-y-H)/V].filter(o)}v/=p,y/=p,g/=p;const S=(3*y-v*v)/3,E=S/3,k=(2*v*v*v-9*v*y+27*g)/27,C=k/2,P=C*C+E*E*E;let R,O,q,D,K;if(P<0){const H=-S/3,V=H*H*H,ee=ir(V),te=-k/(2*ee),pe=te<-1?-1:te>1?1:te,de=Vv(pe),we=_n(ee),se=2*we;return q=se*It(de/3)-v/3,D=se*It((de+_i)/3)-v/3,K=se*It((de+2*_i)/3)-v/3,[q,D,K].filter(o)}else{if(P===0)return R=C<0?_n(-C):-_n(C),q=2*R-v/3,D=-R-v/3,[q,D].filter(o);{const H=ir(P);return R=_n(-C+H),O=_n(C+H),[R-O-v/3].filter(o)}}},droots:function(r){if(r.length===3){const e=r[0],n=r[1],i=r[2],o=e-2*n+i;if(o!==0){const s=-ir(n*n-e*i),a=-e+n,c=-(s+a)/o,f=-(-s+a)/o;return[c,f]}else if(n!==i&&o===0)return[(2*n-i)/(2*(n-i))];return[]}if(r.length===2){const e=r[0],n=r[1];return e!==n?[e/(e-n)]:[]}return[]},curvature:function(r,e,n,i,o){let s,a,c,f,p=0,v=0;const y=L.compute(r,e),g=L.compute(r,n),S=y.x*y.x+y.y*y.y;if(i?(s=ir(pt(y.y*g.z-g.y*y.z,2)+pt(y.z*g.x-g.z*y.x,2)+pt(y.x*g.y-g.x*y.y,2)),a=pt(S+y.z*y.z,3/2)):(s=y.x*g.y-y.y*g.x,a=pt(S,3/2)),s===0||a===0)return{k:0,r:0};if(p=s/a,v=a/s,!o){const E=L.curvature(r-.001,e,n,i,!0).k,k=L.curvature(r+.001,e,n,i,!0).k;f=(k-p+(p-E))/2,c=(Sn(k-p)+Sn(p-E))/2}return{k:p,r:v,dk:f,adk:c}},inflections:function(r){if(r.length<4)return[];const e=L.align(r,{p1:r[0],p2:r.slice(-1)[0]}),n=e[2].x*e[1].y,i=e[3].x*e[1].y,o=e[1].x*e[2].y,s=e[3].x*e[2].y,a=18*(-3*n+2*i+3*o-s),c=18*(3*n-i-3*o),f=18*(o-n);if(L.approximately(a,0)){if(!L.approximately(c,0)){let g=-f/c;if(0<=g&&g<=1)return[g]}return[]}const p=2*a;if(L.approximately(p,0))return[];const v=c*c-4*a*f;if(v<0)return[];const y=Math.sqrt(v);return[(y-c)/p,-(c+y)/p].filter(function(g){return 0<=g&&g<=1})},bboxoverlap:function(r,e){const n=["x","y"],i=n.length;for(let o=0,s,a,c,f;o<i;o++)if(s=n[o],a=r[s].mid,c=e[s].mid,f=(r[s].size+e[s].size)/2,Sn(a-c)>=f)return!1;return!0},expandbox:function(r,e){e.x.min<r.x.min&&(r.x.min=e.x.min),e.y.min<r.y.min&&(r.y.min=e.y.min),e.z&&e.z.min<r.z.min&&(r.z.min=e.z.min),e.x.max>r.x.max&&(r.x.max=e.x.max),e.y.max>r.y.max&&(r.y.max=e.y.max),e.z&&e.z.max>r.z.max&&(r.z.max=e.z.max),r.x.mid=(r.x.min+r.x.max)/2,r.y.mid=(r.y.min+r.y.max)/2,r.z&&(r.z.mid=(r.z.min+r.z.max)/2),r.x.size=r.x.max-r.x.min,r.y.size=r.y.max-r.y.min,r.z&&(r.z.size=r.z.max-r.z.min)},pairiteration:function(r,e,n){const i=r.bbox(),o=e.bbox(),s=1e5,a=n||.5;if(i.x.size+i.y.size<a&&o.x.size+o.y.size<a)return[(s*(r._t1+r._t2)/2|0)/s+"/"+(s*(e._t1+e._t2)/2|0)/s];let c=r.split(.5),f=e.split(.5),p=[{left:c.left,right:f.left},{left:c.left,right:f.right},{left:c.right,right:f.right},{left:c.right,right:f.left}];p=p.filter(function(y){return L.bboxoverlap(y.left.bbox(),y.right.bbox())});let v=[];return p.length===0||(p.forEach(function(y){v=v.concat(L.pairiteration(y.left,y.right,a))}),v=v.filter(function(y,g){return v.indexOf(y)===g})),v},getccenter:function(r,e,n){const i=e.x-r.x,o=e.y-r.y,s=n.x-e.x,a=n.y-e.y,c=i*It(or)-o*Ir(or),f=i*Ir(or)+o*It(or),p=s*It(or)-a*Ir(or),v=s*Ir(or)+a*It(or),y=(r.x+e.x)/2,g=(r.y+e.y)/2,S=(e.x+n.x)/2,E=(e.y+n.y)/2,k=y+c,C=g+f,P=S+p,R=E+v,O=L.lli8(y,g,k,C,S,E,P,R),q=L.dist(O,r);let D=xn(r.y-O.y,r.x-O.x),K=xn(e.y-O.y,e.x-O.x),H=xn(n.y-O.y,n.x-O.x),V;return D<H?((D>K||K>H)&&(D+=_i),D>H&&(V=H,H=D,D=V)):H<K&&K<D?(V=H,H=D,D=V):H+=_i,O.s=D,O.e=H,O.r=q,O},numberSort:function(r,e){return r-e}};class En{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(e){return L.pointsToString(e.points)}).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map(function(e){return e.length()}).reduce(function(e,n){return e+n})}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var n=e[0].bbox(),i=1;i<e.length;i++)L.expandbox(n,e[i].bbox());return n}offset(e){const n=[];return this.curves.forEach(function(i){n.push(...i.offset(e))}),new En(n)}}const{abs:Tn,min:Zu,max:Ku,cos:Xv,sin:qv,acos:jv,sqrt:kn}=Math,Zv=Math.PI;class _e{constructor(e){let n=e&&e.forEach?e:Array.from(arguments).slice(),i=!1;if(typeof n[0]=="object"){i=n.length;const S=[];n.forEach(function(E){["x","y","z"].forEach(function(k){typeof E[k]<"u"&&S.push(E[k])})}),n=S}let o=!1;const s=n.length;if(i){if(i>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");o=!0}}else if(s!==6&&s!==8&&s!==9&&s!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const a=this._3d=!o&&(s===9||s===12)||e&&e[0]&&typeof e[0].z<"u",c=this.points=[];for(let S=0,E=a?3:2;S<s;S+=E){var f={x:n[S],y:n[S+1]};a&&(f.z=n[S+2]),c.push(f)}const p=this.order=c.length-1,v=this.dims=["x","y"];a&&v.push("z"),this.dimlen=v.length;const y=L.align(c,{p1:c[0],p2:c[p]}),g=L.dist(c[0],c[p]);this._linear=y.reduce((S,E)=>S+Tn(E.y),0)<g/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,n,i,o){if(typeof o>"u"&&(o=.5),o===0)return new _e(n,n,i);if(o===1)return new _e(e,n,n);const s=_e.getABC(2,e,n,i,o);return new _e(e,s.A,i)}static cubicFromPoints(e,n,i,o,s){typeof o>"u"&&(o=.5);const a=_e.getABC(3,e,n,i,o);typeof s>"u"&&(s=L.dist(n,a.C));const c=s*(1-o)/o,f=L.dist(e,i),p=(i.x-e.x)/f,v=(i.y-e.y)/f,y=s*p,g=s*v,S=c*p,E=c*v,k={x:n.x-y,y:n.y-g},C={x:n.x+S,y:n.y+E},P=a.A,R={x:P.x+(k.x-P.x)/(1-o),y:P.y+(k.y-P.y)/(1-o)},O={x:P.x+(C.x-P.x)/o,y:P.y+(C.y-P.y)/o},q={x:e.x+(R.x-e.x)/o,y:e.y+(R.y-e.y)/o},D={x:i.x+(O.x-i.x)/(1-o),y:i.y+(O.y-i.y)/(1-o)};return new _e(e,q,D,i)}static getUtils(){return L}getUtils(){return _e.getUtils()}static get PolyBezier(){return En}valueOf(){return this.toString()}toString(){return L.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,n=e[0].x,i=e[0].y,o=["M",n,i,this.order===2?"Q":"C"];for(let s=1,a=e.length;s<a;s++)o.push(e[s].x),o.push(e[s].y);return o.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map(function(e,n){return""+n+e.x+e.y+(e.z?e.z:0)}).join("")}update(){this._lut=[],this.dpoints=L.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,n=L.angle(e[0],e[this.order],e[1]);this.clockwise=n>0}length(){return L.length(this.derivative.bind(this))}static getABC(e=2,n,i,o,s=.5){const a=L.projectionratio(s,e),c=1-a,f={x:a*n.x+c*o.x,y:a*n.y+c*o.y},p=L.abcratio(s,e);return{A:{x:i.x+(i.x-f.x)/p,y:i.y+(i.y-f.y)/p},B:i,C:f,S:n,E:o}}getABC(e,n){n=n||this.get(e);let i=this.points[0],o=this.points[this.order];return _e.getABC(this.order,i,n,o,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let n=0,i,o;n<e;n++)o=n/(e-1),i=this.compute(o),i.t=o,this._lut.push(i);return this._lut}on(e,n){n=n||5;const i=this.getLUT(),o=[];for(let s=0,a,c=0;s<i.length;s++)a=i[s],L.dist(a,e)<n&&(o.push(a),c+=s/i.length);return o.length?t/=o.length:!1}project(e){const n=this.getLUT(),i=n.length-1,o=L.closest(n,e),s=o.mpos,a=(s-1)/i,c=(s+1)/i,f=.1/i;let p=o.mdist,v=a,y=v,g;p+=1;for(let S;v<c+f;v+=f)g=this.compute(v),S=L.dist(e,g),S<p&&(p=S,y=v);return y=y<0?0:y>1?1:y,g=this.compute(y),g.t=y,g.d=p,g}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?L.computeWithRatios(e,this.points,this.ratios,this._3d):L.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,n=[e[0]],i=e.length;for(let o=1,s,a;o<i;o++)s=e[o],a=e[o-1],n[o]={x:(i-o)/i*s.x+o/i*a.x,y:(i-o)/i*s.y+o/i*a.y};return n[i]=e[i-1],new _e(n)}derivative(e){return L.compute(e,this.dpoints[0],this._3d)}dderivative(e){return L.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new _e(L.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return L.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return L.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const n=this.derivative(e),i=kn(n.x*n.x+n.y*n.y);return{t:e,x:-n.y/i,y:n.x/i}}__normal3(e){const n=this.derivative(e),i=this.derivative(e+.01),o=kn(n.x*n.x+n.y*n.y+n.z*n.z),s=kn(i.x*i.x+i.y*i.y+i.z*i.z);n.x/=o,n.y/=o,n.z/=o,i.x/=s,i.y/=s,i.z/=s;const a={x:i.y*n.z-i.z*n.y,y:i.z*n.x-i.x*n.z,z:i.x*n.y-i.y*n.x},c=kn(a.x*a.x+a.y*a.y+a.z*a.z);a.x/=c,a.y/=c,a.z/=c;const f=[a.x*a.x,a.x*a.y-a.z,a.x*a.z+a.y,a.x*a.y+a.z,a.y*a.y,a.y*a.z-a.x,a.x*a.z-a.y,a.y*a.z+a.x,a.z*a.z];return{t:e,x:f[0]*n.x+f[1]*n.y+f[2]*n.z,y:f[3]*n.x+f[4]*n.y+f[5]*n.z,z:f[6]*n.x+f[7]*n.y+f[8]*n.z}}hull(e){let n=this.points,i=[],o=[],s=0;for(o[s++]=n[0],o[s++]=n[1],o[s++]=n[2],this.order===3&&(o[s++]=n[3]);n.length>1;){i=[];for(let a=0,c,f=n.length-1;a<f;a++)c=L.lerp(e,n[a],n[a+1]),o[s++]=c,i.push(c);n=i}return o}split(e,n){if(e===0&&n)return this.split(n).left;if(n===1)return this.split(e).right;const i=this.hull(e),o={left:this.order===2?new _e([i[0],i[3],i[5]]):new _e([i[0],i[4],i[7],i[9]]),right:this.order===2?new _e([i[5],i[4],i[2]]):new _e([i[9],i[8],i[6],i[3]]),span:i};return o.left._t1=L.map(0,0,1,this._t1,this._t2),o.left._t2=L.map(e,0,1,this._t1,this._t2),o.right._t1=L.map(e,0,1,this._t1,this._t2),o.right._t2=L.map(1,0,1,this._t1,this._t2),n?(n=L.map(n,e,1,0,1),o.right.split(n).left):o}extrema(){const e={};let n=[];return this.dims.forEach((function(i){let o=function(a){return a[i]},s=this.dpoints[0].map(o);e[i]=L.droots(s),this.order===3&&(s=this.dpoints[1].map(o),e[i]=e[i].concat(L.droots(s))),e[i]=e[i].filter(function(a){return a>=0&&a<=1}),n=n.concat(e[i].sort(L.numberSort))}).bind(this)),e.values=n.sort(L.numberSort).filter(function(i,o){return n.indexOf(i)===o}),e}bbox(){const e=this.extrema(),n={};return this.dims.forEach((function(i){n[i]=L.getminmax(this,i,e[i])}).bind(this)),n}overlaps(e){const n=this.bbox(),i=e.bbox();return L.bboxoverlap(n,i)}offset(e,n){if(typeof n<"u"){const i=this.get(e),o=this.normal(e),s={c:i,n:o,x:i.x+o.x*n,y:i.y+o.y*n};return this._3d&&(s.z=i.z+o.z*n),s}if(this._linear){const i=this.normal(0),o=this.points.map(function(s){const a={x:s.x+e*i.x,y:s.y+e*i.y};return s.z&&i.z&&(a.z=s.z+e*i.z),a});return[new _e(o)]}return this.reduce().map(function(i){return i._linear?i.offset(e)[0]:i.scale(e)})}simple(){if(this.order===3){const o=L.angle(this.points[0],this.points[3],this.points[1]),s=L.angle(this.points[0],this.points[3],this.points[2]);if(o>0&&s<0||o<0&&s>0)return!1}const e=this.normal(0),n=this.normal(1);let i=e.x*n.x+e.y*n.y;return this._3d&&(i+=e.z*n.z),Tn(jv(i))<Zv/3}reduce(){let e,n=0,i=0,o=.01,s,a=[],c=[],f=this.extrema().values;for(f.indexOf(0)===-1&&(f=[0].concat(f)),f.indexOf(1)===-1&&f.push(1),n=f[0],e=1;e<f.length;e++)i=f[e],s=this.split(n,i),s._t1=n,s._t2=i,a.push(s),n=i;return a.forEach(function(p){for(n=0,i=0;i<=1;)for(i=n+o;i<=1+o;i+=o)if(s=p.split(n,i),!s.simple()){if(i-=o,Tn(n-i)<o)return[];s=p.split(n,i),s._t1=L.map(n,0,1,p._t1,p._t2),s._t2=L.map(i,0,1,p._t1,p._t2),c.push(s),n=i;break}n<1&&(s=p.split(n,1),s._t1=L.map(n,0,1,p._t1,p._t2),s._t2=p._t2,c.push(s))}),c}translate(e,n,i){i=typeof i=="number"?i:n;const o=this.order;let s=this.points.map((a,c)=>(1-c/o)*n+c/o*i);return new _e(this.points.map((a,c)=>({x:a.x+e.x*s[c],y:a.y+e.y*s[c]})))}scale(e){const n=this.order;let i=!1;if(typeof e=="function"&&(i=e),i&&n===2)return this.raise().scale(i);const o=this.clockwise,s=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):e,i?i(1):e);const a=i?i(0):e,c=i?i(1):e,f=[this.offset(0,10),this.offset(1,10)],p=[],v=L.lli4(f[0],f[0].c,f[1],f[1].c);if(!v)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(y){const g=p[y*n]=L.copy(s[y*n]);g.x+=(y?c:a)*f[y].n.x,g.y+=(y?c:a)*f[y].n.y}),i?([0,1].forEach(function(y){if(!(n===2&&y)){var g=s[y+1],S={x:g.x-v.x,y:g.y-v.y},E=i?i((y+1)/n):e;i&&!o&&(E=-E);var k=kn(S.x*S.x+S.y*S.y);S.x/=k,S.y/=k,p[y+1]={x:g.x+E*S.x,y:g.y+E*S.y}}}),new _e(p)):([0,1].forEach(y=>{if(n===2&&y)return;const g=p[y*n],S=this.derivative(y),E={x:g.x+S.x,y:g.y+S.y};p[y+1]=L.lli4(g,E,v,s[y+1])}),new _e(p))}outline(e,n,i,o){if(n=n===void 0?e:n,this._linear){const D=this.normal(0),K=this.points[0],H=this.points[this.points.length-1];let V,ee,te;i===void 0&&(i=e,o=n),V={x:K.x+D.x*e,y:K.y+D.y*e},te={x:H.x+D.x*i,y:H.y+D.y*i},ee={x:(V.x+te.x)/2,y:(V.y+te.y)/2};const pe=[V,ee,te];V={x:K.x-D.x*n,y:K.y-D.y*n},te={x:H.x-D.x*o,y:H.y-D.y*o},ee={x:(V.x+te.x)/2,y:(V.y+te.y)/2};const de=[te,ee,V],we=L.makeline(de[2],pe[0]),se=L.makeline(pe[2],de[0]),Ee=[we,new _e(pe),se,new _e(de)];return new En(Ee)}const s=this.reduce(),a=s.length,c=[];let f=[],p,v=0,y=this.length();const g=typeof i<"u"&&typeof o<"u";function S(D,K,H,V,ee){return function(te){const pe=V/H,de=(V+ee)/H,we=K-D;return L.map(te,0,1,D+pe*we,D+de*we)}}s.forEach(function(D){const K=D.length();g?(c.push(D.scale(S(e,i,y,v,K))),f.push(D.scale(S(-n,-o,y,v,K)))):(c.push(D.scale(e)),f.push(D.scale(-n))),v+=K}),f=f.map(function(D){return p=D.points,p[3]?D.points=[p[3],p[2],p[1],p[0]]:D.points=[p[2],p[1],p[0]],D}).reverse();const E=c[0].points[0],k=c[a-1].points[c[a-1].points.length-1],C=f[a-1].points[f[a-1].points.length-1],P=f[0].points[0],R=L.makeline(C,E),O=L.makeline(k,P),q=[R].concat(c).concat([O]).concat(f);return new En(q)}outlineshapes(e,n,i){n=n||e;const o=this.outline(e,n).curves,s=[];for(let a=1,c=o.length;a<c/2;a++){const f=L.makeshape(o[a],o[c-a],i);f.startcap.virtual=a>1,f.endcap.virtual=a<c/2-1,s.push(f)}return s}intersects(e,n){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof _e&&(e=e.reduce()),this.curveintersects(this.reduce(),e,n)):this.selfintersects(n)}lineIntersects(e){const n=Zu(e.p1.x,e.p2.x),i=Zu(e.p1.y,e.p2.y),o=Ku(e.p1.x,e.p2.x),s=Ku(e.p1.y,e.p2.y);return L.roots(this.points,e).filter(a=>{var c=this.get(a);return L.between(c.x,n,o)&&L.between(c.y,i,s)})}selfintersects(e){const n=this.reduce(),i=n.length-2,o=[];for(let s=0,a,c,f;s<i;s++)c=n.slice(s,s+1),f=n.slice(s+2),a=this.curveintersects(c,f,e),o.push(...a);return o}curveintersects(e,n,i){const o=[];e.forEach(function(a){n.forEach(function(c){a.overlaps(c)&&o.push({left:a,right:c})})});let s=[];return o.forEach(function(a){const c=L.pairiteration(a.left,a.right,i);c.length>0&&(s=s.concat(c))}),s}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,n,i,o){const s=(o-i)/4,a=this.get(i+s),c=this.get(o-s),f=L.dist(e,n),p=L.dist(e,a),v=L.dist(e,c);return Tn(p-f)+Tn(v-f)}_iterate(e,n){let i=0,o=1,s;do{s=0,o=1;let a=this.get(i),c,f,p,v,y=!1,g=!1,S,E=o,k=1;do if(g=y,v=p,E=(i+o)/2,c=this.get(E),f=this.get(o),p=L.getccenter(a,c,f),p.interval={start:i,end:o},y=this._error(p,a,i,o)<=e,S=g&&!y,S||(k=o),y){if(o>=1){if(p.interval.end=k=1,v=p,o>1){let P={x:p.x+p.r*Xv(p.e),y:p.y+p.r*qv(p.e)};p.e+=L.angle({x:p.x,y:p.y},P,this.get(1))}break}o=o+(o-i)/2}else o=E;while(!S&&s++<100);if(s>=100)break;v=v||p,n.push(v),i=k}while(o<1);return n}}function Qu(){const r=new Date,e=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),i=String(r.getDate()).padStart(2,"0"),o=String(r.getHours()).padStart(2,"0"),s=String(r.getMinutes()).padStart(2,"0");return`(${e}${n}${i}${o}${s})`}function Ju([r,e]){return`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${r}" width="${r.split(" ")[2]}mm" height="${r.split(" ")[3]}mm" stroke-width="0.1" stroke="black" fill="white">
        <path d="${e}"/>
    </svg>`}const el=Math.sin,Cn=Math.cos,tl=Math.PI,Kv=Math.PI/180;let Yo,Xo,rl;function Qv(r){const e=Xo+(rl-Xo)*r;let n=[];return n[0]=Yo*(Cn(e)+e*el(e)),n[1]=Yo*(el(e)-e*Cn(e)),n}function Jv(){const e=Array(4),n=Array(4);let i,o,s;for(let a=0;a<4;a++){e[a]=0,n[a]=0;for(let c=1;c<=50;c++)i=(c-.5)/50,[o,s]=Qv(Cn(tl*i)).map(f=>f*Cn(tl*a*i)),e[a]+=o,n[a]+=s;e[a]=e[a]*2/50,n[a]=n[a]*2/50}return[e,n]}function eg(){const[r,e]=Jv(),n=Array(4);n[0]=r[0]/2-r[2],n[1]=r[1]-r[3]*3,n[2]=r[2]*2,n[3]=r[3]*4;const i=Array(4);return i[0]=e[0]/2-e[2],i[1]=e[1]-e[3]*3,i[2]=e[2]*2,i[3]=e[3]*4,[n,i]}const Ei=[[1,0,0,0],[1,1,0,0],[1,2,1,0],[1,3,3,1]];function tg(){const[r,e]=eg(),n=Array(4);for(let i=0;i<4;i++){n[i]={x:0,y:0};for(let o=0;o<=i;o++)n[i].x+=Ei[i][o]*r[o]/Ei[3][o],n[i].y+=Ei[i][o]*e[o]/Ei[3][o]}return n}function rg(r,e,n,{startRadius:i=-1,endRadius:o=-1}={}){n=n*Kv;const s=r*e/2,a=s*Cn(n);i=i<a?a:i,o=o===-1?s+r:o;const c=Math.sqrt(o**2-a**2)/a,f=Math.sqrt(i**2-a**2)/a;return Yo=a,Xo=f,rl=c,tg()}function Ti(r){return Math.tan(r)-r}class ng extends Xu{constructor(n){super();vt(this,ge,void 0);vt(this,et,void 0);vt(this,dt,void 0);vt(this,Nr,void 0);vt(this,zr,void 0);vt(this,Hr,void 0);for(let i in n)this[i]=n[i];if(this.diametralPitch=25.4/this.module,this.CP=Math.PI/this.diametralPitch,this.b=this.width,this.alpha=new Qe(this.pressureAngle,"deg"),this.x=this.profileShift,this.V=this.x*this.module,this.c=this.headPlay*this.module,this.ha=this.module,this.hf=this.module+this.c,this.h=this.ha+this.hf,this.d=this.toothCount*this.module,this.da=this.module*(this.toothCount+2)+2*this.V,this.db=this.d*Math.cos(this.alpha.rad),this.df=this.d-2*this.hf+2*this.V,this.s=this.module*(Math.PI/2+2*this.x*Math.tan(this.alpha.rad)),this.sa=this.sy(this.da),this.sb=this.sy(this.db),this.e=this.module*(Math.PI/2-2*this.x*Math.tan(this.alpha.rad)),this.p=this.s+this.e,this.rhof=this.rootRadius*this.module-.001,this.jn=this.backlash*this.module,this.boreType=this.boreType??"none",this.descriptor=this.generateName(),this.sa<=0){xi("Tooth","Top of Tooth is single Point."),this.error=!0;return}switch(Ue(this,ge,this.createProfileBezier()),Ue(this,et,this.createBore()),this.toothType){case"straight":Ue(this,dt,this.extrudeStraight());break;case"helical":Ue(this,dt,this.extrudeHelical());break;case"doubleHelical":Ue(this,dt,this.extrudeDoubleHelical());break;default:Ue(this,dt,this.extrudeStraight());break}Ue(this,ge,Z(this,et)?Z(this,ge).cut(Z(this,et)):Z(this,ge))}generateName(){const n=this.toothType;let i="invSpur-";return i+=`T${this.toothCount}`,i+=n==="straight"?"S-":n==="helical"?"H-":"D-",i+=this.system==="system-metric"?`M${Bt(this.module)}-`:`DP${Bt(25.4/this.module)}-`,i+=`B${Bt(this.b)}-`,i+=`Deg${Bt(this.pressureAngle)}-`,i+=this.V!=0?`V${Bt(this.V)}-`:"",i+=Qu(),i}alphaY(n){return Math.acos(this.d*(Math.cos(this.alpha.rad)/n))}ey(n){return n*(this.e/this.d-Ti(this.alpha.rad)+Ti(this.alphaY(n)))}sy(n){return n*(this.s/this.d+Ti(this.alpha.rad)-Ti(this.alphaY(n)))}createProfileBezier(n=0){var S;const i="Create Profile";ye(i,0,this.toothCount),n=n>this.toothCount||n==0?this.toothCount:n;const o=2*Math.PI/this.toothCount,s=Qe.fromArc(this.db,this.sb-this.jn*(this.db/this.d)).rad;let a;{let E=Math.max(this.df,this.db+.001)/2;a=new _e(...rg(this.module,this.toothCount,this.pressureAngle,{startRadius:E,endRadius:this.da/2}).map(k=>[k.x,k.y]).flat()),a=qu(a,this.da).left;{const k=(S=qu(a,this.df))==null?void 0:S.right;k&&(a=k)}}let c=a.points.map(E=>[E.x,E.y]),f=[];for(let E=0;E<4;E++){let k=Je.fromCartesian(...c[E]),C=new Je(k.radius,s-k.angle.rad);f.unshift(C.toCartesian())}const p=new Array(9);p[0]=Je.fromCartesian(...c[0]),p[1]=Je.fromCartesian(...c.at(-1)),p[3]=Je.fromCartesian(...f[0]),p[2]=Je.arcMiddlePoint(p[1],p[3]),p[4]=Je.fromCartesian(...f.at(-1)),p[5]=new Je(this.df/2,p[4].angle),p[7]=new Je(this.df/2,p[0].angle.rad+o),p[6]=Je.arcMiddlePoint(p[5],p[7]),p[8]=new Je(p[0].radius,p[0].angle.rad+o);let v=ft([0,0]).lineTo(p[1].toCartesian());v=v.threePointsArcTo(p[3].toCartesian(),p[2].toCartesian()),v=v.cubicBezierCurveTo(f[3],f[1],f[2]),p[4].radius>p[5].radius&&(v=v.lineTo(p[5].toCartesian())),this.rhof==0?v=v.threePointsArcTo(p[7].toCartesian(),p[6].toCartesian()):v=v.customCorner(this.rhof,"fillet").lineTo(p[7].toCartesian()).customCorner(this.rhof,"fillet"),p[7].radius<p[8].radius&&(v=v.lineTo(p[8].toCartesian()));for(let E=0;E<4;E++){let k=Je.fromCartesian(...c[E]);c[E]=k.toCartesian(o)}if(v=v.cubicBezierCurveTo(c[3],c[1],c[2]),v=v.close(),n==1)return v;let y=v.clone();const g=360/this.toothCount;for(let E=1;E<n;E++)y=y.fuse(v.clone().rotate(E*g)),ye(i,E,this.toothCount);return ye(i,this.toothCount,this.toothCount),y}createBore(){let n=null,i=0;const o="Create Bore";switch(ye(o,0,1),this.boreType){case"round":n=Gv({diameter:this.boreDiameter}),i=this.boreDiameter;break;case"rect":n=Nv({width:this.boreWidth,height:this.boreHeight}),i=Math.sqrt(this.boreWidth**2+this.boreHeight**2);break;case"flat":n=zv({diameter:this.boreDiameter,diameterFlat:this.boreDiameterFlat}),i=this.boreDiameter;break;case"keyway":n=Hv({diameter:this.boreDiameter,width:this.boreKeyWidth,height:this.boreKeyHeight}),i=this.boreDiameter+this.boreKeyHeight*2;break;case"hex":n=Wv({edgeToEdge:this.boreEdgeToEdge}),i=this.boreEdgeToEdge/2/Math.cos(Qe.toRad*30)*2;break;default:n=null;break}return n&&i>=this.df&&(n=null,Wo("Error creating Bore","Bore to large")),ye(o,1,1),n}generateUndercut(){const n="Calculate undercut";ye(n,0,1);const i=20,o=this.module*Math.PI/2-2*(this.module/Math.tan(Math.PI/2-this.alpha.rad)),s=this.module*Math.PI/i;let a=[(this.d-2*this.module)/2,o/2];const c=2*Math.PI/this.toothCount/i,f=[];for(let p=0;p<=i*1;p++){let v=p*c,y=Je.fromCartesian(...a);y.angle.rad=y.angle.rad-v,f.push(y),a[1]+=s}return ye(n,1,1),f}extrudeStraight(){const n="Extrude";ye(n,0,this.b);const i=[0,0,1];return Ue(this,ge,Z(this,et)?Z(this,ge).cut(Z(this,et)):Z(this,ge)),ye(n,this.b,this.b),Z(this,ge).sketchOnPlane("XY").extrude(this.b,{extrusionDirection:i})}extrudeHelical(){const n="Extrude";ye(n,0,this.b);const i=[0,0,1],o=Qe.toDeg*this.b/(this.d/2*Math.tan(Qe.toRad*(90-this.helixAngle)))*(this.helixDirection=="left"?-1:1);this.boreType=="round"&&Ue(this,ge,Z(this,et)?Z(this,ge).cut(Z(this,et)):Z(this,ge));let s=Z(this,ge).sketchOnPlane("XY").extrude(this.b,{extrusionDirection:i,twistAngle:o});return this.boreType!="round"&&Z(this,et)&&(ye("Cut Bore",0,1),s=s.cut(Z(this,et).sketchOnPlane("XY").extrude(this.b,{extrusionDirection:i})),Ue(this,ge,Z(this,ge).cut(Z(this,et)))),ye(n,this.b,this.b),s}extrudeDoubleHelical(){const n="Extrude";ye(n,0,this.b);const i=[0,0,1],o=this.b/2,s=Qe.toDeg*o/(this.d/2*Math.tan(Qe.toRad*(90-this.doubleHelixAngle)))*(this.helixDirection=="left"?-1:1),a=s>5?.5:2,c=o/Math.floor(o/a),f=s/Math.floor(o/a),p=Z(this,ge).rotate(s).sketchOnPlane(Et("XY").translate(0,0,o)),v=Z(this,ge).sketchOnPlane("XY"),y=[];for(let E=1;E*c<o;E++)y.push(Z(this,ge).rotate(E*f).sketchOnPlane(Et("XY").translate(0,0,E*c))),ye(n,E*c,this.b);const g=[];for(let E=1;E*c<o;E++)g.push(Z(this,ge).rotate(s-E*f).sketchOnPlane(Et("XY").translate(0,0,o+E*c))),ye(n,o+E*c,this.b);g.push(Z(this,ge).sketchOnPlane(Et("XY").translate(0,0,o*2)));let S=v.loftWith([...y,p,...g]);return Z(this,et)&&(ye("Cut Bore",0,1,!0),S=S.cut(Z(this,et).sketchOnPlane("XY").extrude(this.b,{extrusionDirection:i})),Ue(this,ge,Z(this,ge).cut(Z(this,et)))),ye(n,this.b,this.b),S.simplify()}replicadRepresentation(){return Z(this,dt)||Ue(this,dt,this.createGeometry()),this.replicadRepresentation}get svgPath(){let n=Z(this,ge).toSVGPaths();return n instanceof Array&&(n=n.join("")),[Z(this,ge).toSVGViewBox(),n]}get svgFile(){let n=Z(this,ge).toSVGPaths();return n instanceof Array&&(n=n.join("")),Ju([Z(this,ge).toSVGViewBox(),n])}get stlPreview(){if(!Z(this,zr)){const n=Br(Z(this,dt),"stl","low");return n.then(i=>Ue(this,zr,i)),n}return Promise.resolve(Z(this,zr))}get stlFile(){if(!Z(this,Nr)){const n=Br(Z(this,dt),"stl","high");return n.then(i=>Ue(this,Nr,i)),n}return Promise.resolve(Z(this,Nr))}get stepFile(){if(!Z(this,Hr)){const n=Br(Z(this,dt),"step");return n.then(i=>Ue(this,Hr,i)),n}return Promise.resolve(Z(this,Hr))}}ge=new WeakMap,et=new WeakMap,dt=new WeakMap,Nr=new WeakMap,zr=new WeakMap,Hr=new WeakMap;class ig extends Xu{constructor(n){super();vt(this,sr,void 0);vt(this,Gt,void 0);vt(this,Wr,void 0);vt(this,Vr,void 0);vt(this,$r,void 0);for(let R in n)this[R]=n[R];if(this.diametralPitch=25.4/this.module,this.CP=Math.PI/this.diametralPitch,this.b=this.width,this.pressureAngle=this.pressureAngle||.001,this.alpha=new Qe(this.pressureAngle,"deg"),this.toothType=="helical"?this.beta=new Qe(this.helixAngle,"deg"):this.toothType=="doubleHelical"&&(this.beta=new Qe(this.doubleHelixAngle,"deg")),this.jn=Number(this.backlash)*this.module,this.c=this.headPlay*this.module,this.ha=this.module,this.hf=this.module+this.c,this.h=this.ha+this.hf,this.s=this.module*(Math.PI/2)-this.jn,this.sa=this.module*Math.PI/2-2*(this.module/Math.tan(Math.PI/2-this.alpha.rad))-this.jn,this.e=this.module*(Math.PI/2)+this.jn,this.p=this.s+this.e,this.bottomHeight=this.bottomHeight<=0?.001:this.bottomHeight,this.rhof=this.c?this.rootRadius*this.module-.001:0,this.descriptor=this.generateName(),this.c>=this.bottomHeight){xi("Headplay","Headplay bigger than Base Body"),this.error=!0;return}if(this.sa<0){xi("Backlash","Backlash bigger than Tooth."),this.error=!0;return}const i=Math.min(Math.floor(this.toothCount/2),10),o=2*this.module,s=o/Math.tan(Math.PI/2-this.alpha.rad);this.sb=2*s+this.sa,this.sb<=0&&xi("HeadPlay","HeadPlay too high for Pressure Angle");const a=[];a[0]=[0,0],a[1]=[s,o],a[2]=[s+this.sa,o],a[3]=[this.sb,0],a[4]=[this.sb,-this.bottomHeight],a[5]=[0,-this.bottomHeight];const c=[];if(c[0]=[this.sb,0],c[3]=[this.p,0],c[4]=[this.p,-this.bottomHeight],c[5]=[this.sb,-this.bottomHeight],this.c>0){const R=this.c/Math.tan(Math.PI/2-this.alpha.rad),O=-this.c;c[1]=[this.sb+R,O],c[2]=[this.p-R,O]}let f="Create Teethprofile",p=ft(a[0]);for(let R=1;R<a.length;R++)p=p.lineTo(a[R]);p=p.close();let v;if(this.rhof==0){v=ft(c[0]);for(let R=1;R<c.length;R++)c[R]&&(v=v.lineTo(c[R]))}else{let R=this.c/(1-Math.sin(this.alpha.rad));if(this.rhof>R){Wo("Root Tooth Fillet","Maximum possible Tooth Root Fillet exceeded.");const O=this.filletLengths(this.rhof,c[3][0]-c[0][0]),q=O[0],D=O[1],K=O[2],H=[c[0][0]+(c[3][0]-c[0][0])/2,-K-this.rhof];v=ft(c[0]).lineTo([c[0][0]+D,c[0][1]-q]).threePointsArcTo([c[3][0]-D,c[3][1]-q],H).lineTo(c[3]).lineTo(c[4]).lineTo(c[5])}else v=ft(c[0]),v=v.lineTo(c[1]).customCorner(this.rhof,"fillet").lineTo(c[2]).customCorner(this.rhof,"fillet").lineTo(c[3]).lineTo(c[4]).lineTo(c[5])}v=v.close();const y=p.clone().fuse(v);let g=y.clone(),S=1;for(S;S<Math.min(this.toothCount-1,i);S++){ye(f,S,this.toothCount);let R=y.clone().translate(this.p*S,0);g=g.fuse(R)}if(this.toothCount>S+1){let R=g.clone();for(S;S+1+i<this.toothCount;S+=i)g=g.fuse(R.clone().translate(this.p*S,0)),ye(f,S,this.toothCount);for(S;S+1<this.toothCount;S++){let O=y.clone().translate(this.p*S,0);g=g.fuse(O),ye(f,S,this.toothCount)}}if(g=g.fuse(p.translate(this.p*S,0)),ye(f,this.toothCount,this.toothCount),this.extendRackBody==="yes"){const R=c[0][0]+(c[3][0]-c[0][0])/2,O=c[4][1]-c[3][1];let q=ft(c[0]).lineTo([R,c[0][1]]).lineTo([R,O]).lineTo([c[0][0],O]).close(),D=ft(c[3]).lineTo([R,c[3][1]]).lineTo([R,O]).lineTo([c[3][0],O]).close();const K=g.boundingBox.bounds[1][0],H=g.boundingBox.bounds[0][0];let V=v.clone().intersect(q),ee=ft(c[0]).line(-.1,0).line(0,-this.bottomHeight).line(.1,0).line(0,+this.bottomHeight).close();V=V.fuse(ee).translate(K-c[0][0],0);let te=v.clone().intersect(D),pe=ft(c[3]).line(.1,0).line(0,-this.bottomHeight).line(-.1,0).line(0,+this.bottomHeight).close();te=te.fuse(pe).translate(H-c[3][0],0),g=g.fuse(V).fuse(te)}f="Extrude",ye(f,0,this.b,!0);const E=this.toothType=="doubleHelical"?this.b/2:this.b,k=this.toothType=="straight"?0:-E/Math.tan(Math.PI/2-this.beta.rad)*(this.helixDirection=="left"?1:-1);let C=g.clone();(this.toothType=="helical"||this.toothType=="doubleHelical")&&(C=C.translate(k,0)),ye(f,E,this.b,!0),C=C.sketchOnPlane(new nt([0,0,E],[1,0,0],[0,0,1]));let P=g.sketchOnPlane("XY").loftWith(C);if(this.toothType=="doubleHelical"&&(P=P.fuse(P.clone().mirror(new nt([0,0,E],[1,0,0],[0,0,1])),{optimisation:"commonFace"}),ye(f,this.b,this.b,!0)),P=P.translate(-P.boundingBox.center[0],0,0),g=g.translate(-g.boundingBox.center[0],0),this.extendRackBody!=="yes"&&this.toothType!=="straight"){f="Create Body",ye(f,0,1);let R=Mu(P.boundingBox.width,this.bottomHeight-this.c).translate(0,(-this.bottomHeight-this.c)/2);P=P.fuse(R.clone().sketchOnPlane("XY").extrude(this.b)),g=g.fuse(R),ye(f,1,1)}Ue(this,sr,g.rotate(180)),Ue(this,Gt,P.rotate(180))}filletLengths(n,i){const o=Math.cos(this.alpha.rad)*n,s=Math.sin(this.alpha.rad)*n,a=(i/2-o)/Math.tan(this.alpha.rad);return[a,i/2-o,a-s]}generateName(){const n=this.toothType;let i="invRack-";return i+=`T${this.toothCount}`,i+=n==="straight"?"S-":n==="helical"?"H-":"D-",i+=this.system==="system-metric"?`M${Bt(this.module)}-`:`DP${Bt(25.4/this.module)}-`,i+=`B${Bt(this.b)}-`,i+=`Deg${Bt(this.pressureAngle)}-`,i+=Qu(),i}get replicadRepresentation(){return Z(this,Gt)||this.createGeometry(),Z(this,Gt)}get svgPath(){let n=Z(this,sr).toSVGPaths();return n instanceof Array&&(n=n.join("")),[Z(this,sr).toSVGViewBox(),n]}get svgFile(){let n=Z(this,sr).toSVGPaths();return n instanceof Array&&(n=n.join("")),Ju([Z(this,sr).toSVGViewBox(),n])}get stlPreview(){if(!Z(this,Vr)){const n=Br(Z(this,Gt),"stl","low");return n.then(i=>Ue(this,Vr,i)),n}return Promise.resolve(Z(this,Vr))}get stlFile(){if(!Z(this,Wr)){const n=Br(Z(this,Gt),"stl","high");return n.then(i=>Ue(this,Wr,i)),n}return Promise.resolve(Z(this,Wr))}get stepFile(){if(!Z(this,$r)){const n=Br(Z(this,Gt),"step");return n.then(i=>Ue(this,$r,i)),n}return Promise.resolve(Z(this,$r))}}sr=new WeakMap,Gt=new WeakMap,Wr=new WeakMap,Vr=new WeakMap,$r=new WeakMap;const og={"involute-spur":{bore:!0,mount:!0,constructor:ng,toothTypes:["straight","helical","doubleHelical"],parameters:["toothCount","module","width","pressureAngle","profileShift","rootRadius","backlash","headPlay","undercut","filletStrategy"]},"involute-rack":{bore:!1,mount:!1,constructor:ig,toothTypes:["straight","helical","doubleHelical"],parameters:["toothCount","module","width","bottomHeight","pressureAngle","rootRadius","backlash","headPlay","extendRackBody","filletStrategy"]}};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nl=Symbol("Comlink.proxy"),sg=Symbol("Comlink.endpoint"),ag=Symbol("Comlink.releaseProxy"),qo=Symbol("Comlink.finalizer"),ki=Symbol("Comlink.thrown"),il=r=>typeof r=="object"&&r!==null||typeof r=="function",ug={canHandle:r=>il(r)&&r[nl],serialize(r){const{port1:e,port2:n}=new MessageChannel;return jo(r,e),[n,[n]]},deserialize(r){return r.start(),hg(r)}},lg={canHandle:r=>il(r)&&ki in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},ol=new Map([["proxy",ug],["throw",lg]]);function cg(r,e){for(const n of r)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function jo(r,e=globalThis,n=["*"]){e.addEventListener("message",function i(o){if(!o||!o.data)return;if(!cg(n,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:s,type:a,path:c}=Object.assign({path:[]},o.data),f=(o.data.argumentList||[]).map(mr);let p;try{const v=c.slice(0,-1).reduce((g,S)=>g[S],r),y=c.reduce((g,S)=>g[S],r);switch(a){case"GET":p=y;break;case"SET":v[c.slice(-1)[0]]=mr(o.data.value),p=!0;break;case"APPLY":p=y.apply(v,f);break;case"CONSTRUCT":{const g=new y(...f);p=mg(g)}break;case"ENDPOINT":{const{port1:g,port2:S}=new MessageChannel;jo(r,S),p=gg(g,[g])}break;case"RELEASE":p=void 0;break;default:return}}catch(v){p={value:v,[ki]:0}}Promise.resolve(p).catch(v=>({value:v,[ki]:0})).then(v=>{const[y,g]=Mi(v);e.postMessage(Object.assign(Object.assign({},y),{id:s}),g),a==="RELEASE"&&(e.removeEventListener("message",i),sl(e),qo in r&&typeof r[qo]=="function"&&r[qo]())}).catch(v=>{const[y,g]=Mi({value:new TypeError("Unserializable return value"),[ki]:0});e.postMessage(Object.assign(Object.assign({},y),{id:s}),g)})}),e.start&&e.start()}function fg(r){return r.constructor.name==="MessagePort"}function sl(r){fg(r)&&r.close()}function hg(r,e){return Zo(r,[],e)}function Ci(r){if(r)throw new Error("Proxy has been released and is not useable")}function al(r){return Gr(r,{type:"RELEASE"}).then(()=>{sl(r)})}const Pi=new WeakMap,Ai="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{const e=(Pi.get(r)||0)-1;Pi.set(r,e),e===0&&al(r)});function pg(r,e){const n=(Pi.get(e)||0)+1;Pi.set(e,n),Ai&&Ai.register(r,e,r)}function dg(r){Ai&&Ai.unregister(r)}function Zo(r,e=[],n=function(){}){let i=!1;const o=new Proxy(n,{get(s,a){if(Ci(i),a===ag)return()=>{dg(o),al(r),i=!0};if(a==="then"){if(e.length===0)return{then:()=>o};const c=Gr(r,{type:"GET",path:e.map(f=>f.toString())}).then(mr);return c.then.bind(c)}return Zo(r,[...e,a])},set(s,a,c){Ci(i);const[f,p]=Mi(c);return Gr(r,{type:"SET",path:[...e,a].map(v=>v.toString()),value:f},p).then(mr)},apply(s,a,c){Ci(i);const f=e[e.length-1];if(f===sg)return Gr(r,{type:"ENDPOINT"}).then(mr);if(f==="bind")return Zo(r,e.slice(0,-1));const[p,v]=ul(c);return Gr(r,{type:"APPLY",path:e.map(y=>y.toString()),argumentList:p},v).then(mr)},construct(s,a){Ci(i);const[c,f]=ul(a);return Gr(r,{type:"CONSTRUCT",path:e.map(p=>p.toString()),argumentList:c},f).then(mr)}});return pg(o,r),o}function vg(r){return Array.prototype.concat.apply([],r)}function ul(r){const e=r.map(Mi);return[e.map(n=>n[0]),vg(e.map(n=>n[1]))]}const ll=new WeakMap;function gg(r,e){return ll.set(r,e),r}function mg(r){return Object.assign(r,{[nl]:!0})}function Mi(r){for(const[e,n]of ol)if(n.canHandle(r)){const[i,o]=n.serialize(r);return[{type:"HANDLER",name:e,value:i},o]}return[{type:"RAW",value:r},ll.get(r)||[]]}function mr(r){switch(r.type){case"HANDLER":return ol.get(r.name).deserialize(r.value);case"RAW":return r.value}}function Gr(r,e,n){return new Promise(i=>{const o=yg();r.addEventListener("message",function s(a){!a.data||!a.data.id||a.data.id!==o||(r.removeEventListener("message",s),i(a.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:o},e),n)})}function yg(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}let Ko=!1,Pn=null;function wg(){const r=`Opencascade Loaded: ${Ko}, Model: ${Pn!=null}`;postMessage({type:"Status",status:r})}function bg(r){const e=og[r.gearType];Pn=new e.constructor(r),Pn.error||postMessage({type:"Model",model:Pn})}function Sg(r){switch(r=r.data,r.type){case"status":wg();break;case"create":bg(r.data);break}}async function xg(){if(Ko)return Promise.resolve(!0);const r=await De({locateFile:()=>Pe});return Gn(r),Ko=!0,!0}function _g(r){return Pn[r]}jo(_g),xg().then(()=>{postMessage({type:"Ready"})}).catch(r=>console.error(r)),onmessage=Sg})();
